import{e as D}from"./chunk-VE7GAG7N.js";import{B as Z,Sa as M,Ta as H,Ua as U,Ub as et,Va as w,Wa as _,Xa as k,Za as T,db as tt,jc as v,mc as N}from"./chunk-7ONBG64W.js";import{a as ct}from"./chunk-4LXUHWEL.js";import{Ba as X,C as x,E as f,J as i,K as E,Ua as L,ja as Q}from"./chunk-TV2KLZD5.js";import{v as R}from"./chunk-WN3YRVO4.js";import{D as j,Tb as J,Ya as q,nb as $,p as V,x as I}from"./chunk-FSPAMUWJ.js";import{g as at,h as lt,j as A}from"./chunk-NZGOIL2E.js";A();var dt={};at(dt,{DateAgoPipe:()=>P});A();var nt={years:T,months:w*30,weeks:_,days:w,hr:U,min:H,sec:M},P=(()=>{class e{constructor(n){this.translate=n}transform(n,r){if(n){let s=!!r?.applyAgo,o=!!r?.short,l=!!r?.textPart,c=Math.floor(+new Date-+new Date(n));if(c<29*M)return this.translate.instant(l?"timewindow.just-now-lower":"timewindow.just-now");let a;for(let u in nt)if(a=Math.floor(c/nt[u]),a>0){let d=this.translate.instant(`timewindow.${u+(o?"-short":"")}`,{[u]:a});return s&&(d+=" "+this.translate.instant("timewindow.ago")),d}}return""}static{this.\u0275fac=function(r){return new(r||e)(J(D,16))}}static{this.\u0275pipe=q({name:"dateAgo",type:e,pure:!0})}}return e})();var rt=lt(ct());var ft=["px","em","%","rem","pt","pc","in","cm","mm","ex","ch","vw","vh","vmin","vmax"],jt=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],qt=new Map([["normal","widgets.widget-font.font-weight-normal"],["bold","widgets.widget-font.font-weight-bold"],["bolder","widgets.widget-font.font-weight-bolder"],["lighter","widgets.widget-font.font-weight-lighter"]]),$t=["normal","italic","oblique"],Jt=new Map([["normal","widgets.widget-font.font-style-normal"],["italic","widgets.widget-font.font-style-italic"],["oblique","widgets.widget-font.font-style-oblique"]]),Qt=["Roboto","monospace","sans-serif","serif"],p=function(e){return e.constant="constant",e.latestKey="latestKey",e.entity="entity",e}(p||{}),Xt=Object.keys(p),Zt=new Map([[p.constant,"widgets.value-source.type-constant"],[p.latestKey,"widgets.value-source.type-latest-key"],[p.entity,"widgets.value-source.type-entity"]]),m=function(e){return e.constant="constant",e.gradient="gradient",e.range="range",e.function="function",e}(m||{}),_t=new Map([[m.constant,"widgets.color.color-type-constant"],[m.gradient,"widgets.color.color-type-gradient"],[m.range,"widgets.color.color-type-range"],[m.function,"widgets.color.color-type-function"]]),mt=(e,t)=>i(e.from)&&i(e.to)?i(t.from)&&i(t.to)?t.from>=e.from&&t.to<e.to:!1:i(e.from)?i(t.from)?t.from>=e.from:!1:i(e.to)&&i(t.to)?t.to<e.to:!1,kt=e=>{let t=[...Array.isArray(e)?e:e.range],n=!0;for(;n;){let r=-1;for(let s=0;s<t.length;s++){let o=t[s];if(t.some((l,c)=>c!==s&&mt(l,o))){r=s;break}}r>-1?t.splice(r,1):n=!1}return t},te=e=>e?[...e].sort((t,n)=>i(t.from)&&i(t.to)&&i(n.from)&&i(n.to)?n.from>=t.from&&n.to<t.to?1:t.from>=n.from&&t.to<n.to?-1:t.from-n.from:i(t.from)&&i(n.from)?t.from-n.from:i(t.to)&&i(n.to)?t.to-n.to:i(t.from)&&x(n.from)?1:x(t.from)&&i(n.from)?-1:i(t.to)&&x(n.to)?1:x(t.to)&&i(n.to)?-1:0):[],ee={showIcon:!0,icon:"query_builder",iconSize:"24px",iconPosition:"left",displayTypePrefix:!0},pt=e=>({type:m.constant,color:e,colorFunction:ot}),ne=(e,t,n,r)=>({type:m.gradient,color:e,colorFunction:ot,gradient:{advancedMode:!1,gradient:t,minValue:f(n)?n:0,maxValue:f(r)?r:100}}),re=(e,t)=>({advancedMode:!1,gradient:["rgba(0, 255, 0, 1)","rgba(255, 0, 0, 1)"],gradientAdvanced:[{source:{type:p.constant},color:"rgba(0, 255, 0, 1)"},{source:{type:p.constant},color:"rgba(255, 0, 0, 1)"}],minValue:f(e)?e:0,maxValue:f(t)?t:100}),oe=()=>({advancedMode:!1,range:[],rangeAdvanced:[]}),gt=(e,t,n)=>{f(e.gradient)&&(f(t)&&(e.gradient.minValue=t),f(n)&&(e.gradient.maxValue=n))},ot=`var temperature = value;
if (typeof temperature !== undefined) {
  var percent = (temperature + 60)/120 * 100;
  return tinycolor.mix('blue', 'red', percent).toHexString();
}
return 'blue';`,yt=(e,t)=>(f(e)?e+"":"0")+(t||"px"),ht=e=>{if(!e||!e.trim().length)return[null,"px"];let t,n=e,r=e.match(new RegExp(`(${ft.join("|")})$`));r&&(t=r[0]),t&&(n=e.substring(0,e.length-t.length)),t=t||"px";let s=null;return E(n)&&(s=Number(n)),[s,t]},se=e=>{let t=ht(e);if(t[0]&&t[1])return yt(t[0],t[1])},b=class e{static fromSettings(t,n){return e.fromColorProcessorSettings({settings:t,ctx:n})}static fromColorProcessorSettings(t){let n=t.settings||pt(null);switch(n.type){case m.constant:return new F(n);case m.range:return new B(n,t.ctx);case m.function:return new O(n);case m.gradient:return gt(n,t.minGradientValue,t.maxGradientValue),new C(n,t.ctx);default:return new F(n)}}constructor(t){this.settings=t,this.color=t.color}destroy(){}},F=class extends b{constructor(t){super(t),this.settings=t}update(t){}},O=class extends b{constructor(t){super(t),this.settings=t,this.colorFunction=X(t.colorFunction,["value"])}update(t){this.colorFunction&&(this.color=this.colorFunction(t)||this.settings.color)}},K=class extends b{constructor(t,n){super(t),this.settings=t,this.ctx=n,this.colorUpdated=new $,this.advancedMode=this.getCurrentConfig()?.advancedMode,this.advancedMode&&Ut(this.ctx,this.datasourceConfigs(),this.onDataUpdated.bind(this)).subscribe(r=>{this.sourcesSubscription=r})}update(t){this.advancedMode&&(this.currentValue=t)}destroy(){this.sourcesSubscription&&this.ctx.subscriptionApi.removeSubscription(this.sourcesSubscription.id),this.colorUpdated.complete(),this.colorUpdated.unsubscribe(),this.colorUpdated=null}onDataUpdated(t){this.updatedAdvancedData(t.data),this.currentValue&&(this.update(this.currentValue),this.colorUpdated.emit())}},B=class e extends K{constructor(t,n){super(t,n),this.settings=t,this.ctx=n}update(t){super.update(t),this.color=this.computeFromRange(t)}updatedAdvancedData(t){for(let n of t)if(n&&n.data&&n.data[0]){let r=n.data[0][1];if(isFinite(r))for(let s of n.dataKey.settings.indexes){let o=Math.floor(s/2);o===s/2?this.settings.rangeList.rangeAdvanced[o].from.value=r:this.settings.rangeList.rangeAdvanced[o].to.value=r}}}datasourceConfigs(){let t=[];for(let n of this.settings.rangeList.rangeAdvanced)n.from&&t.push(n.from),n.to&&t.push(n.to);return t}getCurrentConfig(){return this.settings.rangeList}computeFromRange(t){let n=this.settings.rangeList,r=!1;if(f(this.settings.rangeList?.advancedMode)&&(r=this.settings.rangeList.advancedMode,n=r?this.settings.rangeList.rangeAdvanced:this.settings.rangeList.range),n?.length&&f(t)&&E(t)){let s=Number(t);for(let o of n){if(r?e.constantAdvancedRange(o)&&o.from.value===s:e.constantRange(o)&&o.from===s)return o.color;if(r?(!i(o.from.value)||s>=o.from.value)&&(!i(o.to.value)||s<o.to.value):(!i(o.from)||s>=o.from)&&(!i(o.to)||s<o.to))return o.color}}return this.settings.color}static constantRange(t){return i(t.from)&&i(t.to)&&t.from===t.to}static constantAdvancedRange(t){return i(t.from.value)&&i(t.to.value)&&t.from.value===t.to.value}},C=class extends K{constructor(t,n){super(t,n),this.settings=t,this.ctx=n,this.minValue=f(t.gradient.minValue)?t.gradient.minValue:0,this.maxValue=f(t.gradient.maxValue)?t.gradient.maxValue:100}update(t){let n=this.calculateProgress(+t,this.minValue,this.maxValue);super.update(n),this.color=this.getGradientColor(n,this.advancedMode?this.settings.gradient.gradientAdvanced:this.settings.gradient.gradient)}updatedAdvancedData(t){for(let n of t)if(n&&n.data&&n.data[0]){let r=n.data[0][1];if(isFinite(r))for(let s of n.dataKey.settings.indexes)this.settings.gradient.gradientAdvanced[s].source.value=r}}datasourceConfigs(){let t=[];for(let n of this.settings.gradient.gradientAdvanced)t.push(n.source);return t}getCurrentConfig(){return this.settings.gradient}calculateProgress(t,n,r){return t<n?0:t>r?1:(t-n)/(r-n)}getGradientColor(t,n){let r=n.length,s=r>1?1/(r-1):1,o=[];if(n.forEach((l,c)=>{let a=typeof l=="string"?l:l.color;if(a!==null){let u=L(a);o.push({pct:typeof l!="string"?this.calculateProgress(+l.source.value,this.minValue,this.maxValue):s*c,color:u.toRgb(),alpha:u.getAlpha(),rgbString:u.toRgbString()})}}),t===0||o.length===1)return o[0].rgbString;for(let l=1;l<o.length;l++)if(t<=o[l].pct){let c=o[l-1],a=o[l],u=a.pct-c.pct,d=(t-c.pct)/u,g=1-d,h=d;return L({r:Math.floor(c.color.r*g+a.color.r*h),g:Math.floor(c.color.g*g+a.color.g*h),b:Math.floor(c.color.b*g+a.color.b*h),a:(c.alpha+a.alpha)/2}).toRgbString()}return o[o.length-1].rgbString}},ie=["year","month","day","hour","minute","second","millisecond"],ae=new Map([["year","date.unit-year"],["month","date.unit-month"],["day","date.unit-day"],["hour","date.unit-hour"],["minute","date.unit-minute"],["second","date.unit-second"],["millisecond","date.unit-millisecond"]]),xt=e=>({format:e,lastUpdateAgo:!1,custom:!1,auto:!1}),Mt=()=>({format:null,lastUpdateAgo:!0,custom:!1,auto:!1}),wt=e=>({format:e,lastUpdateAgo:!1,custom:!0,auto:!1}),vt={millisecond:"MMM dd yyyy HH:mm:ss.SSS",second:"MMM dd yyyy HH:mm:ss",minute:"MMM dd yyyy HH:mm",hour:"MMM dd yyyy HH:mm",day:"MMM dd yyyy",month:"MMM yyyy",year:"yyyy"},bt=()=>({format:null,lastUpdateAgo:!1,custom:!1,auto:!0,autoDateFormatSettings:{}}),St=["MMM yyyy","MMM dd yyyy","MMM dd yyyy HH:mm","dd MMM yyyy HH:mm","dd MMM yyyy HH:mm:ss","yyyy MMM dd HH:mm","MM/dd/yyyy HH:mm","dd/MM/yyyy HH:mm","MMM dd yyyy HH:mm:ss","yyyy/MM/dd HH:mm:ss","yyyy-MM-dd HH:mm:ss","MMM dd yyyy HH:mm:ss.SSS","yyyy-MM-dd HH:mm:ss.SSS"].map(e=>xt(e)).concat([Mt(),wt("EEE, MMMM dd, yyyy")]),le=[bt()].concat(St),ce=(e,t)=>{if(e===t)return!0;if(e&&t){if(e.lastUpdateAgo&&t.lastUpdateAgo)return!0;if(e.custom&&t.custom)return!0;if(e.auto&&t.auto&&!e.custom&&!t.custom)return!0;if(!e.lastUpdateAgo&&!t.lastUpdateAgo&&!e.custom&&!t.custom&&!e.auto&&!t.auto)return e.format===t.format}return!1},S=class{static fromSettings(t,n){return n.lastUpdateAgo?new G(t,n):n.auto&&!n.custom?new W(t,n):new Y(t,n)}constructor(t,n){this.$injector=t,this.settings=n,this.formatted="&nbsp;"}},Y=class extends S{constructor(t,n){super(t,n),this.$injector=t,this.settings=n,this.datePipe=t.get(R)}update(t){return t?this.formatted=this.datePipe.transform(t,this.settings.format):this.formatted="&nbsp;",this.formatted}},G=class extends S{constructor(t,n){super(t,n),this.$injector=t,this.settings=n,this.dateAgoPipe=t.get(P),this.translate=t.get(D)}update(t){if(t){let n=this.dateAgoPipe.transform(t,{applyAgo:!0,short:!0,textPart:!0});this.settings.hideLastUpdatePrefix?this.formatted=n:this.formatted=this.translate.instant("date.last-update-n-ago-text",{agoText:n})}else this.formatted="&nbsp;";return this.formatted}},W=class extends S{constructor(t,n){super(t,n),this.$injector=t,this.settings=n,this.datePipe=t.get(R),this.autoDateFormatSettings=Q({},vt,this.settings.autoDateFormatSettings)}update(t,n){if(t){let r=n?At(n):Dt(t),s=this.autoDateFormatSettings[r];s?this.formatted=this.datePipe.transform(t,s):this.formatted="&nbsp;"}else this.formatted="&nbsp;";return this.formatted}},At=e=>{let t=tt.numberValue(e);return t<M?"millisecond":t<H?"second":t<U?"minute":t<w?"hour":t<k?"day":t<T?"month":"year"},Dt=e=>{let t=(0,rt.default)(e),n=t.month()+1,r=t.date(),s=t.hours(),o=t.minutes(),l=t.seconds(),a=t.milliseconds()===0,u=a&&l===0,d=u&&o===0,g=d&&s===0,h=g&&r===1;return h&&n===1?"year":h?"month":g?"day":d?"hour":u?"minute":a?"second":"millisecond"},y=function(e){return e.image="image",e.color="color",e}(y||{}),ue=new Map([[y.image,"widgets.background.background-type-image"],[y.color,"widgets.background.background-type-color"]]),de=e=>!!(e&&e.type&&e.overlay&&e.overlay.color),fe=e=>({type:y.color,color:e,overlay:{enabled:!1,color:"rgba(255,255,255,0.72)",blur:3}}),me=(e,t="px")=>{let n=typeof e=="number"?e+t:e;return{width:n,minWidth:n,height:n,fontSize:n,lineHeight:n}},pe=(e,t="normal")=>{let n={letterSpacing:t};return e?.style&&(n.fontStyle=e.style),e?.weight&&(n.fontWeight=e.weight),e?.lineHeight&&(n.lineHeight=e.lineHeight),e?.size&&(n.fontSize=e.size+(e.sizeUnit||"px")),e?.family&&(n.fontFamily=e.family+(e.family!=="Roboto"?", Roboto":"")),n},ge=(e,t="normal")=>{let n={letterSpacing:t};return e?.style&&(n["font-style"]=e.style),e?.weight&&(n["font-weight"]=e.weight),e?.lineHeight&&(n["line-height"]=e.lineHeight),e?.size&&(n["font-size"]=e.size+(e.sizeUnit||"px")),e?.family&&(n["font-family"]=e.family+(e.family!=="Roboto"?", Roboto":"")),n},ye=e=>Object.entries(e).map(([t,n])=>`${t}: ${n}`).join("; "),he=e=>!!e&&!!e.style&&!!e.weight&&!!e.size&&!!e.family,xe=e=>!!e&&(!!e.style||!!e.weight||!!e.size||!!e.family),Ht=e=>(e&&(e.type===y.image&&e.imageBase64&&(e.imageUrl=e.imageBase64),e.type==="imageUrl"&&(e.type=y.image),delete e.imageBase64),e),Me=(e,t,n,r=!1)=>{if(e=Ht(e),e.type===y.color)return I({background:e.color});{let s=e.imageUrl;return s?t.transform(s,{asString:!0,ignoreLoadingImage:!0,preview:r}).pipe(j(o=>({background:n.bypassSecurityTrustStyle(`url(${o}) no-repeat 50% 50% / cover`)}))):I({})}},we=e=>({display:e.enabled?"block":"none",background:e.color,backdropFilter:`blur(${e.blur}px)`}),st=(e,t=0)=>{if(e&&e.length){let n=e[0].dataKeys;if(n&&n.length>t)return n[t]}return null},ve=(e,t)=>{e&&e.length&&(e[0].dataKeys=t)},be=(e,t)=>{if(e&&e.length){let n=e[0].dataKeys;if(n&&n.length)return n.find(r=>r.label===t)}return null},Se=(e,t,n)=>{if(e&&e.length){let r=e[0].dataKeys;r||(r=[],e[0].dataKeys=r);let s=r.findIndex(o=>o.label===n||o===t);t?(t.label=n,s>-1?r[s]=t:r.push(t)):s>-1&&r.splice(s,1)}},Ae=e=>{if(e&&e.length){let t=e[0];if(t?.type===v.device)return{type:N.device,deviceId:t?.deviceId};if(t?.type===v.entity)return{type:N.entity,entityAliasId:t?.entityAliasId}}return null},De=e=>{if(e&&e.length){let t=e[0].alarmFilterConfig;if(t)return t}return{statusList:[Z.ACTIVE]}},He=(e,t)=>{t&&t.length&&(t[0].alarmFilterConfig=e)},Ue=e=>{let t=st(e);return t?t.label:""},Te=(e,t)=>{let n=st(t);n&&(n.label=e)},Fe=e=>{if(e.length){let t=e[0];if(t.data.length)return t.data[0]}return null},Ke=(e,t)=>{if(e.length){let n=e.find(r=>r.dataKey===t);if(n?.data?.length)return n.data[0]}return null},Ve=e=>{if(e.length){let t=e[0];if(t.data.length)return t.data[t.data.length-1]}return null},Ut=(e,t,n)=>{let r=[],s=0;return t.forEach(o=>{if(o.type!==p.constant)try{r=Tt(e,r,o,s)}catch{return}s++}),r.length?Ft(e,r,n):V},Tt=(e,t,n,r)=>(n.type===p.latestKey?e.datasources.length&&f(e.datasources[0].aliasName)?t=z(e,n,e.datasources[0].aliasName,t,r,!0):t=z(e,n,"",t,r,!0):n.type===p.entity&&(t=z(e,n,n.entityAlias,t,r,!1)),t),z=(e,t,n,r,s,o)=>{let l=[s],c=e.aliasController.getEntityAliasId(n),a=r.find(d=>n?d.entityAliasId===c:d.deviceId===e.datasources[0].deviceId),u={type:o?t.latestKeyType:t.entityKeyType,name:o?t.latestKey:t.entityKey,label:o?t.latestKey:t.entityKey,settings:{indexes:l}};if(a){let d=a.dataKeys.find(g=>g.name===(o?t.latestKey:t.entityKey));d?d.settings.indexes.push(s):a.dataKeys.push(u)}else n?a={type:v.entity,name:n,aliasName:n,entityAliasId:c,dataKeys:[u]}:a={type:v.device,name:e.datasources[0].name,deviceName:e.datasources[0].name,deviceId:e.datasources[0].deviceId,dataKeys:[u]},r.push(a);return r},Ft=(e,t,n)=>{if(!t.length)return V;let r={datasources:t,useDashboardTimewindow:!1,type:et.latest,callbacks:{onDataUpdated:n}};return e.subscriptionApi.createSubscription(r,!0)};export{P as a,dt as b,ft as c,jt as d,qt as e,$t as f,Jt as g,Qt as h,p as i,Xt as j,Zt as k,m as l,_t as m,mt as n,kt as o,te as p,ee as q,pt as r,ne as s,re as t,oe as u,ot as v,yt as w,ht as x,se as y,b as z,K as A,ie as B,ae as C,xt as D,Mt as E,wt as F,vt as G,bt as H,St as I,le as J,ce as K,S as L,Y as M,G as N,W as O,Dt as P,y as Q,ue as R,de as S,fe as T,me as U,pe as V,ge as W,ye as X,he as Y,xe as Z,Ht as _,Me as $,we as aa,st as ba,ve as ca,be as da,Se as ea,Ae as fa,De as ga,He as ha,Ue as ia,Te as ja,Fe as ka,Ke as la,Ve as ma,Ut as na};
