import{$ as vg,A as og,Aa as Fg,B as ol,Ba as Ag,C as ag,Ca as fc,D as Kt,Da as Ng,E as di,Ea as pl,F as rg,Fa as Mo,G as pc,Ga as kg,H as Ci,Ha as gc,I as sg,Ia as ml,J as lg,Ja as Rg,K as pg,Ka as Og,L as mg,La as dl,M as dg,Ma as Ee,N as cg,Na as Bg,O as ug,Oa as Vg,P as fg,Pa as Lg,Q as gg,Qa as jg,R as xn,Ra as cl,S as al,Sa as ul,T as Xi,Ta as fl,U as rl,Ua as hc,V as er,W as hg,X as mc,Y as dc,Z as Mr,_ as bg,a as qf,aa as cc,b as wr,ba as yg,c as Wf,ca as tr,d as Xa,da as _g,e as Hn,ea as qi,f as Fe,fa as Wi,g as Hf,ga as Ei,h as zf,ha as wi,i as $f,ia as Cg,j as nl,ja as Sg,k as Qf,ka as Tg,l as Jf,la as sl,m as lc,ma as xg,n as Kf,na as Ig,o as Yf,oa as Eg,p as Xf,pa as wg,q as Zf,qa as Mg,r as eg,ra as ll,s as tg,sa as Dg,t as ig,ta as Pg,u as Za,ua as uc,v as ng,va as ir,w as qe,wa as Io,x as Jt,xa as Eo,y as bt,ya as wo,z as Ui,za as Mi}from"./chunk-UOCB6GOY.js";import"./chunk-CJJCCEFJ.js";import"./chunk-PJ2Z4MGN.js";import"./chunk-AHTIWLLN.js";import"./chunk-KZCXR7UM.js";import"./chunk-CBLQ7AKI.js";import"./chunk-GS4UQ2EW.js";import{a as Et,b as il}from"./chunk-6OWGWFY5.js";import{$f as j0,$j as yf,A as Vu,Aa as $t,Ab as Is,Ah as ef,Al as Nf,Bc as f0,Bd as ln,Bg as Ba,Bk as If,Bl as kf,Cc as ii,Ch as tf,Cl as Rf,Da as bs,Dg as So,Dk as Wn,Dl as tl,Ea as Ma,Ee as Oo,Eh as Zd,El as Of,Fc as g0,Fe as Qd,Fl as Bf,Ga as vs,Ge as k0,Gh as nf,Gk as Ef,Gl as Vf,H as Lu,Ha as ys,Hc as v0,He as Jd,Hg as J0,Ie as R0,Ik as ji,Ja as _s,Jc as Ms,Je as O0,Jg as K0,Jj as Js,Jl as Lf,Ka as Cs,Kh as Ga,Kj as xo,Kl as sc,Lc as Ds,Lg as Y0,Ll as Ka,Mi as zs,Mk as Ja,Na as ge,Nb as Es,Nc as Ps,Nf as Kd,Nj as uf,Nk as Gi,Ob as ws,Oc as _n,Of as ks,Oi as lf,Oj as ff,Pb as Pt,Pf as Tr,Pg as Un,Pj as ec,Qa as xi,Qb as Co,Qf as Rs,Qi as pf,Qj as gf,R as Ki,Ri as mf,Rj as tc,Sa as Ku,Sf as L0,Sj as hf,Ta as Yu,Te as V0,Tf as an,Ti as $s,Tj as ic,Uh as Sn,Uj as bf,V as Vi,Va as Da,Wa as Xu,Wj as vf,X as jn,Xa as Pa,Xh as of,Xj as nc,Ya as Fa,Yj as oc,Z as xe,Zh as Ua,Zj as za,_b as r0,_h as js,_j as $a,ab as _o,ae as Ns,ag as G0,aj as df,am as Ya,ba as ju,be as Ai,bg as U0,bh as X0,bm as jf,cb as e0,ce as Hd,cg as q0,cj as Wa,cm as Gf,db as t0,dc as s0,dg as fi,dl as wf,ea as Gu,ed as ka,ej as Qs,ek as _f,el as ac,fa as li,fb as Ss,fd as As,fl as Mf,fm as re,g as Dt,ga as Uu,gb as Ts,gc as l0,gd as on,ge as P0,gh as Z0,gi as To,gj as cf,ha as qu,hb as xs,hd as I0,he as F0,i as io,ia as Wu,id as E0,ie as Oa,ii as sf,im as rn,ja as Hu,jk as Qa,jm as Tn,ka as fs,kd as _i,ke as A0,kk as Qt,la as Qu,lc as Tt,ld as Sr,lg as Bs,li as qs,lj as Ha,lk as Ks,lm as Uf,ma as gs,mb as it,md as Cn,mg as W0,mk as Cf,nc as p0,ng as H0,ni as qa,nl as Er,o as yo,ob as i0,og as Ii,pb as n0,pc as m0,ph as jt,pk as Ir,pl as pn,qa as Ea,qd as w0,qh as Va,qk as Sf,ql as Ys,r as Ln,ra as wa,rd as M0,re as N0,rg as z0,rh as te,rl as Xs,s as bi,sd as Wd,sh as Yd,sj as Bo,sl as Xt,t as Oi,ta as ti,tg as $0,tj as Vo,tl as Zs,u as Bu,ua as vi,ub as hn,ug as wn,uh as Ke,uj as Lo,uk as Tf,ul as el,v as Bi,va as pi,vb as bn,vd as Ra,ve as zd,vg as Gn,vh as La,vi as Ws,vl as Df,w as us,wa as Ju,wb as o0,wc as u0,wg as Q0,wh as Qe,wl as Pf,xa as hs,xb as vn,xe as $d,xg as Vs,xh as Ot,xi as Hs,xk as qn,xl as Ff,ya as yi,yb as yn,yd as D0,yh as ja,yl as rc,z as Lt,zb as a0,zd as mi,zg as Ls,zh as Xd,zk as xf,zl as Af}from"./chunk-VMPT5D7D.js";import{b as tt,c as Ou,d as ni,f as y0,j as _0,s as Os}from"./chunk-COGHJGTZ.js";import{T as c0,r as d0}from"./chunk-WUISJLQF.js";import{$b as ct,$c as z,$d as S0,Ac as ku,Ae as Na,B as j,Bd as Ie,Be as B0,Cd as De,Ce as Gs,Da as ps,Dd as zt,De as Us,Ec as Ta,Ed as $u,F as ua,Fc as Ru,Fd as ei,Gc as en,Hc as ms,I as Bn,Ic as bo,Id as me,Jc as ds,Kc as vo,Lc as cs,Mb as hi,Md as St,N as vu,Nc as gn,Nd as Zu,Qa as Wh,Qc as ee,Qd as Oe,R as yu,Ra as Ud,T as ha,Tc as We,Td as He,Uc as ue,V as M,Vc as kt,Xc as S,Yd as no,Zd as qd,_c as W,_d as C0,ad as Yi,ae as Aa,bd as xa,ce as T0,dd as ut,de as x0,ed as fe,fd as Ti,gb as ho,gd as Yt,ge as Fs,hc as Ze,hd as X,ic as Mt,id as ft,jd as zu,kc as je,kd as oe,nc as Je,oc as Ct,od as tn,pd as Li,qd as ce,rc as et,sc as K,tc as Sa,td as nn,uc as Au,ud as Ia,vc as Nu,vd as ht,w as Si,wc as Ce,wd as se,y as de,z as su}from"./chunk-L4LVEODN.js";import{b as os,f as Vn,i as _u,k as as,l as Cu,m as Su,o as ba,q as fn,r as Bt}from"./chunk-J74R64SH.js";import{a as ya,k as Ca}from"./chunk-CPGRFLIF.js";import{e as ie,f as H,g as k}from"./chunk-VE7GAG7N.js";import{B as Cr,C as Iu,E as Eu,Qa as Pu,S as wu,Sb as ls,T as Mu,Tb as It,U as ss,Ub as Fi,Vb as _a,a as ai,ca as Du,m as P,mc as Fu,n as Ht,u as rs,w as va,y as Tu,z as xu}from"./chunk-UKIO5DAW.js";import{a as h0,c as b0,d as xr,e as af,f as rf}from"./chunk-7HSUHNOR.js";import"./chunk-4LXUHWEL.js";import{B as du,C as Gd,D as eo,E as Re,G as fa,Ga as to,Ha as gu,Ka as _r,M as cu,Oa as hu,Ta as bu,_ as uu,b as Be,ba as Ue,c as B,da as ns,e as $e,f as _t,j as Ri,ja as ga,la as fu,n as lu,o as Ji,r as pu,x as mu}from"./chunk-MS5TNNAU.js";import{a as Vt}from"./chunk-L3F6I533.js";import{d as ca,e as ru,o as is}from"./chunk-EL3WWTSF.js";import{l as we,m as V,n as Rn,o as On,r as go,s as le,t as au,u as es,v as Ge,w as ts,x as ae}from"./chunk-WN3YRVO4.js";import{$c as ve,Ad as xt,D as mt,Dc as a,E as Yc,Ec as r,F as yt,Fc as f,Ga as Pe,Gc as Ut,Ha as Ae,Hc as qt,Ia as Q,Ic as At,Jc as O,K as Gt,Nb as sn,O as Xc,Oa as N,Ob as Nn,P as Zc,Pa as Zt,Q as eu,Rc as y,Sb as o,T as cn,Tb as g,Tc as v,Td as Xe,Ub as iu,Uc as pa,Va as D,Vc as uo,Wa as J,Wc as T,Xa as Kr,Xc as Zn,Y as Qr,Yb as un,Zb as ki,_ as gi,_c as be,ad as ye,ae as da,be as ou,db as Fn,ea as ra,eb as x,ed as U,fb as I,fc as G,fd as p,g as Ft,gd as R,hc as la,hd as h,id as yr,j as Kc,jd as st,kd as lt,lb as Yr,ld as pt,mc as b,md as ke,nb as rt,ob as Xr,od as fo,pd as Y,q as Kn,qd as Rt,r as Yn,ra as Jr,rc as l,rd as at,sb as An,sc as Qi,sd as ma,ta as tu,tc as L,td as kn,va as Xn,vc as jd,vd as d,w as vr,wa as sa,wc as Zr,wd as c,x as ot,xa as dt,xd as Nt,y as aa,yd as nu,za as wt}from"./chunk-FSPAMUWJ.js";import{a as _e,b as $i,j as C}from"./chunk-NZGOIL2E.js";C();C();C();C();function zh(i,m){i&1&&f(0,"mat-progress-bar",32)}function $h(i,m){i&1&&f(0,"div",33)}function Qh(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.mail-from-required")," "))}function Jh(i,m){if(i&1&&(a(0,"mat-option",34),p(1),r()),i&2){let e,n=m.$implicit,t=v();l("value",n),o(),h(" ",((e=t.templates.get(n))==null?null:e.name)||"Custom"," ")}}function Kh(i,m){if(i&1&&(a(0,"mat-option",34),p(1),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e.toUpperCase()," ")}}function Yh(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.smtp-host-required")," "))}function Xh(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.smtp-port-required")," "))}function Zh(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.smtp-port-invalid")," "))}function eb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.timeout-required")," "))}function tb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.timeout-invalid")," "))}function ib(i,m){if(i&1&&(a(0,"mat-option",34),p(1),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e," ")}}function nb(i,m){if(i&1&&(a(0,"mat-form-field",46)(1,"mat-label",13),p(2,"admin.tls-version"),r(),a(3,"mat-select",47),b(4,ib,2,2,"mat-option",17),r()()),i&2){let e=v(2);o(4),l("ngForOf",e.tlsVersions)}}function ob(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.proxy-host-required")," "))}function ab(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.proxy-port-required")," "))}function rb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.proxy-port-range")," "))}function sb(i,m){if(i&1&&(a(0,"div")(1,"div",48)(2,"mat-form-field",37)(3,"mat-label",13),p(4,"admin.proxy-host"),r(),f(5,"input",49),b(6,ob,3,3,"mat-error",15),r(),a(7,"mat-form-field",39)(8,"mat-label",13),p(9,"admin.proxy-port"),r(),f(10,"input",50),b(11,ab,3,3,"mat-error",15)(12,rb,3,3,"mat-error",15),r()(),a(13,"div",51)(14,"mat-form-field",46)(15,"mat-label",13),p(16,"admin.proxy-user"),r(),f(17,"input",52),r(),a(18,"mat-form-field",46)(19,"mat-label",13),p(20,"admin.proxy-password"),r(),f(21,"input",53)(22,"tb-toggle-password",54),r()()()),i&2){let e=v(2);o(6),l("ngIf",e.mailSettings.get("proxyHost").hasError("required")),o(5),l("ngIf",e.mailSettings.get("proxyPort").hasError("required")),o(),l("ngIf",e.mailSettings.get("proxyPort").hasError("pattern")||e.mailSettings.get("proxyPort").hasError("min")||e.mailSettings.get("proxyPort").hasError("max"))}}function lb(i,m){if(i&1&&(a(0,"mat-form-field",12)(1,"mat-label",13),p(2,"admin.smtp-protocol"),r(),a(3,"mat-select",35),b(4,Kh,2,2,"mat-option",17),r()(),a(5,"div",36)(6,"mat-form-field",37)(7,"mat-label",13),p(8,"admin.smtp-host"),r(),f(9,"input",38),b(10,Yh,3,3,"mat-error",15),r(),a(11,"mat-form-field",39)(12,"mat-label",13),p(13,"admin.smtp-port"),r(),f(14,"input",40,0),a(16,"mat-hint",41),p(17),r(),b(18,Xh,3,3,"mat-error",15)(19,Zh,3,3,"mat-error",15),r()(),a(20,"mat-form-field",12)(21,"mat-label",13),p(22,"admin.timeout-msec"),r(),f(23,"input",42,1),a(25,"mat-hint",41),p(26),r(),b(27,eb,3,3,"mat-error",15)(28,tb,3,3,"mat-error",15),r(),a(29,"mat-slide-toggle",43),p(30),d(31,"translate"),r(),b(32,nb,5,1,"mat-form-field",44),a(33,"mat-slide-toggle",45),p(34),d(35,"translate"),r(),b(36,sb,23,3,"div",15)),i&2){let e=U(15),n=U(24),t=v();o(4),l("ngForOf",t.smtpProtocols),o(6),l("ngIf",t.mailSettings.get("smtpHost").hasError("required")),o(7),h("",(e.value==null?null:e.value.length)||0,"/5"),o(),l("ngIf",t.mailSettings.get("smtpPort").hasError("required")),o(),l("ngIf",t.mailSettings.get("smtpPort").hasError("pattern")||t.mailSettings.get("smtpPort").hasError("maxlength")),o(7),h("",(n.value==null?null:n.value.length)||0,"/6"),o(),l("ngIf",t.mailSettings.get("timeout").hasError("required")),o(),l("ngIf",t.mailSettings.get("timeout").hasError("pattern")||t.mailSettings.get("timeout").hasError("maxlength")),o(2),h(" ",c(31,12,"admin.enable-tls")," "),o(2),l("ngIf",t.mailSettings.get("enableTls").value),o(2),h(" ",c(35,14,"admin.enable-proxy")," "),o(2),l("ngIf",t.mailSettings.get("enableProxy").value)}}function pb(i,m){if(i&1&&(a(0,"div",55),f(1,"div",56),r()),i&2){let e=v();o(),l("tb-help",e.helpLink)}}function mb(i,m){i&1&&(a(0,"mat-checkbox",59),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.change-password")," "))}function db(i,m){i&1&&(a(0,"mat-form-field",12)(1,"mat-label",13),p(2,"common.password"),r(),f(3,"input",60),d(4,"translate"),f(5,"tb-toggle-password",54),r()),i&2&&(o(3),T("placeholder",c(4,1,"common.enter-password")))}function cb(i,m){if(i&1&&(a(0,"section"),b(1,mb,3,3,"mat-checkbox",57)(2,db,6,3,"mat-form-field",58),r()),i&2){let e=v();o(),l("ngIf",e.showChangePassword),o(),l("ngIf",e.mailSettings.get("changePassword").value||!e.showChangePassword)}}function ub(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-id-required")," "))}function fb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-id-max-length")," "))}function gb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-secret-required")," "))}function hb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-secret-max-length")," "))}function bb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.microsoft-tenant-id-required")," "))}function vb(i,m){if(i&1&&(a(0,"mat-form-field",46)(1,"mat-label",13),p(2,"admin.oauth2.microsoft-tenant-id"),r(),f(3,"input",74),b(4,bb,3,3,"mat-error",15),r()),i&2){let e=v(2);o(4),l("ngIf",e.mailSettings.get("providerTenantId").hasError("required"))}}function yb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.access-token-uri-required")," "))}function _b(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function Cb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.access-token-uri-required")," "))}function Sb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function Tb(i,m){if(i&1){let e=O();a(0,"mat-chip-row",81),y("removed",function(){let t=x(e).index,s=v(3);return I(s.removeScope(t))}),p(1),a(2,"mat-icon",82),p(3,"cancel"),r()()}if(i&2){let e=m.$implicit;o(),h(" ",e," ")}}function xb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.scope-required")," "))}function Ib(i,m){if(i&1){let e=O();a(0,"div",51)(1,"mat-form-field",46)(2,"mat-label",13),p(3,"admin.oauth2.authorization-uri"),r(),f(4,"input",75),a(5,"button",76),y("click",function(){x(e);let t=v(2);return I(t.toggleEditMode("authUri"))}),a(6,"mat-icon",77),p(7,"create"),r()(),b(8,yb,3,3,"mat-error",15)(9,_b,3,3,"mat-error",15),r(),a(10,"mat-form-field",46)(11,"mat-label",13),p(12,"admin.oauth2.token-uri"),r(),f(13,"input",78),a(14,"button",76),y("click",function(){x(e);let t=v(2);return I(t.toggleEditMode("tokenUri"))}),a(15,"mat-icon",77),p(16,"create"),r()(),b(17,Cb,3,3,"mat-error",15)(18,Sb,3,3,"mat-error",15),r()(),a(19,"mat-form-field",46)(20,"mat-label",13),p(21,"admin.oauth2.scope"),r(),a(22,"mat-chip-grid",null,2),b(24,Tb,4,1,"mat-chip-row",79),a(25,"input",80),y("matChipInputTokenEnd",function(t){x(e);let s=v(2);return I(s.addScope(t))}),r()(),b(26,xb,3,3,"mat-error",15),r()}if(i&2){let e=U(23),n=v(2);o(8),l("ngIf",n.mailSettings.get("authUri").hasError("required")),o(),l("ngIf",n.mailSettings.get("authUri").hasError("pattern")),o(8),l("ngIf",n.mailSettings.get("tokenUri").hasError("required")),o(),l("ngIf",n.mailSettings.get("tokenUri").hasError("pattern")),o(6),l("ngForOf",n.mailSettings.get("scope").value)("ngForTrackBy",n.trackByParams),o(),l("matChipInputFor",e)("matChipInputSeparatorKeyCodes",n.separatorKeysCodes),o(),l("ngIf",n.mailSettings.get("scope").hasError("required"))}}function Eb(i,m){if(i&1&&(a(0,"mat-option",34),p(1),d(2,"translate"),d(3,"uppercase"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(3,4,c(2,2,n.domainSchemaTranslations.get(e)))," ")}}function wb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.error-verification-url")," "))}function Mb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.domain-name-max-length")," "))}function Db(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.domain-name-unique")," "))}function Pb(i,m){if(i&1&&(a(0,"section")(1,"div",51)(2,"mat-form-field",46)(3,"mat-label",13),p(4,"admin.oauth2.client-id"),r(),f(5,"input",61),b(6,ub,3,3,"mat-error",15)(7,fb,3,3,"mat-error",15),r(),a(8,"mat-form-field",46)(9,"mat-label",13),p(10,"admin.oauth2.client-secret"),r(),f(11,"input",62),b(12,gb,3,3,"mat-error",15)(13,hb,3,3,"mat-error",15),r()(),b(14,vb,5,1,"mat-form-field",44),a(15,"mat-expansion-panel",63)(16,"mat-expansion-panel-header")(17,"mat-panel-description",64),p(18," tenant-profile.advanced-settings "),r()(),b(19,Ib,27,9,"ng-template",20),r(),a(20,"fieldset",21)(21,"legend",22),p(22,"admin.oauth2.redirect-uri"),r(),a(23,"div",65)(24,"div",66)(25,"div",67)(26,"mat-form-field",68)(27,"mat-label",13),p(28,"admin.oauth2.protocol"),r(),a(29,"mat-select",69),b(30,Eb,4,6,"mat-option",17),r()(),a(31,"mat-form-field",46)(32,"mat-label",13),p(33,"admin.domain-name"),r(),f(34,"input",70),b(35,wb,3,3,"mat-error",15)(36,Mb,3,3,"mat-error",15),r()(),b(37,Db,3,3,"mat-error",15),r(),a(38,"div",71)(39,"mat-form-field",46)(40,"mat-label",13),p(41,"admin.oauth2.redirect-uri-template"),r(),f(42,"input",72)(43,"tb-copy-button",73),d(44,"translate"),r()()()()()),i&2){let e=v();o(6),l("ngIf",e.mailSettings.get("clientId").hasError("required")),o(),l("ngIf",e.mailSettings.get("clientId").hasError("maxlen gth")),o(5),l("ngIf",e.mailSettings.get("clientSecret").hasError("required")),o(),l("ngIf",e.mailSettings.get("clientSecret").hasError("maxlength")),o(),l("ngIf",e.mailSettings.get("providerId").value===e.mailServerOauth2Provider.OFFICE_365),o(),l("expanded",e.mailSettings.get("providerId").value===e.mailServerOauth2Provider.CUSTOM),o(9),l("formGroup",e.domainForm),o(6),l("ngForOf",e.protocols),o(5),l("ngIf",e.domainForm.get("name").hasError("pattern")),o(),l("ngIf",e.domainForm.get("name").hasError("maxlength")),o(),l("ngIf",e.domainForm.hasError("unique")),o(6),T("tooltipText",c(44,13,"admin.oauth2.copy-redirect-uri")),l("copyText",e.mailSettings.get("redirectUri").value)}}function Fb(i,m){if(i&1){let e=O();a(0,"section",83)(1,"div")(2,"span",84),p(3,"admin.oauth2.access-token-status"),r(),a(4,"span"),p(5),r()(),a(6,"button",85),d(7,"async"),y("click",function(){x(e);let t=v();return I(t.generateAccessToken())}),p(8),r()()}if(i&2){let e=v();o(5),h(" ",e.accessTokenStatus," "),o(),l("disabled",c(7,3,e.isLoading$)||e.mailSettings.invalid||e.domainForm.invalid||e.mailSettings.dirty||e.domainForm.dirty),o(2),h(" ",e.accessTokenButtonName," ")}}var bl=(()=>{class i extends It{constructor(e,n,t,s,u,_,E,w){super(e),this.store=e,this.router=n,this.route=t,this.adminService=s,this.authService=u,this.translate=_,this.fb=E,this.window=w,this.smtpProtocols=Object.values(wr),this.showChangePassword=!1,this.protocols=Object.values(Ta).filter(q=>q!==Ta.MIXED),this.domainSchemaTranslations=Ru,this.mailServerOauth2Provider=Wf,this.tlsVersions=["TLSv1","TLSv1.1","TLSv1.2","TLSv1.3"],this.templates=new Map,this.templateProvider=["CUSTOM"],this.separatorKeysCodes=[13,188],this.destroy$=new Ft,this.DOMAIN_AND_PORT_REGEXP=/^(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?$/,this.URL_REGEXP=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?(?:\/[\w#!:.,?+=&%@\-/]*)?$/,this.mailSettings=this.fb.group({mailFrom:["",[S.required]],smtpProtocol:[wr.SMTP],smtpHost:["localhost",[S.required]],smtpPort:[25,[S.required,S.pattern(qf),S.maxLength(5)]],timeout:[1e4,[S.required,S.pattern(/^[0-9]{1,6}$/),S.maxLength(6)]],enableTls:[!1],tlsVersion:[{value:null,disabled:!0}],enableProxy:[!1],proxyHost:[{value:"",disabled:!0},[S.required]],proxyPort:[{value:null,disabled:!0},[S.required,S.min(1),S.max(65535)]],proxyUser:[{value:"",disabled:!0}],proxyPassword:[{value:"",disabled:!0}],username:[""],changePassword:[!1],password:[""],enableOauth2:[!1],providerId:["CUSTOM",[S.required]],clientId:[{value:"",disabled:!0},[S.required,S.maxLength(255)]],clientSecret:[{value:"",disabled:!0},[S.required,S.maxLength(2048)]],providerTenantId:[{value:"",disabled:!0},[S.required]],authUri:[{value:"",disabled:!0},[S.required,S.pattern(this.URL_REGEXP)]],tokenUri:[{value:"",disabled:!0},[S.required,S.pattern(this.URL_REGEXP)]],scope:[],redirectUri:[{value:"",disabled:!0}]}),this.defaultConfiguration={providerId:"CUSTOM",smtpProtocol:wr.SMTP,smtpHost:"",smtpPort:null,timeout:null,enableTls:!1,tlsVersion:null,enableProxy:!1,proxyHost:"",proxyPort:null,proxyUser:"",proxyPassword:"",enableOauth2:!1,clientId:"",clientSecret:"",providerTenantId:"",authUri:"",tokenUri:"",scope:[],redirectUri:""},this.domainForm=this.fb.group({name:[this.window.location.hostname,[S.required,S.maxLength(255),S.pattern(this.DOMAIN_AND_PORT_REGEXP)]],scheme:[Ta.HTTPS,S.required]})}ngOnInit(){this.mailServerSettingsForm(),this.domainFormConfiguration(),Gt([this.adminService.getLoginProcessingUrl(),this.adminService.getMailConfigTemplate(),this.adminService.getAdminSettings("mail")]).subscribe(([e,n,t])=>{this.loginProcessingUrl=e,this.initTemplates(n),this.adminSettings=t,this.adminSettings.jsonValue&&cu(this.adminSettings.jsonValue.enableTls)&&(this.adminSettings.jsonValue.enableTls=this.adminSettings.jsonValue.enableTls==="true"),this.showChangePassword=Re(this.adminSettings.jsonValue.showChangePassword)?this.adminSettings.jsonValue.showChangePassword:!0,delete this.adminSettings.jsonValue.showChangePassword,this.adminSettings.jsonValue.providerId||(this.adminSettings.jsonValue.providerId="CUSTOM"),this.mailSettings.reset(this.adminSettings.jsonValue,{emitEvent:!1}),this.enableMailPassword(!this.showChangePassword),this.enableProxyChanged(),this.enableTls(this.adminSettings.jsonValue.enableTls),this.helpLink=this.templates.get(this.adminSettings.jsonValue.providerId)?.helpLink||null,this.adminSettings.jsonValue.enableOauth2?(this.enableOauth2(!!this.adminSettings.jsonValue.enableOauth2),this.enableProviderTenantIdChanged(this.adminSettings.jsonValue.providerId),this.parseUrl(this.adminSettings.jsonValue.redirectUri),this.mailSettings.get("redirectUri").patchValue(this.adminSettings.jsonValue.redirectUri,{emitEvent:!1})):this.mailSettings.get("enableOauth2").patchValue(!1,{emitEvent:!1})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),super.ngOnDestroy()}initTemplates(e){e.map(n=>{delete n.additionalInfo,this.templates.set(n.providerId,n)}),this.templateProvider.push(...Array.from(this.templates.keys())),this.templateProvider.sort()}mailServerSettingsForm(){this.registerDisableOnLoadFormControl(this.mailSettings.get("smtpProtocol")),this.registerDisableOnLoadFormControl(this.mailSettings.get("enableTls")),this.registerDisableOnLoadFormControl(this.mailSettings.get("enableProxy")),this.registerDisableOnLoadFormControl(this.mailSettings.get("changePassword")),this.mailSettings.get("enableTls").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>this.enableTls(e)),this.mailSettings.get("enableProxy").valueChanges.pipe(dt(this.destroy$)).subscribe(()=>{this.enableProxyChanged()}),this.mailSettings.get("changePassword").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>{this.enableMailPassword(e)}),this.mailSettings.get("enableOauth2").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>{this.enableOauth2(e),this.enableProviderTenantIdChanged(this.mailSettings.get("providerId").value),e&&!this.mailSettings.get("redirectUri").value&&this.mailSettings.get("redirectUri").patchValue(this.redirectURI(),{emitEvent:!1})}),this.mailSettings.get("providerTenantId").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>{let n=this.templates.get(this.mailServerOauth2Provider.OFFICE_365).authorizationUri.replace("%s",`${e}`),t=this.templates.get(this.mailServerOauth2Provider.OFFICE_365).accessTokenUri.replace("%s",`${e}`);this.mailSettings.get("authUri").patchValue(n,{emitEvent:!1}),this.mailSettings.get("tokenUri").patchValue(t,{emitEvent:!1})}),this.mailSettings.get("providerId").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>{if(e===this.mailServerOauth2Provider.CUSTOM||!e)this.mailSettings.reset(_e(_e({},this.adminSettings.jsonValue),this.defaultConfiguration),{emitEvent:!1});else{let n=this.templates.get(e);this.helpLink=n.helpLink,this.mailSettings.patchValue({smtpProtocol:wr[n.smtpProtocol],smtpHost:n.smtpHost,smtpPort:n.smtpPort,timeout:n.timeout,enableTls:n.enableTls,tlsVersion:n.tlsVersion,authUri:n.authorizationUri,tokenUri:n.accessTokenUri,scope:n.scope,enableOauth2:!1,enableProxy:!1,proxyHost:"",proxyPort:null,proxyUser:"",proxyPassword:"",clientId:"",clientSecret:"",providerTenantId:"",redirectUri:""},{emitEvent:!1})}this.enableTls(this.mailSettings.get("enableTls").value),this.enableOauth2(this.mailSettings.get("enableOauth2").value),this.enableProviderTenantIdChanged(e)})}domainFormConfiguration(){this.domainForm.get("name").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>this.mailSettings.get("redirectUri").patchValue(this.redirectURI(this.domainForm.get("scheme").value,e),{emitEvent:!1})),this.domainForm.get("scheme").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>this.mailSettings.get("redirectUri").patchValue(this.redirectURI(e),{emitEvent:!1}))}enableOauth2(e){e?(this.mailSettings.get("clientId").enable({emitEvent:!1}),this.mailSettings.get("clientSecret").enable({emitEvent:!1}),this.mailSettings.get("redirectUri").enable({emitEvent:!1}),this.mailSettings.get("providerId").value===this.mailServerOauth2Provider.CUSTOM?(this.mailSettings.get("authUri").enable({emitEvent:!1}),this.mailSettings.get("tokenUri").enable({emitEvent:!1})):(this.mailSettings.get("authUri").disable({emitEvent:!1}),this.mailSettings.get("tokenUri").disable({emitEvent:!1}))):(this.mailSettings.get("clientId").disable({emitEvent:!1}),this.mailSettings.get("clientSecret").disable({emitEvent:!1}),this.mailSettings.get("redirectUri").disable({emitEvent:!1}),this.mailSettings.get("authUri").disable({emitEvent:!1}),this.mailSettings.get("tokenUri").disable({emitEvent:!1}))}enableProviderTenantIdChanged(e){e===this.mailServerOauth2Provider.OFFICE_365&&this.mailSettings.get("enableOauth2").value?this.mailSettings.get("providerTenantId").enable({emitEvent:!1}):this.mailSettings.get("providerTenantId").disable({emitEvent:!1})}enableProxyChanged(){this.mailSettings.get("enableProxy").value?(this.mailSettings.get("proxyHost").enable({emitEvent:!1}),this.mailSettings.get("proxyPort").enable({emitEvent:!1}),this.mailSettings.get("proxyUser").enable({emitEvent:!1}),this.mailSettings.get("proxyPassword").enable({emitEvent:!1})):(this.mailSettings.get("proxyHost").disable({emitEvent:!1}),this.mailSettings.get("proxyPort").disable({emitEvent:!1}),this.mailSettings.get("proxyUser").disable({emitEvent:!1}),this.mailSettings.get("proxyPassword").disable({emitEvent:!1}))}enableMailPassword(e){e?this.mailSettings.get("password").enable({emitEvent:!1}):this.mailSettings.get("password").disable({emitEvent:!1})}enableTls(e){e?this.mailSettings.get("tlsVersion").enable({emitEvent:!1}):this.mailSettings.get("tlsVersion").disable({emitEvent:!1})}sendTestMail(){this.adminSettings.jsonValue=_e(_e({},this.adminSettings.jsonValue),this.mailSettingsFormValue),this.adminService.sendTestMail(this.adminSettings).subscribe({next:()=>this.store.dispatch(new tt({message:this.translate.instant("admin.test-mail-sent"),type:"success"})),error:e=>this.store.dispatch(new tt({message:e.error.message,type:"error"}))})}save(){this.adminSettings.jsonValue=_e(_e({},this.adminSettings.jsonValue),this.mailSettingsFormValue),this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>{this.adminSettings=e,this.showChangePassword=!0,this.mailSettings.reset(this.adminSettings.jsonValue,{emitEvent:!1}),this.domainForm.reset(this.domainForm.value),this.parseUrl(this.adminSettings.jsonValue.redirectUri)})}generateAccessToken(){this.adminService.generateAccessToken().subscribe(e=>this.window.location.href=e)}redirectURI(e,n){let t=this.domainForm.value;if(t.name!==""){let s=eo(e)?e.toLowerCase():t.scheme.toLowerCase(),u=eo(n)?n:t.name;return`${s}://${u}${this.loginProcessingUrl}`}return""}parseUrl(e){if(e){let n=new URL(e);this.domainForm.get("scheme").patchValue(n.protocol.startsWith("https")?Ta.HTTPS:Ta.HTTP,{emitEvent:!1}),this.domainForm.get("name").patchValue(n.host,{emitEvent:!1})}}get accessTokenButtonName(){return this.translate.instant(this.adminSettings.jsonValue.tokenGenerated?"admin.oauth2.update-access-token":"admin.oauth2.generate-access-token")}get accessTokenStatus(){return this.translate.instant(this.adminSettings.jsonValue.tokenGenerated?"admin.oauth2.token-status-generated":"admin.oauth2.token-status-not-generated")}confirmForm(){return this.mailSettings}get mailSettingsFormValue(){let e=this.mailSettings.getRawValue();return delete e.changePassword,Re(e.password)||delete e.password,e}trackByParams(e){return e}removeScope(e){let n=this.mailSettings.get("scope");n.removeAt(e),n.markAsTouched(),n.markAsDirty()}addScope(e){let n=e.chipInput.inputElement,t=e.value,s=this.mailSettings.get("scope");t.trim()!==""&&(s.push(this.fb.control(t.trim())),s.markAsDirty()),n&&(n.value="")}toggleEditMode(e){this.mailSettings.get(e).disabled?this.mailSettings.get(e).enable():this.mailSettings.get(e).disable()}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Si),g(Hn),g(gn),g(ie),g(ht),g(ya))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mail-server"]],features:[G],decls:60,vars:42,consts:[["smtpPortInput",""],["timeoutInput",""],["scopeList",""],["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","outgoingMailSettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","mailFrom","required",""],[4,"ngIf"],["formControlName","providerId"],[3,"value",4,"ngFor","ngForOf"],[1,"configuration-panel","mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-center","justify-start"],["matExpansionPanelContent",""],[1,"fields-group","flex","flex-col"],["translate","",1,"group-title"],["matInput","","formControlName","username","autocomplete","new-username",3,"placeholder"],[1,"flex","items-center","justify-between",2,"height","50px","padding-bottom","20px"],["formControlName","enableOauth2",1,"tb-notification-unread-toggle-group",2,"width","250px"],[1,"flex-1",3,"value"],["class","details-buttons",4,"ngIf"],["class","flex flex-row pb-3 xs:flex-col gt-xs:items-center gt-xs:justify-between",4,"ngIf"],[1,"flex","flex-row","items-center","justify-end","gap-4","xs:flex-col","xs:items-stretch"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],["formControlName","smtpProtocol"],[1,"gt-sm:flex","gt-sm:flex-row","gt-sm:gap-2.5"],[1,"mat-block","flex-full","gt-sm:max-w-60%"],["matInput","","formControlName","smtpHost","placeholder","localhost","required",""],[1,"mat-block","flex-full","gt-sm:max-w-40%"],["matInput","","formControlName","smtpPort","placeholder","25","maxlength","5","required",""],["align","end"],["matInput","","formControlName","timeout","placeholder","10000","maxlength","6","required",""],["formControlName","enableTls",1,"flex-1",2,"display","block","padding-bottom","22px"],["class","mat-block flex-1",4,"ngIf"],["formControlName","enableProxy",2,"display","block","padding-bottom","22px"],[1,"mat-block","flex-1"],["formControlName","tlsVersion"],[1,"gt-sm:flex","gt-sm:flex-row","gt-sm:gap-2"],["matInput","","required","","formControlName","proxyHost"],["matInput","","required","","formControlName","proxyPort","type","number","step","1","min","1","max","65535"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],["matInput","","formControlName","proxyUser"],["matInput","","type","password","formControlName","proxyPassword","autocomplete","new-proxy-password"],["matSuffix",""],[1,"details-buttons"],[3,"tb-help"],["formControlName","changePassword","style","padding-bottom: 16px;",4,"ngIf"],["class","mat-block",4,"ngIf"],["formControlName","changePassword",2,"padding-bottom","16px"],["matInput","","formControlName","password","type","password","autocomplete","new-password",3,"placeholder"],["matInput","","formControlName","clientId","required",""],["matInput","","formControlName","clientSecret","required",""],[1,"mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-stretch","justify-end"],[1,"flex","flex-1","flex-row","gap-2","xs:flex-col"],[1,"flex","flex-col","sm:max-w-60%","sm:flex-full","gt-sm:max-w-50%","gt-sm:flex-full",3,"formGroup"],[1,"flex","flex-row","gap-2","xs:flex-col","md:flex-col","md:gap-0"],[1,"mat-block","max-w-30%","flex-full","xs:max-w-full","xs:flex-1","md:max-w-full","md:flex-1"],["formControlName","scheme"],["matInput","","formControlName","name","required",""],[1,"flex","flex-1","flex-col"],["matInput","","formControlName","redirectUri","readonly",""],["matSuffix","","color","primary","tooltipPosition","above","icon","mdi:clipboard-arrow-left",3,"copyText","tooltipText"],["matInput","","formControlName","providerTenantId","required",""],["matInput","","formControlName","authUri","required",""],["mat-icon-button","","matSuffix","","type","button",3,"click"],[1,"material-icons"],["matInput","","formControlName","tokenUri","required",""],["removable","",3,"removed",4,"ngFor","ngForOf","ngForTrackBy"],["matChipInputAddOnBlur","",3,"matChipInputTokenEnd","matChipInputFor","matChipInputSeparatorKeyCodes"],["removable","",3,"removed"],["matChipRemove",""],[1,"flex","flex-row","pb-3","xs:flex-col","gt-xs:items-center","gt-xs:justify-between"],["translate","",1,"token-status"],["mat-raised-button","","type","button","color","primary",3,"click","disabled"]],template:function(n,t){n&1&&(a(0,"div")(1,"mat-card",3)(2,"mat-card-header")(3,"mat-card-title")(4,"span",4),p(5,"admin.outgoing-mail-settings"),r()(),f(6,"span",5)(7,"div",6),r(),b(8,zh,1,0,"mat-progress-bar",7),d(9,"async"),b(10,$h,1,0,"div",8),d(11,"async"),a(12,"mat-card-content",9)(13,"form",10),y("ngSubmit",function(){return t.save()}),a(14,"fieldset",11),d(15,"async"),a(16,"mat-form-field",12)(17,"mat-label",13),p(18,"admin.mail-from"),r(),f(19,"input",14),b(20,Qh,3,3,"mat-error",15),r(),a(21,"mat-form-field",12)(22,"mat-label",13),p(23,"admin.oauth2.smtp-provider"),r(),a(24,"mat-select",16),b(25,Jh,2,2,"mat-option",17),r()(),a(26,"mat-expansion-panel",18)(27,"mat-expansion-panel-header")(28,"mat-panel-title",19),p(29," admin.connection-settings "),r()(),b(30,lb,37,16,"ng-template",20),r(),a(31,"fieldset",21)(32,"legend",22),p(33,"admin.oauth2.authentication"),r(),a(34,"mat-form-field",12)(35,"mat-label",13),p(36,"common.username"),r(),f(37,"input",23),d(38,"translate"),r(),a(39,"div",24)(40,"mat-button-toggle-group",25)(41,"mat-button-toggle",26),p(42),d(43,"translate"),r(),a(44,"mat-button-toggle",26),p(45),d(46,"translate"),r()(),b(47,pb,2,1,"div",27),r(),b(48,cb,3,2,"section",15)(49,Pb,45,15,"section",15)(50,Fb,9,5,"section",28),r(),a(51,"div",29)(52,"button",30),d(53,"async"),y("click",function(){return t.sendTestMail()}),p(54),d(55,"translate"),r(),a(56,"button",31),d(57,"async"),p(58),d(59,"translate"),r()()()()()()()),n&2&&(o(8),l("ngIf",c(9,22,t.isLoading$)),o(2),l("ngIf",!c(11,24,t.isLoading$)),o(3),l("formGroup",t.mailSettings),o(),l("disabled",c(15,26,t.isLoading$)),o(6),l("ngIf",t.mailSettings.get("mailFrom").hasError("required")),o(5),l("ngForOf",t.templateProvider),o(),l("expanded",t.mailSettings.get("providerId").value===t.mailServerOauth2Provider.CUSTOM),o(11),T("placeholder",c(38,28,"common.enter-username")),o(2),L("!hidden",t.mailSettings.get("providerId").value==="SENDGRID"),o(2),l("value",!1),o(),R(c(43,30,"admin.oauth2.basic")),o(2),l("value",!0),o(),R(c(46,32,"admin.oauth2.oauth2")),o(2),l("ngIf",t.helpLink&&t.mailSettings.get("enableOauth2").value),o(),l("ngIf",!t.mailSettings.get("enableOauth2").value),o(),l("ngIf",t.mailSettings.get("enableOauth2").value),o(),l("ngIf",t.mailSettings.get("enableOauth2").value),o(2),l("disabled",c(53,34,t.isLoading$)||t.mailSettings.get("enableOauth2").value?t.mailSettings.invalid||t.domainForm.invalid||t.mailSettings.dirty||t.domainForm.dirty:t.mailSettings.invalid),o(2),h(" ",c(55,36,"admin.send-test-mail")," "),o(2),l("disabled",c(57,38,t.isLoading$)||t.mailSettings.invalid||t.domainForm.invalid||!t.mailSettings.dirty&&!t.domainForm.dirty),o(2),h("",c(59,40,"action.save")," "))},dependencies:[we,V,Tt,K,Ce,Ea,wa,$t,ee,ti,pi,yi,vi,Oe,ge,me,Ie,zt,De,ei,St,ct,it,bi,Oi,Bi,Bu,Ln,_s,Cs,bs,vs,fe,ue,Ti,W,z,ce,nn,Li,tn,X,oe,H,Wa,Qs,le,es,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 8px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000b3;width:fit-content}[_nghost-%COMP%]   .token-status[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;color:#0009;letter-spacing:.25px;padding:8px 0}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-header{height:48px;padding:0 12px}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-header.mat-expanded{height:48px}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-body{padding:0 12px}[_nghost-%COMP%]     .mat-expansion-panel.configuration-panel{border:1px solid rgba(0,0,0,.2)}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard{border:none;border-radius:14px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle{border-left:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle{background:#0000000f;height:28px;align-items:center;display:flex}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle .mat-button-toggle-ripple{inset:2px;border-radius:12px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-button{color:#959595}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-focus-overlay{border-radius:14px;margin:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked .mat-button-toggle-button{background-color:#359b07;color:#fff;border-radius:14px;margin-left:2px;margin-right:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content{line-height:24px;font-size:16px;font-weight:500}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content .mat-pseudo-checkbox{display:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.01}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();var nr=i=>({protocol:i});function Nb(i,m){i&1&&f(0,"mat-progress-bar",25)}function kb(i,m){i&1&&f(0,"div",26)}function Rb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.base-url-required")," "))}function Ob(i,m){i&1&&f(0,"mat-progress-bar",25)}function Bb(i,m){i&1&&f(0,"div",26)}function Vb(i,m){i&1&&At(0)}function Lb(i,m){i&1&&At(0)}function jb(i,m){if(i&1&&(Ut(0),b(1,Vb,1,0,"ng-container",27)(2,Lb,1,0,"ng-container",27),qt()),i&2){let e=v(),n=U(63);o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(4,nr,e.protocol)),o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(6,nr,e.protocol+"s"))}}function Gb(i,m){i&1&&At(0)}function Ub(i,m){i&1&&At(0)}function qb(i,m){if(i&1&&(Ut(0),b(1,Gb,1,0,"ng-container",27)(2,Ub,1,0,"ng-container",27),qt()),i&2){let e=v(),n=U(63);o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(4,nr,e.protocol)),o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(6,nr,e.protocol+"s"))}}function Wb(i,m){i&1&&At(0)}function Hb(i,m){i&1&&At(0)}function zb(i,m){if(i&1&&(Ut(0),b(1,Wb,1,0,"ng-container",27)(2,Hb,1,0,"ng-container",27),qt()),i&2){let e=v(),n=U(63);o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(4,nr,e.protocol)),o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(6,nr,e.protocol+"s"))}}function $b(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.device-connectivity.port-pattern")," "))}function Qb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.device-connectivity.port-range")," "))}function Jb(i,m){if(i&1&&(a(0,"div",28)(1,"mat-slide-toggle",29),p(2),d(3,"translate"),r(),a(4,"div",30)(5,"mat-form-field",31)(6,"mat-label",9),p(7,"admin.device-connectivity.host"),r(),f(8,"input",32),r(),a(9,"mat-form-field",31)(10,"mat-label",9),p(11,"admin.device-connectivity.port"),r(),f(12,"input",33),b(13,$b,3,3,"mat-error",11)(14,Qb,3,3,"mat-error",11),r()()()),i&2){let e=m.protocol,n=v();l("formGroupName",e),o(2),h(" ",c(3,4,"admin.device-connectivity."+e)," "),o(11),l("ngIf",n.deviceConnectivitySettingsForm.get(e+".port").hasError("pattern")),o(),l("ngIf",n.deviceConnectivitySettingsForm.get(e+".port").hasError("min")||n.deviceConnectivitySettingsForm.get(e+".port").hasError("max"))}}var _l=(()=>{class i extends It{constructor(e,n,t){super(e),this.store=e,this.adminService=n,this.fb=t,this.protocol="http",this.destroy$=new Ft,this.buildGeneralServerSettingsForm(),this.adminService.getAdminSettings("general").subscribe(s=>this.processGeneralSettings(s)),this.buildDeviceConnectivitySettingsForm(),this.adminService.getAdminSettings("connectivity").subscribe(s=>this.processDeviceConnectivitySettings(s))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildGeneralServerSettingsForm(){this.generalSettings=this.fb.group({baseUrl:["",[S.required]],prohibitDifferentUrl:["",[]]})}buildDeviceConnectivitySettingsForm(){this.deviceConnectivitySettingsForm=this.fb.group({http:this.buildDeviceConnectivityInfoForm(),https:this.buildDeviceConnectivityInfoForm(),mqtt:this.buildDeviceConnectivityInfoForm(),mqtts:this.buildDeviceConnectivityInfoForm(),coap:this.buildDeviceConnectivityInfoForm(),coaps:this.buildDeviceConnectivityInfoForm()})}buildDeviceConnectivityInfoForm(){let e=this.fb.group({enabled:[!1,[]],host:[{value:"",disabled:!0}],port:[{value:null,disabled:!0},[S.min(1),S.max(65535),S.pattern("[0-9]*")]]});return e.get("enabled").valueChanges.pipe(dt(this.destroy$)).subscribe(n=>{n?(e.get("host").enable({emitEvent:!1}),e.get("port").enable({emitEvent:!1})):(e.get("host").disable({emitEvent:!1}),e.get("port").disable({emitEvent:!1}))}),e}save(){this.adminSettings.jsonValue=_e(_e({},this.adminSettings.jsonValue),this.generalSettings.value),this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>this.processGeneralSettings(e))}saveDeviceConnectivitySettings(){this.deviceConnectivitySettings.jsonValue=_e(_e({},this.deviceConnectivitySettings.jsonValue),this.deviceConnectivitySettingsForm.getRawValue()),this.adminService.saveAdminSettings(this.deviceConnectivitySettings).subscribe(e=>this.processDeviceConnectivitySettings(e))}discardGeneralSettings(){this.generalSettings.reset(this.adminSettings.jsonValue)}discardDeviceConnectivitySettings(){this.deviceConnectivitySettingsForm.reset(this.deviceConnectivitySettings.jsonValue)}processGeneralSettings(e){this.adminSettings=e,this.generalSettings.reset(this.adminSettings.jsonValue)}processDeviceConnectivitySettings(e){this.deviceConnectivitySettings=e,this.deviceConnectivitySettingsForm.reset(this.deviceConnectivitySettings.jsonValue)}confirmForm(){return this.generalSettings.dirty?this.generalSettings:this.deviceConnectivitySettingsForm}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(Hn),g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-general-settings"]],features:[G],decls:72,vars:60,consts:[["connectivitySettings",""],["appearance","outlined",1,"settings-card"],[1,"flex","flex-row"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[1,"tb-form-panel","no-border","no-padding",3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","baseUrl","required",""],[4,"ngIf"],[1,"tb-form-row",3,"tb-hint-tooltip-icon"],["formControlName","prohibitDifferentUrl",1,"mat-slide","margin"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"tb-form-panel","no-border","no-padding"],[1,"tb-form-panel","no-border","no-padding","toggle-group"],["appearance","fill",3,"ngModelChange","ngModel"],["value","http"],["value","mqtt"],["value","coap"],[1,"tb-form-hint","tb-primary-fill"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"tb-form-panel","stroked","no-padding-bottom",3,"formGroupName"],["formControlName","enabled",1,"mat-slide"],[1,"tb-form-row","column-xs","no-border","no-padding","tb-standard-fields"],[1,"flex-1"],["matInput","","formControlName","host"],["matInput","","type","number","min","0","max","65535","formControlName","port"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title")(3,"div",2)(4,"span",3),p(5,"admin.general-settings"),r()()()(),b(6,Nb,1,0,"mat-progress-bar",4),d(7,"async"),b(8,kb,1,0,"div",5),d(9,"async"),a(10,"mat-card-content")(11,"form",6),y("ngSubmit",function(){return x(s),I(t.save())}),a(12,"fieldset",7),d(13,"async"),a(14,"div")(15,"mat-form-field",8)(16,"mat-label",9),p(17,"admin.base-url"),r(),f(18,"input",10),b(19,Rb,3,3,"mat-error",11),r(),a(20,"div",12),d(21,"translate"),a(22,"mat-slide-toggle",13),p(23),d(24,"translate"),r()()()(),a(25,"div",14)(26,"button",15),y("click",function(){return x(s),I(t.discardGeneralSettings())}),p(27),d(28,"translate"),r(),a(29,"button",16),d(30,"async"),p(31),d(32,"translate"),r()()()()(),a(33,"mat-card",1)(34,"mat-card-header")(35,"mat-card-title")(36,"div",3),p(37,"admin.device-connectivity.device-connectivity"),r()()(),b(38,Ob,1,0,"mat-progress-bar",4),d(39,"async"),b(40,Bb,1,0,"div",5),d(41,"async"),a(42,"mat-card-content")(43,"section",17)(44,"div",18)(45,"tb-toggle-select",19),pt("ngModelChange",function(_){return x(s),lt(t.protocol,_)||(t.protocol=_),I(_)}),a(46,"tb-toggle-option",20),p(47),d(48,"translate"),r(),a(49,"tb-toggle-option",21),p(50),d(51,"translate"),r(),a(52,"tb-toggle-option",22),p(53),d(54,"translate"),r()(),a(55,"div",23),p(56),d(57,"translate"),r()(),a(58,"form",6),y("ngSubmit",function(){return x(s),I(t.saveDeviceConnectivitySettings())}),b(59,jb,3,8,"ng-container",11)(60,qb,3,8,"ng-container",11)(61,zb,3,8,"ng-container",11)(62,Jb,15,6,"ng-template",null,0,xt),a(64,"div",14)(65,"button",15),y("click",function(){return x(s),I(t.discardDeviceConnectivitySettings())}),p(66),d(67,"translate"),r(),a(68,"button",24),d(69,"async"),p(70),d(71,"translate"),r()()()()()()}n&2&&(o(6),l("ngIf",c(7,26,t.isLoading$)),o(2),l("ngIf",!c(9,28,t.isLoading$)),o(3),l("formGroup",t.generalSettings),o(),l("disabled",c(13,30,t.isLoading$)),o(7),l("ngIf",t.generalSettings.get("baseUrl").hasError("required")),o(),T("tb-hint-tooltip-icon",c(21,32,"admin.prohibit-different-url-hint")),o(3),h(" ",c(24,34,"admin.prohibit-different-url")," "),o(3),l("disabled",t.generalSettings.pristine),o(),h("",c(28,36,"action.undo")," "),o(2),l("disabled",c(30,38,t.isLoading$)||t.generalSettings.invalid||!t.generalSettings.dirty),o(2),h("",c(32,40,"action.save")," "),o(7),l("ngIf",c(39,42,t.isLoading$)),o(2),l("ngIf",!c(41,44,t.isLoading$)),o(5),st("ngModel",t.protocol),o(2),R(c(48,46,"admin.device-connectivity.http-s")),o(3),R(c(51,48,"admin.device-connectivity.mqtt-s")),o(3),R(c(54,50,"admin.device-connectivity.coap-s")),o(3),R(c(57,52,"admin.device-connectivity.hint")),o(2),l("formGroup",t.deviceConnectivitySettingsForm),o(),l("ngIf",t.protocol==="http"),o(),l("ngIf",t.protocol==="mqtt"),o(),l("ngIf",t.protocol==="coap"),o(4),l("disabled",t.deviceConnectivitySettingsForm.pristine),o(),h("",c(67,54,"action.undo")," "),o(2),l("disabled",c(69,56,t.isLoading$)||t.deviceConnectivitySettingsForm.invalid||!t.deviceConnectivitySettingsForm.dirty),o(2),h("",c(71,58,"action.save")," "))},dependencies:[V,go,K,ti,pi,yi,vi,Oe,ge,me,Ie,De,it,fe,ue,Ti,W,z,ce,Li,tn,ut,X,oe,ft,H,qn,Wn,qs,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .toggle-group[_ngcontent-%COMP%]{max-width:670px;width:100%;margin:0 auto}[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .toggle-group[_ngcontent-%COMP%]   .tb-form-hint[_ngcontent-%COMP%]{text-align:center}@media screen and (max-width: 599px){[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .tb-form-row[_ngcontent-%COMP%]{gap:0}}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();function Kb(i,m){i&1&&f(0,"mat-progress-bar",47)}function Yb(i,m){i&1&&f(0,"div",48)}function Xb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-max-failed-login-attempts-range")," "))}function Zb(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.user-activation-token-ttl-range")," "))}function e1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.user-activation-token-ttl-range")," "))}function t1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.password-reset-token-ttl-range")," "))}function i1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.password-reset-token-ttl-range")," "))}function n1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.mobile-secret-key-length-range")," "))}function o1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-password-length-required")," "))}function a1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-password-length-range")," "))}function r1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-password-length-range")," "))}function s1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.maximum-password-length-min")," "))}function l1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.maximum-password-length-less-min")," "))}function p1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-uppercase-letters-range")," "))}function m1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-lowercase-letters-range")," "))}function d1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-digits-range")," "))}function c1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-special-characters-range")," "))}function u1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.password-expiration-period-days-range")," "))}function f1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.password-reuse-frequency-days-range")," "))}function g1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.issuer-name-required")," "))}function h1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.signings-key-required")," "))}function b1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.signings-key-base64")," "))}function v1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.signings-key-min-length")," "))}function y1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.expiration-time-required")," "))}function _1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.expiration-time-pattern")," "))}function C1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.expiration-time-min")," "))}function S1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.refresh-expiration-time-required")," "))}function T1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.refresh-expiration-time-pattern")," "))}function x1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.refresh-expiration-time-min")," "))}function I1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.refresh-expiration-time-less-token")," "))}var Cl=(()=>{class i extends It{constructor(e,n,t,s,u,_,E){super(e),this.store=e,this.router=n,this.adminService=t,this.authService=s,this.dialogService=u,this.translate=_,this.fb=E,this.showMainLoadingBar=!1,this.buildSecuritySettingsForm(),this.buildJwtSecuritySettingsForm(),this.adminService.getSecuritySettings().subscribe(w=>this.processSecuritySettings(w)),this.adminService.getJwtSettings().subscribe(w=>this.processJwtSettings(w))}buildSecuritySettingsForm(){this.securitySettingsFormGroup=this.fb.group({maxFailedLoginAttempts:[null,[S.min(0)]],userLockoutNotificationEmail:["",[]],userActivationTokenTtl:[24,[S.required,S.min(1),S.max(24)]],passwordResetTokenTtl:[24,[S.required,S.min(1),S.max(24)]],mobileSecretKeyLength:[null,[S.min(1)]],passwordPolicy:this.fb.group({minimumLength:[null,[S.required,S.min(6),S.max(50)]],maximumLength:[null,[S.min(6),this.maxPasswordValidation()]],minimumUppercaseLetters:[null,S.min(0)],minimumLowercaseLetters:[null,S.min(0)],minimumDigits:[null,S.min(0)],minimumSpecialCharacters:[null,S.min(0)],passwordExpirationPeriodDays:[null,S.min(0)],passwordReuseFrequencyDays:[null,S.min(0)],allowWhitespaces:[!0],forceUserToResetPasswordIfNotValid:[!1]})})}buildJwtSecuritySettingsForm(){this.jwtSecuritySettingsFormGroup=this.fb.group({tokenIssuer:["",S.required],tokenSigningKey:["",[S.required,this.base64Format]],tokenExpirationTime:[0,[S.required,S.pattern("[0-9]*"),S.min(60)]],refreshTokenExpTime:[0,[S.required,S.pattern("[0-9]*"),S.min(900)]]},{validators:this.refreshTokenTimeGreatTokenTime.bind(this)}),this.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").valueChanges.subscribe(()=>this.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").updateValueAndValidity({onlySelf:!0}))}save(){this.securitySettings=_e(_e({},this.securitySettings),this.securitySettingsFormGroup.value),this.adminService.saveSecuritySettings(this.securitySettings).subscribe(e=>this.processSecuritySettings(e))}saveJwtSettings(){let e=this.jwtSecuritySettingsFormGroup.value;this.confirmChangeJWTSettings().pipe(yt(n=>n?this.adminService.saveJwtSettings(e).pipe(wt(t=>this.authService.setUserFromJwtToken(t.token,t.refreshToken,!1)),yt(()=>this.adminService.getJwtSettings()),wt(t=>this.processJwtSettings(t))):ot(null))).subscribe(()=>{})}maxPasswordValidation(){return e=>{let n=e.value;return n&&n<e.parent.value?.minimumLength?{lessMin:!0}:null}}discardSetting(){this.securitySettingsFormGroup.reset(this.securitySettings)}discardJwtSetting(){this.jwtSecuritySettingsFormGroup.reset(this.jwtSettings)}markAsTouched(){this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsTouched()}confirmChangeJWTSettings(){return this.jwtSecuritySettingsFormGroup.get("tokenIssuer").value!==(this.jwtSettings?.tokenIssuer||"")||this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").value!==(this.jwtSettings?.tokenSigningKey||"")?this.dialogService.confirm(this.translate.instant("admin.jwt.info-header"),`<div style="max-width: 640px">${this.translate.instant("admin.jwt.info-message")}</div>`,this.translate.instant("action.discard-changes"),this.translate.instant("action.confirm")):ot(!0)}generateSigningKey(){this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").setValue(btoa(_r(64))),this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").pristine&&(this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsDirty(),this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsTouched())}processSecuritySettings(e){this.securitySettings=e,this.securitySettingsFormGroup.reset(this.securitySettings)}processJwtSettings(e){this.jwtSettings=e,this.jwtSecuritySettingsFormGroup.reset(e)}refreshTokenTimeGreatTokenTime(e){if(e){let n=e.value.tokenExpirationTime,t=e.value.refreshTokenExpTime;if(n>=t)return e.get("refreshTokenExpTime").untouched&&e.get("refreshTokenExpTime").markAsTouched(),e.get("refreshTokenExpTime").setErrors({lessToken:!0}),{lessToken:!0}}return null}base64Format(e){if(e.value===""||e.value==="thingsboardDefaultSigningKey")return null;try{return atob(e.value).length<64?{minLength:!0}:null}catch{return{base64:!0}}}confirmForm(){return this.securitySettingsFormGroup.dirty?this.securitySettingsFormGroup:this.jwtSecuritySettingsFormGroup}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Hn),g(gn),g(Lt),g(ie),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-security-settings"]],features:[G],decls:166,vars:71,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","securitySettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["autocomplete","off",3,"ngSubmit","formGroup"],[3,"disabled"],[1,"fields-group"],["translate","",1,"group-title"],[1,"mat-block"],["translate",""],["matInput","","type","number","formControlName","maxFailedLoginAttempts","step","1","min","0"],[4,"ngIf"],["matInput","","type","email","formControlName","userLockoutNotificationEmail"],["matInput","","type","number","formControlName","userActivationTokenTtl","step","1","min","1","max","24"],["matInput","","type","number","formControlName","passwordResetTokenTtl","step","1","min","1","max","24"],["matInput","","type","number","formControlName","mobileSecretKeyLength","step","1","min","1"],["formGroupName","passwordPolicy"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-1"],["matInput","","type","number","formControlName","minimumLength","step","1","min","6","max","50","required",""],["subscriptSizing","dynamic",1,"mat-block","flex-1"],["matInput","","type","number","formControlName","maximumLength","step","1","min","6"],["matInput","","type","number","formControlName","minimumUppercaseLetters","step","1","min","0"],["matInput","","type","number","formControlName","minimumLowercaseLetters","step","1","min","0"],["matInput","","type","number","formControlName","minimumDigits","step","1","min","0"],["matInput","","type","number","formControlName","minimumSpecialCharacters","step","1","min","0"],["matInput","","type","number","formControlName","passwordExpirationPeriodDays","step","1","min","0"],["matInput","","type","number","formControlName","passwordReuseFrequencyDays","step","1","min","0"],["formControlName","allowWhitespaces",1,"flex-1",2,"margin-bottom","16px"],["formControlName","forceUserToResetPasswordIfNotValid",1,"flex-1",2,"margin-bottom","16px"],[3,"tb-hint-tooltip-icon"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2",2,"margin-top","16px"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["tb-help","jwtSecuritySettings"],[2,"padding-top","16px"],[1,"flex","flex-col","gap-2",3,"disabled"],[1,"flex","flex-row","gap-2","xs:flex-col"],["matInput","","required","","formControlName","tokenIssuer"],["matInput","","required","","formControlName","tokenSigningKey",3,"focus"],["type","button","matSuffix","","mat-button","","color","primary",2,"line-height","32px",3,"click"],["matInput","","type","number","required","","formControlName","tokenExpirationTime","step","1","min","0"],["matInput","","type","number","required","","formControlName","refreshTokenExpTime","step","1","min","0"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title")(3,"span",1),p(4,"admin.security-settings"),r()(),f(5,"span",2)(6,"div",3),r(),b(7,Kb,1,0,"mat-progress-bar",4),d(8,"async"),b(9,Yb,1,0,"div",5),d(10,"async"),a(11,"mat-card-content")(12,"form",6),y("ngSubmit",function(){return t.save()}),a(13,"fieldset",7),d(14,"async"),a(15,"fieldset",8)(16,"legend",9),p(17,"admin.general-policy"),r(),a(18,"mat-form-field",10)(19,"mat-label",11),p(20,"admin.max-failed-login-attempts"),r(),f(21,"input",12),b(22,Xb,3,3,"mat-error",13),r(),a(23,"mat-form-field",10)(24,"mat-label",11),p(25,"admin.user-lockout-notification-email"),r(),f(26,"input",14),r(),a(27,"mat-form-field",10)(28,"mat-label",11),p(29,"admin.user-activation-token-ttl"),r(),f(30,"input",15),b(31,Zb,3,3,"mat-error",13)(32,e1,3,3,"mat-error",13),r(),a(33,"mat-form-field",10)(34,"mat-label",11),p(35,"admin.password-reset-token-ttl"),r(),f(36,"input",16),b(37,t1,3,3,"mat-error",13)(38,i1,3,3,"mat-error",13),r(),a(39,"mat-form-field",10)(40,"mat-label",11),p(41,"admin.mobile-secret-key-length"),r(),f(42,"input",17),b(43,n1,3,3,"mat-error",13),r()(),a(44,"fieldset",8)(45,"legend",9),p(46,"admin.password-policy"),r(),a(47,"section",18)(48,"div",19)(49,"mat-form-field",20)(50,"mat-label",11),p(51,"admin.minimum-password-length"),r(),f(52,"input",21),b(53,o1,3,3,"mat-error",13)(54,a1,3,3,"mat-error",13)(55,r1,3,3,"mat-error",13),r(),a(56,"mat-form-field",22)(57,"mat-label",11),p(58,"admin.maximum-password-length"),r(),f(59,"input",23)(60,"mat-hint"),b(61,s1,3,3,"mat-error",13)(62,l1,3,3,"mat-error",13),r()(),a(63,"div",19)(64,"mat-form-field",20)(65,"mat-label",11),p(66,"admin.minimum-uppercase-letters"),r(),f(67,"input",24),b(68,p1,3,3,"mat-error",13),r(),a(69,"mat-form-field",20)(70,"mat-label",11),p(71,"admin.minimum-lowercase-letters"),r(),f(72,"input",25),b(73,m1,3,3,"mat-error",13),r()(),a(74,"div",19)(75,"mat-form-field",20)(76,"mat-label",11),p(77,"admin.minimum-digits"),r(),f(78,"input",26),b(79,d1,3,3,"mat-error",13),r(),a(80,"mat-form-field",20)(81,"mat-label",11),p(82,"admin.minimum-special-characters"),r(),f(83,"input",27),b(84,c1,3,3,"mat-error",13),r()(),a(85,"div",19)(86,"mat-form-field",20)(87,"mat-label",11),p(88,"admin.password-expiration-period-days"),r(),f(89,"input",28),b(90,u1,3,3,"mat-error",13),r(),a(91,"mat-form-field",20)(92,"mat-label",11),p(93,"admin.password-reuse-frequency-days"),r(),f(94,"input",29),b(95,f1,3,3,"mat-error",13),r()(),a(96,"div",19)(97,"mat-checkbox",30)(98,"mat-label",11),p(99,"admin.allow-whitespace"),r()(),a(100,"mat-checkbox",31)(101,"mat-label",32),d(102,"translate"),p(103),d(104,"translate"),r()()()()(),a(105,"div",33)(106,"button",34),y("click",function(){return t.discardSetting()}),p(107),d(108,"translate"),r(),a(109,"button",35),d(110,"async"),p(111),d(112,"translate"),r()()()()()(),a(113,"mat-card",0)(114,"mat-card-header")(115,"mat-card-title")(116,"span",1),p(117,"admin.jwt.security-settings"),r()(),f(118,"span",2)(119,"div",36),r(),a(120,"mat-card-content",37)(121,"form",6),y("ngSubmit",function(){return t.saveJwtSettings()}),a(122,"fieldset",38),d(123,"async"),a(124,"div",39)(125,"mat-form-field",20)(126,"mat-label",11),p(127,"admin.jwt.issuer-name"),r(),f(128,"input",40),b(129,g1,3,3,"mat-error",13),r(),a(130,"mat-form-field",20)(131,"mat-label",11),p(132,"admin.jwt.signings-key"),r(),a(133,"input",41),y("focus",function(){return t.markAsTouched()}),r(),a(134,"button",42),y("click",function(){return t.generateSigningKey()}),p(135),d(136,"translate"),r(),a(137,"mat-hint",11),p(138,"admin.jwt.signings-key-hint"),r(),b(139,h1,3,3,"mat-error",13)(140,b1,3,3,"mat-error",13)(141,v1,3,3,"mat-error",13),r()(),a(142,"div",39)(143,"mat-form-field",20)(144,"mat-label",11),p(145,"admin.jwt.expiration-time"),r(),f(146,"input",43),b(147,y1,3,3,"mat-error",13)(148,_1,3,3,"mat-error",13)(149,C1,3,3,"mat-error",13),r(),a(150,"mat-form-field",20)(151,"mat-label",11),p(152,"admin.jwt.refresh-expiration-time"),r(),f(153,"input",44),b(154,S1,3,3,"mat-error",13)(155,T1,3,3,"mat-error",13)(156,x1,3,3,"mat-error",13)(157,I1,3,3,"mat-error",13),r()(),a(158,"div",45)(159,"button",34),y("click",function(){return t.discardJwtSetting()}),p(160),d(161,"translate"),r(),a(162,"button",46),d(163,"async"),p(164),d(165,"translate"),r()()()()()()),n&2&&(o(7),l("ngIf",c(8,45,t.isLoading$)),o(2),l("ngIf",!c(10,47,t.isLoading$)),o(3),l("formGroup",t.securitySettingsFormGroup),o(),l("disabled",c(14,49,t.isLoading$)),o(9),l("ngIf",t.securitySettingsFormGroup.get("maxFailedLoginAttempts").hasError("min")),o(9),l("ngIf",t.securitySettingsFormGroup.get("userActivationTokenTtl").hasError("min")),o(),l("ngIf",t.securitySettingsFormGroup.get("userActivationTokenTtl").hasError("max")),o(5),l("ngIf",t.securitySettingsFormGroup.get("passwordResetTokenTtl").hasError("min")),o(),l("ngIf",t.securitySettingsFormGroup.get("passwordResetTokenTtl").hasError("max")),o(5),l("ngIf",t.securitySettingsFormGroup.get("mobileSecretKeyLength").hasError("min")),o(10),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("required")),o(),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("min")),o(),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("max")),o(6),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.maximumLength").hasError("min")),o(),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.maximumLength").hasError("lessMin")),o(6),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumUppercaseLetters").hasError("min")),o(5),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLowercaseLetters").hasError("min")),o(6),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumDigits").hasError("min")),o(5),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumSpecialCharacters").hasError("min")),o(6),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.passwordExpirationPeriodDays").hasError("min")),o(5),l("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.passwordReuseFrequencyDays").hasError("min")),o(6),T("tb-hint-tooltip-icon",c(102,51,"admin.force-reset-password-if-no-valid-hint")),o(2),h(" ",c(104,53,"admin.force-reset-password-if-no-valid")," "),o(3),l("disabled",t.securitySettingsFormGroup.pristine),o(),h("",c(108,55,"action.undo")," "),o(2),l("disabled",c(110,57,t.isLoading$)||t.securitySettingsFormGroup.invalid||!t.securitySettingsFormGroup.dirty),o(2),h("",c(112,59,"action.save")," "),o(10),l("formGroup",t.jwtSecuritySettingsFormGroup),o(),l("disabled",c(123,61,t.isLoading$)),o(7),l("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenIssuer").hasError("required")),o(6),h(" ",c(136,63,"admin.jwt.generate-key")," "),o(4),l("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("required")),o(),l("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("base64")),o(),l("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("minLength")),o(6),l("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("required")),o(),l("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("pattern")),o(),l("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("min")),o(5),l("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("required")),o(),l("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("pattern")),o(),l("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("min")),o(),l("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("lessToken")),o(2),l("disabled",t.jwtSecuritySettingsFormGroup.pristine),o(),h("",c(161,65,"action.undo")," "),o(2),l("disabled",c(163,67,t.isLoading$)||t.jwtSecuritySettingsFormGroup.invalid||!t.jwtSecuritySettingsFormGroup.dirty),o(2),h("",c(165,69,"action.save")," "))},dependencies:[V,Tt,K,$t,ti,pi,yi,vi,Oe,ge,me,Ie,zt,De,ei,fe,ue,Ti,W,z,ce,Li,tn,X,oe,ft,H,qs,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:8px 16px 0;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();C();function E1(i,m){i&1&&f(0,"mat-progress-bar",17)}function w1(i,m){i&1&&f(0,"div",18)}function M1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.sms-message-required")," "))}function D1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.sms-message-max-length")," "))}var Sl=(()=>{class i extends et{constructor(e,n,t,s,u,_,E){super(e,n,_),this.store=e,this.router=n,this.data=t,this.adminService=s,this.translate=u,this.dialogRef=_,this.fb=E,this.phoneNumberPattern=Xa,this.smsProviderConfiguration=this.data.smsProviderConfiguration}ngOnInit(){this.sendTestSmsFormGroup=this.fb.group({numberTo:[null,[S.required,S.pattern(Xa)]],message:[null,[S.required,S.maxLength(1600)]]})}close(){this.dialogRef.close()}sendTestSms(){let e={providerConfiguration:this.smsProviderConfiguration,numberTo:this.sendTestSmsFormGroup.value.numberTo,message:this.sendTestSmsFormGroup.value.message};this.adminService.sendTestSms(e).subscribe(()=>{this.store.dispatch(new tt({message:this.translate.instant("admin.test-sms-sent"),target:"sendTestSmsDialogContent",verticalPosition:"bottom",horizontalPosition:"left",type:"success"}))})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(Hn),g(ie),g(Ze),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-send-test-sms-dialog"]],features:[G],decls:32,vars:29,consts:[[2,"min-width","500px","position","relative",3,"formGroup"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","sendTestSmsDialogContent"],[3,"disabled"],["required","","formControlName","numberTo",3,"enableFlagsSelect","label"],[1,"mat-block"],["required","","matInput","","rows","3","formControlName","message",3,"maxLength"],[4,"ngIf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(a(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"admin.send-test-sms"),r(),f(4,"span",3),a(5,"button",4),y("click",function(){return t.close()}),a(6,"mat-icon",5),p(7,"close"),r()()(),b(8,E1,1,0,"mat-progress-bar",6),d(9,"async"),b(10,w1,1,0,"div",7),d(11,"async"),a(12,"div",8)(13,"fieldset",9),d(14,"async"),f(15,"tb-phone-input",10),d(16,"translate"),a(17,"mat-form-field",11)(18,"mat-label",2),p(19,"admin.sms-message"),r(),f(20,"textarea",12),b(21,M1,3,3,"mat-error",13)(22,D1,3,3,"mat-error",13),r()()(),a(23,"div",14)(24,"button",15),d(25,"async"),y("click",function(){return t.close()}),p(26),d(27,"translate"),r(),a(28,"button",16),d(29,"async"),y("click",function(){return t.sendTestSms()}),p(30),d(31,"translate"),r()()()),n&2&&(l("formGroup",t.sendTestSmsFormGroup),o(8),l("ngIf",c(9,13,t.isLoading$)),o(2),l("ngIf",!c(11,15,t.isLoading$)),o(3),l("disabled",c(14,17,t.isLoading$)),o(2),T("label",c(16,19,"admin.number-to")),l("enableFlagsSelect",!1),o(5),l("maxLength",1600),o(),l("ngIf",t.sendTestSmsFormGroup.get("message").hasError("required")),o(),l("ngIf",t.sendTestSmsFormGroup.get("message").hasError("maxLength")),o(2),l("disabled",c(25,21,t.isLoading$)),o(2),h(" ",c(27,23,"action.close")," "),o(2),l("disabled",c(29,25,t.isLoading$)||t.sendTestSmsFormGroup.invalid),o(2),h(" ",c(31,27,"admin.send-test-sms")," "))},dependencies:[V,Vi,K,Ce,ee,Oe,ge,me,Ie,De,He,Ct,Je,fe,ue,W,z,ce,X,oe,H,xo,le,k],encapsulation:2})}}return i})();function P1(i,m){i&1&&f(0,"mat-progress-bar",22)}function F1(i,m){i&1&&f(0,"div",23)}function A1(i,m){if(i&1){let e=O();a(0,"mat-card",16)(1,"mat-card-header")(2,"mat-card-title")(3,"span",3),p(4,"admin.sms-provider-settings"),r()(),f(5,"span",4)(6,"div",17),r(),b(7,P1,1,0,"mat-progress-bar",6),d(8,"async"),b(9,F1,1,0,"div",7),d(10,"async"),a(11,"mat-card-content")(12,"form",1),y("ngSubmit",function(){x(e);let t=v();return I(t.save())}),f(13,"tb-sms-provider-configuration",18),a(14,"div",19)(15,"button",20),d(16,"async"),y("click",function(){x(e);let t=v();return I(t.sendTestSms())}),p(17),d(18,"translate"),r(),a(19,"button",21),d(20,"async"),p(21),d(22,"translate"),r()()()()()}if(i&2){let e=v();o(7),l("ngIf",c(8,7,e.isLoading$)),o(2),l("ngIf",!c(10,9,e.isLoading$)),o(3),l("formGroup",e.smsProvider),o(3),l("disabled",c(16,11,e.isLoading$)||e.smsProvider.invalid),o(2),h(" ",c(18,13,"admin.send-test-sms")," "),o(2),l("disabled",c(20,15,e.isLoading$)||e.smsProvider.invalid||!e.smsProvider.dirty),o(2),h("",c(22,17,"action.save")," ")}}function N1(i,m){i&1&&f(0,"mat-progress-bar",22)}function k1(i,m){i&1&&f(0,"div",23)}function R1(i,m){i&1&&(a(0,"mat-card-header")(1,"mat-card-title")(2,"span",3),p(3,"admin.mobile-settings"),r()(),f(4,"span",4),r())}function O1(i,m){if(i&1){let e=O();a(0,"mat-card-content",24)(1,"tb-file-input",25),d(2,"translate"),d(3,"translate"),y("fileNameChanged",function(t){x(e);let s=v();return I(s.notificationSettingsForm==null?null:s.notificationSettingsForm.get("deliveryMethodsConfigs.MOBILE_APP.firebaseServiceAccountCredentialsFileName").patchValue(t))}),r()()}if(i&2){let e,n=v();o(),T("dropLabel",c(2,3,"admin.select-firebase-service-account-file")),T("label",c(3,5,"admin.firebase-service-account-file")),l("existingFileName",(e=n.notificationSettingsForm.get("deliveryMethodsConfigs.MOBILE_APP.firebaseServiceAccountCredentialsFileName"))==null?null:e.value)}}var Tl=(()=>{class i extends It{constructor(e,n,t,s,u,_){super(e),this.store=e,this.router=n,this.adminService=t,this.notificationService=s,this.dialog=u,this.fb=_,this.authUser=Bt(this.store),this.buildSmsProviderForm(),this.buildGeneralServerSettingsForm(),this.notificationService.getNotificationSettings().subscribe(E=>{this.notificationSettings=E,this.notificationSettingsForm.reset(this.notificationSettings)}),this.isSysAdmin()&&this.adminService.getAdminSettings("sms",{ignoreErrors:!0}).subscribe({next:E=>{this.adminSettings=E,this.smsProvider.reset({configuration:this.adminSettings.jsonValue})},error:()=>{this.adminSettings={key:"sms",jsonValue:null},this.smsProvider.reset({configuration:this.adminSettings.jsonValue})}})}buildSmsProviderForm(){this.smsProvider=this.fb.group({configuration:[null,[S.required]]}),this.registerDisableOnLoadFormControl(this.smsProvider.get("configuration"))}sendTestSms(){this.dialog.open(Sl,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{smsProviderConfiguration:this.smsProvider.value.configuration}})}save(){this.adminSettings.jsonValue=this.smsProvider.value.configuration,this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>{this.adminSettings=e,this.smsProvider.reset({configuration:this.adminSettings.jsonValue})})}confirmForm(){return this.smsProvider.dirty?this.smsProvider:this.notificationSettingsForm}buildGeneralServerSettingsForm(){this.notificationSettingsForm=this.fb.group({deliveryMethodsConfigs:this.fb.group({SLACK:this.fb.group({botToken:[""]}),MOBILE_APP:this.fb.group({firebaseServiceAccountCredentialsFileName:[""],firebaseServiceAccountCredentials:[""]})})}),this.registerDisableOnLoadFormControl(this.notificationSettingsForm.get("deliveryMethodsConfigs"))}saveNotification(){this.notificationSettings=to(_e(_e({},this.notificationSettings),this.notificationSettingsForm.value));for(let e in this.notificationSettings.deliveryMethodsConfigs)Object.keys(this.notificationSettings.deliveryMethodsConfigs[e]).some(t=>!fa(this.notificationSettings.deliveryMethodsConfigs[e][t]))?delete this.notificationSettings.deliveryMethodsConfigs[e]:this.notificationSettings.deliveryMethodsConfigs[e].method=e;this.notificationService.saveNotificationSettings(this.notificationSettings).subscribe(e=>{this.notificationSettings=e,this.notificationSettingsForm.reset(this.notificationSettings)})}isSysAdmin(){return this.authUser.authority===M.SYS_ADMIN}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Hn),g(Ii),g(je),g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-sms-provider"]],features:[G],decls:25,vars:16,consts:[["appearance","outlined","class","settings-card",4,"ngIf"],[3,"ngSubmit","formGroup"],["appearance","outlined","formGroupName","deliveryMethodsConfigs",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","slackSettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["formGroupName","SLACK"],["subscriptSizing","dynamic",1,"mat-block"],["translate",""],["matInput","","formControlName","botToken"],[4,"ngIf"],["formGroupName","MOBILE_APP",4,"ngIf"],[1,"flex","items-center","justify-end","xs:flex-col","xs:items-stretch"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outlined",1,"settings-card"],["tb-help","smsProviderSettings"],["required","","formControlName","configuration"],[1,"flex","flex-row","items-center","justify-end","gap-4","xs:flex-col","xs:items-stretch"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["formGroupName","MOBILE_APP"],["formControlName","firebaseServiceAccountCredentials","accept",".json,application/json","allowedExtensions","json",3,"fileNameChanged","dropLabel","label","existingFileName"]],template:function(n,t){n&1&&(b(0,A1,23,19,"mat-card",0),a(1,"form",1),y("ngSubmit",function(){return t.saveNotification()}),a(2,"mat-card",2)(3,"mat-card-header")(4,"mat-card-title")(5,"span",3),p(6,"admin.slack-settings"),r()(),f(7,"span",4)(8,"div",5),r(),b(9,N1,1,0,"mat-progress-bar",6),d(10,"async"),b(11,k1,1,0,"div",7),d(12,"async"),a(13,"mat-card-content",8)(14,"mat-form-field",9)(15,"mat-label",10),p(16,"admin.slack-api-token"),r(),f(17,"input",11),r()(),b(18,R1,5,0,"mat-card-header",12)(19,O1,4,7,"mat-card-content",13),a(20,"mat-card-actions",14)(21,"button",15),d(22,"async"),p(23),d(24,"translate"),r()()()()),n&2&&(l("ngIf",t.isSysAdmin()),o(),l("formGroup",t.notificationSettingsForm),o(8),l("ngIf",c(10,8,t.isLoading$)),o(2),l("ngIf",!c(12,10,t.isLoading$)),o(7),l("ngIf",t.isSysAdmin()),o(),l("ngIf",t.isSysAdmin()),o(2),l("disabled",c(22,12,t.isLoading$)||t.notificationSettingsForm.invalid||!t.notificationSettingsForm.dirty),o(2),h("",c(24,14,"action.save")," "))},dependencies:[V,Tt,K,ti,hs,pi,yi,vi,Oe,ge,me,Ie,fe,ue,W,z,ce,X,oe,ft,qa,H,Hf,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center;min-height:64px}[_nghost-%COMP%]   .mdc-card__actions[_ngcontent-%COMP%]{padding:16px}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();function B1(i,m){i&1&&f(0,"mat-progress-bar",13)}function V1(i,m){i&1&&f(0,"div",14)}var xl=(()=>{class i extends It{constructor(e,n,t,s){super(e),this.store=e,this.router=n,this.dashboardService=t,this.fb=s}ngOnInit(){this.homeSettings=this.fb.group({dashboardId:[null],hideDashboardToolbar:[!0]}),this.dashboardService.getTenantHomeDashboardInfo().subscribe(e=>{this.setHomeDashboardInfo(e)})}save(){let e=this.homeSettings.get("dashboardId").value,n=e?new zf(e):null,t=this.homeSettings.get("hideDashboardToolbar").value,s={dashboardId:n,hideDashboardToolbar:t};this.dashboardService.setTenantHomeDashboardInfo(s).subscribe(()=>{this.setHomeDashboardInfo(s)})}confirmForm(){return this.homeSettings}setHomeDashboardInfo(e){this.homeSettings.reset({dashboardId:e?.dashboardId?.id,hideDashboardToolbar:Re(e?.hideDashboardToolbar)?e?.hideDashboardToolbar:!0})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ps),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-home-settings"]],features:[G],decls:26,vars:24,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","dashboardId",1,"flex-1",3,"label","dashboardsScope","selectFirstDashboard"],["formControlName","hideDashboardToolbar",1,"flex-1"],[1,"flex","w-full","flex-row","flex-wrap","items-center","justify-end"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(a(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title")(4,"span",1),p(5,"admin.home-settings"),r()()(),b(6,B1,1,0,"mat-progress-bar",2),d(7,"async"),b(8,V1,1,0,"div",3),d(9,"async"),a(10,"mat-card-content",4)(11,"form",5),y("ngSubmit",function(){return t.save()}),a(12,"fieldset",6),d(13,"async"),a(14,"section",7)(15,"section",8),f(16,"tb-dashboard-autocomplete",9),d(17,"translate"),a(18,"mat-checkbox",10),p(19),d(20,"translate"),r()()(),a(21,"div",11)(22,"button",12),d(23,"async"),p(24),d(25,"translate"),r()()()()()()()),n&2&&(o(6),l("ngIf",c(7,10,t.isLoading$)),o(2),l("ngIf",c(9,12,t.isLoading$)===!1),o(3),l("formGroup",t.homeSettings),o(),l("disabled",c(13,14,t.isLoading$)),o(4),T("label",c(17,16,"dashboard.home-dashboard")),l("dashboardsScope","tenant")("selectFirstDashboard",!1),o(3),h(" ",c(20,18,"dashboard.home-dashboard-hide-toolbar")," "),o(3),l("disabled",c(23,20,t.isLoading$)||t.homeSettings.invalid||!t.homeSettings.dirty),o(2),h("",c(25,22,"action.save")," "))},dependencies:[V,_n,K,$t,ti,pi,yi,vi,Oe,fe,W,z,X,oe,H,le,k],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();C();function L1(i,m){if(i&1&&(a(0,"mat-option",16),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.resourceTypesTranslationMap.get(e))," ")}}function j1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"resource.title-required")," "))}function G1(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"resource.title-max-length")," "))}function U1(i,m){if(i&1&&(a(0,"mat-form-field",10)(1,"mat-label",6),p(2,"resource.title"),r(),f(3,"input",17),b(4,j1,3,3,"mat-error",18)(5,G1,3,3,"mat-error",18),r()),i&2){let e=v();o(4),l("ngIf",e.entityForm.get("title").hasError("required")),o(),l("ngIf",e.entityForm.get("title").hasError("maxlength"))}}function q1(i,m){if(i&1){let e=O();a(0,"tb-file-input",19),d(1,"translate"),d(2,"translate"),y("fileNameChanged",function(t){x(e);let s=v();return I(s.entityForm==null?null:s.entityForm.get("fileName").patchValue(t))}),r()}if(i&2){let e,n=v();T("label",c(1,10,n.entityForm.get("resourceType").value===n.resourceType.LWM2M_MODEL?"resource.resource-files":"resource.resource-file")),T("dropLabel",c(2,12,"resource.drop-resource-file-or")),l("required",n.isAdd)("readAsBinary",!0)("maxSizeByte",n.maxResourceSize)("allowedExtensions",n.getAllowedExtensions())("contentConvertFunction",n.convertToBase64File)("accept",n.getAcceptType())("multipleFile",n.entityForm.get("resourceType").value===n.resourceType.LWM2M_MODEL)("existingFileName",(e=n.entityForm.get("fileName"))==null?null:e.value)}}function W1(i,m){i&1&&(a(0,"div",20)(1,"mat-form-field",21)(2,"mat-label",6),p(3,"resource.file-name"),r(),f(4,"input",22),r()())}var Il=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,u,t,s,_),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.fb=u,this.cd=_,this.resourceType=no,this.resourceTypes=Object.values(this.resourceType),this.resourceTypesTranslationMap=Aa,this.maxResourceSize=fn(this.store).maxResourceSize,this.destroy$=new Ft}ngOnInit(){super.ngOnInit(),this.isAdd&&this.observeResourceTypeChange()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],resourceType:[e?.resourceType?e.resourceType:no.JS_MODULE,S.required],fileName:[e?e.fileName:null,S.required],data:[e?e.data:null,this.isAdd?[S.required]:[]]})}updateForm(e){this.entityForm.patchValue(e)}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("resourceType").disable({emitEvent:!1}),this.entityForm.get("resourceType").value!==no.JS_MODULE&&this.entityForm.get("fileName").disable({emitEvent:!1}))}prepareFormValue(e){return this.isEdit&&!Re(e.data)&&delete e.data,super.prepareFormValue(e)}getAllowedExtensions(){try{return S0.get(this.entityForm.get("resourceType").value)}catch{return""}}getAcceptType(){try{return C0.get(this.entityForm.get("resourceType").value)}catch{return"*/*"}}convertToBase64File(e){return window.btoa(e)}onResourceIdCopied(){this.store.dispatch(new tt({message:this.translate.instant("resource.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}observeResourceTypeChange(){this.entityForm.get("resourceType").valueChanges.pipe(Xn(no.JS_MODULE),dt(this.destroy$)).subscribe(e=>this.onResourceTypeChange(e))}onResourceTypeChange(e){e===this.resourceType.LWM2M_MODEL?(this.entityForm.get("title").disable({emitEvent:!1}),this.entityForm.patchValue({title:""},{emitEvent:!1})):this.entityForm.get("title").enable({emitEvent:!1}),this.entityForm.patchValue({data:null,fileName:null},{emitEvent:!1})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(ht),g(Xe))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-resources-library"]],features:[G],decls:30,vars:35,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["formControlName","resourceType","required",""],[3,"value",4,"ngFor","ngForOf"],["class","mat-block",4,"ngIf"],["formControlName","data",3,"required","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","multipleFile","dropLabel","existingFileName","fileNameChanged",4,"ngIf"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-md:gap-2",4,"ngIf"],[3,"value"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","data",3,"fileNameChanged","required","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","multipleFile","dropLabel","existingFileName"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],[1,"flex-1"],["matInput","","formControlName","fileName","type","text"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",2),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"downloadResource")}),p(7),d(8,"translate"),r(),a(9,"button",2),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(11),d(12,"translate"),r(),a(13,"div",3)(14,"button",4),y("cbOnSuccess",function(){return t.onResourceIdCopied()}),f(15,"mat-icon",5),a(16,"span",6),p(17,"resource.copyId"),r()()()(),a(18,"div",7)(19,"form",8)(20,"fieldset",9),d(21,"async"),a(22,"mat-form-field",10)(23,"mat-label",6),p(24,"resource.resource-type"),r(),a(25,"mat-select",11),b(26,L1,3,4,"mat-option",12),r()(),b(27,U1,6,2,"mat-form-field",13)(28,q1,3,14,"tb-file-input",14)(29,W1,5,0,"div",15),r()()()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,21,t.isLoading$)),o(2),h(" ",c(4,23,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(6,25,t.isLoading$)),o(2),h(" ",c(8,27,"resource.download")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(10,29,t.isLoading$)),o(2),h(" ",c(12,31,"resource.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),l("formGroup",t.entityForm),o(),l("disabled",c(21,33,t.isLoading$)||!t.isEdit),o(6),l("ngForOf",t.resourceTypes),o(),l("ngIf",t.entityForm.get("resourceType").value!==t.resourceType.LWM2M_MODEL||!t.isAdd),o(),l("ngIf",t.isAdd||t.isEdit&&t.entityForm.get("resourceType").value===t.resourceType.JS_MODULE),o(),l("ngIf",!t.isAdd&&!(t.isEdit&&t.entityForm.get("resourceType").value===t.resourceType.JS_MODULE)))},dependencies:[we,V,K,ee,ge,me,Ie,De,St,ct,ii,fe,ue,W,z,ce,X,oe,qa,H,le,k],encapsulation:2})}}return i})();C();function H1(i,m){if(i&1&&(a(0,"mat-option",5),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.resourceTypesTranslationMap.get(e))," ")}}var El=(()=>{class i extends Jt{constructor(e){super(e),this.store=e,this.resourceTypes=Object.values(no),this.resourceTypesTranslationMap=Aa}resourceTypeChanged(e){this.entitiesTableConfig.componentsData.resourceType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-resources-table-header"]],features:[G],decls:9,vars:8,consts:[["subscriptSizing","dynamic",1,"mat-block"],["translate",""],[3,"ngModelChange","ngModel","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,t){n&1&&(a(0,"mat-form-field",0)(1,"mat-label",1),p(2,"resource.resource-type"),r(),a(3,"mat-select",2),d(4,"translate"),y("ngModelChange",function(u){return t.resourceTypeChanged(u)}),a(5,"mat-option",3),p(6),d(7,"translate"),r(),b(8,H1,3,4,"mat-option",4),r()()),n&2&&(o(3),T("placeholder",c(4,4,"resource.resource-type")),l("ngModel",t.entitiesTableConfig.componentsData.resourceType),o(3),h(" ",c(7,6,"resource.all-types")," "),o(2),l("ngForOf",t.resourceTypes))},dependencies:[we,me,Ie,St,ct,W,ut,H,k],encapsulation:2})}}return i})();var wl=(()=>{class i{constructor(e,n,t,s,u){this.store=e,this.resourceService=n,this.translate=t,this.router=s,this.datePipe=u,this.config=new Qe,this.resourceTypesTranslationMap=Aa,this.config.entityType=B.TB_RESOURCE,this.config.entityComponent=Il,this.config.entityTranslations=$e.get(B.TB_RESOURCE),this.config.entityResources=_t.get(B.TB_RESOURCE),this.config.headerComponent=El,this.config.entityTitle=_=>_?_.title:"",this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("title","resource.title","60%"),new te("resourceType","resource.resource-type","40%",_=>this.translate.instant(this.resourceTypesTranslationMap.get(_.resourceType))),new te("tenantId","resource.system","60px",_=>Ot(_.tenantId.id===Be))),this.config.cellActionDescriptors.push({name:this.translate.instant("resource.download"),icon:"file_download",isEnabled:()=>!0,onAction:(_,E)=>this.downloadResource(_,E)}),this.config.deleteEntityTitle=_=>this.translate.instant("resource.delete-resource-title",{resourceTitle:_.title}),this.config.deleteEntityContent=()=>this.translate.instant("resource.delete-resource-text"),this.config.deleteEntitiesTitle=_=>this.translate.instant("resource.delete-resources-title",{count:_}),this.config.deleteEntitiesContent=()=>this.translate.instant("resource.delete-resources-text"),this.config.entitiesFetchFunction=_=>this.resourceService.getResources(_,this.config.componentsData.resourceType),this.config.loadEntity=_=>this.resourceService.getResourceInfoById(_.id),this.config.saveEntity=_=>this.saveResource(_),this.config.deleteEntity=_=>this.resourceService.deleteResource(_.id),this.config.onEntityAction=_=>this.onResourceAction(_)}saveResource(e){if(Array.isArray(e.data)){let n=[];return e.data.forEach((t,s)=>{n.push({resourceType:e.resourceType,data:t,fileName:e.fileName[s],title:e.title})}),this.resourceService.saveResources(n,{resendRequest:!0}).pipe(mt(t=>t[0]))}else return this.resourceService.saveResource(e)}resolve(){this.config.tableTitle=this.translate.instant("resource.resources-library"),this.config.componentsData={resourceType:""};let e=Bt(this.store);return this.config.deleteEnabled=n=>this.isResourceEditable(n,e.authority),this.config.entitySelectionEnabled=n=>this.isResourceEditable(n,e.authority),this.config.detailsReadonly=n=>this.detailsReadonly(n,e.authority),this.config}openResource(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["resources","resources-library",n.id.id]);this.router.navigateByUrl(t).then(()=>{})}downloadResource(e,n){e&&e.stopPropagation(),this.resourceService.downloadResource(n.id.id).subscribe()}onResourceAction(e){switch(e.action){case"open":return this.openResource(e.event,e.entity),!0;case"downloadResource":return this.downloadResource(e.event,e.entity),!0}return!1}detailsReadonly(e,n){return e?.resourceType===no.LWM2M_MODEL?!0:!this.isResourceEditable(e,n)}isResourceEditable(e,n){return n===M.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Be:n===M.SYS_ADMIN}static{this.\u0275fac=function(n){return new(n||i)(N(P),N($0),N(ie),N(de),N(Ge))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();var vt=(i,m,e)=>{switch(e.entitiesTableConfig.entityType){case B.TB_RESOURCE:case B.OTA_PACKAGE:return e.entity?.title;default:return e.entity?.name}};C();C();var Ml=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,_,t,s,u),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.cd=u,this.fb=_,this.entityType=B,this.submitStrategies=[],this.processingStrategies=[]}ngOnInit(){super.ngOnInit()}buildForm(e){return this.fb.group({queue:[e]})}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}updateForm(e){this.entityForm.patchValue({queue:e},{emitEvent:!1})}prepareFormValue(e){return super.prepareFormValue(e.queue)}onQueueIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("queue.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(Xe),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-queue"]],features:[G],decls:16,vars:22,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col",3,"formGroup"],["formControlName","queue",3,"newQueue","systemQueue"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",2),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(7),d(8,"translate"),r(),a(9,"div",3)(10,"button",4),y("cbOnSuccess",function(u){return t.onQueueIdCopied(u)}),f(11,"mat-icon",5),a(12,"span",6),p(13,"queue.copyId"),r()()()(),a(14,"div",7),f(15,"tb-queue-form",8),r()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,14,t.isLoading$)),o(2),h(" ",c(4,16,"common.open-details-page")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(6,18,t.isLoading$)),o(2),h(" ",c(8,20,"queue.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(4),l("formGroup",t.entityForm),o(),l("newQueue",t.isAdd)("systemQueue",!0))},dependencies:[K,ee,ii,W,z,X,oe,H,og,le,k],encapsulation:2})}}return i})();var Pl=(()=>{class i{constructor(e,n,t,s,u,_,E,w){this.store=e,this.broadcast=n,this.queueService=t,this.customerService=s,this.dialogService=u,this.homeDialogs=_,this.router=E,this.translate=w,this.queueType=zs.TB_RULE_ENGINE,this.config=new Qe,this.config.entityType=B.QUEUE,this.config.entityComponent=Ml,this.config.entityTranslations=$e.get(B.QUEUE),this.config.entityResources=_t.get(B.QUEUE),this.config.deleteEntityTitle=q=>this.translate.instant("queue.delete-queue-title",{queueName:q.name}),this.config.deleteEntityContent=()=>this.translate.instant("queue.delete-queue-text"),this.config.deleteEntitiesTitle=q=>this.translate.instant("queue.delete-queues-title",{count:q}),this.config.deleteEntitiesContent=()=>this.translate.instant("queue.delete-queues-text"),this.config.onEntityAction=q=>this.onQueueAction(q)}resolve(e){return this.config.componentsData={queueType:this.queueType},this.store.pipe(Ht(Vn),gi(1)).pipe(mt(()=>(this.config.tableTitle=this.translate.instant("admin.queues"),this.config.columns=this.configureColumns(),this.configureEntityFunctions(),this.config)))}configureColumns(){return[new te("name","admin.queue-name","25%"),new te("partitions","admin.queue-partitions","25%"),new te("submitStrategy","admin.queue-submit-strategy","25%",e=>this.translate.instant(lf.get(e.submitStrategy.type).label),()=>({}),!1),new te("processingStrategy","admin.queue-processing-strategy","25%",e=>this.translate.instant(pf.get(e.processingStrategy.type).label),()=>({}),!1)]}configureEntityFunctions(){this.config.entitiesFetchFunction=e=>this.queueService.getTenantQueuesByServiceType(e,this.queueType),this.config.loadEntity=e=>this.queueService.getQueueById(e.id),this.config.saveEntity=e=>this.queueService.saveQueue(e,this.queueType).pipe(yt(n=>this.queueService.getQueueById(n.id.id))),this.config.deleteEntity=e=>this.queueService.deleteQueue(e.id),this.config.deleteEnabled=e=>e&&e.name!=="Main",this.config.entitySelectionEnabled=e=>e&&e.name!=="Main"}onQueueAction(e){switch(e.action){case"open":return this.openQueue(e.event,e.entity),!0}return!1}openQueue(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["settings","queues",n.id.id]);this.router.navigateByUrl(t)}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(jn),N(W0),N(on),N(Lt),N(Ui),N(de),N(ie))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();var $1=["repositorySettingsComponent"],Fl=(()=>{class i extends It{constructor(e){super(e),this.store=e}ngOnInit(){}confirmForm(){return this.repositorySettingsComponent?.repositorySettingsForm}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-repository-admin-settings"]],viewQuery:function(n,t){if(n&1&&be($1,5),n&2){let s;ve(s=ye())&&(t.repositorySettingsComponent=s.first)}},features:[G],decls:2,vars:0,consts:[["repositorySettingsComponent",""]],template:function(n,t){n&1&&f(0,"tb-repository-settings",null,0)},dependencies:[ol],encapsulation:2})}}return i})();C();var Q1=["repositorySettingsComponent"],J1=["autoCommitSettingsComponent"];function K1(i,m){i&1&&f(0,"tb-repository-settings",null,1)}function Y1(i,m){i&1&&f(0,"tb-auto-commit-settings",null,2)}var Al=(()=>{class i extends It{constructor(e){super(e),this.store=e,this.hasRepository$=this.store.pipe(Ht(_u))}ngOnInit(){}confirmForm(){return this.repositorySettingsComponent?this.repositorySettingsComponent?.repositorySettingsForm:this.autoCommitSettingsComponent?.autoCommitSettingsForm}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-auto-commit-admin-settings"]],viewQuery:function(n,t){if(n&1&&(be(Q1,5),be(J1,5)),n&2){let s;ve(s=ye())&&(t.repositorySettingsComponent=s.first),ve(s=ye())&&(t.autoCommitSettingsComponent=s.first)}},features:[G],decls:4,vars:4,consts:[["autoCommitSettings",""],["repositorySettingsComponent",""],["autoCommitSettingsComponent",""],[4,"ngIf","ngIfElse"]],template:function(n,t){if(n&1&&(b(0,K1,2,0,"tb-repository-settings",3),d(1,"async"),b(2,Y1,2,0,"ng-template",null,0,xt)),n&2){let s=U(3);l("ngIf",!c(1,2,t.hasRepository$))("ngIfElse",s)}},dependencies:[V,ol,ag,le],encapsulation:2})}}return i})();C();function X1(i,m){i&1&&f(0,"mat-progress-bar",25)}function Z1(i,m){i&1&&f(0,"div",26)}function ev(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.issuer-name-required")," "))}function tv(i,m){if(i&1&&(Ut(0),a(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.issuer-name"),r(),f(4,"input",32),b(5,ev,3,3,"mat-error",16),r(),qt()),i&2){let e=v(2).$implicit;o(5),l("ngIf",e.get("issuerName").hasError("required")||e.get("issuerName").hasError("pattern"))}}function iv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-message-template-required")," "))}function nv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-message-template-pattern")," "))}function ov(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-code-lifetime-required")," "))}function av(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-code-lifetime-pattern")," "))}function rv(i,m){if(i&1&&(a(0,"div",33)(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.verification-message-template"),r(),f(4,"input",34),b(5,iv,3,3,"mat-error",16)(6,nv,3,3,"mat-error",16),r(),a(7,"mat-form-field",13)(8,"mat-label",14),p(9,"admin.2fa.verification-code-lifetime"),r(),f(10,"input",35),b(11,ov,3,3,"mat-error",16)(12,av,3,3,"mat-error",16),r()()),i&2){let e=v(2).$implicit;o(5),l("ngIf",e.get("smsVerificationMessageTemplate").hasError("required")),o(),l("ngIf",e.get("smsVerificationMessageTemplate").hasError("pattern")),o(5),l("ngIf",e.get("verificationCodeLifetime").hasError("required")),o(),l("ngIf",e.get("verificationCodeLifetime").hasError("min")||e.get("verificationCodeLifetime").hasError("pattern"))}}function sv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-code-lifetime-required")," "))}function lv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-code-lifetime-pattern")," "))}function pv(i,m){if(i&1&&(a(0,"div")(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.verification-code-lifetime"),r(),f(4,"input",35),b(5,sv,3,3,"mat-error",16)(6,lv,3,3,"mat-error",16),r()()),i&2){let e=v(2).$implicit;o(5),l("ngIf",e.get("verificationCodeLifetime").hasError("required")),o(),l("ngIf",e.get("verificationCodeLifetime").hasError("min")||e.get("verificationCodeLifetime").hasError("pattern"))}}function mv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.number-of-codes-required")," "))}function dv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.number-of-codes-pattern")," "))}function cv(i,m){if(i&1&&(a(0,"div")(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.number-of-codes"),r(),f(4,"input",36),b(5,mv,3,3,"mat-error",16)(6,dv,3,3,"mat-error",16),r()()),i&2){let e=v(2).$implicit;o(5),l("ngIf",e.get("codesQuantity").hasError("required")),o(),l("ngIf",e.get("codesQuantity").hasError("min")||e.get("codesQuantity").hasError("pattern"))}}function uv(i,m){if(i&1&&(Ut(0,29),b(1,tv,6,1,"ng-container",30)(2,rv,13,4,"div",31)(3,pv,7,2,"div",30)(4,cv,7,2,"div",30),qt()),i&2){let e=v().$implicit,n=v();l("ngSwitch",e.get("providerType").value),o(),l("ngSwitchCase",n.twoFactorAuthProviderType.TOTP),o(),l("ngSwitchCase",n.twoFactorAuthProviderType.SMS),o(),l("ngSwitchCase",n.twoFactorAuthProviderType.EMAIL),o(),l("ngSwitchCase",n.twoFactorAuthProviderType.BACKUP_CODE)}}function fv(i,m){i&1&&f(0,"mat-divider")}function gv(i,m){if(i&1){let e=O();Ut(0),a(1,"mat-expansion-panel",27)(2,"mat-expansion-panel-header")(3,"mat-panel-title",20)(4,"mat-slide-toggle",28),y("mousedown",function(t){let s=x(e),u=s.$implicit,_=s.index,E=v();return I(E.toggleExtensionPanel(t,_,u.get("enable").value))}),p(5),d(6,"translate"),r()()(),b(7,uv,5,5,"ng-template",22),r(),b(8,fv,1,0,"mat-divider",16),qt()}if(i&2){let e=m.$implicit,n=m.index,t=m.last,s=v();o(),l("formGroupName",n),o(4),h(" ",c(6,3,s.twoFactorAuthProvidersData.get(e.value.providerType).name)," "),o(3),l("ngIf",!t)}}function hv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.total-allowed-time-for-verification-required")," "))}function bv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.total-allowed-time-for-verification-pattern")," "))}function vv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.retry-verification-code-period-required")," "))}function yv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.retry-verification-code-period-pattern")," "))}function _v(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.max-verification-failures-before-user-lockout-pattern")," "))}function Cv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.number-of-checking-attempts-required")," "))}function Sv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.number-of-checking-attempts-pattern")," "))}function Tv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.within-time-required")," "))}function xv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.within-time-pattern")," "))}function Iv(i,m){if(i&1&&(a(0,"div",33)(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.number-of-checking-attempts"),r(),f(4,"input",37),b(5,Cv,3,3,"mat-error",16)(6,Sv,3,3,"mat-error",16),r(),a(7,"mat-form-field",13)(8,"mat-label",14),p(9,"admin.2fa.within-time"),r(),f(10,"input",38),b(11,Tv,3,3,"mat-error",16)(12,xv,3,3,"mat-error",16),r()()),i&2){let e=v();o(5),l("ngIf",e.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("required")),o(),l("ngIf",e.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("pattern")||e.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("min")),o(5),l("ngIf",e.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("required")),o(),l("ngIf",e.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("pattern")||e.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("min"))}}var Nl=(()=>{class i extends It{constructor(e,n,t){super(e),this.store=e,this.twoFaService=n,this.fb=t,this.destroy$=new Ft,this.posIntValidation=[S.required,S.min(1),S.pattern(/^\d*$/)],this.twoFactorAuthProviderType=Et,this.twoFactorAuthProvidersData=il,this.showMainLoadingBar=!1}ngOnInit(){this.build2faSettingsForm(),this.twoFaService.getTwoFaSettings().subscribe(e=>{this.setAuthConfigFormValue(e)})}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}confirmForm(){return this.twoFaFormGroup}save(){if(this.twoFaFormGroup.valid){let e=this.twoFaFormGroup.getRawValue();this.joinRateLimit(e,"verificationCodeCheckRateLimit");let n=e.providers.filter(s=>s.enable);n.forEach(s=>delete s.enable);let t=Object.assign(e,{providers:n});this.twoFaService.saveTwoFaSettings(t).subscribe(s=>{this.setAuthConfigFormValue(s),this.twoFaFormGroup.markAsUntouched(),this.twoFaFormGroup.markAsPristine()})}else Object.keys(this.twoFaFormGroup.controls).forEach(e=>{this.twoFaFormGroup.get(e).markAsTouched({onlySelf:!0})})}toggleExtensionPanel(e,n,t){e&&e.stopPropagation(),t?this.getByIndexPanel(n).open():this.getByIndexPanel(n).close()}trackByElement(e,n){return n}get providersForm(){return this.twoFaFormGroup.get("providers")}build2faSettingsForm(){this.twoFaFormGroup=this.fb.group({maxVerificationFailuresBeforeUserLockout:[30,[S.pattern(/^\d*$/),S.min(0),S.max(65535)]],totalAllowedTimeForVerification:[3600,[S.required,S.min(60),S.pattern(/^\d*$/)]],verificationCodeCheckRateLimitEnable:[!1],verificationCodeCheckRateLimitNumber:[{value:3,disabled:!0},this.posIntValidation],verificationCodeCheckRateLimitTime:[{value:900,disabled:!0},this.posIntValidation],minVerificationCodeSendPeriod:["30",[S.required,S.min(5),S.pattern(/^\d*$/)]],providers:this.fb.array([])}),Object.values(Et).forEach(e=>{this.buildProvidersSettingsForm(e)}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitEnable").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>{e?(this.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").enable({emitEvent:!1}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").enable({emitEvent:!1})):(this.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").disable({emitEvent:!1}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").disable({emitEvent:!1}))}),this.providersForm.valueChanges.pipe(dt(this.destroy$)).subscribe(e=>{let n=e.filter(s=>s.enable),t=Object.values(Et).indexOf(Et.BACKUP_CODE);!n.length||n.length===1&&n[0].providerType===Et.BACKUP_CODE?(this.providersForm.at(t).get("enable").setValue(!1,{emitEvent:!1}),this.providersForm.at(t).disable({emitEvent:!1}),this.providersForm.at(t).get("providerType").enable({emitEvent:!1})):this.providersForm.at(t).get("enable").enable({emitEvent:!1})})}setAuthConfigFormValue(e){let[n,t]=this.splitRateLimit(e?.verificationCodeCheckRateLimit),s=e?.providers.map(_=>_.providerType)||[],u=Object.assign({},e,{verificationCodeCheckRateLimitEnable:n>0,verificationCodeCheckRateLimitNumber:n||3,verificationCodeCheckRateLimitTime:t||900,providers:[]});n>0&&this.getByIndexPanel(this.providersForm.length).open(),Object.values(Et).forEach((_,E)=>{let w=s.indexOf(_);w>-1?(u.providers.push(Object.assign(e.providers[w],{enable:!0})),this.getByIndexPanel(E).open()):u.providers.push({enable:!1})}),this.twoFaFormGroup.patchValue(u)}buildProvidersSettingsForm(e){let n={providerType:[e],enable:[!1]};switch(e){case Et.TOTP:n.issuerName=[{value:"ThingsBoard",disabled:!0},[S.required,S.pattern(/^(?!^\s+$).*$/)]];break;case Et.SMS:n.smsVerificationMessageTemplate=[{value:"Verification code: ${code}",disabled:!0},[S.required,S.pattern(/\${code}/)]],n.verificationCodeLifetime=[{value:120,disabled:!0},this.posIntValidation];break;case Et.EMAIL:n.verificationCodeLifetime=[{value:120,disabled:!0},this.posIntValidation];break;case Et.BACKUP_CODE:n.codesQuantity=[{value:10,disabled:!0},this.posIntValidation];break}let t=this.fb.group(n);t.get("enable").valueChanges.pipe(dt(this.destroy$)).subscribe(s=>{s?t.enable({emitEvent:!1}):(t.disable({emitEvent:!1}),t.get("enable").enable({emitEvent:!1}),t.get("providerType").enable({emitEvent:!1}))}),this.providersForm.push(t,{emitEvent:!1})}getByIndexPanel(e){return this.expansionPanel.find((n,t)=>t===e)}splitRateLimit(e){if(fa(e)){let[n,t]=e.split(":");return[parseInt(n,10),parseInt(t,10)]}return[0,0]}joinRateLimit(e,n){e[`${n}Enable`]&&(e[n]=[e[`${n}Number`],e[`${n}Time`]].join(":")),delete e[`${n}Enable`],delete e[`${n}Number`],delete e[`${n}Time`]}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(rn),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-2fa-settings"]],viewQuery:function(n,t){if(n&1&&be(bi,5),n&2){let s;ve(s=ye())&&(t.expansionPanel=s)}},features:[G],decls:54,vars:26,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","twoFactorAuthentication"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[3,"ngSubmit","formGroup"],[3,"disabled"],["formArrayName","providers",1,"fields-group"],["translate","",1,"group-title"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"fields-group"],[1,"input-row","flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-1"],["translate",""],["matInput","","required","","formControlName","totalAllowedTimeForVerification","type","number","step","1","min","60"],[4,"ngIf"],["matInput","","required","","formControlName","minVerificationCodeSendPeriod","type","number","step","1","min","5"],["matInput","","formControlName","maxVerificationFailuresBeforeUserLockout","type","number","step","1","min","0","max","65535"],[1,"provider"],[1,"flex","items-center","justify-start"],["formControlName","verificationCodeCheckRateLimitEnable",3,"mousedown"],["matExpansionPanelContent",""],[1,"flex","flex-row","items-center","justify-end","gap-2"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"provider",3,"formGroupName"],["formControlName","enable",3,"mousedown"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","flex flex-row xs:flex-col gt-xs:gap-2",4,"ngSwitchCase"],["matInput","","formControlName","issuerName","required",""],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],["matInput","","formControlName","smsVerificationMessageTemplate","required",""],["matInput","","formControlName","verificationCodeLifetime","type","number","step","1","min","1","required",""],["matInput","","formControlName","codesQuantity","type","number","step","1","min","1","required",""],["matInput","","formControlName","verificationCodeCheckRateLimitNumber","required","","type","number","step","1","min","1"],["matInput","","formControlName","verificationCodeCheckRateLimitTime","required","","type","number","step","1","min","1"]],template:function(n,t){n&1&&(a(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title")(4,"span",1),p(5,"admin.2fa.2fa"),r()(),f(6,"span",2)(7,"div",3),r(),b(8,X1,1,0,"mat-progress-bar",4),d(9,"async"),b(10,Z1,1,0,"div",5),d(11,"async"),a(12,"mat-card-content")(13,"form",6),y("ngSubmit",function(){return t.save()}),a(14,"fieldset",7),d(15,"async"),a(16,"div")(17,"fieldset",8)(18,"legend",9),p(19,"admin.2fa.available-providers"),r(),b(20,gv,9,5,"ng-container",10),r(),a(21,"fieldset",11)(22,"legend",9),p(23,"admin.2fa.verification-limitations"),r(),a(24,"div",12)(25,"mat-form-field",13)(26,"mat-label",14),p(27,"admin.2fa.total-allowed-time-for-verification"),r(),f(28,"input",15),b(29,hv,3,3,"mat-error",16)(30,bv,3,3,"mat-error",16),r(),a(31,"mat-form-field",13)(32,"mat-label",14),p(33,"admin.2fa.retry-verification-code-period"),r(),f(34,"input",17),b(35,vv,3,3,"mat-error",16)(36,yv,3,3,"mat-error",16),r(),a(37,"mat-form-field",13)(38,"mat-label",14),p(39,"admin.2fa.max-verification-failures-before-user-lockout"),r(),f(40,"input",18),b(41,_v,3,3,"mat-error",16),r()(),a(42,"mat-expansion-panel",19)(43,"mat-expansion-panel-header")(44,"mat-panel-title",20)(45,"mat-slide-toggle",21),y("mousedown",function(u){return t.toggleExtensionPanel(u,t.providersForm.length,t.twoFaFormGroup.get("verificationCodeCheckRateLimitEnable").value)}),r(),p(46),d(47,"translate"),r()(),b(48,Iv,13,4,"ng-template",22),r()()(),a(49,"div",23)(50,"button",24),d(51,"async"),p(52),d(53,"translate"),r()()()()()()()),n&2&&(o(8),l("ngIf",c(9,14,t.isLoading$)),o(2),l("ngIf",!c(11,16,t.isLoading$)),o(3),l("formGroup",t.twoFaFormGroup),o(),l("disabled",c(15,18,t.isLoading$)),o(6),l("ngForOf",t.providersForm.controls)("ngForTrackBy",t.trackByElement),o(9),l("ngIf",t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("required")),o(),l("ngIf",t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("pattern")||t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("min")),o(5),l("ngIf",t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("required")),o(),l("ngIf",t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("pattern")||t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("min")),o(5),l("ngIf",t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("pattern")||t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("min")||t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("max")),o(5),h(" ",c(47,20,"admin.2fa.verification-code-check-rate-limit")," "),o(4),l("disabled",c(51,22,t.isLoading$)||t.twoFaFormGroup.invalid||!t.twoFaFormGroup.dirty),o(2),h(" ",c(53,24,"action.save")," "))},dependencies:[we,V,Rn,On,Tt,K,ti,pi,yi,vi,Oe,ge,me,Ie,De,xi,it,bi,Oi,Bi,Ln,fe,ue,Ti,W,z,ce,Li,tn,X,oe,ft,zu,H,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}','@charset "UTF-8";@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:90%}}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{margin:8px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px;position:relative;padding-bottom:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3;width:fit-content;margin:0 8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{padding:8px 8px 0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:none;margin:1px 0 0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]{overflow:inherit}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{padding:0 24px 0 8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:48px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header-title[_ngcontent-%COMP%]{height:40px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-form-field-infix{width:100%}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-content{font-size:16px}[_nghost-%COMP%]     .mat-expansion-panel.provider .mat-expansion-panel-header>.mat-content{overflow:inherit}[_nghost-%COMP%]     .mat-expansion-panel.provider .mat-expansion-panel-body{padding:0 16px 8px 8px}']})}}return i})();C();C();C();function Ev(i,m){if(i&1){let e=O();a(0,"mat-tab",2,0),d(2,"translate"),a(3,"tb-version-control",3),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.title)("externalEntityId",n.entity.externalId||n.entity.id)}}var kl=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}isTenantWidgetsBundle(){return this.entity&&this.entity.tenantId.id!==Be}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-widgets-bundle-tabs"]],features:[G],decls:1,vars:1,consts:[["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,Ev,4,7,"mat-tab",1),n&2&&l("ngIf",t.isTenantWidgetsBundle()&&t.authUser.authority===t.authorities.TENANT_ADMIN)},dependencies:[V,Pt,di,k],encapsulation:2})}}return i})();var Rl=(()=>{class i{constructor(e,n,t,s,u,_,E){this.store=e,this.dialogService=n,this.widgetsService=t,this.translate=s,this.importExport=u,this.datePipe=_,this.router=E,this.config=new Qe,this.config.entityType=B.WIDGETS_BUNDLE,this.config.entityComponent=ja,this.config.entityTabsComponent=kl,this.config.entityTranslations=$e.get(B.WIDGETS_BUNDLE),this.config.entityResources=_t.get(B.WIDGETS_BUNDLE),this.config.defaultSortOrder={property:"title",direction:ni.ASC},this.config.rowPointer=!0,this.config.entityTitle=w=>w?w.title:"",this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("title","widgets-bundle.title","100%"),new te("tenantId","widgets-bundle.system","60px",w=>Ot(w.tenantId.id===Be))),this.config.addActionDescriptors.push({name:this.translate.instant("widgets-bundle.create-new-widgets-bundle"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:w=>this.config.getTable().addEntity(w)},{name:this.translate.instant("widgets-bundle.import"),icon:"file_upload",isEnabled:()=>!0,onAction:w=>this.importWidgetsBundle(w)}),this.config.cellActionDescriptors.push({name:this.translate.instant("widgets-bundle.export"),icon:"file_download",isEnabled:()=>!0,onAction:(w,q)=>this.exportWidgetsBundle(w,q)},{name:this.translate.instant("widgets-bundle.widgets-bundle-details"),icon:"edit",isEnabled:()=>!0,onAction:(w,q)=>this.config.toggleEntityDetails(w,q)}),this.config.deleteEntityTitle=w=>this.translate.instant("widgets-bundle.delete-widgets-bundle-title",{widgetsBundleTitle:w.title}),this.config.deleteEntityContent=()=>this.translate.instant("widgets-bundle.delete-widgets-bundle-text"),this.config.deleteEntitiesTitle=w=>this.translate.instant("widgets-bundle.delete-widgets-bundles-title",{count:w}),this.config.deleteEntitiesContent=()=>this.translate.instant("widgets-bundle.delete-widgets-bundles-text"),this.config.loadEntity=w=>this.widgetsService.getWidgetsBundle(w.id),this.config.saveEntity=w=>this.widgetsService.saveWidgetsBundle(w),this.config.deleteEntity=w=>this.widgetsService.deleteWidgetsBundle(w.id),this.config.onEntityAction=w=>this.onWidgetsBundleAction(w,this.config),this.config.handleRowClick=(w,q)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(w,q):this.openWidgetsBundle(w,q),!0),this.config.entityAdded=w=>{this.openWidgetsBundle(null,w)}}resolve(){this.config.tableTitle=this.translate.instant("widgets-bundle.widgets-bundles");let e=Bt(this.store);this.config.deleteEnabled=t=>this.isWidgetsBundleEditable(t,e.authority),this.config.entitySelectionEnabled=t=>this.isWidgetsBundleEditable(t,e.authority),this.config.detailsReadonly=t=>!this.isWidgetsBundleEditable(t,e.authority);let n=fn(this.store);return this.config.entitiesFetchFunction=t=>this.widgetsService.getWidgetBundles(t),this.config}isWidgetsBundleEditable(e,n){return n===M.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Be:n===M.SYS_ADMIN}importWidgetsBundle(e){this.importExport.importWidgetsBundle().subscribe(n=>{n&&this.config.updateData()})}openWidgetsBundle(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`resources/widgets-bundles/${n.id.id}/widgetTypes`)}openWidgetsBundleDetails(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree(["details",n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}exportWidgetsBundle(e,n){e&&e.stopPropagation(),this.importExport.exportWidgetsBundle(n.id.id)}onWidgetsBundleAction(e,n){switch(e.action){case"open":return this.openWidgetsBundle(e.event,e.entity),!0;case"openDetails":return this.openWidgetsBundleDetails(e.event,e.entity,n),!0;case"export":return this.exportWidgetsBundle(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(Lt),N(fi),N(ie),N(Gi),N(Ge),N(de))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();function wv(i,m){i&1&&f(0,"mat-progress-bar",16)}function Mv(i,m){i&1&&f(0,"div",17)}function Dv(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"widget.title-required")," "))}var rr=(()=>{class i extends et{constructor(e,n,t,s,u){super(e,n,s),this.store=e,this.router=n,this.data=t,this.dialogRef=s,this.fb=u,this.dialogTitle="widget.save-widget-as",this.saveAsActionTitle="action.saveAs",Bt(e).authority===M.TENANT_ADMIN?this.bundlesScope="tenant":this.bundlesScope="system",this.data?.dialogTitle&&(this.dialogTitle=this.data.dialogTitle),this.data?.saveAsActionTitle&&(this.saveAsActionTitle=this.data.saveAsActionTitle)}ngOnInit(){this.saveWidgetTypeAsFormGroup=this.fb.group({title:[this.data?.title,[S.required]],widgetsBundle:[null]})}cancel(){this.dialogRef.close(null)}saveAs(){let e=this.saveWidgetTypeAsFormGroup.get("title").value,n=this.saveWidgetTypeAsFormGroup.get("widgetsBundle").value?.id?.id,t={widgetName:e,widgetBundleId:n};this.dialogRef.close(t)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(Ze),g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-save-widget-type-as-dialog"]],features:[G],decls:30,vars:23,consts:[[2,"min-width","360px",3,"ngSubmit","formGroup"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","widgetsBundle","createNew","",3,"bundlesScope"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(a(0,"form",0),y("ngSubmit",function(){return t.saveAs()}),a(1,"mat-toolbar",1)(2,"h2",2),p(3),r(),f(4,"span",3),a(5,"button",4),y("click",function(){return t.cancel()}),a(6,"mat-icon",5),p(7,"close"),r()()(),b(8,wv,1,0,"mat-progress-bar",6),d(9,"async"),b(10,Mv,1,0,"div",7),d(11,"async"),a(12,"div",8)(13,"span",2),p(14),r(),a(15,"mat-form-field",9)(16,"mat-label",2),p(17,"widget.title"),r(),f(18,"input",10),b(19,Dv,3,3,"mat-error",11),r(),f(20,"tb-widgets-bundle-select",12),r(),a(21,"div",13)(22,"button",14),d(23,"async"),y("click",function(){return t.cancel()}),p(24),d(25,"translate"),r(),a(26,"button",15),d(27,"async"),p(28),d(29,"translate"),r()()()),n&2&&(l("formGroup",t.saveWidgetTypeAsFormGroup),o(3),R(t.dialogTitle),o(5),l("ngIf",c(9,11,t.isLoading$)),o(2),l("ngIf",!c(11,13,t.isLoading$)),o(4),R(t.dialogTitle),o(5),l("ngIf",t.saveWidgetTypeAsFormGroup.get("title").hasError("required")),o(),T("bundlesScope",t.bundlesScope),o(2),l("disabled",c(23,15,t.isLoading$)),o(2),h(" ",c(25,17,"action.cancel")," "),o(2),l("disabled",c(27,19,t.isLoading$)||t.saveWidgetTypeAsFormGroup.invalid||!t.saveWidgetTypeAsFormGroup.dirty),o(2),h(" ",c(29,21,t.saveAsActionTitle)," "))},dependencies:[V,ef,K,Ce,ee,Oe,ge,me,Ie,De,He,Ct,Je,fe,ue,W,z,ce,X,oe,H,le,k],encapsulation:2})}}return i})();C();var Pv=_e(_e({self:{description:"Built-in variable <b>self</b> that is a reference to the widget instance",type:'<a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L350" target="_blank">WidgetTypeInstance</a>',meta:"object",children:_e({onInit:{description:"The first function which is called when widget is ready for initialization.<br>Should be used to prepare widget DOM, process widget settings and initial subscription information.",meta:"function"},onDataUpdated:{description:'Called when the new data is available from the widget subscription.<br>Latest data can be accessed from the <code>defaultSubscription</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onResize:{description:'Called when widget container is resized. Latest <code>width</code> and <code>height</code> can be obtained from <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onEditModeChanged:{description:'Called when dashboard editing mode is changed. Latest mode is handled by <code>isEdit</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onMobileModeChanged:{description:'Called when dashboard view width crosses mobile breakpoint. Latest state is handled by <code>isMobile</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onDestroy:{description:"Called when widget element is destroyed. Should be used to cleanup all resources if necessary.",meta:"function"},getSettingsSchema:{description:'Optional function returning widget settings schema json as alternative to <b>Settings tab</b> of <a href="https://thingsboard.io/docs/user-guide/contribution/widgets-development/#settings-schema-section" target="_blank">Settings schema section</a>.',meta:"function",return:{description:"An widget settings schema json",type:"object"}},getDataKeySettingsSchema:{description:'Optional function returning particular data key settings schema json as alternative to <b>Data key settings schema</b> of <a href="https://thingsboard.io/docs/user-guide/contribution/widgets-development/#settings-schema-section" target="_blank">Settings schema section</a>.',meta:"function",return:{description:"A particular data key settings schema json",type:"object"}},typeParameters:{description:"Returns object describing widget datasource parameters.",meta:"function",return:{description:"An object describing widget datasource parameters.",type:'<a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/shared/models/widget.models.ts#L146" target="_blank">WidgetTypeParameters</a>'}},actionSources:{description:"Returns map describing available widget action sources used to define user actions.",meta:"function",return:{description:"A map of action sources by action source id.",type:'{[actionSourceId: string]: <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/shared/models/widget.models.ts#L118" target="_blank">WidgetActionSource</a>}'}}},pc)}},pc),rg),Wg=new Ua(Pv);var kv=["topPanel"],Rv=["topLeftPanel"],Ov=["topRightPanel"],Bv=["bottomPanel"],Vv=["javascriptPanel"],Lv=["framePanel"],jv=["htmlInput"],Gv=["cssInput"],Uv=["settingsJsonInput"],qv=["dataKeySettingsJsonInput"],Wv=["latestDataKeySettingsJsonInput"],Hv=["javascriptInput"],zv=["widgetIFrame"],$v=()=>({maxWidth:"1200px"});function Qv(i,m){if(i&1&&(a(0,"mat-option",70),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.widgetTypesDataMap.get(n.widgetTypes[e]).name)," ")}}function Jv(i,m){if(i&1){let e=O();a(0,"button",29),d(1,"translate"),d(2,"async"),y("click",function(){x(e);let t=v();return I(t.saveWidget())}),a(3,"mat-icon"),p(4,"save"),r(),a(5,"span",26),p(6,"action.save"),r()()}if(i&2){let e=v();Zn("matTooltip","",c(1,4,"widget.save")," (CTRL + S)"),l("disabled",c(2,6,e.isLoading$)||e.saveDisabled())("tb-circular-progress",e.saveWidgetPending)}}function Kv(i,m){if(i&1){let e=O();a(0,"button",34),d(1,"async"),y("click",function(){x(e);let t=v();return I(t.saveWidget())}),a(2,"mat-icon"),p(3,"save"),r(),a(4,"span",26),p(5,"action.save"),r()()}if(i&2){let e=v();l("disabled",c(1,1,e.isLoading$)||e.saveDisabled())}}function Yv(i,m){if(i&1){let e=O();a(0,"div",71)(1,"tb-resource-autocomplete",72),d(2,"translate"),pt("ngModelChange",function(t){let s=x(e).$implicit;return lt(s.url,t)||(s.url=t),I(t)}),y("ngModelChange",function(){x(e);let t=v();return I(t.isDirty=!0)}),r(),a(3,"mat-checkbox",73),pt("ngModelChange",function(t){let s=x(e).$implicit;return lt(s.isModule,t)||(s.isModule=t),I(t)}),y("ngModelChange",function(){x(e);let t=v();return I(t.isDirty=!0)}),p(4),d(5,"translate"),r(),a(6,"button",74),d(7,"translate"),d(8,"async"),y("click",function(){let t=x(e).index,s=v();return I(s.removeResource(t))}),a(9,"mat-icon"),p(10,"close"),r()()()}if(i&2){let e=m.$implicit,n=v();o(),T("placeholder",c(2,7,"widget.resource-url")),l("allowAutocomplete",e.isModule),st("ngModel",e.url),o(2),st("ngModel",e.isModule),o(),h(" ",c(5,9,"widget.resource-is-module")," "),o(2),T("matTooltip",c(7,11,"widget.remove-resource")),l("disabled",c(8,13,n.isLoading$))}}function Xv(i,m){if(i&1){let e=O();a(0,"mat-form-field",53)(1,"mat-label",26),p(2,"widget.latest-data-key-settings-form-selector"),r(),a(3,"input",59),pt("ngModelChange",function(t){x(e);let s=v();return lt(s.widget.latestDataKeySettingsDirective,t)||(s.widget.latestDataKeySettingsDirective=t),I(t)}),y("ngModelChange",function(){x(e);let t=v();return I(t.isDirty=!0)}),r()()}if(i&2){let e=v();o(3),st("ngModel",e.widget.latestDataKeySettingsDirective)}}function Zv(i,m){if(i&1){let e=O();a(0,"mat-form-field",53)(1,"mat-label",26),p(2,"widget.basic-mode-form-selector"),r(),a(3,"input",59),pt("ngModelChange",function(t){x(e);let s=v();return lt(s.widget.basicModeDirective,t)||(s.widget.basicModeDirective=t),I(t)}),y("ngModelChange",function(){x(e);let t=v();return I(t.isDirty=!0)}),r()()}if(i&2){let e=v();o(3),st("ngModel",e.widget.basicModeDirective)}}function ey(i,m){i&1&&(a(0,"div",75),f(1,"mat-spinner",76),r())}var Bl=(()=>{class i extends It{get isDirty(){return this._isDirty||this.isEditModeWidget}set isDirty(e){e||(this.isEditModeWidget=!1),this._isDirty=e}constructor(e,n,t,s,u,_,E,w){super(e),this.store=e,this.window=n,this.route=t,this.router=s,this.widgetService=u,this.translate=_,this.raf=E,this.dialog=w,this.widgetTypes=Fi,this.allWidgetTypes=Object.keys(Fi),this.widgetTypesDataMap=_a,this.isEditModeWidget=!1,this._isDirty=!1,this.fullscreen=!1,this.htmlFullscreen=!1,this.cssFullscreen=!1,this.jsonSettingsFullscreen=!1,this.jsonDataKeySettingsFullscreen=!1,this.jsonLatestDataKeySettingsFullscreen=!1,this.javascriptFullscreen=!1,this.iFrameFullscreen=!1,this.aceEditors=[],this.editorsResizeCafs={},this.onWindowMessageListener=this.onWindowMessage.bind(this),this.iframeWidgetEditModeInited=!1,this.saveWidgetPending=!1,this.saveWidgetAsPending=!1,this.gotError=!1,this.errorMarkers=[],this.errorAnnotationId=-1,this.hotKeys=[],this.updateBreadcrumbs=new rt,this.rxSubscriptions=new Array,this.authUser=Bt(e),this.rxSubscriptions.push(this.route.data.subscribe(q=>{this.init(q)})),this.initHotKeys()}init(e){if(this.widgetTypeDetails=e.widgetEditorData.widgetTypeDetails,this.widget=e.widgetEditorData.widget,this.authUser.authority===M.TENANT_ADMIN?this.isReadOnly=this.widgetTypeDetails&&this.widgetTypeDetails.tenantId.id===Be:this.isReadOnly=this.authUser.authority!==M.SYS_ADMIN,this.widgetTypeDetails){let n=JSON.parse(this.widget.defaultConfig);this.widget.defaultConfig=JSON.stringify(n)}this.origWidget=Ue(this.widget),this.widgetTypeDetails||(this.isDirty=!0)}ngOnInit(){this.initSplitLayout(),this.initAceEditors(),this.iframe=$(this.widgetIFrameElmRef.nativeElement),this.window.addEventListener("message",this.onWindowMessageListener),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.iframe.attr("src","/widget-editor")}ngOnDestroy(){this.window.removeEventListener("message",this.onWindowMessageListener),this.aceEditors.forEach(e=>e.destroy()),this.aceResize$.disconnect(),this.rxSubscriptions.forEach(e=>{e.unsubscribe()}),this.rxSubscriptions.length=0}initHotKeys(){this.hotKeys.push(new Ki("ctrl+q",e=>(!ls(this.store)&&!this.undoDisabled()&&(e.preventDefault(),this.undoWidget()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.undo"))),this.hotKeys.push(new Ki("ctrl+s",e=>(!ls(this.store)&&!this.saveDisabled()&&(e.preventDefault(),this.saveWidget()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.save"))),this.hotKeys.push(new Ki("shift+ctrl+s",e=>(!ls(this.store)&&!this.saveAsDisabled()&&(e.preventDefault(),this.saveWidgetAs()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.saveAs"))),this.hotKeys.push(new Ki("shift+ctrl+f",e=>(e.preventDefault(),this.fullscreen=!this.fullscreen,!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.toggle-fullscreen"))),this.hotKeys.push(new Ki("ctrl+enter",e=>(e.preventDefault(),this.applyWidgetScript(),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.run")))}initSplitLayout(){Split([this.topPanelElmRef.nativeElement,this.bottomPanelElmRef.nativeElement],{sizes:[35,65],gutterSize:8,cursor:"row-resize",direction:"vertical"}),Split([this.topLeftPanelElmRef.nativeElement,this.topRightPanelElmRef.nativeElement],{sizes:[50,50],gutterSize:8,cursor:"col-resize"}),Split([this.javascriptPanelElmRef.nativeElement,this.framePanelElmRef.nativeElement],{sizes:[50,50],gutterSize:8,cursor:"col-resize"})}initAceEditors(){this.aceResize$=new ResizeObserver(n=>{n.forEach(t=>{let s=this.aceEditors.find(u=>u.container===t.target);this.onAceEditorResize(s)})});let e=[];e.push(this.createAceEditor(this.htmlInputElmRef,"html").pipe(wt(n=>{this.htmlEditor=n,this.htmlEditor.on("input",()=>{let t=this.htmlEditor.getValue();this.widget.templateHtml!==t&&(this.widget.templateHtml=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.cssInputElmRef,"css").pipe(wt(n=>{this.cssEditor=n,this.cssEditor.on("input",()=>{let t=this.cssEditor.getValue();this.widget.templateCss!==t&&(this.widget.templateCss=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.settingsJsonInputElmRef,"json").pipe(wt(n=>{this.jsonSettingsEditor=n,this.jsonSettingsEditor.on("input",()=>{let t=this.jsonSettingsEditor.getValue();this.widget.settingsSchema!==t&&(this.widget.settingsSchema=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.dataKeySettingsJsonInputElmRef,"json").pipe(wt(n=>{this.dataKeyJsonSettingsEditor=n,this.dataKeyJsonSettingsEditor.on("input",()=>{let t=this.dataKeyJsonSettingsEditor.getValue();this.widget.dataKeySettingsSchema!==t&&(this.widget.dataKeySettingsSchema=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.latestDataKeySettingsJsonInputElmRef,"json").pipe(wt(n=>{this.latestDataKeyJsonSettingsEditor=n,this.latestDataKeyJsonSettingsEditor.on("input",()=>{let t=this.latestDataKeyJsonSettingsEditor.getValue();this.widget.latestDataKeySettingsSchema!==t&&(this.widget.latestDataKeySettingsSchema=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.javascriptInputElmRef,"javascript").pipe(wt(n=>{this.jsEditor=n,this.jsEditor.on("input",()=>{let t=this.jsEditor.getValue();this.widget.controllerScript!==t&&(this.widget.controllerScript=t,this.isDirty=!0)}),this.jsEditor.on("change",()=>{this.cleanupJsErrors()}),this.jsEditor.completers=[Wg,...this.jsEditor.completers||[]]}))),Gt(e).subscribe(()=>{this.setAceEditorValues()})}setAceEditorValues(){this.htmlEditor.setValue(this.widget.templateHtml?this.widget.templateHtml:"",-1),this.cssEditor.setValue(this.widget.templateCss?this.widget.templateCss:"",-1),this.jsonSettingsEditor.setValue(this.widget.settingsSchema?this.widget.settingsSchema:"",-1),this.dataKeyJsonSettingsEditor.setValue(this.widget.dataKeySettingsSchema?this.widget.dataKeySettingsSchema:"",-1),this.latestDataKeyJsonSettingsEditor.setValue(this.widget.latestDataKeySettingsSchema?this.widget.latestDataKeySettingsSchema:"",-1),this.jsEditor.setValue(this.widget.controllerScript?this.widget.controllerScript:"",-1)}createAceEditor(e,n){let t=e.nativeElement,s={mode:`ace/mode/${n}`,showGutter:!0,showPrintMargin:!0},u={enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0};return s=_e(_e({},s),u),h0().pipe(mt(_=>{let E=_.edit(t,s);return E.session.setUseWrapMode(!0),this.aceEditors.push(E),this.aceResize$.observe(t),E}))}onAceEditorResize(e){this.editorsResizeCafs[e.id]&&(this.editorsResizeCafs[e.id](),delete this.editorsResizeCafs[e.id]),this.editorsResizeCafs[e.id]=this.raf.raf(()=>{e.resize(),e.renderer.updateFull()})}onWindowMessage(e){let n;if(e.data)try{n=JSON.parse(e.data)}catch{}if(n)switch(n.type){case"widgetException":this.onWidgetException(n.data);break;case"widgetEditModeInited":this.onWidgetEditModeInited();break;case"widgetEditUpdated":this.onWidgetEditUpdated(n.data),this.onWidgetEditModeToggled(!1);break;case"widgetEditModeToggle":this.onWidgetEditModeToggled(n.data);break}}onWidgetEditModeInited(){this.iframeWidgetEditModeInited=!0,(this.saveWidgetPending||this.saveWidgetAsPending)&&(this.saveWidgetTimeout||(this.saveWidgetTimeout=setTimeout(()=>{this.gotError?(this.store.dispatch(new tt({message:this.translate.instant("widget.unable-to-save-widget-error"),type:"error"})),this.saveWidgetPending=!1,this.saveWidgetAsPending=!1):this.saveWidgetPending?this.commitSaveWidget():this.saveWidgetAsPending&&this.commitSaveWidgetAs(),this.saveWidgetTimeout=void 0},1500)))}onWidgetEditUpdated(e){this.widget.sizeX=e.sizeX/2,this.widget.sizeY=e.sizeY/2,this.widget.defaultConfig=JSON.stringify(e.config),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.isDirty=!0}onWidgetEditModeToggled(e){this.isEditModeWidget=e}onWidgetException(e){if(!this.gotError){this.gotError=!0;let n="Error:";if(e.message&&(n+=" "+e.message),e.lineNumber&&(n+="<br>Line "+e.lineNumber,e.columnNumber&&(n+=" column "+e.columnNumber),n+=" of script."),!this.saveWidgetPending&&!this.saveWidgetAsPending&&this.store.dispatch(new tt({message:n,type:"error",target:"javascriptPanel"})),e.lineNumber){let t=e.lineNumber-1,s=0;e.columnNumber&&(s=e.columnNumber);let u=this.jsEditor.session.addMarker(new b0(t,0,t,1/0),"ace_active-line","screenLine");this.errorMarkers.push(u);let _=this.jsEditor.session.getAnnotations(),E={row:t,column:s,text:e.message,type:"error"};this.errorAnnotationId=_.push(E)-1,this.jsEditor.session.setAnnotations(_)}}}cleanupJsErrors(){if(this.store.dispatch(new Ou({})),this.errorMarkers.forEach(e=>{this.jsEditor.session.removeMarker(e)}),this.errorMarkers.length=0,this.errorAnnotationId>-1){let e=this.jsEditor.session.getAnnotations();e.splice(this.errorAnnotationId,1),this.jsEditor.session.setAnnotations(e),this.errorAnnotationId=-1}}commitSaveWidget(){let e=this.widgetTypeDetails&&this.widgetTypeDetails.id?this.widgetTypeDetails.id:void 0,n=this.widgetTypeDetails?.version??null,t=this.widgetTypeDetails&&this.widgetTypeDetails.createdTime?this.widgetTypeDetails.createdTime:void 0;this.saveWidgetPending=!1,this.widgetService.saveWidgetTypeDetails(this.widget,e,t,n).pipe(yt(s=>{this.saveWidgetPending=!0;let u=this.route.snapshot.params.widgetsBundleId;return u&&!e?this.widgetService.addWidgetFqnToWidgetBundle(u,s.fqn).pipe(mt(()=>s)):ot(s)}),cn(s=>e&&s.status===ca.Conflict?this.widgetService.getWidgetTypeById(e.id):aa(()=>s))).subscribe({next:s=>{this.saveWidgetPending=!1,this.widgetTypeDetails?.id?this.setWidgetTypeDetails(s):(this.isDirty=!1,this.router.navigate(["..",s.id.id],{relativeTo:this.route})),this.store.dispatch(new tt({message:this.translate.instant("widget.widget-saved"),type:"success",duration:500}))},error:()=>{this.saveWidgetPending=!1}})}commitSaveWidgetAs(){this.dialog.open(rr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(e=>{if(e){this.widget.widgetName=e.widgetName,this.widget.fullFqn=void 0;let n=JSON.parse(this.widget.defaultConfig);n.title=this.widget.widgetName,this.widget.defaultConfig=JSON.stringify(n),this.isDirty=!1,this.widgetService.saveWidgetTypeDetails(this.widget,void 0,void 0,void 0).pipe(yt(t=>e.widgetBundleId?this.widgetService.addWidgetFqnToWidgetBundle(e.widgetBundleId,t.fqn).pipe(mt(()=>t)):ot(t))).subscribe({next:t=>{this.saveWidgetAsPending=!1,e.widgetBundleId?this.router.navigate(["resources","widgets-library","widgets-bundles",e.widgetBundleId,t.id.id]):this.router.navigate(["resources","widgets-library","widget-types",t.id.id])},error:()=>{this.saveWidgetAsPending=!1}})}else this.saveWidgetAsPending=!1})}setWidgetTypeDetails(e){this.widgetTypeDetails=e,this.widget=Os(this.widgetTypeDetails);let n=JSON.parse(this.widget.defaultConfig);this.widget.defaultConfig=JSON.stringify(n),this.origWidget=Ue(this.widget),this.isDirty=!1,this.updateBreadcrumbs.emit()}applyWidgetScript(){this.cleanupJsErrors(),this.gotError=!1,this.iframeWidgetEditModeInited=!1;let e=JSON.parse(this.widget.defaultConfig);e.title||(e.title=this.widget.widgetName),this.widget.defaultConfig=JSON.stringify(e),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.iframe[0].contentWindow.location.reload(!0)}undoWidget(){this.widget=Ue(this.origWidget),this.setAceEditorValues(),this.isDirty=!1,this.applyWidgetScript()}saveWidget(){this.widget.widgetName?(this.saveWidgetPending=!0,this.applyWidgetScript()):this.store.dispatch(new tt({message:this.translate.instant("widget.missing-widget-title-error"),type:"error"}))}saveWidgetAs(){this.saveWidgetAsPending=!0,this.applyWidgetScript()}undoDisabled(){return!this._isDirty||!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}saveDisabled(){return this.isReadOnly||!this._isDirty||!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}saveAsDisabled(){return!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}beautifyCss(){af(this.widget.templateCss,{indent_size:4}).subscribe(e=>{this.widget.templateCss!==e&&(this.isDirty=!0,this.widget.templateCss=e,this.cssEditor.setValue(this.widget.templateCss?this.widget.templateCss:"",-1))})}beautifyHtml(){rf(this.widget.templateHtml,{indent_size:4,wrap_line_length:60}).subscribe(e=>{this.widget.templateHtml!==e&&(this.isDirty=!0,this.widget.templateHtml=e,this.htmlEditor.setValue(this.widget.templateHtml?this.widget.templateHtml:"",-1))})}beautifyJson(){xr(this.widget.settingsSchema,{indent_size:4}).subscribe(e=>{this.widget.settingsSchema!==e&&(this.isDirty=!0,this.widget.settingsSchema=e,this.jsonSettingsEditor.setValue(this.widget.settingsSchema?this.widget.settingsSchema:"",-1))})}beautifyDataKeyJson(){xr(this.widget.dataKeySettingsSchema,{indent_size:4}).subscribe(e=>{this.widget.dataKeySettingsSchema!==e&&(this.isDirty=!0,this.widget.dataKeySettingsSchema=e,this.dataKeyJsonSettingsEditor.setValue(this.widget.dataKeySettingsSchema?this.widget.dataKeySettingsSchema:"",-1))})}beautifyLatestDataKeyJson(){xr(this.widget.latestDataKeySettingsSchema,{indent_size:4}).subscribe(e=>{this.widget.latestDataKeySettingsSchema!==e&&(this.isDirty=!0,this.widget.latestDataKeySettingsSchema=e,this.latestDataKeyJsonSettingsEditor.setValue(this.widget.latestDataKeySettingsSchema?this.widget.latestDataKeySettingsSchema:"",-1))})}beautifyJs(){xr(this.widget.controllerScript,{indent_size:4,wrap_line_length:60}).subscribe(e=>{this.widget.controllerScript!==e&&(this.isDirty=!0,this.widget.controllerScript=e,this.jsEditor.setValue(this.widget.controllerScript?this.widget.controllerScript:"",-1))})}removeResource(e){e>-1&&this.widget.resources.splice(e,1).length>0&&(this.isDirty=!0)}addResource(){this.widget.resources.push({url:""}),this.isDirty=!0}widgetTypeChanged(){let e=JSON.parse(this.widget.defaultConfig);this.widget.type!==Fi.rpc&&this.widget.type!==Fi.alarm?(e.targetDevice&&delete e.targetDevice,e.alarmSource&&delete e.alarmSource,e.datasources||(e.datasources=[]),e.timewindow||(e.timewindow={realtime:{timewindowMs:6e4}})):this.widget.type===Fi.rpc?(e.datasources&&delete e.datasources,e.alarmSource&&delete e.alarmSource,e.timewindow&&delete e.timewindow,e.targetDevice||(e.targetDevice={type:Fu.device})):(e.datasources&&delete e.datasources,e.targetDevice&&delete e.targetDevice,e.alarmSource||(e.alarmSource={}),e.timewindow||(e.timewindow={realtime:{timewindowMs:24*60*60*1e3}})),this.widget.defaultConfig=JSON.stringify(e),this.isDirty=!0}get confirmOnExitMessage(){return this.isEditModeWidget&&!this._isDirty?this.translate.instant("widget.confirm-to-exit-editor-html"):""}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ya),g(Si),g(de),g(fi),g(ie),g(v0),g(je))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-widget-editor"]],viewQuery:function(n,t){if(n&1&&(be(kv,7),be(Rv,7),be(Ov,7),be(Bv,7),be(Vv,7),be(Lv,7),be(jv,7),be(Gv,7),be(Uv,7),be(qv,7),be(Wv,7),be(Hv,7),be(zv,7)),n&2){let s;ve(s=ye())&&(t.topPanelElmRef=s.first),ve(s=ye())&&(t.topLeftPanelElmRef=s.first),ve(s=ye())&&(t.topRightPanelElmRef=s.first),ve(s=ye())&&(t.bottomPanelElmRef=s.first),ve(s=ye())&&(t.javascriptPanelElmRef=s.first),ve(s=ye())&&(t.framePanelElmRef=s.first),ve(s=ye())&&(t.htmlInputElmRef=s.first),ve(s=ye())&&(t.cssInputElmRef=s.first),ve(s=ye())&&(t.settingsJsonInputElmRef=s.first),ve(s=ye())&&(t.dataKeySettingsJsonInputElmRef=s.first),ve(s=ye())&&(t.latestDataKeySettingsJsonInputElmRef=s.first),ve(s=ye())&&(t.javascriptInputElmRef=s.first),ve(s=ye())&&(t.widgetIFrameElmRef=s.first)}},features:[G],decls:216,vars:165,consts:[["cheatSheetComponent",""],["widgetEditMenu","matMenu"],["topPanel",""],["topLeftPanel",""],["htmlInput",""],["cssInput",""],["topRightPanel",""],["settingsJsonInput",""],["dataKeySettingsJsonInput",""],["latestDataKeySettingsJsonInput",""],["descriptionInput",""],["bottomPanel",""],["javascriptPanel",""],["javascriptInput",""],["framePanel",""],["widgetIFrame",""],[1,"flex","flex-1","flex-col"],["tb-fullscreen","",1,"flex","flex-1","flex-col",3,"fullscreen","tb-hotkeys","cheatSheet"],[1,"mat-elevation-z1","tb-edit-toolbar","mat-hue-3","gap-4","lt-xl:gap-2"],[1,"tb-widget-title","tb-appearance-transparent"],["matInput","","required","","maxlength","255",3,"ngModelChange","disabled","ngModel","placeholder"],[1,"tb-appearance-transparent"],[3,"ngModelChange","disabled","placeholder","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"flex-1"],["mat-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","matTooltip"],["translate",""],["mat-raised-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","matTooltip"],["mat-raised-button","","class","lt-md:!hidden","matTooltipPosition","below",3,"disabled","tb-circular-progress","matTooltip","click",4,"ngIf"],["mat-raised-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","tb-circular-progress","matTooltip"],["mat-button","","matTooltipPosition","below",1,"lt-lg:!hidden",3,"click","matTooltip"],["mat-icon-button","","matTooltipPosition","below",1,"lt-md:!hidden","gt-md:!hidden",3,"click","matTooltip"],["mat-icon-button","",1,"gt-md:!hidden",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item","",3,"click","disabled"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],[1,"flex-1",2,"position","relative"],[1,"tb-editor","tb-absolute-fill"],[1,"tb-split","tb-split-vertical"],[1,"tb-split","tb-content"],["mat-stretch-tabs","false","selectedIndex","1","dynamicHeight","true",2,"width","100%","height","100%"],[3,"label"],[1,"tb-resize-container",2,"background-color","#fff"],[1,"mat-padding"],["class","flex flex-1 flex-row items-center justify-start","style","max-height: 40px;",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","matTooltipPosition","above",2,"margin-top","8px",3,"click","disabled","matTooltip"],["tb-fullscreen","",1,"tb-resize-container",3,"fullscreen"],[1,"tb-editor-area-title-panel"],["mat-button","",3,"click"],["mat-icon-button","","matTooltipPosition","above",1,"tb-mat-32",3,"click","matTooltip"],["mat-stretch-tabs","false","dynamicHeight","true",2,"width","100%","height","100%"],[3,"aria-labelledby","label"],[1,"flex-1",3,"ngModelChange","label","ngModel"],[1,"mat-block"],["matInput","","rows","2","maxlength","255",3,"ngModelChange","ngModel"],["align","end"],[3,"ngModelChange","label","ngModel"],[1,"flex","flex-col","gap-4",2,"padding-bottom","16px"],[1,"mat-block",3,"ngModelChange","ngModel"],["matInput","",3,"ngModelChange","ngModel"],["class","mat-block",4,"ngIf"],[1,"mat-block",2,"padding-bottom","16px",3,"ngModelChange","ngModel"],["tb-toast","","toastTarget","javascriptPanel",1,"tb-split","tb-content"],["tb-help-popup","widget/editor/widget_js_fn","tb-help-popup-placement","top",3,"tb-help-popup-style"],[1,"tb-split","tb-content",2,"overflow-y","hidden","position","relative"],["class","mat-content tb-progress-cover flex flex-1 flex-col items-center justify-center",4,"ngIf"],["tb-fullscreen","",2,"width","100%","height","100%",3,"fullscreen"],["height","100%","width","100%",2,"border","0"],[2,"position","absolute","top","10px","left","10px","bottom","initial"],["mat-icon-button","","matTooltipPosition","above",1,"tb-fullscreen-button-style",3,"click","matTooltip"],[3,"value"],[1,"flex","flex-1","flex-row","items-center","justify-start",2,"max-height","40px"],["hideRequiredMarker","","required","","subscriptSizing","dynamic",1,"mat-block","resource-field","flex-1",3,"ngModelChange","allowAutocomplete","ngModel","placeholder"],[3,"ngModelChange","ngModel"],["mat-icon-button","","color","primary","matTooltipPosition","above",3,"click","disabled","matTooltip"],[1,"mat-content","tb-progress-cover","flex","flex-1","flex-col","items-center","justify-center"],["diameter","100","mode","indeterminate","color","warn"]],template:function(n,t){if(n&1){let s=O();a(0,"div",16)(1,"div",17),f(2,"tb-hotkeys-cheatsheet",null,0),a(4,"mat-toolbar",18)(5,"mat-form-field",19)(6,"input",20),d(7,"translate"),pt("ngModelChange",function(_){return x(s),lt(t.widget.widgetName,_)||(t.widget.widgetName=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),r()(),a(8,"mat-form-field",21)(9,"mat-select",22),d(10,"translate"),pt("ngModelChange",function(_){return x(s),lt(t.widget.type,_)||(t.widget.type=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.widgetTypeChanged())}),b(11,Qv,3,4,"mat-option",23),r()(),f(12,"span",24),a(13,"button",25),d(14,"translate"),y("click",function(){return x(s),I(t.applyWidgetScript())}),a(15,"mat-icon"),p(16,"play_arrow"),r(),a(17,"span",26),p(18,"action.run"),r()(),a(19,"button",27),d(20,"translate"),d(21,"async"),y("click",function(){return x(s),I(t.undoWidget())}),a(22,"mat-icon"),p(23,"undo"),r(),a(24,"span",26),p(25,"action.undo"),r()(),b(26,Jv,7,8,"button",28),a(27,"button",29),d(28,"translate"),d(29,"async"),y("click",function(){return x(s),I(t.saveWidgetAs())}),a(30,"mat-icon"),p(31,"save_as"),r(),a(32,"span",26),p(33,"action.saveAs"),r()(),a(34,"button",30),d(35,"translate"),y("click",function(){return x(s),I(t.fullscreen=!t.fullscreen)}),a(36,"mat-icon"),p(37),r(),a(38,"span",26),p(39,"widget.toggle-fullscreen"),r()(),a(40,"button",31),d(41,"translate"),y("click",function(){return x(s),I(t.fullscreen=!t.fullscreen)}),a(42,"mat-icon"),p(43),r()(),a(44,"button",32)(45,"mat-icon"),p(46,"more_vert"),r()(),a(47,"mat-menu",33,1)(49,"button",34),y("click",function(){return x(s),I(t.applyWidgetScript())}),a(50,"mat-icon"),p(51,"play_arrow"),r(),a(52,"span",26),p(53,"action.run"),r()(),a(54,"button",34),d(55,"async"),y("click",function(){return x(s),I(t.undoWidget())}),a(56,"mat-icon"),p(57,"undo"),r(),a(58,"span",26),p(59,"action.undo"),r()(),b(60,Kv,6,3,"button",35),a(61,"button",34),d(62,"async"),y("click",function(){return x(s),I(t.saveWidgetAs())}),a(63,"mat-icon"),p(64,"save_as"),r(),a(65,"span",26),p(66,"action.saveAs"),r()()()(),a(67,"div",36)(68,"div",37)(69,"div",38,2)(71,"div",39,3)(73,"mat-tab-group",40)(74,"mat-tab",41),d(75,"translate"),a(76,"div",42)(77,"div",43),b(78,Yv,11,15,"div",44),a(79,"button",45),d(80,"translate"),d(81,"async"),y("click",function(){return x(s),I(t.addResource())}),a(82,"span",26),p(83,"action.add"),r()()()()(),a(84,"mat-tab",41),d(85,"translate"),a(86,"div",46)(87,"div",47)(88,"button",48),y("click",function(){return x(s),I(t.beautifyHtml())}),p(89),d(90,"translate"),r(),a(91,"button",49),d(92,"translate"),y("click",function(){return x(s),I(t.htmlFullscreen=!t.htmlFullscreen)}),a(93,"mat-icon"),p(94),r()()(),f(95,"div",null,4),r()(),a(97,"mat-tab",41),d(98,"translate"),a(99,"div",46)(100,"div",47)(101,"button",48),y("click",function(){return x(s),I(t.beautifyCss())}),p(102),d(103,"translate"),r(),a(104,"button",49),d(105,"translate"),y("click",function(){return x(s),I(t.cssFullscreen=!t.cssFullscreen)}),a(106,"mat-icon"),p(107),r()()(),f(108,"div",null,5),r()()()(),a(110,"div",39,6)(112,"mat-tab-group",50)(113,"mat-tab",41),d(114,"translate"),a(115,"div",46)(116,"div",47)(117,"button",48),y("click",function(){return x(s),I(t.beautifyJson())}),p(118),d(119,"translate"),r(),a(120,"button",49),d(121,"translate"),y("click",function(){return x(s),I(t.jsonSettingsFullscreen=!t.jsonSettingsFullscreen)}),a(122,"mat-icon"),p(123),r()()(),f(124,"div",null,7),r()(),a(126,"mat-tab",41),d(127,"translate"),a(128,"div",46)(129,"div",47)(130,"button",48),y("click",function(){return x(s),I(t.beautifyDataKeyJson())}),p(131),d(132,"translate"),r(),a(133,"button",49),d(134,"translate"),y("click",function(){return x(s),I(t.jsonDataKeySettingsFullscreen=!t.jsonDataKeySettingsFullscreen)}),a(135,"mat-icon"),p(136),r()()(),f(137,"div",null,8),r()(),a(139,"mat-tab",51),d(140,"translate"),a(141,"div",46)(142,"div",47)(143,"button",48),y("click",function(){return x(s),I(t.beautifyLatestDataKeyJson())}),p(144),d(145,"translate"),r(),a(146,"button",49),d(147,"translate"),y("click",function(){return x(s),I(t.jsonLatestDataKeySettingsFullscreen=!t.jsonLatestDataKeySettingsFullscreen)}),a(148,"mat-icon"),p(149),r()()(),f(150,"div",null,9),r()(),a(152,"mat-tab",41),d(153,"translate"),a(154,"div",42)(155,"div",43)(156,"tb-gallery-image-input",52),d(157,"translate"),pt("ngModelChange",function(_){return x(s),lt(t.widget.image,_)||(t.widget.image=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),r(),a(158,"mat-form-field",53)(159,"mat-label",26),p(160,"widget.description"),r(),a(161,"textarea",54,10),pt("ngModelChange",function(_){return x(s),lt(t.widget.description,_)||(t.widget.description=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),r(),a(163,"mat-hint",55),p(164),r()(),a(165,"tb-string-items-list",56),d(166,"translate"),pt("ngModelChange",function(_){return x(s),lt(t.widget.tags,_)||(t.widget.tags=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),r(),a(167,"div",57)(168,"mat-slide-toggle",58),pt("ngModelChange",function(_){return x(s),lt(t.widget.scada,_)||(t.widget.scada=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),p(169),d(170,"translate"),r(),a(171,"mat-slide-toggle",58),pt("ngModelChange",function(_){return x(s),lt(t.widget.deprecated,_)||(t.widget.deprecated=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),p(172),d(173,"translate"),r()(),a(174,"mat-form-field",53)(175,"mat-label",26),p(176,"widget.settings-form-selector"),r(),a(177,"input",59),pt("ngModelChange",function(_){return x(s),lt(t.widget.settingsDirective,_)||(t.widget.settingsDirective=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),r()(),a(178,"mat-form-field",53)(179,"mat-label",26),p(180,"widget.data-key-settings-form-selector"),r(),a(181,"input",59),pt("ngModelChange",function(_){return x(s),lt(t.widget.dataKeySettingsDirective,_)||(t.widget.dataKeySettingsDirective=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),r()(),b(182,Xv,4,1,"mat-form-field",60),a(183,"mat-slide-toggle",61),pt("ngModelChange",function(_){return x(s),lt(t.widget.hasBasicMode,_)||(t.widget.hasBasicMode=_),I(_)}),y("ngModelChange",function(){return x(s),I(t.isDirty=!0)}),p(184),d(185,"translate"),r(),b(186,Zv,4,1,"mat-form-field",60),r()()()()()(),a(187,"div",38,11)(189,"div",62,12)(191,"div",46)(192,"div",47)(193,"label",26),p(194,"widget.javascript"),r(),a(195,"button",48),y("click",function(){return x(s),I(t.beautifyJs())}),p(196),d(197,"translate"),r(),f(198,"span",63),a(199,"button",49),d(200,"translate"),y("click",function(){return x(s),I(t.javascriptFullscreen=!t.javascriptFullscreen)}),a(201,"mat-icon"),p(202),r()()(),f(203,"div",null,13),r()(),a(205,"div",64,14),b(207,ey,2,0,"div",65),a(208,"div",66),f(209,"iframe",67,15),a(211,"div",68)(212,"button",69),d(213,"translate"),y("click",function(){return x(s),I(t.iFrameFullscreen=!t.iFrameFullscreen)}),a(214,"mat-icon"),p(215),r()()()()()()()()()()}if(n&2){let s=U(3),u=U(48),_=U(162);o(),l("fullscreen",t.fullscreen)("tb-hotkeys",t.hotKeys)("cheatSheet",s),o(5),T("placeholder",c(7,88,"widget.widget-title")),l("disabled",t.isReadOnly),st("ngModel",t.widget.widgetName),o(3),T("placeholder",c(10,90,"widget.type")),l("disabled",t.isReadOnly),st("ngModel",t.widget.type),o(2),l("ngForOf",t.allWidgetTypes),o(2),Zn("matTooltip","",c(14,92,"widget.run")," (CTRL + Return)"),l("disabled",!t.iframeWidgetEditModeInited),o(6),Zn("matTooltip","",c(20,94,"widget.undo")," (CTRL + Q)"),l("disabled",c(21,96,t.isLoading$)||t.undoDisabled()),o(7),l("ngIf",!t.isReadOnly),o(),Zn("matTooltip","",c(28,98,"widget.saveAs")," (Shift + CTRL + S)"),l("disabled",c(29,100,t.isLoading$)||t.saveAsDisabled())("tb-circular-progress",t.saveWidgetAsPending),o(7),Zn("matTooltip","",c(35,102,"widget.toggle-fullscreen")," (Shift + CTRL + F)"),o(3),R(t.fullscreen?"fullscreen_exit":"fullscreen"),o(3),Zn("matTooltip","",c(41,104,"widget.toggle-fullscreen")," (Shift + CTRL + F)"),o(3),R(t.fullscreen?"fullscreen_exit":"fullscreen"),o(),l("matMenuTriggerFor",u),o(5),l("disabled",!t.iframeWidgetEditModeInited),o(5),l("disabled",c(55,106,t.isLoading$)||t.undoDisabled()),o(6),l("ngIf",!t.isReadOnly),o(),l("disabled",c(62,108,t.isLoading$)||t.saveAsDisabled()),o(13),T("label",c(75,110,"widget.resources")),o(4),l("ngForOf",t.widget.resources),o(),T("matTooltip",c(80,112,"widget.add-resource")),l("disabled",c(81,114,t.isLoading$)),o(5),T("label",c(85,116,"widget.html")),o(2),l("fullscreen",t.htmlFullscreen),o(3),h(" ",c(90,118,"widget.tidy")," "),o(2),T("matTooltip",c(92,120,t.htmlFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),R(t.htmlFullscreen?"fullscreen_exit":"fullscreen"),o(3),T("label",c(98,122,"widget.css")),o(2),l("fullscreen",t.cssFullscreen),o(3),h(" ",c(103,124,"widget.tidy")," "),o(2),T("matTooltip",c(105,126,t.cssFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),R(t.cssFullscreen?"fullscreen_exit":"fullscreen"),o(6),T("label",c(114,128,"widget.settings-schema")),o(2),l("fullscreen",t.jsonSettingsFullscreen),o(3),h(" ",c(119,130,"widget.tidy")," "),o(2),T("matTooltip",c(121,132,t.jsonSettingsFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),R(t.jsonSettingsFullscreen?"fullscreen_exit":"fullscreen"),o(3),T("label",c(127,134,"widget.datakey-settings-schema")),o(2),l("fullscreen",t.jsonDataKeySettingsFullscreen),o(3),h(" ",c(132,136,"widget.tidy")," "),o(2),T("matTooltip",c(134,138,t.jsonDataKeySettingsFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),R(t.jsonDataKeySettingsFullscreen?"fullscreen_exit":"fullscreen"),o(3),T("label",c(140,140,"widget.latest-datakey-settings-schema")),l("aria-labelledby",t.widget.type!==t.widgetTypes.timeseries?"hidden":""),o(2),l("fullscreen",t.jsonLatestDataKeySettingsFullscreen),o(3),h(" ",c(145,142,"widget.tidy")," "),o(2),T("matTooltip",c(147,144,t.jsonLatestDataKeySettingsFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),R(t.jsonLatestDataKeySettingsFullscreen?"fullscreen_exit":"fullscreen"),o(3),T("label",c(153,146,"widget.widget-settings")),o(4),T("label",c(157,148,"widget.image-preview")),st("ngModel",t.widget.image),o(5),st("ngModel",t.widget.description),o(3),h("",(_.value==null?null:_.value.length)||0,"/255"),o(),T("label",c(166,150,"widget.tags")),st("ngModel",t.widget.tags),o(3),st("ngModel",t.widget.scada),o(),h(" ",c(170,152,"widget.scada")," "),o(2),st("ngModel",t.widget.deprecated),o(),h(" ",c(173,154,"widget.deprecated")," "),o(5),st("ngModel",t.widget.settingsDirective),o(4),st("ngModel",t.widget.dataKeySettingsDirective),o(),l("ngIf",t.widget.type===t.widgetTypes.timeseries),o(),st("ngModel",t.widget.hasBasicMode),o(),h(" ",c(185,156,"widget.has-basic-mode")," "),o(2),l("ngIf",t.widget.hasBasicMode),o(5),l("fullscreen",t.javascriptFullscreen),o(5),h(" ",c(197,158,"widget.tidy")," "),o(2),l("tb-help-popup-style",Rt(164,$v)),o(),T("matTooltip",c(200,160,t.javascriptFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),R(t.javascriptFullscreen?"fullscreen_exit":"fullscreen"),o(5),l("ngIf",!t.iframeWidgetEditModeInited),o(),l("fullscreen",t.iFrameFullscreen),o(4),T("matTooltip",c(213,162,t.iFrameFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),R(t.iFrameFullscreen?"fullscreen_exit":"fullscreen")}},dependencies:[we,V,Vi,Ms,Z0,Hs,cf,Ws,Un,K,Ce,$t,ee,ge,me,Ie,zt,He,Pa,Da,Fa,St,ct,Dt,_o,Pt,Co,it,ue,W,ce,nn,ut,H,Tf,Ka,le,k],styles:[`@charset "UTF-8";tb-widget-editor{flex:1;display:flex;flex-direction:column}.tb-editor .tb-split{box-sizing:border-box;overflow-x:hidden;overflow-y:auto}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper{padding-bottom:0;height:40px}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex{max-height:40px}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{border:0;padding-top:7px;padding-bottom:7px;min-height:32px}.tb-editor .ace_editor{font-size:14px!important}.tb-editor .tb-content{border:1px solid #c0c0c0}.tb-editor .gutter{background-color:transparent;background-repeat:no-repeat;background-position:50%}.tb-editor .gutter.gutter-horizontal{cursor:col-resize;background-image:url("./vertical-6GFVMCUE.png")}.tb-editor .gutter.gutter-vertical{cursor:row-resize;background-image:url("./horizontal-2FDVWMXP.png")}.tb-editor .tb-split.tb-split-horizontal,.tb-editor .gutter.gutter-horizontal{float:left;height:100%}.tb-editor .tb-split.tb-split-vertical{display:flex}.tb-editor .tb-split.tb-split-vertical .tb-split.tb-content{height:100%}.tb-editor .container{width:100%;height:100%}.tb-editor .mdc-tab[aria-labelledby=hidden]{width:0!important;min-width:0;padding:0;overflow:hidden}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper{height:calc(100% - 49px)}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper .mat-mdc-tab-body{height:100%}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper .mat-mdc-tab-body>div{height:100%}div.tb-editor-area-title-panel{position:absolute;top:5px;right:20px;z-index:5;font-size:.8rem;font-weight:500}div.tb-editor-area-title-panel>*:not(:last-child){margin-right:4px}div.tb-editor-area-title-panel label{padding:4px;color:#00acc1;background:#dcdcdc59;border-radius:5px}div.tb-editor-area-title-panel button.mat-mdc-button-base,div.tb-editor-area-title-panel button.mat-mdc-button-base.tb-mat-32{align-items:center;vertical-align:middle;min-width:32px;min-height:15px;padding:4px;font-size:.8rem;line-height:15px;background:#dcdcdc59}div.tb-editor-area-title-panel button.mat-mdc-button-base:not(.tb-help-popup-button),div.tb-editor-area-title-panel button.mat-mdc-button-base.tb-mat-32:not(.tb-help-popup-button){color:#7b7b7b}div.tb-editor-area-title-panel button.mat-mdc-button-base:not(.mat-mdc-icon-button){height:23px}div.tb-editor-area-title-panel .tb-help-popup-button-loading{background:#f3f3f3}.tb-resize-container{position:relative;width:100%;height:100%;overflow-y:auto}.tb-resize-container .ace_editor{height:100%}mat-toolbar.tb-edit-toolbar{min-height:40px!important;max-height:40px!important}mat-toolbar.tb-edit-toolbar button.mat-mdc-button-base:not(.mat-mdc-icon-button){font-size:12px;line-height:28px;padding:0 8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:28px}mat-toolbar.tb-edit-toolbar button.mat-mdc-button-base:not(.mat-mdc-icon-button) .mat-icon{height:20px;width:20px;font-size:20px}mat-toolbar.tb-edit-toolbar .mat-mdc-form-field input,mat-toolbar.tb-edit-toolbar .mat-mdc-form-field .mat-mdc-select{font-size:1.1rem;font-weight:400;letter-spacing:.005em}mat-toolbar.tb-edit-toolbar .mat-mdc-form-field.tb-widget-title{min-width:250px}@media screen and (max-width: 1279px){mat-toolbar.tb-edit-toolbar .mat-mdc-form-field.tb-widget-title{min-width:0}}
`],encapsulation:2})}}return i})();C();C();function ty(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"widget.title-required")," "))}function iy(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"widget.title-max-length")," "))}var Vl=(()=>{class i extends jt{constructor(e,n,t,s,u){super(e,s,n,t,u),this.store=e,this.entityValue=n,this.entitiesTableConfigValue=t,this.fb=s,this.cd=u}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],image:[e?e.image:""],description:[e?e.description:"",S.maxLength(1024)],tags:[e?e.tags:[]],scada:[e?e.scada:!1],deprecated:[e?e.deprecated:!1]})}updateForm(e){this.entityForm.patchValue({name:e.name,image:e.image,description:e.description,tags:e.tags,scada:e.scada,deprecated:e.deprecated})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g("entity"),g("entitiesTableConfig"),g(se),g(Xe))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-widget-type"]],features:[G],decls:45,vars:51,consts:[["descriptionInput",""],[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","image",1,"flex-1",3,"label"],["matInput","","formControlName","description","rows","2","maxlength","1024"],["align","end"],["formControlName","tags",3,"label"],[1,"flex","flex-col","gap-4"],["formControlName","scada"],["formControlName","deprecated"]],template:function(n,t){if(n&1){let s=O();a(0,"div",1)(1,"button",2),d(2,"async"),y("click",function(_){return x(s),I(t.onEntityAction(_,"edit"))}),p(3),d(4,"translate"),r(),a(5,"button",2),d(6,"async"),y("click",function(_){return x(s),I(t.onEntityAction(_,"openDetails"))}),p(7),d(8,"translate"),r(),a(9,"button",2),d(10,"async"),y("click",function(_){return x(s),I(t.onEntityAction(_,"export"))}),p(11),d(12,"translate"),r(),a(13,"button",2),d(14,"async"),y("click",function(_){return x(s),I(t.onEntityAction(_,"delete"))}),p(15),d(16,"translate"),r()(),a(17,"div",3)(18,"form",4)(19,"fieldset",5),d(20,"async"),a(21,"mat-form-field",6)(22,"mat-label",7),p(23,"widget.title"),r(),f(24,"input",8),b(25,ty,3,3,"mat-error",9)(26,iy,3,3,"mat-error",9),r(),f(27,"tb-gallery-image-input",10),d(28,"translate"),a(29,"mat-form-field",6)(30,"mat-label",7),p(31,"widget.description"),r(),f(32,"textarea",11,0),a(34,"mat-hint",12),p(35),r()(),f(36,"tb-string-items-list",13),d(37,"translate"),a(38,"div",14)(39,"mat-slide-toggle",15),p(40),d(41,"translate"),r(),a(42,"mat-slide-toggle",16),p(43),d(44,"translate"),r()()()()()}if(n&2){let s=U(33);o(),L("!hidden",t.isEdit),l("disabled",c(2,25,t.isLoading$)),o(2),h(" ",c(4,27,"widget.edit")," "),o(2),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(6,29,t.isLoading$)),o(2),h(" ",c(8,31,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(10,33,t.isLoading$)),o(2),h(" ",c(12,35,"widget.export")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(14,37,t.isLoading$)),o(2),h(" ",c(16,39,"widget.delete-widget")," "),o(3),l("formGroup",t.entityForm),o(),l("disabled",c(20,41,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("name").hasError("required")),o(),l("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),T("label",c(28,43,"widget.image-preview")),o(8),h("",(s.value==null?null:s.value.length)||0,"/1024"),o(),T("label",c(37,45,"widget.tags")),o(4),h(" ",c(41,47,"widget.scada")," "),o(3),h(" ",c(44,49,"widget.deprecated")," ")}},dependencies:[V,Un,K,ge,me,Ie,zt,De,it,fe,ue,W,z,ce,nn,X,oe,H,Ka,le,k],encapsulation:2})}}return i})();C();function ny(i,m){if(i&1){let e=O();a(0,"mat-tab",2,0),d(2,"translate"),a(3,"tb-version-control",3),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Ll=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}isTenantWidgetType(){return this.entity&&this.entity.tenantId.id!==Be}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-widget-type-tabs"]],features:[G],decls:1,vars:1,consts:[["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,ny,4,7,"mat-tab",1),n&2&&l("ngIf",t.isTenantWidgetType()&&t.authUser.authority===t.authorities.TENANT_ADMIN)},dependencies:[V,Pt,di,k],encapsulation:2})}}return i})();C();function oy(i,m){i&1&&f(0,"mat-progress-bar",15)}function ay(i,m){i&1&&f(0,"div",16)}function ry(i,m){if(i&1){let e=O();a(0,"button",17),y("click",function(){let t=x(e).$implicit,s=v();return I(s.typeSelected(s.widgetTypes[t]))}),a(1,"tb-icon",18),p(2),r(),a(3,"span",2),p(4),r()()}if(i&2){let e=m.$implicit,n=v();o(2),h(" ",n.widgetTypesDataMap.get(n.widgetTypes[e]).icon," "),o(2),R(n.widgetTypesDataMap.get(n.widgetTypes[e]).name)}}var sr=(()=>{class i extends et{constructor(e,n,t){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.widgetTypes=Fi,this.allWidgetTypes=Object.keys(Fi),this.widgetTypesDataMap=_a}cancel(){this.dialogRef.close(null)}typeSelected(e){this.dialogRef.close(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-select-widget-type-dialog"]],features:[G],decls:23,vars:16,consts:[[2,"width","800px"],["color","primary"],["translate",""],[1,"flex-1"],["tb-help","widgetTypes"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],[1,"flex","flex-col","items-center","justify-center","gap-4","gt-sm:flex-row"],["class","tb-card-button","mat-raised-button","","color","primary","type","button",3,"click",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["mat-raised-button","","color","primary","type","button",1,"tb-card-button",3,"click"],["matButtonIcon","",1,"tb-mat-96"]],template:function(n,t){n&1&&(a(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"widget.select-widget-type"),r(),f(4,"span",3)(5,"div",4),a(6,"button",5),y("click",function(){return t.cancel()}),a(7,"mat-icon",6),p(8,"close"),r()()(),b(9,oy,1,0,"mat-progress-bar",7),d(10,"async"),b(11,ay,1,0,"div",8),d(12,"async"),a(13,"div",9)(14,"fieldset",10),d(15,"async"),a(16,"div",11),b(17,ry,5,2,"button",12),r()()(),a(18,"div",13)(19,"button",14),d(20,"async"),y("click",function(){return t.cancel()}),p(21),d(22,"translate"),r()()()),n&2&&(o(9),l("ngIf",c(10,6,t.isLoading$)),o(2),l("ngIf",!c(12,8,t.isLoading$)),o(3),l("disabled",c(15,10,t.isLoading$)),o(3),l("ngForOf",t.allWidgetTypes),o(2),l("disabled",c(20,12,t.isLoading$)),o(2),h(" ",c(22,14,"action.cancel")," "))},dependencies:[we,V,Tt,K,Ce,ee,Oe,He,Ct,Je,fe,z,Yi,H,ji,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button{width:100%;height:100%;max-width:240px;display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button .mat-icon{margin:auto}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button span.mdc-button__label{height:18px;min-height:18px;max-height:18px;margin:0 0 20px;font-size:18px;font-weight:400;line-height:18px;white-space:normal}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button.mat-mdc-raised-button.mat-primary .mat-ripple-element{opacity:.3;background-color:#ffffff4d}']})}}return i})();var jl=(()=>{class i{constructor(e,n,t,s,u,_,E){this.store=e,this.dialog=n,this.widgetsService=t,this.translate=s,this.importExport=u,this.datePipe=_,this.router=E,this.config=new Qe,this.config.entityType=B.WIDGETS_BUNDLE,this.config.entityComponent=Vl,this.config.entityTabsComponent=Ll,this.config.entityTranslations=$e.get(B.WIDGET_TYPE),this.config.entityResources=_t.get(B.WIDGET_TYPE),this.config.defaultSortOrder={property:"name",direction:ni.ASC},this.config.rowPointer=!0,this.config.entityTitle=w=>w?w.name:"",this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","widget.title","100%"),new te("widgetType","widget.type","150px",w=>w?.widgetType?this.translate.instant(_a.get(w.widgetType).name):"",void 0,!1),new te("tenantId","widget.system","60px",w=>Ot(w.tenantId.id===Be)),new te("deprecated","widget.deprecated","60px",w=>Ot(w.deprecated))),this.config.addActionDescriptors.push({name:this.translate.instant("dashboard.create-new-widget"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:w=>this.addWidgetType(w)},{name:this.translate.instant("widget.import"),icon:"file_upload",isEnabled:()=>!0,onAction:w=>this.importWidgetType(w)}),this.config.cellActionDescriptors.push({name:this.translate.instant("widget.export"),icon:"file_download",isEnabled:()=>!0,onAction:(w,q)=>this.exportWidgetType(w,q)},{name:this.translate.instant("widget.widget-details"),icon:"edit",isEnabled:()=>!0,onAction:(w,q)=>this.config.toggleEntityDetails(w,q)}),this.config.groupActionDescriptors.push({name:this.translate.instant("widget.export-widgets"),icon:"file_download",isEnabled:!0,onAction:(w,q)=>this.exportWidgetTypes(w,q)}),this.config.deleteEntityTitle=w=>this.translate.instant("widget.delete-widget-title",{widgetName:w.name}),this.config.deleteEntityContent=()=>this.translate.instant("widget.delete-widget-text"),this.config.deleteEntitiesTitle=w=>this.translate.instant("widget.delete-widgets-title",{count:w}),this.config.deleteEntitiesContent=()=>this.translate.instant("widget.delete-widgets-text"),this.config.loadEntity=w=>this.widgetsService.getWidgetTypeById(w.id),this.config.saveEntity=w=>this.widgetsService.saveWidgetType(w),this.config.deleteEntity=w=>this.widgetsService.deleteWidgetType(w.id),this.config.onEntityAction=w=>this.onWidgetTypeAction(w,this.config),this.config.handleRowClick=(w,q)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(w,q):this.openWidgetEditor(w,q),!0)}resolve(){this.config.tableTitle=this.translate.instant("widget.widgets");let e=Bt(this.store);return this.config.deleteEnabled=n=>this.isWidgetTypeEditable(n,e.authority),this.config.entitySelectionEnabled=n=>this.isWidgetTypeEditable(n,e.authority),this.config.detailsReadonly=n=>!this.isWidgetTypeEditable(n,e.authority),this.config.entitiesFetchFunction=n=>this.widgetsService.getWidgetTypes(n),this.config}isWidgetTypeEditable(e,n){return n===M.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Be:n===M.SYS_ADMIN}addWidgetType(e){e&&e.stopPropagation(),this.dialog.open(sr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(n=>{n&&this.router.navigateByUrl(`resources/widgets-library/widget-types/${n}`)})}importWidgetType(e){this.importExport.importWidgetType().subscribe(n=>{n&&this.config.updateData()})}openWidgetEditor(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`resources/widgets-library/widget-types/${n.id.id}`)}openWidgetTypeDetails(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree(["details",n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}exportWidgetType(e,n){e&&e.stopPropagation(),this.importExport.exportWidgetType(n.id.id)}exportWidgetTypes(e,n){e&&e.stopPropagation(),this.importExport.exportWidgetTypes(n.map(t=>t.id.id)).subscribe(()=>{this.config.getTable().clearSelection()})}onWidgetTypeAction(e,n){switch(e.action){case"edit":return this.openWidgetEditor(e.event,e.entity),!0;case"openDetails":return this.openWidgetTypeDetails(e.event,e.entity,n),!0;case"export":return this.exportWidgetType(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(je),N(fi),N(ie),N(Gi),N(Ge),N(de))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();var my=["widgetTypeInput"],dy=[[["","tb-error",""]],[["","tb-hint",""]]],cy=["[tb-error]","[tb-hint]"],uy=()=>({preview:!0,emptyUrl:"/assets/widget-preview-empty.svg"}),fy=i=>({entity:i});function gy(i,m){if(i&1&&(a(0,"mat-label"),p(1),r()),i&2){let e=v();o(),R(e.label)}}function hy(i,m){if(i&1){let e=O();a(0,"button",10),y("click",function(){x(e);let t=v();return I(t.clear())}),a(1,"mat-icon",11),p(2,"close"),r()()}}function by(i,m){i&1&&(a(0,"div",18),p(1),d(2,"translate"),r()),i&2&&(o(),R(c(2,1,"widget.deprecated")))}function vy(i,m){if(i&1&&(a(0,"mat-option",12)(1,"div",13),f(2,"img",14),d(3,"image"),d(4,"async"),a(5,"div",15),f(6,"div",16),d(7,"highlight"),b(8,by,3,3,"div",17),r()()()),i&2){let e=m.$implicit,n=v();l("value",e),o(2),T("alt",e.name),l("src",c(4,8,Nt(3,5,e.image,Rt(14,uy))),Nn),o(4),l("innerHTML",nu(7,10,e.name,n.searchText,!0),sn),o(2),l("ngIf",e.deprecated)}}function yy(i,m){i&1&&(a(0,"div")(1,"span"),p(2),d(3,"translate"),r()()),i&2&&(o(2),R(c(3,1,"widget.no-widgets-text")))}function _y(i,m){if(i&1&&(a(0,"span"),p(1),d(2,"async"),r()),i&2){let e=v(2);o(),h(" ",c(2,1,e.translate.get("widget.no-widgets-matching",at(3,fy,e.searchText)))," ")}}function Cy(i,m){if(i&1){let e=O();a(0,"mat-option",12)(1,"div",19),y("click",function(t){return x(e),I(t.stopPropagation())}),b(2,yy,4,3,"div",20)(3,_y,3,5,"ng-template",null,2,xt),r()()}if(i&2){let e=U(4),n=v();l("value",null),o(2),l("ngIf",!n.textIsNotEmpty(n.searchText))("ngIfElse",e)}}var $o=class i{constructor(m,e,n){this.translate=m,this.widgetService=e,this.fb=n,this.dirty=!1,this.label=this.translate.instant("widget.widget"),this.floatLabel="auto",this.appearance="fill",this.subscriptSizing="fixed",this.searchText="",this.propagateChange=t=>{},this.selectWidgetTypeFormGroup=this.fb.group({widgetType:[null]})}registerOnChange(m){this.propagateChange=m}registerOnTouched(m){}ngOnInit(){this.filteredWidgetTypes=this.selectWidgetTypeFormGroup.get("widgetType").valueChanges.pipe(Qr(150),wt(m=>{let e;typeof m=="string"||!m?e=null:e=m,this.updateView(e)}),mt(m=>m?typeof m=="string"?m:m.name:""),ra(),sa(m=>this.fetchWidgetTypes(m)),Jr())}ngAfterViewInit(){}setDisabledState(m){this.disabled=m,this.disabled?this.selectWidgetTypeFormGroup.disable({emitEvent:!1}):this.selectWidgetTypeFormGroup.enable({emitEvent:!1})}writeValue(m){this.searchText="",m!=null?typeof m=="string"?this.widgetService.getWidgetTypeInfoById(m).subscribe(e=>{this.modelValue=e,this.selectWidgetTypeFormGroup.get("widgetType").patchValue(e,{emitEvent:!1})}):(this.modelValue=m,this.selectWidgetTypeFormGroup.get("widgetType").patchValue(m,{emitEvent:!1})):(this.modelValue=null,this.selectWidgetTypeFormGroup.get("widgetType").patchValue("",{emitEvent:!1})),this.dirty=!0}updateView(m){this.modelValue!==m&&(this.modelValue=m,this.propagateChange(this.modelValue))}displayWidgetTypeFn(m){return m?m.name:void 0}fetchWidgetTypes(m){this.searchText=m;let e=new _0(10,0,m,{property:"name",direction:ni.ASC});return this.getWidgetTypes(e)}getWidgetTypes(m,e=[]){return this.widgetService.getWidgetTypes(m,!0).pipe(cn(()=>ot(y0())),sa(n=>{if(this.excludeWidgetTypeIds?.length){let t=n.data.filter(s=>!this.excludeWidgetTypeIds.includes(s.id.id));e=e.concat(t)}else e=n.data;return e.length>=m.pageSize||!this.excludeWidgetTypeIds?.length||!n.hasNext?ot(e):this.getWidgetTypes(m.nextPageLink(),e)}))}onFocus(){this.dirty&&(this.selectWidgetTypeFormGroup.get("widgetType").updateValueAndValidity({onlySelf:!0}),this.dirty=!1)}clear(){this.selectWidgetTypeFormGroup.get("widgetType").patchValue(""),setTimeout(()=>{this.widgetTypeInput.nativeElement.blur(),this.widgetTypeInput.nativeElement.focus()},0)}textIsNotEmpty(m){return m&&m.length>0}static{this.\u0275fac=function(e){return new(e||i)(g(ie),g(fi),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-widget-type-autocomplete"]],viewQuery:function(e,n){if(e&1&&be(my,7),e&2){let t;ve(t=ye())&&(n.widgetTypeInput=t.first)}},inputs:{label:"label",placeholder:"placeholder",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",required:"required",disabled:"disabled",excludeWidgetTypeIds:"excludeWidgetTypeIds"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],ngContentSelectors:cy,decls:15,vars:16,consts:[["widgetTypeInput",""],["widgetTypeAutocomplete",""],["searchNotEmpty",""],[1,"mat-block",3,"formGroup","floatLabel","appearance","subscriptSizing"],[4,"ngIf"],["matInput","","type","text","formControlName","widgetType",3,"focusin","placeholder","required","matAutocomplete"],["type","button","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],[1,"tb-autocomplete","tb-widget-type-autocomplete",3,"displayWith"],[3,"value",4,"ngFor","ngForOf"],[3,"value",4,"ngIf"],["type","button","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"material-icons"],[3,"value"],[1,"tb-widget-type-option-container"],[1,"tb-widget-type-option-image-preview",3,"src","alt"],[1,"tb-widget-type-option-details"],[1,"tb-widget-type-option-text",3,"innerHTML"],["class","tb-widget-type-option-deprecated",4,"ngIf"],[1,"tb-widget-type-option-deprecated"],[3,"click"],[4,"ngIf","ngIfElse"]],template:function(e,n){if(e&1){let t=O();pa(dy),a(0,"mat-form-field",3),b(1,gy,2,1,"mat-label",4),a(2,"input",5,0),y("focusin",function(){return x(t),I(n.onFocus())}),r(),b(4,hy,3,0,"button",6),a(5,"mat-autocomplete",7,1),b(7,vy,9,15,"mat-option",8),d(8,"async"),b(9,Cy,5,3,"mat-option",9),d(10,"async"),r(),a(11,"mat-error"),uo(12),r(),a(13,"mat-hint"),uo(14,1),r()()}if(e&2){let t,s=U(6);l("formGroup",n.selectWidgetTypeFormGroup)("floatLabel",n.floatLabel)("appearance",n.appearance)("subscriptSizing",n.subscriptSizing),o(),l("ngIf",n.label),o(),T("placeholder",n.placeholder),l("required",n.required)("matAutocomplete",s),o(2),l("ngIf",n.selectWidgetTypeFormGroup.get("widgetType").value&&!n.disabled),o(),l("displayWith",n.displayWidgetTypeFn),o(2),l("ngForOf",c(8,12,n.filteredWidgetTypes)),o(2),l("ngIf",!((t=c(10,14,n.filteredWidgetTypes))!=null&&t.length))}},dependencies:[we,V,Ce,ee,ge,me,Ie,zt,De,ei,ct,fs,gs,ue,W,z,ce,X,oe,le,Ds,Us,k],styles:[`@charset "UTF-8";.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text{width:100%}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-container{display:flex;gap:8px;align-items:center}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-image-preview{width:36px;max-height:100%;object-fit:contain;border-radius:6px}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details{flex:1;display:flex;align-items:center;justify-content:space-between}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details .tb-widget-type-option-text{font-size:14px;font-weight:400;letter-spacing:.2px}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details .tb-widget-type-option-deprecated{font-size:13px;font-weight:400;color:#0000008a}
`],encapsulation:2})}};Kn([io(),Yn("design:type",Boolean)],$o.prototype,"required",void 0);var Ty=()=>({preview:!0,emptyUrl:"/assets/widget-preview-empty.svg"});function xy(i,m){if(i&1&&(a(0,"button",19),d(1,"translate"),d(2,"async"),a(3,"mat-icon"),p(4,"add"),r()()),i&2){let e=v(),n=U(14);T("matTooltip",c(1,3,"widget.add-new-widget")),l("disabled",c(2,5,e.isLoading$))("matMenuTriggerFor",n)}}function Iy(i,m){i&1&&f(0,"mat-progress-bar",20)}function Ey(i,m){i&1&&f(0,"div",21)}function wy(i,m){i&1&&(a(0,"div",30),p(1),d(2,"translate"),r()),i&2&&(o(),R(c(2,1,"widget.deprecated")))}function My(i,m){if(i&1){let e=O();a(0,"button",3),d(1,"translate"),y("click",function(t){x(e);let s=v().$implicit,u=v();return I(u.openWidgetEditor(t,s))}),a(2,"mat-icon"),p(3,"edit"),r()()}i&2&&T("matTooltip",c(1,1,"widget.edit"))}function Dy(i,m){if(i&1){let e=O();a(0,"button",3),d(1,"translate"),y("click",function(t){x(e);let s=v().$implicit,u=v();return I(u.exportWidgetType(t,s))}),a(2,"mat-icon"),p(3,"file_download"),r()()}i&2&&T("matTooltip",c(1,1,"widget.export"))}function Py(i,m){if(i&1){let e=O();a(0,"button",3),d(1,"translate"),y("click",function(t){x(e);let s=v().$implicit,u=v();return I(u.removeWidgetType(t,s))}),a(2,"mat-icon"),p(3,"delete"),r()()}i&2&&T("matTooltip",c(1,1,"widget.remove"))}function Fy(i,m){if(i&1&&(a(0,"button",31),d(1,"translate"),a(2,"tb-icon"),p(3,"drag_indicator"),r()()),i&2){let e=v(2);L("!hidden",!e.widgets||e.widgets.length<=1),T("matTooltip",c(1,3,"action.drag"))}}function Ay(i,m){if(i&1&&(a(0,"div",22)(1,"div",23),f(2,"img",24),d(3,"image"),d(4,"async"),a(5,"div",25)(6,"div",26),p(7),r(),b(8,wy,3,3,"div",27),r()(),b(9,My,4,3,"button",28)(10,Dy,4,3,"button",28)(11,Py,4,3,"button",28)(12,Fy,4,5,"button",29),r()),i&2){let e=m.$implicit,n=v();o(2),T("alt",e.name),l("src",c(4,11,Nt(3,8,e.image,Rt(13,Ty))),Nn),o(5),R(e.name),o(),l("ngIf",e.deprecated),o(),l("ngIf",!n.editMode),o(),l("ngIf",!n.editMode),o(),l("ngIf",n.editMode&&!n.addMode),o(),l("ngIf",n.editMode)}}function Ny(i,m){if(i&1){let e=O();a(0,"div",32),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.addWidgetMode())}),a(2,"tb-icon",33),p(3,"add"),r()()}i&2&&T("matTooltip",c(1,1,"widget.add-existing-widget"))}function ky(i,m){if(i&1){let e=O();a(0,"div",34)(1,"div",35),y("click",function(){x(e);let t=v();return I(t.addWidgetMode())}),a(2,"tb-icon",33),p(3,"add"),r(),a(4,"div",36),p(5,"widget.add-existing-widget"),r()()()}}function Ry(i,m){i&1&&(a(0,"div",37),f(1,"div",38),a(2,"div",39),p(3,"widget.no-widgets"),r()())}function Oy(i,m){if(i&1){let e=O();a(0,"div",40),f(1,"tb-widget-type-autocomplete",41),d(2,"translate"),a(3,"div",42)(4,"button",43),d(5,"async"),y("click",function(){x(e);let t=v();return I(t.cancelAddWidgetMode())}),p(6),d(7,"translate"),r()()()}if(i&2){let e=v();o(),T("placeholder",c(2,5,"widget.select-widget")),l("excludeWidgetTypeIds",e.excludeWidgetTypeIds)("formControl",e.addWidgetFormControl),o(3),l("disabled",c(5,7,e.isLoading$)),o(2),h("",c(7,9,"action.cancel")," ")}}function By(i,m){if(i&1){let e=O();a(0,"button",43),d(1,"async"),y("click",function(){x(e);let t=v();return I(t.cancel())}),p(2),d(3,"translate"),r()}if(i&2){let e=v();l("disabled",c(1,2,e.isLoading$)),o(2),h("",c(3,4,"action.cancel")," ")}}function Vy(i,m){if(i&1){let e=O();a(0,"button",44),d(1,"async"),y("click",function(){x(e);let t=v();return I(t.save())}),p(2),d(3,"translate"),r()}if(i&2){let e=v();l("disabled",c(1,2,e.isLoading$)||!e.isDirty),o(2),h("",c(3,4,"action.save")," ")}}function Ly(i,m){if(i&1){let e=O();a(0,"button",44),d(1,"async"),y("click",function(){x(e);let t=v();return I(t.edit())}),p(2),d(3,"translate"),r()}if(i&2){let e=v();l("disabled",c(1,2,e.isLoading$)),o(2),h("",c(3,4,"action.edit")," ")}}var Gl=(()=>{class i extends It{constructor(e,n,t,s,u,_,E){super(e),this.store=e,this.router=n,this.route=t,this.widgetsService=s,this.importExport=u,this.cd=_,this.dialog=E,this.editMode=!1,this.addMode=!1,this.isDirty=!1,this.addWidgetFormControl=new xa(null,[S.required]),this.authUser=Bt(this.store),this.widgetsBundle=this.route.snapshot.data.widgetsBundle,this.widgets=[...this.route.snapshot.data.widgets],this.authUser.authority===M.TENANT_ADMIN?this.isReadOnly=!this.widgetsBundle||this.widgetsBundle.tenantId.id===Be:this.isReadOnly=this.authUser.authority!==M.SYS_ADMIN,!this.isReadOnly&&!this.widgets.length&&(this.editMode=!0),this.addWidgetFormControl.valueChanges.subscribe(w=>{w&&this.addWidget(w)})}ngOnInit(){}trackByWidget(e,n){return n}widgetDrop(e){let n=this.widgets[e.previousIndex];this.widgets.splice(e.previousIndex,1),this.widgets.splice(e.currentIndex,0,n),this.isDirty=!0}addWidgetMode(){this.addWidgetFormControl.patchValue(null,{emitEvent:!1}),this.excludeWidgetTypeIds=this.widgets.map(e=>e.id.id),this.addMode=!0}cancelAddWidgetMode(){this.addMode=!1}addWidget(e){this.widgets.push(e),this.isDirty=!0,this.addMode=!1}openWidgetEditor(e,n){e&&e.stopPropagation(),this.router.navigate([n.id.id],{relativeTo:this.route}).then(()=>{})}exportWidgetType(e,n){e&&e.stopPropagation(),this.importExport.exportWidgetType(n.id.id)}removeWidgetType(e,n){e&&e.stopPropagation();let t=this.widgets.indexOf(n);this.widgets.splice(t,1),this.isDirty=!0}goBack(){this.router.navigate([".."],{relativeTo:this.route})}exportWidgetsBundle(){this.importExport.exportWidgetsBundle(this.widgetsBundle.id.id)}edit(){this.editMode=!0}cancel(){this.isDirty?this.widgetsService.getBundleWidgetTypeInfosList(this.widgetsBundle.id.id).subscribe(e=>{this.widgets=[...e],this.isDirty=!1,this.addMode=!1,this.editMode=!this.widgets.length,this.cd.markForCheck()}):(this.addMode=!1,this.editMode=!this.widgets.length)}save(){let e=this.widgets.map(n=>n.id.id);this.widgetsService.updateWidgetsBundleWidgetTypes(this.widgetsBundle.id.id,e).subscribe(()=>{this.isDirty=!1,this.editMode=!1,this.addMode=!1})}addWidgetType(e){e&&e.stopPropagation(),this.dialog.open(sr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(n=>{n&&this.router.navigate([n],{relativeTo:this.route}).then(()=>{})})}importWidgetType(){this.importExport.importWidgetType().subscribe(e=>{if(e){let n=this.widgets.some(t=>t.id.id===e.id.id);n&&(this.widgets=this.widgets.map(t=>t.id.id!==e.id.id?t:e)),this.editMode?(this.widgets.push(e),this.isDirty=!0,this.cd.markForCheck()):n||this.widgetsService.addWidgetFqnToWidgetBundle(this.widgetsBundle.id.id,e.fqn).subscribe(()=>{this.widgets.push(e),this.cd.markForCheck()})}})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Si),g(fi),g(Gi),g(Xe),g(je))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-widgets-bundle-widget"]],features:[G],decls:46,vars:33,consts:[["addWidgetMenu","matMenu"],["appearance","outlined",1,"tb-bundle-widgets-card"],[1,"title-container"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],[1,"mat-headline-5"],[1,"flex-1"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["xPosition","before"],["mat-menu-item","",3,"click"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-drop-list","tb-bundle-widgets-container",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","","class","tb-draggable tb-bundle-widget-row",4,"ngFor","ngForOf","ngForTrackBy"],["class","tb-add-widget-button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["class","tb-add-widget-button-panel",4,"ngIf"],["class","tb-no-data-available",4,"ngIf"],["class","tb-add-bundle-widget-form",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","matMenuTriggerFor"],["color","warn","mode","indeterminate"],[2,"height","4px"],["cdkDrag","",1,"tb-draggable","tb-bundle-widget-row"],[1,"tb-bundle-widget-row-details"],[1,"tb-bundle-widget-image-preview",3,"src","alt"],[1,"tb-bundle-widget-details"],[1,"tb-bundle-widget-title"],["class","tb-bundle-widget-deprecated",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above","class","tb-drag-handle",3,"!hidden","matTooltip",4,"ngIf"],[1,"tb-bundle-widget-deprecated"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above",1,"tb-drag-handle",3,"matTooltip"],["matTooltipPosition","above",1,"tb-add-widget-button",3,"click","matTooltip"],["color","primary",1,"tb-add-widget-icon"],[1,"tb-add-widget-button-panel"],[1,"tb-add-widget-button-with-text",3,"click"],["translate","",1,"tb-add-widget-button-text"],[1,"tb-no-data-available"],[1,"tb-no-data-bg"],["translate","",1,"tb-no-data-text"],[1,"tb-add-bundle-widget-form"],["required","",3,"placeholder","excludeWidgetTypeIds","formControl"],[1,"tb-add-bundle-widget-actions"],["mat-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title")(3,"div",2)(4,"button",3),d(5,"translate"),y("click",function(){return x(s),I(t.goBack())}),a(6,"mat-icon"),p(7,"arrow_back"),r()(),a(8,"span",4),p(9),d(10,"translate"),r(),f(11,"span",5),b(12,xy,5,7,"button",6),a(13,"mat-menu",7,0)(15,"button",8),y("click",function(_){return x(s),I(t.addWidgetType(_))}),a(16,"mat-icon"),p(17,"insert_drive_file"),r(),a(18,"span"),p(19),d(20,"translate"),r()(),a(21,"button",8),y("click",function(){return x(s),I(t.importWidgetType())}),a(22,"mat-icon"),p(23,"file_upload"),r(),a(24,"span"),p(25),d(26,"translate"),r()()(),a(27,"button",3),d(28,"translate"),y("click",function(){return x(s),I(t.exportWidgetsBundle())}),a(29,"mat-icon"),p(30,"file_download"),r()()()()(),b(31,Iy,1,0,"mat-progress-bar",9),d(32,"async"),b(33,Ey,1,0,"div",10),d(34,"async"),a(35,"mat-card-content")(36,"div",11),y("cdkDropListDropped",function(_){return x(s),I(t.widgetDrop(_))}),b(37,Ay,13,14,"div",12),r(),b(38,Ny,4,3,"div",13)(39,ky,6,0,"div",14)(40,Ry,4,0,"div",15)(41,Oy,8,11,"div",16),r(),a(42,"mat-card-actions"),b(43,By,4,6,"button",17)(44,Vy,4,6,"button",18)(45,Ly,4,6,"button",18),r()()}n&2&&(o(4),T("matTooltip",c(5,19,"action.back")),o(5),yr("",t.widgetsBundle.title,": ",c(10,21,"widget.widgets"),""),o(3),l("ngIf",!t.isReadOnly),o(7),R(c(20,23,"dashboard.create-new-widget")),o(6),R(c(26,25,"widget.import")),o(2),T("matTooltip",c(28,27,"widgets-bundle.export")),o(4),l("ngIf",c(32,29,t.isLoading$)),o(2),l("ngIf",c(34,31,t.isLoading$)===!1),o(3),l("cdkDropListDisabled",!t.editMode||(t.widgets==null?null:t.widgets.length)<2),o(),l("ngForOf",t.widgets)("ngForTrackBy",t.trackByWidget),o(),l("ngIf",t.editMode&&!t.addMode&&(t.widgets==null?null:t.widgets.length)),o(),l("ngIf",t.editMode&&!t.addMode&&!(t.widgets!=null&&t.widgets.length)),o(),l("ngIf",t.isReadOnly&&!(t.widgets!=null&&t.widgets.length)),o(),l("ngIf",t.addMode),o(2),l("ngIf",t.editMode&&((t.widgets==null?null:t.widgets.length)||t.isDirty)),o(),l("ngIf",t.editMode&&((t.widgets==null?null:t.widgets.length)||t.isDirty)),o(),l("ngIf",!t.isReadOnly&&!t.editMode))},dependencies:[we,V,K,Ce,ee,ti,hs,pi,yi,vi,Oe,Pa,Da,Fa,Dt,Lo,Vo,Bo,W,ce,Yt,H,ji,$o,le,Us,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;height:100%;padding:8px}[_nghost-%COMP%]     .tb-bundle-widgets-card .mat-mdc-card-header-text{flex:1}.tb-bundle-widgets-card[_ngcontent-%COMP%]{padding:0;width:100%;height:100%;display:flex;flex-direction:column}@media screen and (min-width: 960px) and (max-width: 1279px){.tb-bundle-widgets-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){.tb-bundle-widgets-card[_ngcontent-%COMP%]{width:60%}}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:8px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{flex:1;padding:16px;min-height:0;overflow:hidden;display:flex;flex-direction:column;gap:8px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button[_ngcontent-%COMP%]{min-height:56px;cursor:pointer;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;padding:8px;border:2px dashed rgba(0,0,0,.08);border-radius:10px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]   .tb-add-widget-button-with-text[_ngcontent-%COMP%]{cursor:pointer;display:flex;padding:24px 40px 24px 24px;justify-content:center;align-items:center;gap:8px;border:2px dashed rgba(0,0,0,.12);border-radius:10px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]   .tb-add-widget-button-with-text[_ngcontent-%COMP%]   .tb-add-widget-button-text[_ngcontent-%COMP%]{font-size:16px;font-style:normal;font-weight:500;line-height:24px;letter-spacing:.25px;color:#359b07}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-bundle-widget-form[_ngcontent-%COMP%]{display:flex;padding:16px;flex-direction:column;gap:12px;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-bundle-widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-start;gap:16px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .mat-mdc-card-actions[_ngcontent-%COMP%]{justify-content:end;gap:8px}.tb-bundle-widgets-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto;padding-top:8px;padding-bottom:8px}.tb-bundle-widget-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:6px 12px 6px 6px;background:#fff;gap:12px;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row;align-items:center;gap:12px}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-image-preview[_ngcontent-%COMP%]{width:64px;max-height:52px;height:100%;object-fit:contain;border-radius:6px}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]{padding:18px 0;flex:1;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]   .tb-bundle-widget-title[_ngcontent-%COMP%]{font-size:14px;font-weight:400;letter-spacing:.2px;color:#000000c2}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]   .tb-bundle-widget-deprecated[_ngcontent-%COMP%]{font-size:13px;font-weight:400;color:#0000008a}.tb-bundle-widget-row[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#0000008a}']})}}return i})();var jy=i=>{let m=i.params.widgetsBundleId;return Zt(fi).getWidgetsBundle(m)},Gy=i=>{let m=i.params.widgetsBundleId;return Zt(fi).getBundleWidgetTypeInfosList(m)},Uy=i=>{let m=i.params.widgetTypeId;if(!m||Object.keys(Fi).includes(m)){let e=m;return e||(e=Fi.timeseries),Zt(fi).getWidgetTemplate(e).pipe(mt(n=>(n.widgetName=null,{widgetTypeDetails:null,widget:n})))}else return Zt(fi).getWidgetTypeById(m).pipe(mt(e=>({widgetTypeDetails:e,widget:Os(e)})))},qy=i=>i.data.widgetsBundle.title,Wy=(i,m,e)=>e?.widget?.widgetName?e.widget.widgetName+(e.widget.deprecated?` (${m.instant("widget.deprecated")})`:""):"",Qg=[{path:":widgetTypeId",component:Bl,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"widget.editor",breadcrumb:{labelFunction:Wy,icon:"insert_chart"},hideTabs:!0},resolve:{widgetEditorData:Uy}}],Hy=[{path:"widget-types",data:{breadcrumb:{menuId:xe.widget_types}},children:[{path:"",component:qe,data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"widget.widgets"},resolve:{entitiesTableConfig:jl}},{path:"details",children:[{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"now_widgets"},auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"widget.widgets",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:jl}}]},...Qg]}],zy=[{path:"widgets-bundles",data:{breadcrumb:{menuId:xe.widgets_bundles}},children:[{path:"",component:qe,data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"widgets-bundle.widgets-bundles"},resolve:{entitiesTableConfig:Rl}},{path:"details",children:[{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"now_widgets"},auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"widgets-bundle.widgets-bundles",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:Rl}}]},{path:":widgetsBundleId",data:{breadcrumb:{labelFunction:qy,icon:"now_widgets"}},resolve:{widgetsBundle:jy},children:[{path:"",component:Gl,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"widgets-bundle.widgets-bundle-widgets",hideTabs:!0},resolve:{widgets:Gy}},...Qg]}]}],Jg=[{path:"widgets-library",component:Tn,data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],breadcrumb:{menuId:xe.widget_library}},children:[{path:"",children:[],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],redirectTo:"/resources/widgets-library/widget-types"}},...Hy,...zy]}],$y=[{path:"widgets-bundles",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles"},{path:"resources/widgets-bundles",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles/:widgetsBundleId"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles/:widgetsBundleId"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes/:widgetTypeId",pathMatch:"full",redirectTo:"/resources/widgets-library/widget-types/:widgetTypeId"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes/:widgetTypeId",pathMatch:"full",redirectTo:"/resources/widgets-library/widget-types/:widgetTypeId"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes/add/:widgetType",redirectTo:"/resources/widgets-library/widget-types/:widgetType"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes/add/:widgetType",redirectTo:"/resources/widgets-library/widget-types/:widgetType"}],Ul=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[jl,Rl],imports:[j.forChild($y),j]})}}return i})();(function(){Y(Ul,{imports:[j],exports:[j]})})();C();var Kg=[{path:"auditLogs",component:Ci,data:{auth:[M.TENANT_ADMIN],title:"audit-log.audit-logs",breadcrumb:{menuId:xe.audit_log},isPage:!0}}],Qy=[{path:"auditLogs",redirectTo:"/security-settings/auditLogs"}],ql=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(Qy),j]})}}return i})();(function(){Y(ql,{imports:[j],exports:[j]})})();C();C();C();var Jy=()=>({standalone:!0});function Ky(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-title-required")," "))}function Yy(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-title-max-length")," "))}function Xy(i,m){if(i&1&&(a(0,"mat-option",17),p(1),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e," ")}}function Zy(i,m){if(i&1&&(a(0,"mat-option",17),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.platformTypeTranslations.get(e))," ")}}function e_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-id-required")," "))}function t_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-id-max-length")," "))}function i_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-secret-required")," "))}function n_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-secret-max-length")," "))}function o_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.access-token-uri-required")," "))}function a_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function r_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.authorization-uri-required")," "))}function s_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function l_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function p_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function m_(i,m){if(i&1&&(a(0,"mat-option",17),p(1),d(2,"uppercase"),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",c(2,2,e)," ")}}function d_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.login-button-label-required")," "))}function c_(i,m){if(i&1&&(a(0,"div",6)(1,"mat-form-field",10)(2,"mat-label",3),p(3,"admin.oauth2.login-button-label"),r(),f(4,"input",35),d(5,"translate"),b(6,d_,3,3,"mat-error",5),r(),a(7,"mat-form-field",2)(8,"mat-label",3),p(9,"admin.oauth2.login-button-icon"),r(),f(10,"input",36),r()()),i&2){let e=v(3);o(4),T("placeholder",c(5,2,"admin.oauth2.login-button-label-placeholder")),o(2),l("ngIf",e.entityForm.get("loginButtonLabel").hasError("required"))}}function u_(i,m){if(i&1&&(a(0,"section",23)(1,"div",6)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.access-token-uri"),r(),f(5,"input",24),b(6,o_,3,3,"mat-error",5)(7,a_,3,3,"mat-error",5),r(),a(8,"mat-form-field",2)(9,"mat-label",3),p(10,"admin.oauth2.authorization-uri"),r(),f(11,"input",25),b(12,r_,3,3,"mat-error",5)(13,s_,3,3,"mat-error",5),r()(),a(14,"div",6)(15,"mat-form-field",2)(16,"mat-label",3),p(17,"admin.oauth2.jwk-set-uri"),r(),f(18,"input",26),b(19,l_,3,3,"mat-error",5),r(),a(20,"mat-form-field",2)(21,"mat-label",3),p(22,"admin.oauth2.user-info-uri"),r(),f(23,"input",27),b(24,p_,3,3,"mat-error",5),r()(),a(25,"div",1)(26,"mat-form-field",2)(27,"mat-label",3),p(28,"admin.oauth2.client-authentication-method"),r(),a(29,"mat-select",28),b(30,m_,3,4,"mat-option",9),r()()(),b(31,c_,11,4,"div",29),a(32,"section",30)(33,"div",31)(34,"mat-slide-toggle",32),p(35),d(36,"translate"),r()(),a(37,"div",31)(38,"mat-slide-toggle",33),p(39),d(40,"translate"),r()()(),f(41,"tb-string-items-list",34),d(42,"translate"),d(43,"translate"),r()),i&2){let e=v(2);o(6),l("ngIf",e.entityForm.get("accessTokenUri").hasError("required")),o(),l("ngIf",e.entityForm.get("accessTokenUri").hasError("pattern")),o(5),l("ngIf",e.entityForm.get("authorizationUri").hasError("required")),o(),l("ngIf",e.entityForm.get("authorizationUri").hasError("pattern")),o(6),l("ngIf",e.entityForm.get("jwkSetUri").hasError("pattern")),o(5),l("ngIf",e.entityForm.get("userInfoUri").hasError("pattern")),o(6),l("ngForOf",e.clientAuthenticationMethods),o(),l("ngIf",e.isCustomProvider()),o(4),h(" ",c(36,12,"admin.oauth2.allow-user-creation")," "),o(4),h(" ",c(40,14,"admin.oauth2.activate-user")," "),o(2),T("label",c(42,16,"admin.oauth2.scope")),T("requiredText",c(43,18,"admin.oauth2.scope-required"))}}function f_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.user-name-attribute-name-required")," "))}function g_(i,m){if(i&1&&(a(0,"mat-option",17),p(1),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e," ")}}function h_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.email-attribute-key-required")," "))}function b_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.email-attribute-key-max-length")," "))}function v_(i,m){if(i&1&&(a(0,"div",1)(1,"mat-form-field",2)(2,"mat-label",3),p(3,"admin.oauth2.email-attribute-key"),r(),f(4,"input",52),b(5,h_,3,3,"mat-error",5)(6,b_,3,3,"mat-error",5),r()()),i&2){let e=v(4);o(5),l("ngIf",e.entityForm.get("mapperConfig.basic.emailAttributeKey").hasError("required")),o(),l("ngIf",e.entityForm.get("mapperConfig.basic.emailAttributeKey").hasError("maxlength"))}}function y_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.first-name-attribute-key-max-length")," "))}function __(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.last-name-attribute-key-max-length")," "))}function C_(i,m){if(i&1&&(a(0,"mat-option",17),p(1),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e," ")}}function S_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.tenant-name-pattern-required")," "))}function T_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.tenant-name-pattern-max-length")," "))}function x_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.customer-name-pattern-max-length")," "))}function I_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.default-dashboard-name-max-length")," "))}function E_(i,m){if(i&1&&(a(0,"section",43),b(1,v_,7,2,"div",44),a(2,"div",6)(3,"mat-form-field",2)(4,"mat-label",3),p(5,"admin.oauth2.first-name-attribute-key"),r(),f(6,"input",45),b(7,y_,3,3,"mat-error",5),r(),a(8,"mat-form-field",2)(9,"mat-label",3),p(10,"admin.oauth2.last-name-attribute-key"),r(),f(11,"input",46),b(12,__,3,3,"mat-error",5),r()(),a(13,"div",6)(14,"mat-form-field",2)(15,"mat-label",3),p(16,"admin.oauth2.tenant-name-strategy"),r(),a(17,"mat-select",47),b(18,C_,2,2,"mat-option",9),r()(),a(19,"mat-form-field",2)(20,"mat-label",3),p(21,"admin.oauth2.tenant-name-pattern"),r(),f(22,"input",48),b(23,S_,3,3,"mat-error",5)(24,T_,3,3,"mat-error",5),r()(),a(25,"div",1)(26,"mat-form-field",2)(27,"mat-label",3),p(28,"admin.oauth2.customer-name-pattern"),r(),f(29,"input",49),b(30,x_,3,3,"mat-error",5),r()(),a(31,"div",6)(32,"mat-form-field",2)(33,"mat-label",3),p(34,"admin.oauth2.default-dashboard-name"),r(),f(35,"input",50),b(36,I_,3,3,"mat-error",5),r(),a(37,"mat-slide-toggle",51),p(38),d(39,"translate"),r()()()),i&2){let e=v(3);o(),l("ngIf",e.entityForm.get("mapperConfig.type").value!==e.mapperType.GITHUB),o(6),l("ngIf",e.entityForm.get("mapperConfig.basic.firstNameAttributeKey").hasError("maxlength")),o(5),l("ngIf",e.entityForm.get("mapperConfig.basic.lastNameAttributeKey").hasError("maxlength")),o(6),l("ngForOf",e.tenantNameStrategies),o(),L("!hidden",e.entityForm.get("mapperConfig.basic.tenantNameStrategy").value!=="CUSTOM"),o(3),l("required",e.entityForm.get("mapperConfig.basic.tenantNameStrategy").value==="CUSTOM"),o(),l("ngIf",e.entityForm.get("mapperConfig.basic.tenantNamePattern").hasError("required")),o(),l("ngIf",e.entityForm.get("mapperConfig.basic.tenantNamePattern").hasError("maxlength")),o(6),l("ngIf",e.entityForm.get("mapperConfig.basic.customerNamePattern").hasError("maxlength")),o(6),l("ngIf",e.entityForm.get("mapperConfig.basic.defaultDashboardName").hasError("maxlength")),o(2),h(" ",c(39,12,"admin.oauth2.always-fullscreen")," ")}}function w_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.url-required")," "))}function M_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.url-pattern")," "))}function D_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.url-max-length")," "))}function P_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.username-max-length")," "))}function F_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.password-max-length")," "))}function A_(i,m){if(i&1&&(a(0,"section",53)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.url"),r(),f(5,"input",54),b(6,w_,3,3,"mat-error",5)(7,M_,3,3,"mat-error",5)(8,D_,3,3,"mat-error",5),r()(),a(9,"div",6)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"common.username"),r(),f(13,"input",55),b(14,P_,3,3,"mat-error",5),r(),a(15,"mat-form-field",2)(16,"mat-label",3),p(17,"common.password"),r(),f(18,"input",56),b(19,F_,3,3,"mat-error",5),r()(),a(20,"mat-slide-toggle",57),p(21),d(22,"translate"),r()()),i&2){let e=v(3);o(6),l("ngIf",e.entityForm.get("mapperConfig.custom.url").hasError("required")),o(),l("ngIf",e.entityForm.get("mapperConfig.custom.url").hasError("pattern")),o(),l("ngIf",e.entityForm.get("mapperConfig.custom.url").hasError("maxlength")),o(6),l("ngIf",e.entityForm.get("mapperConfig.custom.username").hasError("maxlength")),o(5),l("ngIf",e.entityForm.get("mapperConfig.custom.password").hasError("maxlength")),o(2),h(" ",c(22,6,"admin.oauth2.send-token")," ")}}function N_(i,m){if(i&1&&(a(0,"section",37)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.user-name-attribute-name"),r(),f(5,"input",38),b(6,f_,3,3,"mat-error",5),r()(),a(7,"section",39)(8,"div",1)(9,"mat-form-field",2)(10,"mat-label",3),p(11,"admin.oauth2.type"),r(),a(12,"mat-select",40),b(13,g_,2,2,"mat-option",9),r()()(),b(14,E_,40,14,"section",41)(15,A_,23,8,"section",42),r()()),i&2){let e=v(2);o(6),l("ngIf",e.entityForm.get("userNameAttributeName").hasError("required")),o(7),l("ngForOf",e.mapperTypes),o(),l("ngIf",e.entityForm.get("mapperConfig.type").value!==e.mapperType.CUSTOM&&e.entityForm.get("mapperConfig.basic")),o(),l("ngIf",e.entityForm.get("mapperConfig.type").value===e.mapperType.CUSTOM&&e.entityForm.get("mapperConfig.custom"))}}function k_(i,m){if(i&1){let e=O();a(0,"section",18)(1,"div",19),f(2,"span"),a(3,"tb-toggle-select",20),pt("ngModelChange",function(t){x(e);let s=v();return lt(s.generalSettingsMode,t)||(s.generalSettingsMode=t),I(t)}),a(4,"tb-toggle-option",17),p(5),d(6,"translate"),r(),a(7,"tb-toggle-option",17),p(8),d(9,"translate"),r()()(),b(10,u_,44,20,"section",21)(11,N_,16,4,"section",22),r()}if(i&2){let e=v();o(3),st("ngModel",e.generalSettingsMode),l("ngModelOptions",Rt(12,Jy)),o(),l("value",!0),o(),R(c(6,8,"admin.oauth2.general")),o(2),l("value",!1),o(),R(c(9,10,"admin.oauth2.mapper")),o(2),l("ngIf",e.generalSettingsMode),o(),l("ngIf",!e.generalSettingsMode)}}var oo=class i extends jt{constructor(m,e,n,t,s,u,_){super(m,_,t,s,u),this.store=m,this.translate=e,this.oauth2Service=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.cd=u,this.fb=_,this.createNewDialog=!1,this.templateProvider=["Custom"],this.templates=new Map,this.defaultProvider={additionalInfo:{providerName:"Custom"},clientAuthenticationMethod:ms.POST,userNameAttributeName:"email",mapperConfig:{allowUserCreation:!0,activateUser:!1,type:bo.BASIC,basic:{emailAttributeKey:"email",tenantNameStrategy:ds.DOMAIN,alwaysFullScreen:!1}}},this.URL_REGEXP=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?(?:\/[\w#!:.,?+=&%@\-/]*)?$/,this.subscriptions=[],this.separatorKeysCodes=[13,188],this.clientAuthenticationMethods=Object.keys(ms),this.mapperType=bo,this.mapperTypes=Object.keys(bo),this.tenantNameStrategies=Object.keys(ds),this.platformTypes=Object.values(en),this.platformTypeTranslations=vo,this.generalSettingsMode=!0,this.advancedExpanded=!1,this.oauth2Service.getOAuth2Template().subscribe(E=>{this.initTemplates(E)}),Bt(this.store).authority===M.TENANT_ADMIN&&(this.platformTypes=this.platformTypes.filter(E=>E!==en.WEB))}ngOnDestroy(){super.ngOnDestroy(),this.subscriptions.forEach(m=>{m.unsubscribe()})}buildForm(m){return this.fb.group({title:[m?.title?m.title:"",[S.required,S.maxLength(100)]],additionalInfo:this.fb.group({providerName:[m?.additionalInfo?.providerName?m?.additionalInfo?.providerName:"",S.required]}),platforms:[m?.platforms?m.platforms:[]],clientId:[m?.clientId?m.clientId:"",[S.required,S.maxLength(255)]],clientSecret:[m?.clientSecret?m.clientSecret:"",[S.required,S.maxLength(2048)]],accessTokenUri:[m?.accessTokenUri?m.accessTokenUri:"",[S.required,S.pattern(this.URL_REGEXP)]],authorizationUri:[m?.authorizationUri?m.authorizationUri:"",[S.required,S.pattern(this.URL_REGEXP)]],jwkSetUri:[m?.jwkSetUri?m.jwkSetUri:"",S.pattern(this.URL_REGEXP)],userInfoUri:[m?.userInfoUri?m.userInfoUri:"",[S.pattern(this.URL_REGEXP)]],clientAuthenticationMethod:[m?.clientAuthenticationMethod?m.clientAuthenticationMethod:ms.POST,S.required],loginButtonLabel:[m?.loginButtonLabel?m.loginButtonLabel:null,S.required],loginButtonIcon:[m?.loginButtonIcon?m.loginButtonIcon:null],userNameAttributeName:[m?.userNameAttributeName?m.userNameAttributeName:"email",S.required],scope:[m?.scope?m.scope:[],S.required],mapperConfig:this.fb.group({allowUserCreation:[Re(m?.mapperConfig?.allowUserCreation)?m.mapperConfig.allowUserCreation:!0],activateUser:[Re(m?.mapperConfig?.activateUser)?m.mapperConfig.activateUser:!1],type:[m?.mapperConfig?.type?m.mapperConfig.type:bo.BASIC,S.required]})})}updateForm(m){this.entityForm.patchValue({title:m.title,additionalInfo:{providerName:m.additionalInfo.providerName},platforms:m.platforms,clientId:m.clientId,clientSecret:m.clientSecret,accessTokenUri:m.accessTokenUri,scope:m.scope,authorizationUri:m.authorizationUri,jwkSetUri:m.jwkSetUri,userInfoUri:m.userInfoUri,clientAuthenticationMethod:m.clientAuthenticationMethod,loginButtonLabel:m.loginButtonLabel,loginButtonIcon:m.loginButtonIcon,userNameAttributeName:m.userNameAttributeName,mapperConfig:{allowUserCreation:m.mapperConfig.allowUserCreation,activateUser:m.mapperConfig.activateUser,type:m.mapperConfig.type}},{emitEvent:!1}),this.changeMapperConfigType(this.entityForm,this.entityValue.mapperConfig.type,this.entityValue.mapperConfig)}getProviderName(){return this.entityForm.get("additionalInfo.providerName").value}isCustomProvider(){return this.getProviderName()==="Custom"}initTemplates(m){m.map(t=>{delete t.additionalInfo,this.templates.set(t.name,t)}),this.templateProvider.push(...Array.from(this.templates.keys())),this.templateProvider.sort();let e=null;Re(this.entityValue?.additionalInfo)&&(e=this.entityValue.additionalInfo,this.templateProvider.indexOf(e.providerName)===-1&&(e.providerName="Custom"));let n="Custom";this.templateProvider.indexOf("Google")&&(n="Google"),this.entityForm.get("additionalInfo.providerName").setValue(e?.providerName?e?.providerName:n),this.changeMapperConfigType(this.entityForm,bo.BASIC),this.setProviderDefaultValue(n,this.entityForm),this.subscriptions.push(this.entityForm.get("mapperConfig.type").valueChanges.subscribe(t=>{this.changeMapperConfigType(this.entityForm,t)})),this.subscriptions.push(this.entityForm.get("additionalInfo.providerName").valueChanges.subscribe(t=>{this.entityForm.get("scope").setValue([]),this.setProviderDefaultValue(t,this.entityForm)}))}changeMapperConfigType(m,e,n){let t=m.get("mapperConfig");e===bo.CUSTOM?(t.removeControl("basic"),t.get("custom")?t.get("custom").patchValue(n.custom,{emitEvent:!1}):t.addControl("custom",this.formCustomGroup(n?.custom))):(t.removeControl("custom"),t.get("basic")?n?.basic&&(t.get("basic").patchValue(n.basic,{emitEvent:!1}),t.get("basic.tenantNameStrategy").updateValueAndValidity({onlySelf:!0})):t.addControl("basic",this.formBasicGroup(n?.basic)),e===bo.GITHUB?(t.get("basic.emailAttributeKey").disable(),t.get("basic.emailAttributeKey").patchValue(null,{emitEvent:!1})):(this.createNewDialog||this.isEdit||this.isAdd)&&t.get("basic.emailAttributeKey").enable())}formCustomGroup(m){let e=this.fb.group({url:[m?.url?m.url:null,[S.required,S.pattern(this.URL_REGEXP),S.maxLength(255)]],username:[m?.username?m.username:null,S.maxLength(255)],password:[m?.password?m.password:null,S.maxLength(255)],sendToken:[Re(m?.sendToken)?m.sendToken:!1]});return!this.createNewDialog&&!(this.isEdit||this.isAdd)&&e.disable(),e}formBasicGroup(m){let e;m?.tenantNamePattern?e=m.tenantNamePattern:e={value:null,disabled:!0};let n=this.fb.group({emailAttributeKey:[m?.emailAttributeKey?m.emailAttributeKey:"email",[S.required,S.maxLength(31)]],firstNameAttributeKey:[m?.firstNameAttributeKey?m.firstNameAttributeKey:"",S.maxLength(31)],lastNameAttributeKey:[m?.lastNameAttributeKey?m.lastNameAttributeKey:"",S.maxLength(31)],tenantNameStrategy:[m?.tenantNameStrategy?m.tenantNameStrategy:ds.DOMAIN],tenantNamePattern:[e,[S.required,S.maxLength(255)]],customerNamePattern:[m?.customerNamePattern?m.customerNamePattern:null,S.maxLength(255)],defaultDashboardName:[m?.defaultDashboardName?m.defaultDashboardName:null,S.maxLength(255)],alwaysFullScreen:[Re(m?.alwaysFullScreen)?m.alwaysFullScreen:!1]});return!this.createNewDialog&&!(this.isEdit||this.isAdd)&&n.disable(),this.subscriptions.push(n.get("tenantNameStrategy").valueChanges.subscribe(t=>{t==="CUSTOM"&&(this.createNewDialog||this.isEdit||this.isAdd)?n.get("tenantNamePattern").enable():n.get("tenantNamePattern").disable()})),n}setProviderDefaultValue(m,e){if(m==="Custom"){let n=e.get("title").value;e.reset(this.defaultProvider,{emitEvent:!1}),e.patchValue({title:n},{emitEvent:!1}),this.advancedExpanded=!0}else{let n=this.templates.get(m);n.clientId="",n.clientSecret="",e.patchValue(n)}}static{this.\u0275fac=function(e){return new(e||i)(g(P),g(ie),g(wn),g("entity",8),g("entitiesTableConfig",8),g(Xe),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-client"]],inputs:{createNewDialog:"createNewDialog"},features:[G],decls:39,vars:15,consts:[[1,"tb-form-panel","no-gap","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],[1,"flex"],["translate",""],["matInput","","formControlName","title"],[4,"ngIf"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding","column-xs"],["formGroupName","additionalInfo",1,"tb-flex"],["formControlName","providerName"],[3,"value",4,"ngFor","ngForOf"],["floatLabel","always",1,"flex"],["formControlName","platforms","multiple","",3,"placeholder"],["matInput","","formControlName","clientId"],["matInput","","formControlName","clientSecret"],[1,"configuration-panel","mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-center","justify-start"],["matExpansionPanelContent",""],[3,"value"],[1,"tb-form-panel","no-border","no-padding"],[1,"tb-form-row","column-xs","no-border","no-padding","space-between"],["appearance","fill",3,"ngModelChange","ngModel","ngModelOptions"],["class","tb-form-panel no-gap no-border no-padding","style","padding-bottom: 16px",4,"ngIf"],["class","tb-form-panel no-border no-padding no-gap",4,"ngIf"],[1,"tb-form-panel","no-gap","no-border","no-padding",2,"padding-bottom","16px"],["matInput","","formControlName","accessTokenUri"],["matInput","","formControlName","authorizationUri","required",""],["matInput","","formControlName","jwkSetUri"],["matInput","","formControlName","userInfoUri"],["formControlName","clientAuthenticationMethod"],["class","tb-form-row tb-standard-fields no-border no-padding column-xs",4,"ngIf"],["formGroupName","mapperConfig",2,"margin-bottom","22px"],[1,"tb-form-row","no-border","no-padding"],["formControlName","allowUserCreation",1,"mat-slide"],["formControlName","activateUser",1,"mat-slide"],["formControlName","scope","required","",3,"label","requiredText"],["matInput","","formControlName","loginButtonLabel",3,"placeholder"],["matInput","","formControlName","loginButtonIcon"],[1,"tb-form-panel","no-border","no-padding","no-gap"],["matInput","","formControlName","userNameAttributeName"],["formGroupName","mapperConfig",1,"tb-form-panel","no-border","no-padding","no-gap"],["formControlName","type"],["class","tb-form-panel no-border no-padding no-gap","formGroupName","basic",4,"ngIf"],["class","tb-form-panel no-border no-padding no-gap","formGroupName","custom",4,"ngIf"],["formGroupName","basic",1,"tb-form-panel","no-border","no-padding","no-gap"],["class","tb-form-row tb-standard-fields no-border no-padding",4,"ngIf"],["matInput","","formControlName","firstNameAttributeKey"],["matInput","","formControlName","lastNameAttributeKey"],["formControlName","tenantNameStrategy"],["matInput","","formControlName","tenantNamePattern",3,"required"],["matInput","","formControlName","customerNamePattern"],["matInput","","formControlName","defaultDashboardName"],["formControlName","alwaysFullScreen",1,"tb-flex","mat-slide",2,"margin-bottom","16px"],["matInput","","formControlName","emailAttributeKey"],["formGroupName","custom",1,"tb-form-panel","no-border","no-padding","no-gap"],["matInput","","formControlName","url"],["matInput","","formControlName","username","autocomplete","new-username"],["matInput","","formControlName","password","autocomplete","new-password"],["formControlName","sendToken",1,"tb-flex","mat-slide",2,"margin-bottom","16px"]],template:function(e,n){e&1&&(a(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.title"),r(),f(5,"input",4),b(6,Ky,3,3,"mat-error",5)(7,Yy,3,3,"mat-error",5),r()(),a(8,"div",6)(9,"div",7)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"admin.oauth2.provider"),r(),a(13,"mat-select",8),b(14,Xy,2,2,"mat-option",9),r()()(),a(15,"mat-form-field",10)(16,"mat-label",3),p(17,"admin.oauth2.allowed-platforms"),r(),a(18,"mat-select",11),d(19,"translate"),b(20,Zy,3,4,"mat-option",9),r()()(),a(21,"div",6)(22,"mat-form-field",2)(23,"mat-label",3),p(24,"admin.oauth2.client-id"),r(),f(25,"input",12),b(26,e_,3,3,"mat-error",5)(27,t_,3,3,"mat-error",5),r(),a(28,"mat-form-field",2)(29,"mat-label",3),p(30,"admin.oauth2.client-secret"),r(),f(31,"input",13),b(32,i_,3,3,"mat-error",5)(33,n_,3,3,"mat-error",5),r()(),a(34,"mat-expansion-panel",14)(35,"mat-expansion-panel-header")(36,"mat-panel-title",15),p(37," admin.oauth2.advanced-settings "),r()(),b(38,k_,12,13,"ng-template",16),r()()),e&2&&(L("no-padding",n.isAdd),l("formGroup",n.entityForm),o(6),l("ngIf",n.entityForm.get("title").hasError("required")),o(),l("ngIf",n.entityForm.get("title").hasError("maxlength")),o(7),l("ngForOf",n.templateProvider),o(4),T("placeholder",c(19,13,"admin.oauth2.all-platforms")),o(2),l("ngForOf",n.platformTypes),o(6),l("ngIf",n.entityForm.get("clientId").hasError("required")),o(),l("ngIf",n.entityForm.get("clientId").hasError("maxlength")),o(5),l("ngIf",n.entityForm.get("clientSecret").hasError("required")),o(),l("ngIf",n.entityForm.get("clientSecret").hasError("maxlength")),o(),l("expanded",n.advancedExpanded))},dependencies:[we,V,Un,ge,me,Ie,De,St,ct,it,bi,Oi,Bi,Ln,ue,W,z,ce,ut,X,oe,ft,H,qn,Wn,es,k],styles:['@charset "UTF-8";  .mat-expansion-panel .mat-expansion-panel-header{height:48px;padding:0 12px}  .mat-expansion-panel .mat-expansion-panel-header.mat-expanded{height:48px}  .mat-expansion-panel .mat-expansion-panel-body{padding:0 12px}  .mat-expansion-panel.configuration-panel{border:1px solid rgba(0,0,0,.2)}']})}};Kn([io(),Yn("design:type",Object)],oo.prototype,"createNewDialog",void 0);C();var Wl=(()=>{class i extends Jt{constructor(e){super(e),this.store=e}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-client-table-header"]],features:[G],decls:1,vars:0,consts:[["tb-help","oauth2Settings",2,"margin-left","-20px"]],template:function(n,t){n&1&&f(0,"div",0)},dependencies:[Tt],encapsulation:2})}}return i})();var Hl=(()=>{class i{constructor(e,n,t){this.translate=e,this.datePipe=n,this.oauth2Service=t,this.config=new Qe,this.config.tableTitle=this.translate.instant("admin.oauth2.clients"),this.config.selectionEnabled=!1,this.config.entityType=B.OAUTH2_CLIENT,this.config.rowPointer=!0,this.config.entityTranslations=$e.get(B.OAUTH2_CLIENT),this.config.entityResources={helpLinkId:null,helpLinkIdForEntity:s=>cs(s.additionalInfo.providerName)},this.config.entityComponent=oo,this.config.headerComponent=Wl,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("title","admin.oauth2.title","350px"),new te("platforms","admin.oauth2.allowed-platforms","100%",s=>s.platforms&&s.platforms.length?s.platforms.map(u=>this.translate.instant(vo.get(u))).join(", "):this.translate.instant("admin.oauth2.all-platforms"),()=>({}),!1)),this.config.deleteEntityTitle=s=>this.translate.instant("admin.oauth2.delete-client-title",{clientName:s.title}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-client-text"),this.config.entitiesFetchFunction=s=>this.oauth2Service.findTenantOAuth2ClientInfos(s),this.config.loadEntity=s=>this.oauth2Service.getOAuth2ClientById(s.id),this.config.saveEntity=s=>this.oauth2Service.saveOAuth2Client(s),this.config.deleteEntity=s=>this.oauth2Service.deleteOauth2Client(s.id)}resolve(){return this.config}static{this.\u0275fac=function(n){return new(n||i)(N(ie),N(Ge),N(wn))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();var Yg=(()=>{class i{constructor(e){this.http=e}saveDomain(e,n,t){return this.http.post(`/api/domain?oauth2ClientIds=${n.join(",")}`,e,ua(t))}updateOauth2Clients(e,n,t){return this.http.put(`/api/domain/${e}/oauth2Clients`,n,ua(t))}getTenantDomainInfos(e,n){return this.http.get(`/api/domain/infos${e.toQuery()}`,ua(n))}getDomainInfoById(e,n){return this.http.get(`/api/domain/info/${e}`,ua(n))}deleteDomain(e,n){return this.http.delete(`/api/domain/${e}`,ua(n))}static{this.\u0275fac=function(n){return new(n||i)(N(ru))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();C();C();var B_=["clientComponent"];function V_(i,m){i&1&&f(0,"mat-progress-bar",14)}function L_(i,m){i&1&&f(0,"div",15)}var lr=(()=>{class i extends et{constructor(e,n,t,s,u){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.oauth2Service=s,this.errorStateMatcher=u,this.submitted=!1}ngAfterViewInit(){setTimeout(()=>{this.clientComponent.entityForm.markAsDirty()},0)}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),s=!!(e&&e.invalid&&this.submitted);return t||s}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0,this.clientComponent.entityForm.valid&&this.oauth2Service.saveOAuth2Client(this.clientComponent.entityFormValue()).subscribe(e=>{this.dialogRef.close(e)})}helpLinkId(){return cs(this.clientComponent.entityForm.get("additionalInfo.providerName")?.value)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze),g(wn),g(hi,4))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-client-dialog"]],viewQuery:function(n,t){if(n&1&&be(B_,7),n&2){let s;ve(s=ye())&&(t.clientComponent=s.first)}},features:[ke([{provide:hi,useExisting:i}]),G],decls:26,vars:22,consts:[["clientComponent",""],[2,"width","850px","max-height","100vh",3,"ngSubmit"],["color","primary"],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","",2,"padding","0"],["createNewDialog",""],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){if(n&1){let s=O();a(0,"form",1),y("ngSubmit",function(){return x(s),I(t.save())}),a(1,"mat-toolbar",2)(2,"h2"),p(3),d(4,"translate"),r(),f(5,"span",3)(6,"div",4),a(7,"button",5),y("click",function(){return x(s),I(t.cancel())}),a(8,"mat-icon",6),p(9,"close"),r()()(),b(10,V_,1,0,"mat-progress-bar",7),d(11,"async"),b(12,L_,1,0,"div",8),d(13,"async"),a(14,"div",9),f(15,"tb-client",10,0),r(),a(17,"div",11)(18,"button",12),d(19,"async"),y("click",function(){return x(s),I(t.cancel())}),p(20),d(21,"translate"),r(),a(22,"button",13),d(23,"async"),p(24),d(25,"translate"),r()()()}if(n&2){let s=U(16);o(3),R(c(4,8,"admin.oauth2.add-client")),o(3),l("tb-help",t.helpLinkId()),o(4),l("ngIf",c(11,10,t.isLoading$)),o(2),l("ngIf",!c(13,12,t.isLoading$)),o(6),l("disabled",c(19,14,t.isLoading$)),o(2),h(" ",c(21,16,"action.cancel")," "),o(2),l("disabled",c(23,18,t.isLoading$)||(s.entityForm==null?null:s.entityForm.invalid)||!(s.entityForm!=null&&s.entityForm.dirty)),o(2),h(" ",c(25,20,"action.add")," ")}},dependencies:[V,Tt,K,Ce,ee,Oe,He,Ct,Je,fe,z,Yi,oo,le,k],encapsulation:2})}}return i})();function j_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.domain-name-required")," "))}function G_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.domain-name-max-length")," "))}function U_(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"admin.error-verification-url")," "))}var zl=(()=>{class i extends jt{constructor(e,n,t,s,u,_,E,w,q){super(e,E,s,u,_),this.store=e,this.translate=n,this.oauth2Service=t,this.entityValue=s,this.entitiesTableConfigValue=u,this.cd=_,this.fb=E,this.window=w,this.dialog=q,this.loginProcessingUrl="",this.entityType=B,this.entityForm.get("name").setValue(this.window.location.hostname),this.entityForm.markAsDirty(),this.oauth2Service.getLoginProcessingUrl().subscribe(Te=>{this.loginProcessingUrl=Te})}buildForm(e){return this.fb.group({name:[e?.name?e.name:"",[S.required,S.maxLength(255),S.pattern("^(?:\\w+(?::\\w+)?@)?[^\\s/]+(?::\\d+)?$")]],oauth2Enabled:Re(e?.oauth2Enabled)?e.oauth2Enabled:!0,oauth2ClientInfos:e?.oauth2ClientInfos?e.oauth2ClientInfos.map(n=>n.id.id):[],propagateToEdge:Re(e?.propagateToEdge)?e.propagateToEdge:!1})}updateForm(e){this.entityForm.patchValue({name:e.name,oauth2Enabled:e.oauth2Enabled,oauth2ClientInfos:e.oauth2ClientInfos?.map(n=>n.id?n.id.id:n),propagateToEdge:e.propagateToEdge})}redirectURI(){let e=this.entityForm.get("name").value;return e!==""?`${e}${this.loginProcessingUrl}`:""}createClient(e){e&&(e.stopPropagation(),e.preventDefault()),this.dialog.open(lr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(n=>{if(n){let t=this.entityForm.get("oauth2ClientInfos").value?[...this.entityForm.get("oauth2ClientInfos").value]:[];t.push(n.id.id),this.entityForm.get("oauth2ClientInfos").patchValue(t),this.entityForm.get("oauth2ClientInfos").markAsDirty()}})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g(wn),g("entity"),g("entitiesTableConfig"),g(Xe),g(se),g(ya),g(je))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-domain"]],features:[G],decls:31,vars:28,consts:[[1,"tb-form-panel","no-gap","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],[1,"flex"],["translate",""],["matInput","","formControlName","name"],[4,"ngIf"],["matInput","","readonly","",3,"value"],["matSuffix","","miniButton","false","color","primary","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],[1,"tb-form-row","no-border","no-padding",2,"margin-bottom","22px"],["formControlName","oauth2Enabled",1,"mat-slide"],["formControlName","oauth2ClientInfos",3,"entityType","labelText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click","disabled"],[2,"white-space","nowrap"],[1,"tb-form-row","no-border","no-padding"],["formControlName","propagateToEdge",1,"mat-slide"]],template:function(n,t){n&1&&(a(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.domain-name"),r(),f(5,"input",4),b(6,j_,3,3,"mat-error",5)(7,G_,3,3,"mat-error",5)(8,U_,3,3,"mat-error",5),r()(),a(9,"div",1)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"admin.oauth2.redirect-url-template"),r(),f(13,"input",6)(14,"tb-copy-button",7),d(15,"translate"),r()(),a(16,"div",8)(17,"mat-slide-toggle",9),p(18),d(19,"translate"),r()(),a(20,"tb-entity-list",10),d(21,"translate"),d(22,"translate"),a(23,"button",11),y("click",function(u){return t.createClient(u)}),a(24,"span",12),p(25),d(26,"translate"),r()()(),a(27,"div",13)(28,"mat-slide-toggle",14),p(29),d(30,"translate"),r()()()),n&2&&(L("no-padding",t.isAdd),l("formGroup",t.entityForm),o(6),l("ngIf",t.entityForm.get("name").hasError("required")),o(),l("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),l("ngIf",t.entityForm.get("name").hasError("pattern")),o(5),l("value",t.redirectURI()),o(),T("tooltipText",c(15,16,"admin.oauth2.copy-redirect-uri")),l("copyText",t.redirectURI()),o(4),h(" ",c(19,18,"admin.oauth2.enable")," "),o(2),T("labelText",c(21,20,"admin.oauth2.clients")),T("placeholderText",c(22,22,"admin.oauth2.add-client")),l("entityType",t.entityType.OAUTH2_CLIENT),o(3),l("disabled",!t.isEdit),o(2),R(c(26,24,"admin.oauth2.create-new")),o(4),h(" ",c(30,26,"admin.oauth2.edge")," "))},dependencies:[V,So,K,ge,me,Ie,De,ei,it,ue,W,z,X,oe,H,Wa,k],encapsulation:2})}}return i})();C();var $l=(()=>{class i extends Jt{constructor(e){super(e),this.store=e}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-domain-table-header"]],features:[G],decls:1,vars:0,consts:[["tb-help","oauth2Settings",2,"margin-left","-20px"]],template:function(n,t){n&1&&f(0,"div",0)},dependencies:[Tt],encapsulation:2})}}return i})();var _c=(()=>{class i{constructor(e,n,t,s){this.translate=e,this.datePipe=n,this.utilsService=t,this.domainService=s,this.config=new Qe,this.config.tableTitle=this.translate.instant("admin.oauth2.domains"),this.config.selectionEnabled=!1,this.config.entityType=B.DOMAIN,this.config.rowPointer=!0,this.config.entityTranslations=$e.get(B.DOMAIN),this.config.entityResources=_t.get(B.DOMAIN),this.config.entityComponent=zl,this.config.headerComponent=$l,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("name","admin.oauth2.domain-name","170px"),new La("oauth2ClientInfos","admin.oauth2.clients","40%"),new Yd("oauth2Enabled","admin.oauth2.enable",{name:"",nameFunction:u=>this.translate.instant(u.oauth2Enabled?"admin.oauth2.disable":"admin.oauth2.enable"),icon:"mdi:toggle-switch",iconFunction:u=>u.oauth2Enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(u,_)=>this.toggleEnableOAuth(u,_)}),new Yd("propagateToEdge","admin.oauth2.edge",{name:"",nameFunction:u=>this.translate.instant(u.propagateToEdge?"admin.oauth2.edge-disable":"admin.oauth2.edge-enable"),icon:"mdi:toggle-switch",iconFunction:u=>u.propagateToEdge?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(u,_)=>this.togglePropagateToEdge(u,_)})),this.config.deleteEntityTitle=u=>this.translate.instant("admin.oauth2.delete-domain-title",{domainName:u.name}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-domain-text"),this.config.entitiesFetchFunction=u=>this.domainService.getTenantDomainInfos(u),this.config.loadEntity=u=>this.domainService.getDomainInfoById(u.id),this.config.saveEntity=(u,_)=>{let E=u.oauth2ClientInfos||[],w;return u.id&&!ns(u.oauth2ClientInfos?.sort(),_.oauth2ClientInfos?.map(q=>q.id?q.id.id:q).sort())?w=this.domainService.updateOauth2Clients(u.id.id,E):w=ot(null),delete u.oauth2ClientInfos,w.pipe(yt(()=>this.domainService.saveDomain(u,u.id?[]:E)),mt(q=>(q.oauth2ClientInfos=E,q)))},this.config.deleteEntity=u=>this.domainService.deleteDomain(u.id)}resolve(e){return this.config}toggleEnableOAuth(e,n){e&&e.stopPropagation();let t=$i(_e({},n),{oauth2Enabled:!n.oauth2Enabled});this.domainService.saveDomain(t,n.oauth2ClientInfos.map(s=>s.id.id),{ignoreLoading:!0}).subscribe(s=>{n.oauth2Enabled=s.oauth2Enabled,this.config.getTable().detectChanges()})}togglePropagateToEdge(e,n){e&&e.stopPropagation();let t=$i(_e({},n),{propagateToEdge:!n.propagateToEdge});this.domainService.saveDomain(t,n.oauth2ClientInfos.map(s=>s.id.id),{ignoreLoading:!0}).subscribe(s=>{n.propagateToEdge=s.propagateToEdge,this.config.getTable().detectChanges()})}static{this.\u0275fac=function(n){return new(n||i)(N(ie),N(Ge),N(Ca),N(Yg))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var q_=(()=>{class i{constructor(e){this.oauth2Service=e}resolve(){return this.oauth2Service.getLoginProcessingUrl()}static{this.\u0275fac=function(n){return new(n||i)(N(wn))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),Cc=[{path:"oauth2",component:Tn,data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],breadcrumb:{label:"admin.oauth2.oauth2",icon:"mdi:shield-account"}},children:[{path:"",children:[],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/security-settings/oauth2/domains",TENANT_ADMIN:"/security-settings/oauth2/clients"}}},{path:"domains",component:qe,data:{auth:[M.SYS_ADMIN],title:"admin.oauth2.domains",breadcrumb:{menuId:xe.domains}},resolve:{entitiesTableConfig:_c}},{path:"clients",data:{title:"admin.oauth2.clients",breadcrumb:{menuId:xe.clients}},children:[{path:"",component:qe,data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"admin.oauth2.clients"},resolve:{entitiesTableConfig:Hl}},{path:"details",children:[{path:":entityId",component:bt,data:{breadcrumb:{labelFunction:vt,icon:"public"},auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"admin.oauth2.clients",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:Hl}}]}]}]}],Ql=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[q_,Hl,_c],imports:[j.forChild(Cc),j]})}}return i})();(function(){Y(Ql,{imports:[j],exports:[j]})})();C();C();C();C();var W_=["tagField"],Nr=`@charset "UTF-8";.tb-scada-symbol-tooltip-panel{display:flex;flex-direction:row;align-items:center;gap:8px}.tb-scada-symbol-tooltip-panel.column{flex-direction:column}.tb-scada-symbol-tooltip-panel.flex-start{align-items:start}.tb-scada-symbol-tooltip-panel .tb-confirm-text{font-size:14px;line-height:16px;text-align:center;font-weight:400}.tb-scada-symbol-tooltip-panel .mdc-button{line-height:20px;font-size:12px}.tb-scada-symbol-tooltip-panel .mdc-button.mat-mdc-button-base,.tb-scada-symbol-tooltip-panel .mdc-button.mat-mdc-button-base .mat-mdc-button-touch-target{height:20px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field{font-size:12px;line-height:12px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper{padding:0 8px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{padding-top:4px;padding-bottom:4px;min-height:20px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix .mat-mdc-input-element{font-size:12px;line-height:12px;height:12px}
`,H_=["tagSettingsButton"],z_=["removeTagButton"];function $_(i,m){if(i&1){let e=O();a(0,"button",5),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.onUpdateTag())}),a(2,"mat-icon"),p(3,"edit"),r()()}i&2&&T("matTooltip",c(1,1,"scada.tag.update-tag"))}function Q_(i,m){i&1&&(a(0,"button",6,0),d(2,"translate"),a(3,"mat-icon"),p(4,"settings"),r()()),i&2&&T("matTooltip",c(2,1,"scada.tag.tag-settings"))}function J_(i,m){i&1&&(a(0,"button",6,1),d(2,"translate"),a(3,"mat-icon"),p(4,"delete"),r()()),i&2&&T("matTooltip",c(2,1,"scada.tag.remove-tag"))}var K_=["yesButton"];function Y_(i,m){i&1&&(a(0,"div",3),p(1,"scada.state-render-function"),r())}function X_(i,m){if(i&1){let e=O();a(0,"button",4),y("click",function(){x(e);let t=v();return I(t.editStateRenderFunction())}),a(1,"mat-icon"),p(2),r(),a(3,"span"),p(4),d(5,"translate"),r()()}if(i&2){let e=v();o(2),R(e.symbolElement!=null&&e.symbolElement.readonly?"visibility":"edit"),o(2),R(c(5,2,e.symbolElement!=null&&e.symbolElement.readonly?"action.view":"action.edit"))}}function Z_(i,m){if(i&1){let e=O();a(0,"button",4),y("click",function(){x(e);let t=v();return I(t.editStateRenderFunction())}),a(1,"mat-icon"),p(2,"add"),r(),a(3,"span",3),p(4,"action.add"),r()()}}function eC(i,m){i&1&&(a(0,"div",3),p(1,"scada.tag.on-click-action"),r())}function tC(i,m){if(i&1){let e=O();a(0,"button",4),y("click",function(){x(e);let t=v();return I(t.editClickAction())}),a(1,"mat-icon"),p(2),r(),a(3,"span"),p(4),d(5,"translate"),r()()}if(i&2){let e=v();o(2),R(e.symbolElement!=null&&e.symbolElement.readonly?"visibility":"edit"),o(2),R(c(5,2,e.symbolElement!=null&&e.symbolElement.readonly?"action.view":"action.edit"))}}function iC(i,m){if(i&1){let e=O();a(0,"button",4),y("click",function(){x(e);let t=v();return I(t.editClickAction())}),a(1,"mat-icon"),p(2,"add"),r(),a(3,"span",3),p(4,"action.add"),r()()}}var kr=(()=>{class i{constructor(e){this.element=e,this.viewInited=new rt}ngAfterViewInit(){this.viewInited.emit()}static{this.\u0275fac=function(n){return new(n||i)(g(An))}}static{this.\u0275dir=Kr({type:i,inputs:{symbolElement:"symbolElement"},outputs:{viewInited:"viewInited"}})}}return i})(),Zg=(()=>{class i extends kr{constructor(e){super(e),this.element=e,this.addTag=new rt}onAddTag(){this.addTag.emit()}static{this.\u0275fac=function(n){return new(n||i)(g(An))}}static{this.\u0275cmp=D({type:i,selectors:[["ng-component"]],outputs:{addTag:"addTag"},features:[G],decls:9,vars:4,consts:[[1,"tb-scada-symbol-tooltip-panel"],["mat-stroked-button","","color","primary",3,"click"],["translate",""]],template:function(n,t){n&1&&(a(0,"div",0)(1,"span"),p(2),d(3,"translate"),r(),a(4,"button",1),y("click",function(){return t.onAddTag()}),a(5,"mat-icon"),p(6,"add"),r(),a(7,"span",2),p(8,"scada.tag.add-tag"),r()()()),n&2&&(o(2),yr("",t.symbolElement==null||t.symbolElement.element==null?null:t.symbolElement.element.type,"",t.symbolElement!=null&&t.symbolElement.invisible?" ("+c(3,2,"scada.hidden")+")":"",""))},dependencies:[K,ee,H,k],styles:[Nr],encapsulation:2})}}return i})(),eh=(()=>{class i extends kr{constructor(e){super(e),this.element=e,this.apply=new rt,this.cancel=new rt,this.closed=!1}ngAfterViewInit(){super.ngAfterViewInit(),setTimeout(()=>{this.tagField.nativeElement.focus()})}ngOnDestroy(){this.blurTimeout&&(clearTimeout(this.blurTimeout),this.blurTimeout=null)}tagEnter(e){e.keyCode===13&&(e.preventDefault(),this.tag&&(this.closed=!0,this.apply.emit(this.tag)))}onApply(){this.closed=!0,this.tag?this.apply.emit(this.tag):this.cancel.emit()}onCancel(){this.closed=!0,this.cancel.emit()}onBlur(){this.blurTimeout=setTimeout(()=>{this.closed||(this.closed=!0,this.cancel.emit())},300)}static{this.\u0275fac=function(n){return new(n||i)(g(An))}}static{this.\u0275cmp=D({type:i,selectors:[["ng-component"]],viewQuery:function(n,t){if(n&1&&be(W_,5),n&2){let s;ve(s=ye())&&(t.tagField=s.first)}},inputs:{isAdd:"isAdd",tag:"tag"},outputs:{apply:"apply",cancel:"cancel"},features:[G],decls:16,vars:14,consts:[["tagField",""],[1,"tb-scada-symbol-tooltip-panel"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field"],["matInput","",3,"ngModelChange","keydown","blur","ngModel","placeholder"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip","disabled"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip"]],template:function(n,t){if(n&1){let s=O();a(0,"div",1)(1,"span"),p(2),d(3,"translate"),r(),a(4,"mat-form-field",2)(5,"input",3,0),d(7,"translate"),pt("ngModelChange",function(_){return x(s),lt(t.tag,_)||(t.tag=_),I(_)}),y("keydown",function(_){return x(s),I(t.tagEnter(_))})("blur",function(){return x(s),I(t.onBlur())}),r()(),a(8,"button",4),d(9,"translate"),y("click",function(){return x(s),I(t.onApply())}),a(10,"mat-icon"),p(11,"done"),r()(),a(12,"button",5),d(13,"translate"),y("click",function(){return x(s),I(t.onCancel())}),a(14,"mat-icon"),p(15,"close"),r()()()}n&2&&(o(2),h("",c(3,6,t.isAdd?"scada.tag.enter-tag":"scada.tag.update-tag"),":"),o(3),T("placeholder",c(7,8,"widget-config.set")),st("ngModel",t.tag),o(3),T("matTooltip",c(9,10,"action.apply")),l("disabled",!t.tag),o(4),T("matTooltip",c(13,12,"action.cancel")))},dependencies:[Ce,ee,ge,me,Dt,ue,W,ut,k],styles:[Nr],encapsulation:2})}}return i})(),th=(()=>{class i extends kr{constructor(e,n){super(e),this.element=e,this.container=n,this.updateTag=new rt,this.removeTag=new rt,this.displayTagSettings=!0}ngOnInit(){this.symbolElement?.readonly&&(this.displayTagSettings=this.symbolElement?.hasStateRenderFunction()||this.symbolElement?.hasClickAction())}ngAfterViewInit(){super.ngAfterViewInit(),setTimeout(()=>{if(this.displayTagSettings){let e=$(this.tagSettingsButton.nativeElement);e.tooltipster({parent:this.symbolElement.tooltipContainer,zIndex:200,arrow:!0,theme:["scada-symbol","tb-active"],interactive:!0,trigger:"click",trackOrigin:!0,trackerInterval:100,side:"top",content:""});let n=e.tooltipster("instance"),t=Ar(this.symbolElement,this.container,nh,n);n.on("ready",()=>{t.instance.updateFunctionsState()})}if(!this.symbolElement.readonly){let e=$(this.removeTagButton.nativeElement);e.tooltipster({parent:this.symbolElement.tooltipContainer,zIndex:200,arrow:!0,theme:["scada-symbol","tb-active"],interactive:!0,trigger:"click",trackOrigin:!0,trackerInterval:100,side:"top",content:""});let n=e.tooltipster("instance"),t=Ar(this.symbolElement,this.container,ih,n);t.instance.removeTag.subscribe(()=>{n.destroy(),this.removeTag.emit()}),t.instance.cancel.subscribe(()=>{n.close()}),n.on("ready",()=>{t.instance.yesButton.focus()})}})}onUpdateTag(){this.updateTag.emit()}static{this.\u0275fac=function(n){return new(n||i)(g(An),g(ki))}}static{this.\u0275cmp=D({type:i,selectors:[["ng-component"]],viewQuery:function(n,t){if(n&1&&(be(H_,5,An),be(z_,5,An)),n&2){let s;ve(s=ye())&&(t.tagSettingsButton=s.first),ve(s=ye())&&(t.removeTagButton=s.first)}},outputs:{updateTag:"updateTag",removeTag:"removeTag"},features:[G],decls:10,vars:8,consts:[["tagSettingsButton",""],["removeTagButton",""],[1,"tb-scada-symbol-tooltip-panel"],["type","button","mat-icon-button","","class","tb-mat-20","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["type","button","mat-icon-button","","class","tb-mat-20","matTooltipPosition","above",3,"matTooltip",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"matTooltip"]],template:function(n,t){n&1&&(a(0,"div",2)(1,"span"),p(2),d(3,"translate"),r(),a(4,"span")(5,"b"),p(6),r()(),b(7,$_,4,3,"button",3)(8,Q_,5,3,"button",4)(9,J_,5,3,"button",4),r()),n&2&&(o(2),yr("",t.symbolElement==null||t.symbolElement.element==null?null:t.symbolElement.element.type,"",t.symbolElement!=null&&t.symbolElement.invisible?" ("+c(3,6,"scada.hidden")+")":"",":"),o(4),R(t.symbolElement==null?null:t.symbolElement.tag),o(),l("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)),o(),l("ngIf",t.displayTagSettings),o(),l("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)))},dependencies:[V,Ce,ee,Dt,k],styles:[Nr],encapsulation:2})}}return i})(),ih=(()=>{class i extends kr{constructor(e,n){super(e),this.element=e,this.translate=n,this.cancel=new rt,this.removeTag=new rt}ngOnInit(){this.deleteText=this.translate.instant("scada.tag.delete-tag-text",{tag:this.symbolElement?.tag,elementType:this.symbolElement?.element?.type})}onCancel(){this.cancel.emit()}onRemoveTag(){this.removeTag.emit()}static{this.\u0275fac=function(n){return new(n||i)(g(An),g(ie))}}static{this.\u0275cmp=D({type:i,selectors:[["ng-component"]],viewQuery:function(n,t){if(n&1&&be(K_,5),n&2){let s;ve(s=ye())&&(t.yesButton=s.first)}},outputs:{cancel:"cancel",removeTag:"removeTag"},features:[G],decls:14,vars:1,consts:[["yesButton",""],[1,"tooltipster-content","tb-scada-symbol-tooltip-panel","column"],[1,"tb-confirm-text",3,"innerHTML"],[1,"tb-scada-symbol-tooltip-panel"],["mat-stroked-button","","color","primary",3,"click"],["translate",""]],template:function(n,t){if(n&1){let s=O();a(0,"div",1),f(1,"div",2),a(2,"div",3)(3,"button",4),y("click",function(){return x(s),I(t.onCancel())}),a(4,"mat-icon"),p(5,"close"),r(),a(6,"span",5),p(7,"action.no"),r()(),a(8,"button",4,0),y("click",function(){return x(s),I(t.onRemoveTag())}),a(10,"mat-icon"),p(11,"done"),r(),a(12,"span",5),p(13,"action.yes"),r()()()()}n&2&&(o(),l("innerHTML",t.deleteText,sn))},dependencies:[K,ee,H],styles:[Nr],encapsulation:2})}}return i})(),nh=(()=>{class i extends kr{constructor(e){super(e),this.element=e,this.hasStateRenderFunction=!1,this.hasClickAction=!1}ngOnInit(){this.updateFunctionsState()}updateFunctionsState(){this.hasStateRenderFunction=this.symbolElement.hasStateRenderFunction(),this.hasClickAction=this.symbolElement.hasClickAction()}editStateRenderFunction(){this.symbolElement.editStateRenderFunction()}editClickAction(){this.symbolElement.editClickAction()}static{this.\u0275fac=function(n){return new(n||i)(g(An))}}static{this.\u0275cmp=D({type:i,selectors:[["ng-component"]],features:[G],decls:7,vars:6,consts:[[1,"tooltipster-content","tb-scada-symbol-tooltip-panel","column","flex-start"],["translate","",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["translate",""],["mat-stroked-button","","color","primary",3,"click"]],template:function(n,t){n&1&&(a(0,"div",0),b(1,Y_,2,0,"div",1)(2,X_,6,4,"button",2)(3,Z_,5,0,"button",2)(4,eC,2,0,"div",1)(5,tC,6,4,"button",2)(6,iC,5,0,"button",2),r()),n&2&&(o(),l("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)||t.hasStateRenderFunction),o(),l("ngIf",t.hasStateRenderFunction),o(),l("ngIf",!t.hasStateRenderFunction&&!(t.symbolElement!=null&&t.symbolElement.readonly)),o(),l("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)||t.hasClickAction),o(),l("ngIf",t.hasClickAction),o(),l("ngIf",!t.hasClickAction&&!(t.symbolElement!=null&&t.symbolElement.readonly)))},dependencies:[V,K,ee,H,k],styles:[Nr],encapsulation:2})}}return i})(),Jl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re]})}}return i})();(function(){Y(Jl,{declarations:[Zg,eh,th,ih,nh],imports:[ae,re]})})();var Sc=(i,m)=>{i.stopEdit(),i.tooltip.off("close");let e=Ar(i,m,Zg);e.instance.addTag.subscribe(()=>{e.destroy(),oh(i,m,!0)})},Tc=(i,m)=>{i.stopEdit(),i.unhighlight();let e=Ar(i,m,th);e.instance.updateTag.subscribe(()=>{e.destroy(),oh(i,m,!1)}),e.instance.removeTag.subscribe(()=>{e.destroy(),i.clearTag()}),i.tooltip.open()},oh=(i,m,e)=>{i.startEdit(()=>{e?(i.unhighlight(),i.tooltip.close()):(n.destroy(),Tc(i,m))});let n=Ar(i,m,eh);n.instance.isAdd=e,e||(n.instance.tag=i.tag),n.instance.apply.subscribe(t=>{n.destroy(),e&&i.tooltip.off("close"),i.setTag(t)}),n.instance.cancel.subscribe(()=>{i.stopEdit(!0)}),e&&(i.tooltip.option("delay",[0,1e7]),i.tooltip.on("close",()=>{n.destroy(),i.tooltip.option("delay",[0,300]),Sc(i,m)}))},Ar=(i,m,e,n)=>{n||(n=i.tooltip);let t=m.createComponent(e);t.instance.symbolElement=i,t.instance.viewInited.subscribe(()=>{n.status().open&&n.reposition()}),n.on("destroyed",()=>{t.destroy()});let s=t.instance.element.nativeElement,u=s.firstChild;return s.removeChild(u),s.style.display="none",n.content(u),t};var Kl=.75,xc=4,Yl=class{constructor(m,e,n,t,s,u){this.rootElement=m,this.tooltipsContainer=e,this.viewContainerRef=n,this.zone=t,this.callbacks=s,this.readonly=u,this.elements=[],this.performSetup=!1,this.showHidden=!1,this.scale=1,this.tags=[],this.zoomFactor=.34,this.shapeResize$=new ResizeObserver(()=>{this.resize()})}setReadOnly(m){this.readonly=m}setContent(m){this.shapeResize$.unobserve(this.rootElement),this.svgShape&&(this.destroyElements(),this.svgShape.remove()),this.scale=1,this.showHidden=!1;let e=Rf(m);this.svgRootNodePart=e.svgRootNode,this.svgShape=ac().svg(e.innerSvg),this.svgShape.node.style.overflow="visible",this.svgShape.node.style["user-select"]="none";let n=ac(`${e.svgRootNode}
${e.innerSvg}
</svg>`);n.type==="svg"?(this.box=n.viewbox(),n.fill()&&this.svgShape.fill(n.fill())):this.box=this.svgShape.bbox(),n.remove(),this.svgShape.size(this.box.width,this.box.height),this.svgShape.viewbox(`0 0 ${this.box.width} ${this.box.height}`),this.svgShape.style().attr("tb:inner",!0).rule(".tb-element",{cursor:"pointer",transition:"0.2s filter ease-in-out"}),this.svgShape.addTo(this.rootElement),this.updateHoverFilterStyle(),this.performSetup=!0,this.shapeResize$.observe(this.rootElement)}getContent(){if(this.svgShape){this.elements.forEach(e=>e.restoreOrigVisibility());let m=this.svgShape.svg(e=>{if(e.node.hasAttribute("tb:inner"))return!1;e.node.classList.remove("tb-element","tooltipstered"),e.node.classList.length||e.node.removeAttribute("class"),e.attr("svgjs:data",null)},!1);return this.showHiddenElements(this.showHidden),`${this.svgRootNodePart}
${m}
</svg>`}else return null}cancelEdit(){this.elements.filter(m=>m.isEditing()).forEach(m=>m.stopEdit(!0))}zoomIn(){let m=Math.min(Math.pow(1+this.zoomFactor,1.2)*this.svgShape.zoom(),xc);this.zoomAnimate(m)}zoomOut(){let m=Math.max(Math.pow(1+this.zoomFactor,-1.2)*this.svgShape.zoom(),Kl);this.zoomAnimate(m)}showHiddenElements(m){this.showHidden=m,this.elements.forEach(e=>m?e.showInvisible():e.hideInvisible())}zoomAnimate(m,e=200){m!==this.svgShape.zoom()&&(this.hideTooltips(),this.svgShape.animate(e).ease("<>").zoom(m).during(()=>{let t=this.restrictToMargins(this.svgShape.viewbox());this.svgShape.viewbox(t)}).after(()=>{this.postZoom(this.callbacks.onZoom)}))}zoomInDisabled(){return Number(this.svgShape.zoom().toFixed(5))>=xc}zoomOutDisabled(){return Number(this.svgShape.zoom().toFixed(5))<=Kl}doSetup(){this.setupZoomPan(),window.SVG=Mf,Gt([vr(import("./chunk-A7EJUMMW.js")),vr(import("./chunk-CEEY4KUF.js"))]).subscribe(()=>{this.zone.run(()=>{this.setupElements()})})}setupZoomPan(){this.svgShape.panZoom({zoomMin:Kl,zoomMax:xc,zoomFactor:this.zoomFactor}),this.svgShape.on("zoom",m=>{let{detail:{level:e,focus:n}}=m;this.svgShape.zoom(e,n),this.postZoom(this.callbacks.onZoom,m)}),this.svgShape.on("panning",m=>{let e=m.detail.box;this.svgShape.viewbox(this.restrictToMargins(e)),m.preventDefault()}),this.svgShape.on("panStart",m=>{this.hideTooltips(),this.svgShape.node.style.cursor="grab"}),this.svgShape.on("panEnd",m=>{this.restoreTooltips(),this.svgShape.node.style.cursor="default"}),this.svgShape.zoom(Kl)}postZoom(m,e){let n=this.restrictToMargins(this.svgShape.viewbox());this.svgShape.viewbox(n),setTimeout(()=>{this.updateTooltipPositions()}),e?.preventDefault(),m&&m()}restrictToMargins(m){let e=Math.max(m.width-this.box.width,0),n=Math.max(m.height-this.box.height,0);return m.x<-e?m.x=-e:m.x+m.width>this.box.width+e&&(m.x=this.box.width+e-m.width),m.y<-n?m.y=-n:m.y+m.height>this.box.height+n&&(m.y=this.box.height+n-m.height),m}setupElements(){this.svgShape.children().forEach(n=>{this.addElement(n)});let m=[];for(let n of this.elements)for(let t of this.elements)if(n!==t&&n.overlappingCenters(t)){let s;for(let u of m)if(u.includes(t)||u.includes(n)){s=u;break}s?s.includes(n)?s.includes(t)||s.push(t):s.push(n):(s=[n,t],m.push(s))}for(let n of m){let t=n.map(w=>w.box.cy),s=t.reduce((w,q)=>w+q,0)/t.length,u=n.find(w=>w.isText()),_=u&&n.length%2===0?n.length+1:n.length;u&&(u.setInnerTooltipOffset(0,s),n.splice(n.indexOf(u),1));let E=-(pr*_)/2+pr/2;for(let w of n)u&&E===0&&(E+=pr),w.setInnerTooltipOffset(E,s),E+=pr}for(let n of this.elements)n.init();this.updateTags();let e=this.elements.some(n=>n.invisible);this.callbacks.hasHiddenElements&&this.callbacks.hasHiddenElements(e)}addElement(m,e=!1){if(nC(m)){let n=e||!m.visible(),t=new Ic(this,m,n);this.elements.push(t),m.children().forEach(s=>{s.type==="tspan"&&m.type==="text"||this.addElement(s,n)},!0)}}destroy(){this.shapeResize$&&this.shapeResize$.disconnect(),this.destroyElements()}destroyElements(){this.elements.forEach(m=>{m.destroy()}),this.elements.length=0}resize(){if(this.svgShape){let m=this.rootElement.getBoundingClientRect().width,e=this.rootElement.getBoundingClientRect().height;if(m&&e){let n=this.box.width/this.box.height,t=m/e,s;n>t?s=m/this.box.width:s=e/this.box.height,this.scale!==s&&(this.scale=s,this.svgShape.node.style.transform=`scale(${this.scale})`,this.updateHoverFilterStyle(),this.updateTooltipPositions()),this.performSetup&&(this.performSetup=!1,this.doSetup())}}}updateHoverFilterStyle(){this.hoverFilterStyle&&this.hoverFilterStyle.remove();let m=(2.8/this.scale).toFixed(2),e=(1.2/this.scale).toFixed(2);this.hoverFilterStyle=this.svgShape.style().attr("tb:inner",!0).rule(".hovered",{filter:`drop-shadow(0px 0px ${m}px white) drop-shadow(0px 0px ${m}px white)
             drop-shadow(0px 0px ${m}px white) drop-shadow(0px 0px ${m}px white)
             drop-shadow(0px 0px ${e}px black)`})}updateTooltipPositions(){for(let m of this.elements)m.updateTooltipPosition()}hideTooltips(){for(let m of this.elements)m.hideTooltip()}restoreTooltips(){for(let m of this.elements)m.restoreTooltip()}updateTags(){this.tags=this.elements.filter(m=>m.hasTag()).map(m=>m.tag).filter((m,e,n)=>n.indexOf(m)===e).sort(),this.callbacks.tagsUpdated(this.tags)}getTags(){return this.tags}tagHasStateRenderFunction(m){return this.callbacks.tagHasStateRenderFunction(m)}tagHasClickAction(m){return this.callbacks.tagHasClickAction(m)}editTagStateRenderFunction(m){this.callbacks.editTagStateRenderFunction(m)}editTagClickAction(m){this.callbacks.editTagClickAction(m)}setDirty(m){this.callbacks.onSymbolEditObjectDirty(m)}},nC=i=>{try{if(i.bbox){let m=i.bbox();return!m.width&&!m.height&&!i.visible()&&(i.show(),m=i.bbox(),i.hide()),!!m.width||!!m.height}else return!1}catch{return!1}},pr=44,oC=100,Rr=2,Qo=2,Ic=class{get readonly(){return this.editObject.readonly}constructor(m,e,n=!1){this.editObject=m,this.element=e,this.invisible=n,this.editing=!1,this.innerTooltipOffset=0,this.highlighted=!1,this.origVisibility=!0,this.tag=e.attr("tb:tag"),this.origVisibility=e.visible(),this.invisible&&e.show(),this.box=e.rbox(this.editObject.svgShape)}init(){this.isGroup()?(this.highlightRect=this.editObject.svgShape.rect(this.box.width+Qo*2,this.box.height+Qo*2).x(this.box.x-Qo).y(this.box.y-Qo).attr({"tb:inner":!0,fill:"none",rx:this.unscaled(6),stroke:"rgba(0, 0, 0, 0.38)","stroke-dasharray":"1","stroke-width":this.unscaled(Rr),opacity:0}),this.highlightRectTimeline=new wf,this.highlightRect.timeline(this.highlightRectTimeline),this.highlightRect.hide()):this.element.addClass("tb-element"),this.element.on("mouseenter",m=>{this.highlight()}),this.element.on("mouseleave",m=>{this.unhighlight()}),this.invisible||this.setupTooltips(),this.hideInvisible()}setupTooltips(){this.hasTag()?this.createTagTooltip():this.readonly||this.createAddTagTooltip()}showInvisible(){this.invisible&&(this.element.show(),this.tooltip||this.setupTooltips())}hideInvisible(){this.invisible&&(this.element.hide(),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null))}restoreOrigVisibility(){this.origVisibility?this.element.show():this.element.hide()}overlappingCenters(m){return this.isGroup()||m.isGroup()?!1:Math.abs(this.box.cx-m.box.cx)*this.editObject.scale<oC&&Math.abs(this.box.cy-m.box.cy)*this.editObject.scale<pr}highlight(){this.highlighted||(this.highlighted=!0,this.isGroup()?(this.highlightRectTimeline.finish(),this.highlightRect.attr({rx:this.unscaled(6),"stroke-width":this.unscaled(Rr)}),this.highlightRect.show(),this.highlightRect.animate(300).attr({opacity:1})):this.element.addClass("hovered"),this.hasTag()&&(this.tooltip.reposition(),$(this.tooltip.elementTooltip()).addClass("tb-active")))}unhighlight(){this.highlighted&&(this.highlighted=!1,this.isGroup()?(this.highlightRectTimeline.finish(),this.highlightRect.animate(300).attr({opacity:0}).after(()=>{this.highlightRect.hide()})):this.element.removeClass("hovered"),this.hasTag()&&!this.editing&&$(this.tooltip.elementTooltip()).removeClass("tb-active"))}clearTag(){this.tooltip.destroy(),this.tag=null,this.element.attr("tb:tag",null),this.unhighlight(),this.createAddTagTooltip(),this.editObject.setDirty(!0),this.editObject.updateTags()}setTag(m){this.tooltip.destroy(),this.tag=m,this.element.attr("tb:tag",m),this.createTagTooltip(),this.editObject.setDirty(!0),this.editObject.updateTags()}hasStateRenderFunction(){return this.hasTag()?this.editObject.tagHasStateRenderFunction(this.tag):!1}hasClickAction(){return this.hasTag()?this.editObject.tagHasClickAction(this.tag):!1}editStateRenderFunction(){this.hasTag()&&this.editObject.editTagStateRenderFunction(this.tag)}editClickAction(){this.hasTag()&&this.editObject.editTagClickAction(this.tag)}startEdit(m){this.editing||(this.editObject.cancelEdit(),this.editing=!0,this.onCancelEdit=m)}stopEdit(m=!1){this.editing&&(this.editing=!1,m&&this.onCancelEdit&&this.onCancelEdit(),this.onCancelEdit=null,this.hasTag()&&!this.highlighted&&$(this.tooltip.elementTooltip()).removeClass("tb-active"))}isEditing(){return this.editing}updateTooltipPosition(){if(this.tooltip&&!this.tooltip.status().destroyed){this.tooltip.reposition();let m=this.tooltip.elementTooltip();m&&(m.style.visibility=null)}}hideTooltip(){if(this.tooltip&&!this.tooltip.status().destroyed){let m=this.tooltip.elementTooltip();m&&(m.style.visibility="hidden")}}restoreTooltip(){this.updateTooltipPosition()}setInnerTooltipOffset(m,e){this.innerTooltipOffset=m+(e-this.box.cy)*this.editObject.scale}destroy(){this.tooltip&&this.tooltip.destroy()}get tooltipContainer(){return $(this.editObject.tooltipsContainer)}unscaled(m){return m/(this.editObject.scale*this.editObject.svgShape.zoom())}scaled(m){return m*(this.editObject.scale*this.editObject.svgShape.zoom())}createTagTooltip(){let m=$(this.element.node);m.tooltipster({parent:this.tooltipContainer,zIndex:100,arrow:this.isGroup(),distance:this.isGroup()?this.scaled(Qo)+Rr:6,theme:["scada-symbol"],delay:0,animationDuration:0,interactive:!0,trigger:"custom",side:"top",trackOrigin:!1,content:"",functionPosition:(e,n,t)=>this.innerTagTooltipPosition(e,n,t),functionReady:(e,n)=>{let t=$(n.tooltip);t.on("mouseenter",()=>{this.highlight()}),t.on("mouseleave",()=>{this.unhighlight()})}}),this.tooltip=m.tooltipster("instance"),this.setupTagPanel()}setupTagPanel(){Tc(this,this.editObject.viewContainerRef)}createAddTagTooltip(){let m=$(this.element.node);m.tooltipster({parent:this.tooltipContainer,zIndex:100,arrow:!0,theme:["scada-symbol","tb-active"],delay:[0,300],interactive:!0,trigger:"hover",side:["top","left","bottom","right"],trackOrigin:!1,content:"",functionBefore:(e,n)=>{let t=n.event;this.tooltipMouseX=t.clientX,this.tooltipMouseY=t.clientY;let s;this.isGroup()?s="top":s=this.calculateTooltipSide(n.origin.getBoundingClientRect(),t.clientX,t.clientY),e.option("side",s)},functionPosition:(e,n,t)=>this.innerAddTagTooltipPosition(e,n,t),functionReady:(e,n)=>{let t=$(n.tooltip);t.on("mouseenter",()=>{this.highlight()}),t.on("mouseleave",()=>{this.unhighlight()})}}),this.tooltip=m.tooltipster("instance"),this.setupAddTagPanel()}setupAddTagPanel(){Sc(this,this.editObject.viewContainerRef)}innerTagTooltipPosition(m,e,n){let t=e.origin.getBoundingClientRect();return this.isGroup()?(n.distance=this.scaled(Qo)+Rr,n.coord.top=t.top-n.size.height-(this.scaled(Qo)+Rr)):(n.coord.top=t.top+(t.height-n.size.height)/2+this.innerTooltipOffset*this.editObject.svgShape.zoom(),n.coord.left=t.left+(t.width-n.size.width)/2),n}innerAddTagTooltipPosition(m,e,n){let s=this.tooltipContainer[0].getBoundingClientRect();switch(n.side){case"right":n.coord.top=this.tooltipMouseY-n.size.height/2,n.coord.left=this.tooltipMouseX+10,n.target=this.tooltipMouseY;break;case"top":n.coord.top=this.tooltipMouseY-n.size.height-10,n.coord.left=this.tooltipMouseX-n.size.width/2,n.target=this.tooltipMouseX,this.isGroup()&&(n.coord.top-=pr);break;case"left":n.coord.top=this.tooltipMouseY-n.size.height/2,n.coord.left=this.tooltipMouseX-n.size.width-10,n.target=this.tooltipMouseY;break;case"bottom":n.coord.top=this.tooltipMouseY+10,n.coord.left=this.tooltipMouseX-n.size.width/2,n.target=this.tooltipMouseX;break}let u=s.right-(n.coord.left+n.size.width);u<0&&(n.coord.left+=u);let _=s.left-n.coord.left;return _>0&&(n.coord.left+=_),n}calculateTooltipSide(m,e,n){let t,s=m.left+m.width/2,u=m.top+m.height/2;return m.width>m.height?Math.abs(s-e)>m.width/4?e<s?t="left":t="right":n<u?t="top":t="bottom":Math.abs(u-n)>m.height/4?n<u?t="top":t="bottom":e<s?t="left":t="right",t}hasTag(){return!!this.tag}isGroup(){return this.element.type==="g"}isText(){return this.element.type==="text"}},Fo=/[a-zA-Z$_\u00a1-\uffff][a-zA-Z\d$_\u00a1-\uffff]*/,ao={token:"punctuation.operator",regex:/[.](?![.])/},ro={regex:"",token:"empty",next:"no_regex"},Ec={token:"tb.scada-symbol-ctx",regex:/\bctx\b/,next:"scadaSymbolCtxApi"},aC={token:"tb.scada-symbol-svg",regex:/\bsvg\b/,next:"scadaSymbolSVGApi"},ah={token:"tb.scada-symbol-element",regex:/\belement\b/,next:"scadaSymbolElementApi"},rC={token:"tb.scada-symbol-event",regex:/\bevent\b/,next:"scadaSymbolEventApi"},wc={scadaSymbolCtxApi:[ao,{token:"tb.scada-symbol-ctx-properties",regex:/properties/,next:"scadaSymbolCtxPropertiesApi"},{token:"tb.scada-symbol-ctx-tags",regex:/tags/,next:"scadaSymbolCtxTagsApi"},{token:"tb.scada-symbol-ctx-values",regex:/values/,next:"scadaSymbolCtxValuesApi"},{token:"tb.scada-symbol-ctx-api",regex:/api/,next:"scadaSymbolCtxApiMethodApi"},{token:"tb.scada-symbol-ctx-svg",regex:/svg/,next:"scadaSymbolCtxSVGMethodApi"},ro],scadaSymbolCtxPropertiesApi:[ao,{token:"tb.scada-symbol-ctx-property",regex:Fo,next:"no_regex"},ro],scadaSymbolCtxTagsApi:[ao,{token:"tb.scada-symbol-ctx-tag",regex:Fo,next:"no_regex"},ro],scadaSymbolCtxValuesApi:[ao,{token:"tb.scada-symbol-ctx-value",regex:Fo,next:"no_regex"},ro],scadaSymbolCtxApiMethodApi:[ao,{token:"tb.scada-symbol-ctx-api-method",regex:Fo,next:"no_regex"},ro],scadaSymbolCtxSVGMethodApi:[ao,{token:"tb.scada-symbol-ctx-svg-method",regex:Fo,next:"no_regex"},ro]},sC={scadaSymbolSVGApi:[ao,{token:"tb.scada-symbol-svg-properties",regex:Fo,next:"no_regex"},ro]},rh={scadaSymbolElementApi:[ao,{token:"tb.scada-symbol-element-properties",regex:Fo,next:"no_regex"},ro]},lC={scadaSymbolEventApi:[ao,{token:"tb.scada-symbol-event-properties",regex:Fo,next:"no_regex"},ro]},sh=_e(_e({start:[Ec,aC]},wc),sC),lh=_e(_e({no_regex:[Ec,ah]},wc),rh),ph=_e(_e(_e({start:[Ec,ah,rC]},wc),rh),lC),mh=i=>({ctx:i,svg:{meta:"argument",type:'<a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>',description:'A root svg node. Instance of <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>.'}}),Mc=i=>({ctx:i,element:{meta:"argument",type:"Element",description:'SVG element.<br>See <a href="https://svgjs.dev/docs/3.2/manipulating/" target="_blank">Manipulating</a> section to manipulate the element.<br>See <a href="https://svgjs.dev/docs/3.2/animating/" target="_blank">Animating</a> section to animate the element.'}}),dh=i=>{let m=Mc(i);return m.event={meta:"argument",type:"Event",description:"DOM event."},m},ch=(i,m,e)=>{let t=`<a href="${lu.linksMap.scadaSymbolDevAnimation}" target="_blank">ScadaSymbolAnimation</a>`,s={meta:"object",type:"object",description:"An object holding all defined SCADA symbol properties.",children:{}};for(let w of i.properties)s.children[w.id]=pC(w,e);let u={meta:"object",type:"object",description:'An object holding all values obtained using behaviors of type <b>"Value"</b>',children:{}},_=i.behavior.filter(w=>w.type===pn.value);for(let w of _)u.children[w.id]=mC(w,e);let E={meta:"object",type:"object",description:"An object holding all tagged SVG elements grouped by tags (object keys).",children:{}};if(m?.length)for(let w of m)E.children[w]={meta:"property",description:"An array of SVG elements.",type:"Array<Element>"};return{meta:"argument",type:"ScadaSymbolContext",description:"Context of the SCADA symbol.",children:{api:{meta:"object",type:"ScadaSymbolApi",description:"SCADA symbol API",children:{cssAnimate:{meta:"function",description:"Finishes any previous CSS animation and starts new CSS animation for SVG element.",args:[{name:"element",description:"SVG element",type:"Element"},{name:"duration",description:"Animation duration in milliseconds",type:"number"}],return:{description:`Instance of ${t} class with API to setup and control the animation.`,type:t}},cssAnimation:{meta:"function",description:"Get the current CSS animation applied for the SVG element.",args:[{name:"element",description:"SVG element",type:"Element"}],return:{description:`Instance of ${t} class with API to setup and control the animation.`,type:t}},resetCssAnimation:{meta:"function",description:"Stops CSS animation if any and restore SVG element initial state, removes CSS animation instance.",args:[{name:"element",description:"SVG element",type:"Element"}]},finishCssAnimation:{meta:"function",description:"Finishes CSS animation if any, SVG element state updated according to the end animation values, removes CSS animation instance.",args:[{name:"element",description:"SVG element",type:"Element"}]},generateElementId:{meta:"function",description:"Generates new unique element id.",args:[],return:{type:"string",description:"Newly generated element id."}},formatValue:{meta:"function",description:"Formats numeric value according to specified decimals and units",args:[{name:"value",description:"Numeric value to be formatted",type:"any"},{name:"dec",description:"Number of decimal digits",type:"number",optional:!0},{name:"units",description:"Units to append to the formatted value",type:"string",optional:!0},{name:"showZeroDecimals",description:"Whether to keep zero decimal digits",type:"boolean",optional:!0}],return:{type:"string",description:"Formatted value"}},text:{meta:"function",description:'Set text to element(s). Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-text" target="_blank">SVG.Text</a> or <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-tspan" target="_blank">SVG.Tspan</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"text",description:"Text to be set",type:"string"}]},font:{meta:"function",description:'Set element(s) text font and color. Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-text" target="_blank">SVG.Text</a> or <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-tspan" target="_blank">SVG.Tspan</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"font",description:"Font settings object used to apply text element font",type:"Font"},{name:"color",description:"Color string used to apply text color of the element",type:"string"}]},icon:{meta:"function",description:'Draws icon inside element(s). Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-g" target="_blank">SVG.G</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"icon",description:"Icon to draw",type:"string"},{name:"size",description:"Optional icon size in pixels. Default 12 pixels.",type:"number",optional:!0},{name:"color",description:"Optional icon color. Default #0000008A.",type:"string",optional:!0},{name:"center",description:"Whether to center icon inside group element. Default true.",type:"boolean",optional:!0}]},disable:{meta:"function",description:"Disables element(s). Disabled element doesn't accept any user interaction. For ex. if disabled element has click action, no click action will be performed on user click.",args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"}]},enable:{meta:"function",description:"Enables disabled element(s). Enabled element accepts user interaction. For ex. if element has click action, click action will be performed on user click.",args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"}]},callAction:{meta:"function",description:'Invokes action specified by behavior of type <b>"Action"</b> found by <b>behaviorId</b>.',args:[{name:"event",description:"DOM event",type:"Event"},{name:"behaviorId",description:'Id of the <b>"Action"</b> behavior',type:"string"},{name:"value",description:"Optional value passed to behavior",type:"any",optional:!0},{name:"observer",description:"Optional observer callback",type:"Partial&lt;Observer&lt;void&gt;&gt;",optional:!0}]},setValue:{meta:"function",description:"Updates value by <b>valueId</b>. See <code>ctx.values</code> for reference. Value update triggers all render functions.",args:[{name:"valueId",description:"Id of the value to be updated",type:"string"},{name:"value",description:"New value to be set",type:"any"}]}}},properties:s,values:u,tags:E,svg:{meta:"argument",type:'<a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>',description:'A root svg node. Instance of <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>.'}}}},pC=(i,m)=>{let e=m.transform(i.name,i.name);return i.subLabel&&(e+=` <small>${m.transform(i.subLabel,i.subLabel)}</small>`),{meta:"property",description:e,type:dC(i.type)}},mC=(i,m)=>({meta:"property",description:m.transform(i.name,i.name),type:cC(i.valueType)}),dC=i=>{switch(i){case Xt.text:return"string";case Xt.number:return"number";case Xt.switch:return"boolean";case Xt.color:return"color string";case Xt.color_settings:return"ColorProcessor";case Xt.font:return"Font";case Xt.units:return"units string";case Xt.icon:return"icon string"}},cC=i=>{switch(i){case Ji.STRING:return"string";case Ji.INTEGER:case Ji.DOUBLE:return"number";case Ji.BOOLEAN:return"boolean";case Ji.JSON:return"object"}};var uC=["scadaSymbolShape"],fC=["tooltipsContainer"],gC=["tooltipsContainerComponent"];function hC(i,m){if(i&1){let e=O();a(0,"div",13)(1,"button",14),d(2,"translate"),y("click",function(){x(e);let t=v();return I(t.toggleShowHidden())}),a(3,"mat-icon"),p(4),r()()()}if(i&2){let e=v();L("!hidden",e.editorMode!=="svg"),o(),T("matTooltip",c(2,4,e.showHiddenElements?"scada.hide-hidden-elements":"scada.show-hidden-elements")),o(3),R(e.showHiddenElements?"visibility_off":"visibility")}}var Xl=(()=>{class i{get editorMode(){return this.editorModeValue}set editorMode(e){this.updateEditorMode(e)}constructor(e,n){this.cd=e,this.zone=n,this.updateScadaSymbol=new rt,this.downloadScadaSymbol=new rt,this.zoomInDisabled=!1,this.zoomOutDisabled=!1,this.showHiddenElements=!1,this.showHiddenElementsChange=new rt,this.displayShowHidden=!1,this.svgContentFormControl=new xa,this.editorModeValue="svg"}ngOnInit(){this.readonly?this.svgContentFormControl.disable({emitEvent:!1}):this.svgContentFormControl.enable({emitEvent:!1}),this.svgContentFormControl.valueChanges.subscribe(e=>{this.svgContent!==e&&(this.svgContent=e,this.editObjectCallbacks.onSymbolEditObjectDirty(!0)),this.editObjectCallbacks.onSymbolEditObjectValid(this.svgContentFormControl.valid)})}ngAfterViewInit(){this.editObjectCallbacks.onZoom=()=>{this.updateZoomButtonsState()},this.editObjectCallbacks.hasHiddenElements=e=>{this.displayShowHidden=e,e&&this.scadaSymbolEditObject.showHiddenElements(this.showHiddenElements),this.cd.markForCheck()},this.scadaSymbolEditObject=new Yl(this.scadaSymbolShape.nativeElement,this.tooltipsContainer.nativeElement,this.tooltipsContainerComponent.viewContainerRef,this.zone,this.editObjectCallbacks,this.readonly),this.data&&this.updateContent(this.data.scadaSymbolContent)}ngOnChanges(e){for(let n of Object.keys(e)){let t=e[n];!t.firstChange&&t.currentValue!==t.previousValue&&(n==="data"?setTimeout(()=>{this.updateContent(this.data.scadaSymbolContent)}):n==="readonly"&&(this.scadaSymbolEditObject.setReadOnly(this.readonly),this.readonly?this.svgContentFormControl.disable({emitEvent:!1}):this.svgContentFormControl.enable({emitEvent:!1})))}}ngOnDestroy(){this.scadaSymbolEditObject.destroy()}getContent(){return this.editorMode==="svg"?this.scadaSymbolEditObject?.getContent():this.svgContent}getTags(){return this.editorMode==="svg"?this.scadaSymbolEditObject?.getTags():Af(this.svgContent)}zoomIn(){this.scadaSymbolEditObject.zoomIn()}zoomOut(){this.scadaSymbolEditObject.zoomOut()}toggleShowHidden(){this.showHiddenElements=!this.showHiddenElements,this.showHiddenElementsChange.emit(this.showHiddenElements),this.scadaSymbolEditObject.showHiddenElements(this.showHiddenElements)}updateEditorMode(e){this.editorModeValue=e,e==="xml"?(this.svgContent=this.scadaSymbolEditObject.getContent(),this.svgContentFormControl.setValue(this.svgContent,{emitEvent:!1})):this.updateEditObjectContent(this.svgContent)}updateContent(e){this.svgContent=kf(e),this.editorMode==="xml"?this.svgContentFormControl.setValue(this.svgContent,{emitEvent:!1}):this.updateEditObjectContent(this.svgContent)}updateEditObjectContent(e){this.scadaSymbolEditObject&&(this.displayShowHidden=!1,this.scadaSymbolEditObject.setContent(e),setTimeout(()=>{this.updateZoomButtonsState()}))}updateZoomButtonsState(){this.zoomInDisabled=this.scadaSymbolEditObject.zoomInDisabled(),this.zoomOutDisabled=this.scadaSymbolEditObject.zoomOutDisabled(),this.cd.markForCheck()}static{this.\u0275fac=function(n){return new(n||i)(g(Xe),g(Xr))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-editor"]],viewQuery:function(n,t){if(n&1&&(be(uC,5),be(fC,5),be(gC,7)),n&2){let s;ve(s=ye())&&(t.scadaSymbolShape=s.first),ve(s=ye())&&(t.tooltipsContainer=s.first),ve(s=ye())&&(t.tooltipsContainerComponent=s.first)}},inputs:{data:"data",editObjectCallbacks:"editObjectCallbacks",readonly:"readonly",showHiddenElements:"showHiddenElements"},outputs:{updateScadaSymbol:"updateScadaSymbol",downloadScadaSymbol:"downloadScadaSymbol",showHiddenElementsChange:"showHiddenElementsChange"},features:[Fn],decls:38,vars:32,consts:[["scadaSymbolShape",""],["tooltipsContainer",""],["tooltipsContainerComponent",""],[1,"tb-scada-symbol-editor-shape"],[1,"tb-scada-symbol-editor-tooltips"],[1,"tb-scada-symbol-editor-svg-xml"],["fillHeight","","noLabel","",3,"formControl"],[1,"tb-scada-symbol-editor-buttons"],[1,"tb-scada-symbol-editor-view-buttons"],[1,"tb-scada-symbol-editor-zoom-buttons","tb-primary-fill"],["mat-icon-button","","matTooltipPosition","above",3,"click","disabled","matTooltip"],["class","tb-primary-fill",3,"!hidden",4,"ngIf"],[1,"tb-scada-symbol-editor-right-buttons"],[1,"tb-primary-fill"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["appearance","fill","fillHeight","","extraPadding","","primaryBackground","",3,"ngModelChange","disabled","ngModel"],["value","svg"],["value","xml"]],template:function(n,t){if(n&1){let s=O();f(0,"div",3,0),a(2,"div",4,1),f(4,"tb-anchor",null,2),r(),a(6,"div",5),f(7,"tb-svg-xml",6),r(),a(8,"div",7)(9,"div",8)(10,"div",9)(11,"button",10),d(12,"translate"),y("click",function(){return x(s),I(t.zoomIn())}),a(13,"mat-icon"),p(14,"add"),r()(),a(15,"button",10),d(16,"translate"),y("click",function(){return x(s),I(t.zoomOut())}),a(17,"mat-icon"),p(18,"remove"),r()()(),b(19,hC,5,6,"div",11),r(),a(20,"div",12)(21,"div",13)(22,"button",14),d(23,"translate"),y("click",function(){return x(s),I(t.updateScadaSymbol.emit())}),a(24,"mat-icon"),p(25,"file_upload"),r()()(),a(26,"div",13)(27,"button",14),d(28,"translate"),y("click",function(){return x(s),I(t.downloadScadaSymbol.emit())}),a(29,"mat-icon"),p(30,"download"),r()()(),a(31,"tb-toggle-select",15),pt("ngModelChange",function(_){return x(s),lt(t.editorMode,_)||(t.editorMode=_),I(_)}),a(32,"tb-toggle-option",16),p(33),d(34,"translate"),r(),a(35,"tb-toggle-option",17),p(36),d(37,"translate"),r()()()()}n&2&&(L("!hidden",t.editorMode!=="svg"),o(2),L("!hidden",t.editorMode!=="svg"),o(4),L("!hidden",t.editorMode!=="xml"),o(),l("formControl",t.svgContentFormControl),o(3),L("!hidden",t.editorMode!=="svg"),o(),T("matTooltip",c(12,20,"scada.zoom-in")),l("disabled",t.zoomInDisabled),o(4),T("matTooltip",c(16,22,"scada.zoom-out")),l("disabled",t.zoomOutDisabled),o(4),l("ngIf",t.displayShowHidden),o(3),T("matTooltip",c(23,24,"scada.update-symbol")),o(5),T("matTooltip",c(28,26,"scada.download-symbol")),o(4),l("disabled",!t.readonly&&!t.svgContentFormControl.valid),st("ngModel",t.editorMode),o(2),R(c(34,28,"scada.mode-svg")),o(3),R(c(37,30,"scada.mode-xml")))},dependencies:[V,p0,Gf,Ce,ee,Dt,W,ut,Yt,qn,Wn,k],styles:[`@charset "UTF-8";.tb-scada-symbol-editor-shape{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.tb-scada-symbol-editor-tooltips{position:absolute;inset:0;pointer-events:none}.tb-scada-symbol-editor-svg-xml{width:100%;height:100%;padding-top:88px}.tb-scada-symbol-editor-buttons{pointer-events:none;position:absolute;left:20px;top:20px;right:20px;display:flex;justify-content:space-between;align-items:flex-start}.tb-scada-symbol-editor-buttons .tb-primary-fill{background:#fff;border-radius:50%}.tb-scada-symbol-editor-buttons .tb-primary-fill:before{opacity:.1}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-view-buttons{display:flex;flex-direction:column;gap:8px;z-index:101}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons{display:flex;flex-direction:column;z-index:101;background:#fff;border-radius:24px}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons.tb-primary-fill{border-radius:24px}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons.tb-primary-fill:before{opacity:.1}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-right-buttons{display:flex;flex-direction:row;gap:8px;z-index:101}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-right-buttons tb-toggle-select{pointer-events:auto}.tooltipster-sidetip.scada-symbol{position:fixed}.tooltipster-sidetip.scada-symbol .tooltipster-box{-webkit-user-select:none;user-select:none;background:#0000008a;border:1px solid rgba(0,0,0,0);border-radius:8px;display:flex;align-items:center}.tooltipster-sidetip.scada-symbol .tooltipster-box .tooltipster-content{padding:4px 8px;font-size:12px;line-height:12px;font-weight:500;color:#fff}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-box{background:#fff;border:1px solid rgba(0,0,0,.38);box-shadow:0 0 10px 6px #0003}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-box .tooltipster-content{color:#000000c2}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-width:12px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow{bottom:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-top-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-top-color:#fff;left:-2px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow{top:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-bottom-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-bottom-color:#fff;left:-2px;top:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow{right:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-left-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-left-color:#fff;top:-2px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow{left:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-right-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-right-color:#fff;top:-2px;left:-1px}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-box,.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-box{min-height:36px}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow{bottom:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-top-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-top-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow{top:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-bottom-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-bottom-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow{right:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-left-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-left-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow{left:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-right-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-right-color:transparent}
`],encapsulation:2})}}return i})();C();C();C();C();var yC=["tagFunctionComponent"];function _C(i,m){if(i&1){let e=O();a(0,"button",9),y("click",function(){x(e);let t=v();return I(t.applyTagFunction())}),p(1),d(2,"translate"),r()}if(i&2){let e=v();l("disabled",e.tagFunctionFormGroup.invalid||!e.tagFunctionFormGroup.dirty),o(),h(" ",c(2,2,"action.apply")," ")}}var Zl=(()=>{class i{constructor(e,n){this.fb=e,this.widgetService=n,this.tagFunctionApplied=new rt,this.functionScopeVariables=this.widgetService.getWidgetScopeVariables()}ngOnInit(){this.tagFunctionFormGroup=this.fb.group({tagFunction:[this.tagFunction,[]]}),this.disabled&&this.tagFunctionFormGroup.disable({emitEvent:!1}),this.tagFunctionType==="renderFunction"?(this.panelTitle="scada.state-render-function",this.tagFunctionArgs=["ctx","element"],this.highlightRules=lh,this.tagFunctionHelpId="scada/tag_state_render_fn"):this.tagFunctionType==="clickAction"&&(this.panelTitle="scada.tag.on-click-action",this.tagFunctionArgs=["ctx","element","event"],this.highlightRules=ph,this.tagFunctionHelpId="scada/tag_click_action_fn")}ngAfterViewInit(){this.tagFunctionComponent.focus()}cancel(){this.popover?.hide()}applyTagFunction(){let e=this.tagFunctionFormGroup.get("tagFunction").value;this.tagFunctionApplied.emit(e)}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(fi))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-metadata-tag-function-panel"]],viewQuery:function(n,t){if(n&1&&be(yC,5),n&2){let s;ve(s=ye())&&(t.tagFunctionComponent=s.first)}},inputs:{tagFunction:"tagFunction",tagFunctionType:"tagFunctionType",tag:"tag",completer:"completer",disabled:"disabled",popover:"popover"},outputs:{tagFunctionApplied:"tagFunctionApplied"},decls:17,vars:13,consts:[["tagFunctionComponent",""],[1,"tb-scada-symbol-metadata-tag-function-panel",3,"formGroup"],[1,"tb-scada-symbol-metadata-tag-function-title-container"],[1,"tb-scada-symbol-metadata-tag-function-title"],[1,"tb-scada-symbol-metadata-tag-function-panel-content"],["minHeight","300px","formControlName","tagFunction",3,"highlightRules","editorCompleter","functionArgs","helpId"],[1,"tb-scada-symbol-metadata-tag-function-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){if(n&1){let s=O();a(0,"div",1)(1,"div",2)(2,"mat-chip-set")(3,"mat-chip")(4,"span"),p(5),r()()(),a(6,"div",3),p(7),d(8,"translate"),r()(),a(9,"div",4),f(10,"tb-js-func",5,0),r(),a(12,"div",6)(13,"button",7),y("click",function(){return x(s),I(t.cancel())}),p(14),d(15,"translate"),r(),b(16,_C,3,4,"button",8),r()()}n&2&&(l("formGroup",t.tagFunctionFormGroup),o(5),h(" ",t.tag," "),o(2),R(c(8,9,t.panelTitle)),o(3),l("highlightRules",t.highlightRules)("editorCompleter",t.completer)("functionArgs",t.tagFunctionArgs)("helpId",t.tagFunctionHelpId),o(4),h(" ",c(15,11,t.disabled?"action.close":"action.cancel")," "),o(2),l("ngIf",!t.disabled))},dependencies:[V,js,K,Ma,ys,W,z,X,oe,k],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tag-function-panel{width:800px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-metadata-tag-function-panel{width:90vw}}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-title-container{display:flex;flex-direction:row;gap:16px;align-items:center}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();var CC=["editStateRenderFunctionButton"],SC=["editClickActionButton"];function TC(i,m){if(i&1){let e=O();a(0,"button",8,0),y("click",function(){x(e);let t=v();return I(t.editTagStateRenderFunction())}),a(2,"mat-icon"),p(3),r(),a(4,"span"),p(5),d(6,"translate"),r()()}if(i&2){let e=v();o(3),R(e.disabled?"visibility":e.tagFormGroup.get("stateRenderFunction").value?"edit":"add"),o(2),R(c(6,2,e.disabled?"action.view":e.tagFormGroup.get("stateRenderFunction").value?"action.edit":"action.add"))}}function xC(i,m){if(i&1){let e=O();a(0,"button",8,1),y("click",function(){x(e);let t=v();return I(t.editClickAction())}),a(2,"mat-icon"),p(3),r(),a(4,"span"),p(5),d(6,"translate"),r()()}if(i&2){let e=v();o(3),R(e.disabled?"visibility":e.tagFormGroup.get("clickAction").value?"edit":"add"),o(2),R(c(6,2,e.disabled?"action.view":e.tagFormGroup.get("clickAction").value?"action.edit":"action.add"))}}var mr=(()=>{class i{constructor(e,n,t,s){this.fb=e,this.popoverService=n,this.renderer=t,this.viewContainerRef=s,this.propagateChange=u=>{}}ngOnInit(){this.tagFormGroup=this.fb.group({tag:[null,[]],stateRenderFunction:[null,[]],clickAction:[null,[]]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.tagFormGroup.disable({emitEvent:!1}):this.tagFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e;let n=e?.actions?.click?.actionFunction;this.tagFormGroup.patchValue({tag:e?.tag,stateRenderFunction:e?.stateRenderFunction,clickAction:n},{emitEvent:!1})}validate(e){return this.tagFormGroup.valid?null:{tag:{valid:!1}}}editTagStateRenderFunction(){this.openTagFunction("renderFunction",this.editStateRenderFunctionButton)}editClickAction(){this.openTagFunction("clickAction",this.editClickActionButton)}openTagFunction(e,n){let t=n._elementRef.nativeElement;if(t.scrollIntoView(),this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let s,u;e==="renderFunction"?(s=this.tagFormGroup.get("stateRenderFunction"),u=this.elementStateRenderFunctionCompleter):e==="clickAction"&&(s=this.tagFormGroup.get("clickAction"),u=this.clickActionFunctionCompleter);let _={tagFunction:s.value,tagFunctionType:e,tag:this.tagFormGroup.get("tag").value,completer:u,disabled:this.disabled},E=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,Zl,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,_,{},{},{},!0);E.tbComponentRef.instance.popover=E,E.tbComponentRef.instance.tagFunctionApplied.subscribe(w=>{E.hide(),s.patchValue(w,{emitEvent:!1}),this.updateModel()})}}updateModel(){let e=this.tagFormGroup.value;this.modelValue={tag:e.tag,stateRenderFunction:e.stateRenderFunction},e.clickAction?this.modelValue.actions={click:{actionFunction:e.clickAction}}:this.modelValue.actions=null,this.propagateChange(this.modelValue)}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(Sn),g(un),g(ki))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-metadata-tag"]],viewQuery:function(n,t){if(n&1&&(be(CC,5),be(SC,5)),n&2){let s;ve(s=ye())&&(t.editStateRenderFunctionButton=s.first),ve(s=ye())&&(t.editClickActionButton=s.first)}},inputs:{disabled:"disabled",elementStateRenderFunctionCompleter:"elementStateRenderFunctionCompleter",clickActionFunctionCompleter:"clickActionFunctionCompleter"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:10,vars:4,consts:[["editStateRenderFunctionButton",""],["editClickActionButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-tag-row",3,"formGroup"],[1,"tb-tag-field"],[1,"tb-scada-symbol-metadata-tag-label"],[1,"tb-state-render-function-field"],["mat-button","","color","primary",3,"click",4,"ngIf"],[1,"tb-on-click-action-field"],["mat-button","","color","primary",3,"click"]],template:function(n,t){n&1&&(a(0,"div",2)(1,"div",3)(2,"mat-chip-set")(3,"mat-chip")(4,"span",4),p(5),r()()()(),a(6,"div",5),b(7,TC,7,4,"button",6),r(),a(8,"div",7),b(9,xC,7,4,"button",6),r()()),n&2&&(l("formGroup",t.tagFormGroup),o(5),h(" ",t.tagFormGroup.get("tag").value," "),o(2),l("ngIf",!t.disabled||t.tagFormGroup.get("stateRenderFunction").value),o(2),l("ngIf",!t.disabled||t.tagFormGroup.get("clickAction").value))},dependencies:[V,K,ee,Ma,ys,z,X,k],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tag-row .tb-tag-field{flex:1 1 70%}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field{flex:1 1 15%}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field{display:flex;justify-content:flex-end}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field .mdc-button .mat-mdc-button-touch-target,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field .mdc-button .mat-mdc-button-touch-target{height:36px}
`],encapsulation:2})}}return i})();function EC(i,m){i&1&&f(0,"mat-divider")}function wC(i,m){if(i&1&&(a(0,"div"),f(1,"tb-scada-symbol-metadata-tag",10),b(2,EC,1,0,"mat-divider",11),r()),i&2){let e=m.$implicit,n=m.last,t=v(2);o(),l("elementStateRenderFunctionCompleter",t.elementStateRenderFunctionCompleter)("clickActionFunctionCompleter",t.clickActionFunctionCompleter)("formControl",e),o(),l("ngIf",!n)}}function MC(i,m){if(i&1&&(a(0,"div",8),b(1,wC,3,4,"div",9),r()),i&2){let e=v();o(),l("ngForOf",e.tagsFormArray().controls)("ngForTrackBy",e.trackByTag)}}function DC(i,m){i&1&&(a(0,"span",12),p(1),d(2,"translate"),r()),i&2&&(o(),R(c(2,1,"scada.tag.no-tags")))}var uh=i=>!i.stateRenderFunction&&!i.actions?.click?.actionFunction,ep=(()=>{class i{constructor(e){this.fb=e,this.styleDisplay="flex",this.styleOverflow="hidden",this.propagateChange=n=>{}}ngOnInit(){this.tagsFormGroup=this.fb.group({tags:this.fb.array([])});let e=this.setupTags();this.tagsFormGroup.setControl("tags",this.prepareTagsFormArray(e.tags),{emitEvent:!1}),this.tagsFormGroup.valueChanges.subscribe(()=>{let n=this.tagsFormGroup.get("tags").value;n&&(n=n.filter(t=>!uh(t))),this.modelValue=n,this.propagateChange(this.modelValue)})}ngOnChanges(e){for(let n of Object.keys(e)){let t=e[n];if(!t.firstChange&&t.currentValue!==t.previousValue&&["tags"].includes(n)){let s=this.setupTags(this.modelValue),u=this.prepareTagsFormArray(s.tags);s.emitEvent?setTimeout(()=>{this.tagsFormGroup.setControl("tags",u,{emitEvent:!0}),this.setDisabledState(this.disabled)}):(this.tagsFormGroup.setControl("tags",u,{emitEvent:!1}),this.setDisabledState(this.disabled))}}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.tagsFormGroup.disable({emitEvent:!1}):this.tagsFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e||[];let n=this.setupTags(this.modelValue);this.tagsFormGroup.setControl("tags",this.prepareTagsFormArray(n.tags),{emitEvent:!1}),this.setDisabledState(this.disabled)}validate(e){return this.tagsFormGroup.valid?null:{tags:{valid:!1}}}tagsFormArray(){return this.tagsFormGroup.get("tags")}trackByTag(e,n){return n}editTagStateRenderFunction(e){setTimeout(()=>{let t=this.tagsFormGroup.get("tags").value.findIndex(u=>u.tag===e);this.metadataTags.get(t)?.editTagStateRenderFunction()})}editTagClickAction(e){setTimeout(()=>{let t=this.tagsFormGroup.get("tags").value.findIndex(u=>u.tag===e);this.metadataTags.get(t)?.editClickAction()})}setupTags(e){e=(e||[]).filter(s=>!uh(s));let n=(this.tags||[]).sort().map(s=>({tag:s,stateRenderFunction:null,actions:null}));for(let s of e){let u=n.find(_=>_.tag===s.tag);u&&(u.stateRenderFunction=s.stateRenderFunction,s.actions?.click?.actionFunction&&(u.actions={click:{actionFunction:s.actions.click.actionFunction}}))}let t=!!e.find(s=>!n.find(u=>u.tag===s.tag));return{tags:n,emitEvent:t}}prepareTagsFormArray(e){let n=[];return e&&e.forEach(t=>{n.push(this.fb.control(t,[]))}),this.fb.array(n)}static{this.\u0275fac=function(n){return new(n||i)(g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-metadata-tags"]],viewQuery:function(n,t){if(n&1&&be(mr,5),n&2){let s;ve(s=ye())&&(t.metadataTags=s)}},hostVars:4,hostBindings:function(n,t){n&2&&Qi("display",t.styleDisplay)("overflow",t.styleOverflow)},inputs:{disabled:"disabled",tags:"tags",elementStateRenderFunctionCompleter:"elementStateRenderFunctionCompleter",clickActionFunctionCompleter:"clickActionFunctionCompleter"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}]),Fn],decls:12,vars:2,consts:[["noTags",""],[1,"tb-form-panel","tb-scada-symbol-metadata-tags"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-tag-header"],["translate","",1,"tb-form-table-header-cell","tb-state-render-function-header"],["translate","",1,"tb-form-table-header-cell","tb-on-click-action-header"],["class","tb-form-table-body",4,"ngIf","ngIfElse"],[1,"tb-form-table-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex-1",3,"elementStateRenderFunctionCompleter","clickActionFunctionCompleter","formControl"],[4,"ngIf"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(n,t){if(n&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),p(4,"scada.tag.tag"),r(),a(5,"div",5),p(6,"scada.state-render-function"),r(),a(7,"div",6),p(8,"scada.tag.on-click-action"),r()(),b(9,MC,2,2,"div",7),r()(),b(10,DC,3,3,"ng-template",null,0,xt)),n&2){let s=U(11);o(9),l("ngIf",t.tagsFormArray().controls.length)("ngIfElse",s)}},dependencies:[we,V,xi,W,Yt,H,mr,k],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tags{flex:1;margin:12px}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-tag-header{flex:1 1 70%}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-state-render-function-header,.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-on-click-action-header{flex:1 1 15%}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-state-render-function-header,.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-on-click-action-header{display:flex;justify-content:flex-end}.tb-scada-symbol-metadata-tags .tb-form-table{overflow:hidden}.tb-scada-symbol-metadata-tags .tb-form-table-body{overflow:auto}.tb-scada-symbol-metadata-tags .tb-form-table-body tb-scada-symbol-metadata-tag{overflow:hidden}.tb-scada-symbol-metadata-tags .tb-form-table-body .mat-divider{margin-top:8px}
`],encapsulation:2})}}return i})();C();C();C();var FC=(i,m)=>[i,m];function AC(i,m){if(i&1&&(a(0,"mat-option",17),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.scadaSymbolBehaviorTypeTranslations.get(e))," ")}}function NC(i,m){if(i&1&&(a(0,"mat-select-trigger")(1,"div",20),f(2,"mat-icon",21),a(3,"span"),p(4),d(5,"translate"),r()()()),i&2){let e=v(2);o(2),T("svgIcon",e.valueTypesMap.get(e.behaviorFormGroup.get("valueType").value).icon),o(2),R(c(5,2,e.valueTypesMap.get(e.behaviorFormGroup.get("valueType").value).name))}}function kC(i,m){if(i&1&&(a(0,"mat-option",17),f(1,"mat-icon",22),a(2,"span"),p(3),d(4,"translate"),r()()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),T("svgIcon",n.valueTypesMap.get(e).icon),o(2),R(c(4,3,n.valueTypesMap.get(e).name))}}function RC(i,m){if(i&1&&(a(0,"div",3)(1,"div",4),p(2,"scada.behavior.value-type"),r(),a(3,"mat-form-field",18)(4,"mat-select",19),b(5,NC,6,4,"mat-select-trigger",13)(6,kC,5,5,"mat-option",11),r()()()),i&2){let e=v();o(5),l("ngIf",e.behaviorFormGroup.get("valueType").value),o(),l("ngForOf",e.valueTypes)}}function OC(i,m){i&1&&(Ut(0),a(1,"div",3)(2,"div",4),p(3,"scada.behavior.true-label"),r(),a(4,"mat-form-field",5),f(5,"input",24),d(6,"translate"),r()(),a(7,"div",3)(8,"div",4),p(9,"scada.behavior.false-label"),r(),a(10,"mat-form-field",5),f(11,"input",25),d(12,"translate"),r()(),a(13,"div",3)(14,"div",4),p(15,"scada.behavior.state-label"),r(),a(16,"mat-form-field",5),f(17,"input",26),d(18,"translate"),r()(),qt()),i&2&&(o(5),T("placeholder",c(6,3,"widget-config.set")),o(6),T("placeholder",c(12,5,"widget-config.set")),o(6),T("placeholder",c(18,7,"widget-config.set")))}function BC(i,m){if(i&1&&(Ut(0),b(1,OC,19,9,"ng-container",13),a(2,"div",3)(3,"div",4),p(4,"scada.behavior.default-settings"),r(),f(5,"tb-get-value-action-settings",23),d(6,"customTranslate"),d(7,"customTranslate"),d(8,"customTranslate"),d(9,"customTranslate"),r(),qt()),i&2){let e=v();o(),l("ngIf",e.behaviorFormGroup.get("valueType").value===e.ValueType.BOOLEAN),o(4),T("panelTitle",c(6,8,e.behaviorFormGroup.get("name").value)),l("valueType",e.behaviorFormGroup.get("valueType").value)("trueLabel",c(7,10,e.behaviorFormGroup.get("trueLabel").value))("falseLabel",c(8,12,e.behaviorFormGroup.get("falseLabel").value))("stateLabel",c(9,14,e.behaviorFormGroup.get("stateLabel").value))("aliasController",e.aliasController)("widgetType",e.widgetType.rpc)}}function VC(i,m){if(i&1&&(Ut(0),a(1,"div",3)(2,"div",4),p(3,"scada.behavior.default-settings"),r(),f(4,"tb-set-value-action-settings",27),d(5,"customTranslate"),r(),qt()),i&2){let e=v();o(4),T("panelTitle",c(5,4,e.behaviorFormGroup.get("name").value)),l("valueType",e.behaviorFormGroup.get("valueType").value)("aliasController",e.aliasController)("widgetType",e.widgetType.rpc)}}function LC(i,m){if(i&1&&(Ut(0),a(1,"div",3)(2,"div",4),p(3,"scada.behavior.default-settings"),r(),f(4,"tb-widget-action-settings",28),d(5,"customTranslate"),r(),qt()),i&2){let e=v();o(4),T("panelTitle",c(5,3,e.behaviorFormGroup.get("name").value)),l("callbacks",e.callbacks)("widgetType",e.widgetType.rpc)}}function jC(i,m){if(i&1){let e=O();a(0,"button",29),y("click",function(){x(e);let t=v();return I(t.applyBehaviorSettings())}),p(1),d(2,"translate"),r()}if(i&2){let e=v();l("disabled",e.behaviorFormGroup.invalid||!e.behaviorFormGroup.dirty),o(),h(" ",c(2,2,e.isAdd?"action.add":"action.apply")," ")}}var tp=(()=>{class i{constructor(e,n){this.fb=e,this.widgetService=n,this.widgetType=Fi,this.ScadaSymbolBehaviorType=pn,this.ValueType=Ji,this.ValueToDataType=Er,this.scadaSymbolBehaviorTypes=Ys,this.scadaSymbolBehaviorTypeTranslations=Xs,this.valueTypes=Object.keys(Ji),this.valueTypesMap=pu,this.isAdd=!1,this.behaviorSettingsApplied=new rt,this.functionScopeVariables=this.widgetService.getWidgetScopeVariables()}ngOnInit(){this.panelTitle=this.isAdd?"scada.behavior.add-behavior":"scada.behavior.behavior-settings",this.behaviorFormGroup=this.fb.group({id:[this.behavior.id,[S.required]],name:[this.behavior.name,[S.required]],hint:[this.behavior.hint,[]],group:[this.behavior.group,[]],type:[this.behavior.type,[S.required]],valueType:[this.behavior.valueType,[S.required]],trueLabel:[this.behavior.trueLabel,[]],falseLabel:[this.behavior.falseLabel,[]],stateLabel:[this.behavior.stateLabel,[]],defaultGetValueSettings:[this.behavior.defaultGetValueSettings,[S.required]],defaultSetValueSettings:[this.behavior.defaultSetValueSettings,[S.required]],defaultWidgetActionSettings:[this.behavior.defaultWidgetActionSettings,[S.required]]}),this.disabled?this.behaviorFormGroup.disable({emitEvent:!1}):(Xc(this.behaviorFormGroup.get("type").valueChanges,this.behaviorFormGroup.get("valueType").valueChanges).subscribe(()=>{this.updateValidators()}),this.updateValidators())}cancel(){this.popover?.hide()}applyBehaviorSettings(){let e=this.behaviorFormGroup.getRawValue();this.behaviorSettingsApplied.emit(e)}updateValidators(){let e=this.behaviorFormGroup.get("type").value,n=this.behaviorFormGroup.get("valueType").value,t=this.behaviorFormGroup.get("defaultGetValueSettings").value,s=this.behaviorFormGroup.get("defaultSetValueSettings").value,u=this.behaviorFormGroup.get("defaultWidgetActionSettings").value;switch(this.behaviorFormGroup.disable({emitEvent:!1}),this.behaviorFormGroup.get("id").enable({emitEvent:!1}),this.behaviorFormGroup.get("name").enable({emitEvent:!1}),this.behaviorFormGroup.get("type").enable({emitEvent:!1}),this.behaviorFormGroup.get("hint").enable({emitEvent:!1}),this.behaviorFormGroup.get("group").enable({emitEvent:!1}),e){case pn.value:this.behaviorFormGroup.get("valueType").enable({emitEvent:!1}),this.behaviorFormGroup.get("defaultGetValueSettings").enable({emitEvent:!1}),n===Ji.BOOLEAN&&(this.behaviorFormGroup.get("trueLabel").enable({emitEvent:!1}),this.behaviorFormGroup.get("falseLabel").enable({emitEvent:!1}),this.behaviorFormGroup.get("stateLabel").enable({emitEvent:!1})),t||(t=ga({},tl(n)),this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(t,{emitEvent:!0})),s&&this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(null,{emitEvent:!0}),u&&this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(null,{emitEvent:!0});break;case pn.action:this.behaviorFormGroup.get("valueType").enable({emitEvent:!1}),this.behaviorFormGroup.get("defaultSetValueSettings").enable({emitEvent:!1}),s||(s=ga({},Of(n)),this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(s,{emitEvent:!0})),t&&this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(null,{emitEvent:!0}),u&&this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(null,{emitEvent:!0});break;case pn.widgetAction:this.behaviorFormGroup.get("defaultWidgetActionSettings").enable({emitEvent:!1}),u||(u=ga({},Bf),this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(u,{emitEvent:!0})),t&&this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(null,{emitEvent:!0}),s&&this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(null,{emitEvent:!0});break}}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(fi))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-behavior-panel"]],inputs:{isAdd:"isAdd",behavior:"behavior",aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled",popover:"popover"},outputs:{behaviorSettingsApplied:"behaviorSettingsApplied"},decls:44,vars:28,consts:[[1,"tb-scada-symbol-behavior-settings-panel",3,"formGroup"],[1,"tb-scada-symbol-behavior-settings-title"],[1,"tb-scada-symbol-behavior-settings-panel-content"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["required","","matInput","","formControlName","id",3,"placeholder"],["required","","matInput","","formControlName","name",3,"placeholder"],["matInput","","formControlName","hint",3,"placeholder"],["matInput","","formControlName","group",3,"placeholder"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["class","tb-form-row",4,"ngIf"],[4,"ngIf"],[1,"tb-scada-symbol-behavior-settings-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],[3,"value"],["appearance","outline","subscriptSizing","dynamic",1,"tb-value-type","flex"],["formControlName","valueType"],[1,"tb-value-type-row"],[1,"tb-mat-18",3,"svgIcon"],[1,"tb-mat-20",3,"svgIcon"],["formControlName","defaultGetValueSettings",1,"flex-1",3,"panelTitle","valueType","trueLabel","falseLabel","stateLabel","aliasController","widgetType"],["matInput","","formControlName","trueLabel",3,"placeholder"],["matInput","","formControlName","falseLabel",3,"placeholder"],["matInput","","formControlName","stateLabel",3,"placeholder"],["formControlName","defaultSetValueSettings",1,"flex-1",3,"panelTitle","valueType","aliasController","widgetType"],["formControlName","defaultWidgetActionSettings",1,"flex-1",3,"panelTitle","callbacks","widgetType"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1),p(2),d(3,"translate"),r(),a(4,"div",2)(5,"div",3)(6,"div",4),p(7,"scada.behavior.id"),r(),a(8,"mat-form-field",5),f(9,"input",6),d(10,"translate"),r()(),a(11,"div",3)(12,"div",4),p(13,"scada.behavior.name"),r(),a(14,"mat-form-field",5),f(15,"input",7),d(16,"translate"),r()(),a(17,"div",3)(18,"div",4),p(19,"scada.behavior.hint"),r(),a(20,"mat-form-field",5),f(21,"input",8),d(22,"translate"),r()(),a(23,"div",3)(24,"div",4),p(25,"scada.behavior.group-title"),r(),a(26,"mat-form-field",5),f(27,"input",9),d(28,"translate"),r()(),a(29,"div",3)(30,"div",4),p(31,"scada.behavior.type"),r(),a(32,"mat-form-field",5)(33,"mat-select",10),b(34,AC,3,4,"mat-option",11),r()()(),b(35,RC,7,2,"div",12)(36,BC,10,16,"ng-container",13)(37,VC,6,6,"ng-container",13)(38,LC,6,5,"ng-container",13),r(),a(39,"div",14)(40,"button",15),y("click",function(){return t.cancel()}),p(41),d(42,"translate"),r(),b(43,jC,3,4,"button",16),r()()),n&2&&(l("formGroup",t.behaviorFormGroup),o(2),R(c(3,13,t.panelTitle)),o(7),T("placeholder",c(10,15,"widget-config.set")),o(6),T("placeholder",c(16,17,"widget-config.set")),o(6),T("placeholder",c(22,19,"widget-config.set")),o(6),T("placeholder",c(28,21,"widget-config.set")),o(7),l("ngForOf",t.scadaSymbolBehaviorTypes),o(),l("ngIf",ma(25,FC,t.ScadaSymbolBehaviorType.value,t.ScadaSymbolBehaviorType.action).includes(t.behaviorFormGroup.get("type").value)),o(),l("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.value),o(),l("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.action),o(),l("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.widgetAction),o(3),h(" ",c(42,23,t.disabled?"action.close":"action.cancel")," "),o(2),l("ngIf",!t.disabled))},dependencies:[we,V,K,ee,ge,me,St,Zu,ct,ue,W,z,ce,X,oe,H,pg,mg,dg,Ya,k],styles:[`@charset "UTF-8";.tb-scada-symbol-behavior-settings-panel{width:540px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-behavior-settings-panel{width:90vw}}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type .mat-mdc-form-field-infix{max-height:40px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type mat-select-trigger .tb-value-type-row{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;gap:10px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type mat-select-trigger .tb-value-type-row .mat-icon{color:#00000061;vertical-align:bottom}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();var GC=["idInput"],UC=["editButton"];function qC(i,m){if(i&1&&(a(0,"mat-option",13),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.scadaSymbolBehaviorTypeTranslations.get(e))," ")}}function WC(i,m){if(i&1){let e=O();a(0,"button",11),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.behaviorRemoved.emit())}),a(2,"mat-icon"),p(3,"delete"),r()()}i&2&&T("matTooltip",c(1,1,"scada.behavior.remove-behavior"))}var Br=i=>{if(!i.id||!i.name||!i.type)return!1;switch(i.type){case pn.value:if(!i.valueType||!i.defaultGetValueSettings)return!1;break;case pn.action:if(!i.defaultSetValueSettings||i.defaultSetValueSettings.valueToData?.type===Er.CONSTANT&&Gd(i.defaultSetValueSettings.valueToData?.constantValue)||i.defaultSetValueSettings.valueToData?.type===Er.FUNCTION&&Gd(i.defaultSetValueSettings.valueToData?.valueToDataFunction))return!1;break;case pn.widgetAction:break}return!0},Vr=(()=>{class i{constructor(e,n,t,s,u,_){this.fb=e,this.cd=n,this.popoverService=t,this.renderer=s,this.viewContainerRef=u,this.behaviorsComponent=_,this.scadaSymbolBehaviorTypes=Ys,this.scadaSymbolBehaviorTypeTranslations=Xs,this.behaviorRemoved=new rt,this.propagateChange=E=>{}}ngOnInit(){this.behaviorRowFormGroup=this.fb.group({id:[null,[this.behaviorIdValidator()]],name:[null,[S.required]],type:[null,[S.required]]}),this.behaviorRowFormGroup.valueChanges.subscribe(()=>this.updateModel()),this.behaviorRowFormGroup.get("type").valueChanges.subscribe(e=>{this.onTypeChanged(e)})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.behaviorRowFormGroup.disable({emitEvent:!1}):this.behaviorRowFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e,this.behaviorRowFormGroup.patchValue({id:e?.id,name:e?.name,type:e?.type},{emitEvent:!1}),this.cd.markForCheck()}editBehavior(e,n,t=!1,s=()=>{}){e&&e.stopPropagation();let u=n._elementRef.nativeElement;if(this.popoverService.hasPopover(u))this.popoverService.hidePopover(u);else{let _={isAdd:t,disabled:this.disabled,aliasController:this.aliasController,callbacks:this.callbacks,behavior:Ue(this.modelValue)},E=this.popoverService.displayPopover(u,this.renderer,this.viewContainerRef,tp,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,_,{},{},{},!0);E.tbComponentRef.instance.popover=E,E.tbComponentRef.instance.behaviorSettingsApplied.subscribe(w=>{E.hide(),this.behaviorRowFormGroup.patchValue({id:w.id,name:w.name,type:w.type},{emitEvent:!1}),this.modelValue=w,this.propagateChange(this.modelValue)}),E.tbDestroy.subscribe(()=>{Br(this.modelValue)||s()})}}focus(){this.idInput.nativeElement.scrollIntoView(),this.idInput.nativeElement.focus()}onAdd(e){this.idInput.nativeElement.scrollIntoView(),this.editBehavior(null,this.editButton,!0,e)}validate(e){let n=this.behaviorRowFormGroup.get("id");if(n.hasError("behaviorIdNotUnique")&&n.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),n.hasError("behaviorIdNotUnique"))return this.behaviorRowFormGroup.get("id").markAsTouched(),{behaviorIdNotUnique:!0};let t=_e(_e({},this.modelValue),this.behaviorRowFormGroup.value);return Br(t)?null:{behavior:!0}}behaviorIdValidator(){return e=>e.value?this.behaviorsComponent.behaviorIdUnique(e.value,this.index)?null:{behaviorIdNotUnique:!0}:{required:!0}}onTypeChanged(e){let n=Ue(this.modelValue);this.modelValue=$i(_e({},this.modelValue),{type:e}),this.modelValue=Vf(this.modelValue),Br(this.modelValue)||this.editBehavior(null,this.editButton,!1,()=>{this.modelValue=n,this.behaviorRowFormGroup.patchValue({type:n.type},{emitEvent:!0})})}updateModel(){let e=this.behaviorRowFormGroup.value;this.modelValue=_e(_e({},this.modelValue),e),this.propagateChange(this.modelValue)}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(Xe),g(Sn),g(un),g(ki),g(Jo))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-metadata-behavior-row"]],viewQuery:function(n,t){if(n&1&&(be(GC,5),be(UC,5)),n&2){let s;ve(s=ye())&&(t.idInput=s.first),ve(s=ye())&&(t.editButton=s.first)}},inputs:{disabled:"disabled",index:"index",aliasController:"aliasController",callbacks:"callbacks"},outputs:{behaviorRemoved:"behaviorRemoved"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:18,vars:12,consts:[["idInput",""],["editButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-behavior-row",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-id-field"],["required","","matInput","","formControlName","id",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-name-field"],["required","","matInput","","formControlName","name",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-type-field","fixed-height"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[1,"tb-form-table-row-cell-buttons"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[3,"value"]],template:function(n,t){if(n&1){let s=O();a(0,"div",2)(1,"mat-form-field",3),f(2,"input",4,0),d(4,"translate"),r(),a(5,"mat-form-field",5),f(6,"input",6),d(7,"translate"),r(),a(8,"mat-form-field",7)(9,"mat-select",8),b(10,qC,3,4,"mat-option",9),r()(),a(11,"div",10)(12,"button",11,1),d(14,"translate"),y("click",function(_){x(s);let E=U(13);return I(t.editBehavior(_,E))}),a(15,"mat-icon"),p(16,"settings"),r()(),b(17,WC,4,3,"button",12),r()()}n&2&&(l("formGroup",t.behaviorRowFormGroup),o(2),T("placeholder",c(4,6,"widget-config.set")),o(4),T("placeholder",c(7,8,"widget-config.set")),o(4),l("ngForOf",t.scadaSymbolBehaviorTypes),o(2),T("matTooltip",c(14,10,"scada.behavior.behavior-settings")),o(5),l("ngIf",!t.disabled))},dependencies:[we,V,Ce,ee,ge,me,St,ct,Dt,ue,W,z,ce,X,oe,k],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-behavior-row .tb-id-field,.tb-scada-symbol-metadata-behavior-row .tb-name-field{flex:1 1 40%}.tb-scada-symbol-metadata-behavior-row .tb-type-field{flex:1 1 20%}
`],encapsulation:2})}}return i})();function HC(i,m){if(i&1&&(a(0,"button",17),d(1,"translate"),a(2,"mat-icon"),p(3,"drag_indicator"),r()()),i&2){let e=v(3);L("tb-hidden",!e.dragEnabled),T("matTooltip",c(1,3,"action.drag"))}}function zC(i,m){if(i&1){let e=O();a(0,"div",13)(1,"tb-scada-symbol-metadata-behavior-row",14),y("behaviorRemoved",function(){let t=x(e).index,s=v(2);return I(s.removeBehavior(t))}),r(),a(2,"div",15),b(3,HC,4,5,"button",16),r()()}if(i&2){let e=m.$implicit,n=m.index,t=v(2);L("tb-draggable-form-table-row",!t.disabled),l("cdkDragDisabled",!t.dragEnabled),o(),l("index",n)("formControl",e)("aliasController",t.aliasController)("callbacks",t.callbacks),o(2),l("ngIf",!t.disabled)}}function $C(i,m){if(i&1){let e=O();a(0,"div",11),y("cdkDropListDropped",function(t){x(e);let s=v();return I(s.behaviorDrop(t))}),b(1,zC,4,8,"div",12),r()}if(i&2){let e=v();l("cdkDropListDisabled",!e.dragEnabled),o(),l("ngForOf",e.behaviorsFormArray().controls)("ngForTrackBy",e.trackByBehavior)}}function QC(i,m){if(i&1&&f(0,"tb-error",18),i&2){let e=v();l("error",e.errorText)}}function JC(i,m){if(i&1){let e=O();a(0,"div")(1,"button",19),y("click",function(){x(e);let t=v();return I(t.addBehavior())}),p(2),d(3,"translate"),r()()}i&2&&(o(2),h(" ",c(3,1,"scada.behavior.add-behavior")," "))}function KC(i,m){i&1&&(a(0,"span",20),p(1),d(2,"translate"),r()),i&2&&(o(),R(c(2,1,"scada.behavior.no-behaviors")))}var Jo=(()=>{class i{get dragEnabled(){return!this.disabled&&this.behaviorsFormArray().controls.length>1}constructor(e,n){this.fb=e,this.translate=n,this.styleDisplay="flex",this.styleOverflow="hidden",this.errorText="",this.propagateChange=t=>{}}ngOnInit(){this.behaviorsFormGroup=this.fb.group({behaviors:this.fb.array([])}),this.behaviorsFormGroup.valueChanges.subscribe(()=>{let e=this.behaviorsFormGroup.get("behaviors").value;e&&(e=e.filter(n=>Br(n))),this.propagateChange(e)})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.behaviorsFormGroup.disable({emitEvent:!1}):this.behaviorsFormGroup.enable({emitEvent:!1})}writeValue(e){let n=e||[];this.behaviorsFormGroup.setControl("behaviors",this.prepareBehaviorsFormArray(n),{emitEvent:!1})}validate(e){this.errorText="";let t=this.behaviorsFormGroup.get("behaviors").controls.filter(u=>u.hasError("behaviorIdNotUnique"));for(let u of t)u.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),u.hasError("behaviorIdNotUnique")&&(this.errorText=this.translate.instant("scada.behavior.not-unique-behavior-ids-error"));return this.behaviorsFormGroup.valid?null:{behaviors:{valid:!1}}}behaviorIdUnique(e,n){let t=this.behaviorsFormGroup.get("behaviors");for(let s=0;s<t.controls.length;s++)if(s!==n){let u=t.controls[s];if(e===u.value.id)return!1}return!0}behaviorDrop(e){let n=this.behaviorsFormGroup.get("behaviors"),t=n.at(e.previousIndex);n.removeAt(e.previousIndex),n.insert(e.currentIndex,t)}behaviorsFormArray(){return this.behaviorsFormGroup.get("behaviors")}trackByBehavior(e,n){return n}removeBehavior(e,n=!0){this.behaviorsFormGroup.get("behaviors").removeAt(e,{emitEvent:n})}addBehavior(){let e={id:"",name:"",type:pn.value,valueType:Ji.BOOLEAN,defaultGetValueSettings:ga({},tl(Ji.BOOLEAN))},n=this.behaviorsFormGroup.get("behaviors"),t=this.fb.control(e,[]);n.push(t),setTimeout(()=>{this.behaviorRows.get(this.behaviorRows.length-1).onAdd(()=>{this.removeBehavior(n.length-1)})})}prepareBehaviorsFormArray(e){let n=[];return e&&e.forEach(t=>{n.push(this.fb.control(t,[]))}),this.fb.array(n)}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(ie))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-metadata-behaviors"]],viewQuery:function(n,t){if(n&1&&be(Vr,5),n&2){let s;ve(s=ye())&&(t.behaviorRows=s)}},hostVars:4,hostBindings:function(n,t){n&2&&Qi("display",t.styleDisplay)("overflow",t.styleOverflow)},inputs:{aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:15,vars:8,consts:[["noBehaviors",""],[1,"tb-form-panel","tb-scada-symbol-behaviors"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-id-header"],["translate","",1,"tb-form-table-header-cell","tb-name-header"],["translate","",1,"tb-form-table-header-cell","tb-type-header"],[1,"tb-form-table-header-cell","tb-actions-header"],["class","tb-form-table-body tb-drop-list","cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDisabled","cdkDropListDropped",4,"ngIf","ngIfElse"],["noMargin","","style","padding-left: 12px;",3,"error",4,"ngIf"],[4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-form-table-body","tb-drop-list",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","",3,"cdkDragDisabled","tb-draggable-form-table-row",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",3,"cdkDragDisabled"],[1,"flex-1",3,"behaviorRemoved","index","formControl","aliasController","callbacks"],[1,"tb-form-table-row-cell-buttons"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"tb-hidden","matTooltip",4,"ngIf"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"matTooltip"],["noMargin","",2,"padding-left","12px",3,"error"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(n,t){if(n&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),p(4,"scada.behavior.id"),r(),a(5,"div",5),p(6,"scada.behavior.name"),r(),a(7,"div",6),p(8,"scada.behavior.type"),r(),f(9,"div",7),r(),b(10,$C,2,3,"div",8)(11,QC,1,1,"tb-error",9),r(),b(12,JC,4,3,"div",10),r(),b(13,KC,3,3,"ng-template",null,0,xt)),n&2){let s=U(14);o(2),L("no-padding-right",!t.disabled),o(7),L("disabled",t.disabled),o(),l("ngIf",t.behaviorsFormArray().controls.length)("ngIfElse",s),o(),l("ngIf",t.errorText),o(),l("ngIf",!t.disabled)}},styles:[`@charset "UTF-8";.tb-scada-symbol-behaviors{flex:1;margin:12px}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-id-header,.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-name-header{flex:1 1 40%}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-type-header{flex:1 1 20%}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-actions-header{width:120px;min-width:120px}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-actions-header.disabled{width:40px;min-width:40px}.tb-scada-symbol-behaviors .tb-form-table{overflow:hidden}.tb-scada-symbol-behaviors .tb-form-table-body{overflow:auto}.tb-scada-symbol-behaviors .tb-form-table-body tb-scada-symbol-metadata-behavior-row{overflow:hidden}
`],encapsulation:2})}}return i})();C();C();C();var YC=(i,m)=>[i,m];function XC(i,m){if(i&1&&(a(0,"mat-option",28),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.scadaSymbolPropertyTypeTranslations.get(e))," ")}}function ZC(i,m){i&1&&(a(0,"mat-form-field",5),f(1,"input",29),d(2,"translate"),r()),i&2&&(o(),T("placeholder",c(2,1,"widget-config.set")))}function e2(i,m){i&1&&f(0,"tb-color-input",30)}function t2(i,m){if(i&1&&f(0,"tb-color-settings",31),i&2){let e=v();T("settingsKey",e.propertyFormGroup.get("id").value)}}function i2(i,m){if(i&1&&(a(0,"mat-form-field",32),f(1,"input",33),d(2,"translate"),r()),i&2){let e=v();o(),T("placeholder",c(2,4,"widget-config.set")),l("min",e.propertyFormGroup.get("min").value)("max",e.propertyFormGroup.get("max").value)("step",e.propertyFormGroup.get("step").value)}}function n2(i,m){i&1&&f(0,"tb-font-settings",34)}function o2(i,m){i&1&&f(0,"tb-unit-input",35)}function a2(i,m){if(i&1&&f(0,"tb-value-input",36),i&2){let e=v();l("valueType",e.ValueType.BOOLEAN)}}function r2(i,m){i&1&&f(0,"tb-material-icon-select",37)}function s2(i,m){i&1&&(a(0,"div",10)(1,"div",38),p(2,"scada.property.number-settings"),r(),a(3,"div",39)(4,"div",40),p(5,"scada.property.min"),r(),a(6,"mat-form-field",41),f(7,"input",42),d(8,"translate"),r(),f(9,"mat-divider",43),a(10,"div",40),p(11,"scada.property.max"),r(),a(12,"mat-form-field",41),f(13,"input",44),d(14,"translate"),r(),f(15,"mat-divider",43),a(16,"div",40),p(17,"scada.property.step"),r(),a(18,"mat-form-field",41),f(19,"input",45),d(20,"translate"),r()()()),i&2&&(o(7),T("placeholder",c(8,3,"widget-config.set")),o(6),T("placeholder",c(14,5,"widget-config.set")),o(6),T("placeholder",c(20,7,"widget-config.set")))}function l2(i,m){i&1&&(a(0,"div",10)(1,"div",4),p(2,"scada.property.input-field-suffix"),r(),a(3,"mat-form-field",5),f(4,"input",51),d(5,"translate"),r()()),i&2&&(o(4),T("placeholder",c(5,1,"widget-config.set")))}function p2(i,m){if(i&1&&(a(0,"mat-option",28),p(1),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e," ")}}function m2(i,m){if(i&1&&(a(0,"mat-option",28),p(1),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e," ")}}function d2(i,m){if(i&1&&(a(0,"mat-option",28),p(1),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e," ")}}function c2(i,m){if(i&1&&(a(0,"div",3)(1,"div",4),p(2,"scada.property.property-field-classes"),r(),a(3,"mat-form-field",5)(4,"mat-select",52),d(5,"translate"),b(6,d2,2,2,"mat-option",9),r()()()),i&2){let e=v(2);o(4),T("placeholder",c(5,2,"widget-config.set")),o(2),l("ngForOf",e.scadaSymbolPropertyFieldClasses)}}function u2(i,m){if(i&1&&(a(0,"div",10)(1,"div",4),p(2,"scada.property.sub-label"),r(),a(3,"mat-form-field",5),f(4,"input",46),d(5,"translate"),r()(),a(6,"div",10)(7,"mat-slide-toggle",47),p(8),d(9,"translate"),r()(),b(10,l2,6,3,"div",19),a(11,"div",10)(12,"div",4),p(13,"scada.property.disable-on-property"),r(),a(14,"mat-form-field",5)(15,"mat-select",48),d(16,"translate"),f(17,"mat-option",28),b(18,p2,2,2,"mat-option",9),r()()(),a(19,"div",3)(20,"div",4),p(21,"scada.property.property-row-classes"),r(),a(22,"mat-form-field",5)(23,"mat-select",49),d(24,"translate"),b(25,m2,2,2,"mat-option",9),r()()(),b(26,c2,7,4,"div",50)),i&2){let e=v();o(4),T("placeholder",c(5,9,"widget-config.set")),o(4),h(" ",c(9,11,"scada.property.vertical-divider-after")," "),o(2),l("ngIf",ma(17,YC,e.ScadaSymbolPropertyType.number,e.ScadaSymbolPropertyType.text).includes(e.propertyFormGroup.get("type").value)),o(5),T("placeholder",c(16,13,"widget-config.set")),o(2),l("value",null),o(),l("ngForOf",e.booleanPropertyIds),o(5),T("placeholder",c(24,15,"widget-config.set")),o(2),l("ngForOf",e.scadaSymbolPropertyRowClasses),o(),l("ngIf",e.propertyFormGroup.get("type").value!==e.ScadaSymbolPropertyType.switch)}}function f2(i,m){if(i&1){let e=O();a(0,"button",53),y("click",function(){x(e);let t=v();return I(t.applyPropertySettings())}),p(1),d(2,"translate"),r()}if(i&2){let e=v();l("disabled",e.propertyFormGroup.invalid||!e.propertyFormGroup.dirty),o(),h(" ",c(2,2,e.isAdd?"action.add":"action.apply")," ")}}var ip=(()=>{class i{constructor(e){this.fb=e,this.ValueType=Ji,this.ScadaSymbolPropertyType=Xt,this.scadaSymbolPropertyTypes=Zs,this.scadaSymbolPropertyTypeTranslations=el,this.scadaSymbolPropertyRowClasses=Df,this.scadaSymbolPropertyFieldClasses=Pf,this.isAdd=!1,this.propertySettingsApplied=new rt}ngOnInit(){this.panelTitle=this.isAdd?"scada.property.add-property":"scada.property.property-settings",this.propertyType=this.property.type,this.propertyFormGroup=this.fb.group({id:[this.property.id,[S.required]],name:[this.property.name,[S.required]],type:[this.property.type,[S.required]],default:[this.property.default,[]],required:[this.property.required,[]],subLabel:[this.property.subLabel,[]],divider:[this.property.divider,[]],fieldSuffix:[this.property.fieldSuffix,[]],disableOnProperty:[this.property.disableOnProperty,[]],rowClass:[(this.property.rowClass||"").split(" "),[]],fieldClass:[(this.property.fieldClass||"").split(" "),[]],min:[this.property.min,[]],max:[this.property.max,[]],step:[this.property.step,[S.min(0)]]}),this.disabled?this.propertyFormGroup.disable({emitEvent:!1}):(this.propertyFormGroup.get("type").valueChanges.subscribe(()=>{this.updateValidators()}),this.updateValidators())}cancel(){this.popover?.hide()}applyPropertySettings(){let e=this.propertyFormGroup.getRawValue();e.rowClass=(e.rowClass||[]).join(" "),e.fieldClass=(e.fieldClass||[]).join(" "),this.propertySettingsApplied.emit(e)}updateValidators(){let e=this.propertyFormGroup.get("type").value;if(e===Xt.number?(this.propertyFormGroup.get("min").enable({emitEvent:!1}),this.propertyFormGroup.get("max").enable({emitEvent:!1}),this.propertyFormGroup.get("step").enable({emitEvent:!1})):(this.propertyFormGroup.get("min").disable({emitEvent:!1}),this.propertyFormGroup.get("max").disable({emitEvent:!1}),this.propertyFormGroup.get("step").disable({emitEvent:!1})),this.propertyType!==e){let n=Pc(e);this.propertyFormGroup.get("default").patchValue(n,{emitEvent:!1}),this.propertyType=e}}static{this.\u0275fac=function(n){return new(n||i)(g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-property-panel"]],inputs:{isAdd:"isAdd",property:"property",booleanPropertyIds:"booleanPropertyIds",disabled:"disabled",popover:"popover"},outputs:{propertySettingsApplied:"propertySettingsApplied"},decls:51,vars:30,consts:[[1,"tb-scada-symbol-property-settings-panel",3,"formGroup"],[1,"tb-scada-symbol-property-settings-title"],[1,"tb-scada-symbol-property-settings-panel-content"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["required","","matInput","","formControlName","id",3,"placeholder"],["required","","matInput","","formControlName","name",3,"placeholder"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[1,"tb-form-row","space-between"],["class","flex","appearance","outline","subscriptSizing","dynamic",4,"ngIf"],["asBoxInput","","colorClearButton","","formControlName","default",4,"ngIf"],["formControlName","default",3,"settingsKey",4,"ngIf"],["appearance","outline","class","number","subscriptSizing","dynamic",4,"ngIf"],["formControlName","default","clearButton","","disabledLineHeight","",4,"ngIf"],["formControlName","default",4,"ngIf"],["formControlName","default",3,"valueType",4,"ngIf"],["asBoxInput","","formControlName","default",4,"ngIf"],["class","tb-form-row space-between",4,"ngIf"],["formControlName","required",1,"mat-slide","fixed-title-width"],[1,"tb-form-panel","stroked"],[1,"tb-settings"],[1,"flex","flex-row","flex-wrap"],["matExpansionPanelContent",""],[1,"tb-scada-symbol-property-settings-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],[3,"value"],["matInput","","formControlName","default",3,"placeholder"],["asBoxInput","","colorClearButton","","formControlName","default"],["formControlName","default",3,"settingsKey"],["appearance","outline","subscriptSizing","dynamic",1,"number"],["matInput","","formControlName","default","type","number",3,"min","max","step","placeholder"],["formControlName","default","clearButton","","disabledLineHeight",""],["formControlName","default"],["formControlName","default",3,"valueType"],["asBoxInput","","formControlName","default"],["translate",""],[1,"flex","flex-1","flex-row","items-center","justify-end","gap-2"],["translate","",1,"tb-small-label"],["appearance","outline","subscriptSizing","dynamic",1,"number","flex"],["matInput","","formControlName","min","type","number",3,"placeholder"],["vertical",""],["matInput","","formControlName","max","type","number",3,"placeholder"],["matInput","","formControlName","step","min","0","type","number",3,"placeholder"],["matInput","","formControlName","subLabel",3,"placeholder"],["formControlName","divider",1,"mat-slide","fixed-title-width"],["formControlName","disableOnProperty",3,"placeholder"],["formControlName","rowClass","multiple","",3,"placeholder"],["class","tb-form-row",4,"ngIf"],["matInput","","formControlName","fieldSuffix",3,"placeholder"],["formControlName","fieldClass","multiple","",3,"placeholder"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1),p(2),d(3,"translate"),r(),a(4,"div",2)(5,"div",3)(6,"div",4),p(7,"scada.property.id"),r(),a(8,"mat-form-field",5),f(9,"input",6),d(10,"translate"),r()(),a(11,"div",3)(12,"div",4),p(13,"scada.property.name"),r(),a(14,"mat-form-field",5),f(15,"input",7),d(16,"translate"),r()(),a(17,"div",3)(18,"div",4),p(19,"scada.property.type"),r(),a(20,"mat-form-field",5)(21,"mat-select",8),b(22,XC,3,4,"mat-option",9),r()()(),a(23,"div",10)(24,"div",4),p(25,"scada.property.default-value"),r(),b(26,ZC,3,3,"mat-form-field",11)(27,e2,1,0,"tb-color-input",12)(28,t2,1,1,"tb-color-settings",13)(29,i2,3,6,"mat-form-field",14)(30,n2,1,0,"tb-font-settings",15)(31,o2,1,0,"tb-unit-input",16)(32,a2,1,1,"tb-value-input",17)(33,r2,1,0,"tb-material-icon-select",18),r(),b(34,s2,21,9,"div",19),a(35,"div",10)(36,"mat-slide-toggle",20),p(37),d(38,"translate"),r()(),a(39,"div",21)(40,"mat-expansion-panel",22)(41,"mat-expansion-panel-header",23)(42,"mat-panel-title"),p(43),d(44,"translate"),r()(),b(45,u2,27,20,"ng-template",24),r()()(),a(46,"div",25)(47,"button",26),y("click",function(){return t.cancel()}),p(48),d(49,"translate"),r(),b(50,f2,3,4,"button",27),r()()),n&2&&(l("formGroup",t.propertyFormGroup),o(2),R(c(3,18,t.panelTitle)),o(7),T("placeholder",c(10,20,"widget-config.set")),o(6),T("placeholder",c(16,22,"widget-config.set")),o(7),l("ngForOf",t.scadaSymbolPropertyTypes),o(4),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.text),o(),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.color),o(),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.color_settings),o(),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.number),o(),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.font),o(),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.units),o(),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.switch),o(),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.icon),o(),l("ngIf",t.propertyFormGroup.get("type").value===t.ScadaSymbolPropertyType.number),o(3),h(" ",c(38,24,"scada.property.value-required")," "),o(6),h(" ",c(44,26,"scada.property.advanced-ui-settings")," "),o(5),h(" ",c(49,28,t.disabled?"action.close":"action.cancel")," "),o(2),l("ngIf",!t.disabled))},dependencies:[we,V,g0,K,ge,me,St,ct,xi,it,bi,Oi,Bi,Ln,ue,Ti,W,z,ce,Li,tn,X,oe,of,To,H,Ef,cg,ug,k],styles:[`@charset "UTF-8";.tb-scada-symbol-property-settings-panel{width:540px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-property-settings-panel{width:90vw}}.tb-scada-symbol-property-settings-panel .tb-scada-symbol-property-settings-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-property-settings-panel .tb-scada-symbol-property-settings-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-property-settings-panel .tb-scada-symbol-property-settings-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();var g2=["idInput"],h2=["editButton"];function b2(i,m){if(i&1&&(a(0,"mat-option",13),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.scadaSymbolPropertyTypeTranslations.get(e))," ")}}function v2(i,m){if(i&1){let e=O();a(0,"button",11),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.propertyRemoved.emit())}),a(2,"mat-icon"),p(3,"delete"),r()()}i&2&&T("matTooltip",c(1,1,"scada.property.remove-property"))}var np=i=>!(!i.id||!i.name||!i.type),Pc=i=>{switch(i){case Xt.text:return"";case Xt.number:return 0;case Xt.switch:return!1;case Xt.color:return"#000";case Xt.color_settings:return d0("#000");case Xt.font:return{size:12,sizeUnit:"px",family:"Roboto",weight:"normal",style:"normal",lineHeight:"1"};case Xt.units:return"";case Xt.icon:return"star"}},Lr=(()=>{class i{constructor(e,n,t,s,u,_){this.fb=e,this.cd=n,this.popoverService=t,this.renderer=s,this.viewContainerRef=u,this.propertiesComponent=_,this.scadaSymbolPropertyTypes=Zs,this.scadaSymbolPropertyTypeTranslations=el,this.propertyRemoved=new rt,this.propagateChange=E=>{}}ngOnInit(){this.propertyRowFormGroup=this.fb.group({id:[null,[this.propertyIdValidator()]],name:[null,[S.required]],type:[null,[S.required]]}),this.propertyRowFormGroup.valueChanges.subscribe(()=>this.updateModel()),this.propertyRowFormGroup.get("type").valueChanges.subscribe(e=>{this.onTypeChanged(e)})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.propertyRowFormGroup.disable({emitEvent:!1}):this.propertyRowFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e,this.propertyRowFormGroup.patchValue({id:e?.id,name:e?.name,type:e?.type},{emitEvent:!1}),this.cd.markForCheck()}editProperty(e,n,t=!1,s=()=>{}){e&&e.stopPropagation();let u=n._elementRef.nativeElement;if(this.popoverService.hasPopover(u))this.popoverService.hidePopover(u);else{let _={isAdd:t,disabled:this.disabled,booleanPropertyIds:this.booleanPropertyIds,property:Ue(this.modelValue)},E=this.popoverService.displayPopover(u,this.renderer,this.viewContainerRef,ip,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,_,{},{},{},!0);E.tbComponentRef.instance.popover=E,E.tbComponentRef.instance.propertySettingsApplied.subscribe(w=>{E.hide(),this.propertyRowFormGroup.patchValue({id:w.id,name:w.name,type:w.type},{emitEvent:!1}),this.modelValue=w,this.propagateChange(this.modelValue)}),E.tbDestroy.subscribe(()=>{np(this.modelValue)||s()})}}focus(){this.idInput.nativeElement.scrollIntoView(),this.idInput.nativeElement.focus()}onAdd(e){this.idInput.nativeElement.scrollIntoView(),this.editProperty(null,this.editButton,!0,e)}validate(e){let n=this.propertyRowFormGroup.get("id");if(n.hasError("propertyIdNotUnique")&&n.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),n.hasError("propertyIdNotUnique"))return this.propertyRowFormGroup.get("id").markAsTouched(),{propertyIdNotUnique:!0};let t=_e(_e({},this.modelValue),this.propertyRowFormGroup.value);return np(t)?null:{property:!0}}propertyIdValidator(){return e=>e.value?this.propertiesComponent.propertyIdUnique(e.value,this.index)?null:{propertyIdNotUnique:!0}:{required:!0}}onTypeChanged(e){this.modelValue=$i(_e({},this.modelValue),{type:e}),this.modelValue.default=Pc(e)}updateModel(){let e=this.propertyRowFormGroup.value;this.modelValue=_e(_e({},this.modelValue),e),this.propagateChange(this.modelValue)}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(Xe),g(Sn),g(un),g(ki),g(Ko))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-metadata-property-row"]],viewQuery:function(n,t){if(n&1&&(be(g2,5),be(h2,5)),n&2){let s;ve(s=ye())&&(t.idInput=s.first),ve(s=ye())&&(t.editButton=s.first)}},inputs:{disabled:"disabled",index:"index",booleanPropertyIds:"booleanPropertyIds"},outputs:{propertyRemoved:"propertyRemoved"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:18,vars:12,consts:[["idInput",""],["editButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-property-row",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-id-field"],["required","","matInput","","formControlName","id",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-name-field"],["required","","matInput","","formControlName","name",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-type-field","fixed-height"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[1,"tb-form-table-row-cell-buttons"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[3,"value"]],template:function(n,t){if(n&1){let s=O();a(0,"div",2)(1,"mat-form-field",3),f(2,"input",4,0),d(4,"translate"),r(),a(5,"mat-form-field",5),f(6,"input",6),d(7,"translate"),r(),a(8,"mat-form-field",7)(9,"mat-select",8),b(10,b2,3,4,"mat-option",9),r()(),a(11,"div",10)(12,"button",11,1),d(14,"translate"),y("click",function(_){x(s);let E=U(13);return I(t.editProperty(_,E))}),a(15,"mat-icon"),p(16,"settings"),r()(),b(17,v2,4,3,"button",12),r()()}n&2&&(l("formGroup",t.propertyRowFormGroup),o(2),T("placeholder",c(4,6,"widget-config.set")),o(4),T("placeholder",c(7,8,"widget-config.set")),o(4),l("ngForOf",t.scadaSymbolPropertyTypes),o(2),T("matTooltip",c(14,10,"scada.property.property-settings")),o(5),l("ngIf",!t.disabled))},dependencies:[we,V,Ce,ee,ge,me,St,ct,Dt,ue,W,z,ce,X,oe,k],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-property-row .tb-id-field,.tb-scada-symbol-metadata-property-row .tb-name-field{flex:1 1 40%}.tb-scada-symbol-metadata-property-row .tb-type-field{flex:1 1 20%}
`],encapsulation:2})}}return i})();function y2(i,m){if(i&1&&(a(0,"button",17),d(1,"translate"),a(2,"mat-icon"),p(3,"drag_indicator"),r()()),i&2){let e=v(3);L("tb-hidden",!e.dragEnabled),T("matTooltip",c(1,3,"action.drag"))}}function _2(i,m){if(i&1){let e=O();a(0,"div",13)(1,"tb-scada-symbol-metadata-property-row",14),y("propertyRemoved",function(){let t=x(e).index,s=v(2);return I(s.removeProperty(t))}),r(),a(2,"div",15),b(3,y2,4,5,"button",16),r()()}if(i&2){let e=m.$implicit,n=m.index,t=v(2);L("tb-draggable-form-table-row",!t.disabled),l("cdkDragDisabled",!t.dragEnabled),o(),l("index",n)("booleanPropertyIds",t.booleanPropertyIds)("formControl",e),o(2),l("ngIf",!t.disabled)}}function C2(i,m){if(i&1){let e=O();a(0,"div",11),y("cdkDropListDropped",function(t){x(e);let s=v();return I(s.propertyDrop(t))}),b(1,_2,4,7,"div",12),r()}if(i&2){let e=v();l("cdkDropListDisabled",!e.dragEnabled),o(),l("ngForOf",e.propertiesFormArray().controls)("ngForTrackBy",e.trackByProperty)}}function S2(i,m){if(i&1&&f(0,"tb-error",18),i&2){let e=v();l("error",e.errorText)}}function T2(i,m){if(i&1){let e=O();a(0,"div")(1,"button",19),y("click",function(){x(e);let t=v();return I(t.addProperty())}),p(2),d(3,"translate"),r()()}i&2&&(o(2),h(" ",c(3,1,"scada.property.add-property")," "))}function x2(i,m){i&1&&(a(0,"span",20),p(1),d(2,"translate"),r()),i&2&&(o(),R(c(2,1,"scada.property.no-properties")))}var Ko=(()=>{class i{get dragEnabled(){return!this.disabled&&this.propertiesFormArray().controls.length>1}constructor(e,n){this.fb=e,this.translate=n,this.styleDisplay="flex",this.styleOverflow="hidden",this.booleanPropertyIds=[],this.errorText="",this.propagateChange=t=>{}}ngOnInit(){this.propertiesFormGroup=this.fb.group({properties:this.fb.array([])}),this.propertiesFormGroup.valueChanges.subscribe(()=>{let e=this.propertiesFormGroup.get("properties").value;e&&(e=e.filter(n=>np(n))),this.booleanPropertyIds=e.filter(n=>n.type===Xt.switch).map(n=>n.id),e.forEach((n,t)=>{n.disableOnProperty&&!this.booleanPropertyIds.includes(n.disableOnProperty)&&(n.disableOnProperty=null,this.propertiesFormArray().controls[t].patchValue(n,{emitEvent:!1}))}),this.propagateChange(e)})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.propertiesFormGroup.disable({emitEvent:!1}):this.propertiesFormGroup.enable({emitEvent:!1})}writeValue(e){let n=e||[];this.propertiesFormGroup.setControl("properties",this.preparePropertiesFormArray(n),{emitEvent:!1}),this.booleanPropertyIds=n.filter(t=>t.type===Xt.switch).map(t=>t.id)}validate(e){this.errorText="";let t=this.propertiesFormGroup.get("properties").controls.filter(u=>u.hasError("propertyIdNotUnique"));for(let u of t)u.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),u.hasError("propertyIdNotUnique")&&(this.errorText=this.translate.instant("scada.property.not-unique-property-ids-error"));return this.propertiesFormGroup.valid?null:{properties:{valid:!1}}}propertyIdUnique(e,n){let t=this.propertiesFormGroup.get("properties");for(let s=0;s<t.controls.length;s++)if(s!==n){let u=t.controls[s];if(e===u.value.id)return!1}return!0}propertyDrop(e){let n=this.propertiesFormGroup.get("properties"),t=n.at(e.previousIndex);n.removeAt(e.previousIndex),n.insert(e.currentIndex,t)}propertiesFormArray(){return this.propertiesFormGroup.get("properties")}trackByProperty(e,n){return n}removeProperty(e,n=!0){this.propertiesFormGroup.get("properties").removeAt(e,{emitEvent:n})}addProperty(){let e={id:"",name:"",type:Xt.text,default:""},n=this.propertiesFormGroup.get("properties"),t=this.fb.control(e,[]);n.push(t),setTimeout(()=>{this.propertyRows.get(this.propertyRows.length-1).onAdd(()=>{this.removeProperty(n.length-1)})})}preparePropertiesFormArray(e){let n=[];return e&&e.forEach(t=>{n.push(this.fb.control(t,[]))}),this.fb.array(n)}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(ie))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-metadata-properties"]],viewQuery:function(n,t){if(n&1&&be(Lr,5),n&2){let s;ve(s=ye())&&(t.propertyRows=s)}},hostVars:4,hostBindings:function(n,t){n&2&&Qi("display",t.styleDisplay)("overflow",t.styleOverflow)},inputs:{disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:15,vars:8,consts:[["noProperties",""],[1,"tb-form-panel","tb-scada-symbol-properties"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-id-header"],["translate","",1,"tb-form-table-header-cell","tb-name-header"],["translate","",1,"tb-form-table-header-cell","tb-type-header"],[1,"tb-form-table-header-cell","tb-actions-header"],["class","tb-form-table-body tb-drop-list","cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDisabled","cdkDropListDropped",4,"ngIf","ngIfElse"],["noMargin","","style","padding-left: 12px;",3,"error",4,"ngIf"],[4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-form-table-body","tb-drop-list",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","",3,"cdkDragDisabled","tb-draggable-form-table-row",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",3,"cdkDragDisabled"],[1,"flex-1",3,"propertyRemoved","index","booleanPropertyIds","formControl"],[1,"tb-form-table-row-cell-buttons"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"tb-hidden","matTooltip",4,"ngIf"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"matTooltip"],["noMargin","",2,"padding-left","12px",3,"error"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(n,t){if(n&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),p(4,"scada.property.id"),r(),a(5,"div",5),p(6,"scada.property.name"),r(),a(7,"div",6),p(8,"scada.property.type"),r(),f(9,"div",7),r(),b(10,C2,2,3,"div",8)(11,S2,1,1,"tb-error",9),r(),b(12,T2,4,3,"div",10),r(),b(13,x2,3,3,"ng-template",null,0,xt)),n&2){let s=U(14);o(2),L("no-padding-right",!t.disabled),o(7),L("disabled",t.disabled),o(),l("ngIf",t.propertiesFormArray().controls.length)("ngIfElse",s),o(),l("ngIf",t.errorText),o(),l("ngIf",!t.disabled)}},styles:[`@charset "UTF-8";.tb-scada-symbol-properties{flex:1;margin:12px}.tb-scada-symbol-properties .tb-form-table-header-cell.tb-id-header,.tb-scada-symbol-properties .tb-form-table-header-cell.tb-name-header{flex:1 1 40%}.tb-scada-symbol-properties .tb-form-table-header-cell.tb-type-header{flex:1 1 20%}.tb-scada-symbol-properties .tb-form-table-header-cell.tb-actions-header{width:120px;min-width:120px}.tb-scada-symbol-properties .tb-form-table-header-cell.tb-actions-header.disabled{width:40px;min-width:40px}.tb-scada-symbol-properties .tb-form-table{overflow:hidden}.tb-scada-symbol-properties .tb-form-table-body{overflow:auto}.tb-scada-symbol-properties .tb-form-table-body tb-scada-symbol-metadata-property-row{overflow:hidden}
`],encapsulation:2})}}return i})();var I2=["symbolMetadataTags"],E2=[[["",8,"tb-scada-symbol-metadata-header-prefix"]],[["",8,"tb-scada-symbol-metadata-header-suffix"]]],w2=[".tb-scada-symbol-metadata-header-prefix",".tb-scada-symbol-metadata-header-suffix"],M2=()=>["ctx","svg"];function D2(i,m){if(i&1&&f(0,"tb-js-func",28),i&2){let e=v();l("editorCompleter",e.generalStateRenderFunctionCompleter)("highlightRules",e.highlightRules)("functionArgs",Rt(3,M2))}}var jr=(()=>{class i extends It{constructor(e,n,t,s){super(e),this.store=e,this.fb=n,this.translate=t,this.customTranslate=s,this.propagateChange=null,this.headerOptions=[{name:this.translate.instant("scada.general"),value:"general"},{name:this.translate.instant("scada.tags"),value:"tags"},{name:this.translate.instant("scada.behavior.behavior"),value:"behavior"},{name:this.translate.instant("scada.properties"),value:"properties"}],this.selectedOption="general",this.highlightRules=sh}ngOnInit(){this.metadataFormGroup=this.fb.group({title:[null,[S.required]],description:[null],searchTags:[null],widgetSizeX:[null,[S.min(1),S.max(24),S.required]],widgetSizeY:[null,[S.min(1),S.max(24),S.required]],stateRenderFunction:[null],tags:[null],behavior:[null],properties:[null]}),this.updateFunctionCompleters(Ff()),this.metadataFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}ngOnChanges(e){for(let n of Object.keys(e)){let t=e[n];!t.firstChange&&t.currentValue!==t.previousValue&&["tags"].includes(n)&&this.updateFunctionCompleters(this.modelValue)}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.metadataFormGroup.disable({emitEvent:!1}):this.metadataFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e,this.metadataFormGroup.patchValue({title:e?.title,description:e?.description,searchTags:e?.searchTags,widgetSizeX:e?.widgetSizeX||3,widgetSizeY:e?.widgetSizeY||3,stateRenderFunction:e?.stateRenderFunction,tags:e?.tags,behavior:e?.behavior,properties:e?.properties},{emitEvent:!1}),this.updateFunctionCompleters(e)}editTagStateRenderFunction(e){this.selectedOption="tags",this.symbolMetadataTags.editTagStateRenderFunction(e)}editTagClickAction(e){this.selectedOption="tags",this.symbolMetadataTags.editTagClickAction(e)}validate(e){return this.metadataFormGroup.valid?null:{metadata:{valid:!1}}}updateModel(){let e=this.metadataFormGroup.getRawValue();this.modelValue=e,this.propagateChange(this.modelValue),this.updateFunctionCompleters(e)}updateFunctionCompleters(e){let n=ch(e,this.tags,this.customTranslate),t=mh(n);this.generalStateRenderFunctionCompleter?this.generalStateRenderFunctionCompleter.updateCompletions(t):this.generalStateRenderFunctionCompleter=new Ua(t);let s=Mc(n);this.elementStateRenderFunctionCompleter?this.elementStateRenderFunctionCompleter.updateCompletions(s):this.elementStateRenderFunctionCompleter=new Ua(s);let u=dh(n);this.clickActionFunctionCompleter?this.clickActionFunctionCompleter.updateCompletions(u):this.clickActionFunctionCompleter=new Ua(u)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se),g(ie),g(Ya))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol-metadata"]],viewQuery:function(n,t){if(n&1&&be(I2,5),n&2){let s;ve(s=ye())&&(t.symbolMetadataTags=s.first)}},inputs:{aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled",tags:"tags"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}]),G,Fn],ngContentSelectors:w2,decls:55,vars:40,consts:[["symbolMetadataTags",""],[1,"tb-scada-symbol-metadata","tb-absolute-fill"],[1,"tb-scada-symbol-metadata-header"],["appearance","fill",3,"ngModelChange","options","ngModel"],[1,"tb-scada-symbol-metadata-header-components"],[1,"tb-scada-symbol-metadata-content",3,"formGroup"],[1,"mat-content"],[1,"tb-form-panel"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["matInput","","required","","formControlName","title",3,"placeholder"],["matInput","","formControlName","description","rows","2"],[1,"flex","flex-1","flex-row","items-center","justify-start"],["formControlName","searchTags","appearance","outline","subscriptSizing","dynamic",1,"flex-1",2,"display","flex"],[1,"flex","flex-1","flex-row","items-center","justify-end","gap-2"],[1,"tb-small-label"],["appearance","outline","subscriptSizing","dynamic",1,"number","flex"],["matInput","","formControlName","widgetSizeX","required","","type","number",3,"min","max","step","placeholder"],["matInput","","formControlName","widgetSizeY","required","","type","number",3,"min","max","step","placeholder"],[1,"tb-form-panel","stroked"],["expanded","",1,"tb-settings"],[1,"flex","flex-row","flex-wrap"],["matExpansionPanelContent",""],[1,"mat-content","overflow-hidden"],["formControlName","tags",3,"tags","clickActionFunctionCompleter","elementStateRenderFunctionCompleter"],["formControlName","behavior",3,"aliasController","callbacks"],["formControlName","properties"],["formControlName","stateRenderFunction","minHeight","300px","helpId","scada/symbol_state_render_fn",3,"editorCompleter","highlightRules","functionArgs"]],template:function(n,t){if(n&1){let s=O();pa(E2),a(0,"div",1)(1,"div",2)(2,"tb-toggle-select",3),pt("ngModelChange",function(_){return x(s),lt(t.selectedOption,_)||(t.selectedOption=_),I(_)}),r(),a(3,"div",4),uo(4),uo(5,1),r()(),a(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9),p(11,"scada.title"),r(),a(12,"mat-form-field",10),f(13,"input",11),d(14,"translate"),r()(),a(15,"div",8)(16,"div",9),p(17,"scada.description"),r(),a(18,"mat-form-field",10),f(19,"textarea",12),r()(),a(20,"div",8)(21,"div",9),p(22,"scada.search-tags"),r(),a(23,"div",13),f(24,"tb-string-items-list",14),r()(),a(25,"div",8)(26,"div",9),p(27,"scada.widget-size"),r(),a(28,"div",15)(29,"div",16),p(30),d(31,"translate"),r(),a(32,"mat-form-field",17),f(33,"input",18),d(34,"translate"),r(),a(35,"div",16),p(36),d(37,"translate"),r(),a(38,"mat-form-field",17),f(39,"input",19),d(40,"translate"),r()()(),a(41,"div",20)(42,"mat-expansion-panel",21)(43,"mat-expansion-panel-header",22)(44,"mat-panel-title"),p(45),d(46,"translate"),r()(),b(47,D2,1,4,"ng-template",23),r()()()(),a(48,"div",24),f(49,"tb-scada-symbol-metadata-tags",25,0),r(),a(51,"div",24),f(52,"tb-scada-symbol-metadata-behaviors",26),r(),a(53,"div",24),f(54,"tb-scada-symbol-metadata-properties",27),r()()()}n&2&&(o(2),l("options",t.headerOptions),st("ngModel",t.selectedOption),o(4),l("formGroup",t.metadataFormGroup),o(),L("!hidden",t.selectedOption!=="general"),o(6),T("placeholder",c(14,28,"widget-config.set")),o(17),R(c(31,30,"scada.cols")),o(3),T("placeholder",c(34,32,"widget-config.set")),l("min",1)("max",24)("step",1),o(3),R(c(37,34,"scada.rows")),o(3),T("placeholder",c(40,36,"widget-config.set")),l("min",1)("max",24)("step",1),o(6),h(" ",c(46,38,"scada.state-render-function")," "),o(3),L("!hidden",t.selectedOption!=="tags"),o(),l("tags",t.tags)("clickActionFunctionCompleter",t.clickActionFunctionCompleter)("elementStateRenderFunctionCompleter",t.elementStateRenderFunctionCompleter),o(2),L("!hidden",t.selectedOption!=="behavior"),o(),l("aliasController",t.aliasController)("callbacks",t.callbacks),o(),L("!hidden",t.selectedOption!=="properties"))},dependencies:[Un,js,ge,me,bi,Oi,Bi,Ln,ue,Ti,W,z,ce,Li,tn,ut,X,oe,H,Wn,ep,Jo,Ko,k],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata{display:flex;flex-direction:column;gap:8px}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header{padding:24px 24px 0;display:flex;gap:12px;flex-direction:column-reverse;align-items:flex-start}@media screen and (min-width: 960px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header{gap:0;flex-direction:row;align-items:center;justify-content:space-between}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header .tb-scada-symbol-metadata-header-components{width:100%;flex:1;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content{display:flex;flex:1;overflow:auto}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>.mat-content{padding-top:8px}@media screen and (max-width: 599px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>.mat-content{padding-left:8px;padding-right:8px}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>div{padding:16px}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content{display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 599px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content{gap:8px}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content.overflow-hidden{overflow:hidden}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .tb-form-panel .mat-expansion-panel.tb-settings>.mat-expansion-panel-header{font-weight:400}.tb-js-func .ace_tb.ace_scada-symbol-ctx{color:#c52f00}.tb-js-func .ace_tb.ace_scada-symbol-ctx-properties,.tb-js-func .ace_tb.ace_scada-symbol-ctx-property{color:#185f2a}.tb-js-func .ace_tb.ace_scada-symbol-ctx-values,.tb-js-func .ace_tb.ace_scada-symbol-ctx-value{color:#2caa00}.tb-js-func .ace_tb.ace_scada-symbol-ctx-tags,.tb-js-func .ace_tb.ace_scada-symbol-ctx-tag{color:#df8600}.tb-js-func .ace_tb.ace_scada-symbol-ctx-api,.tb-js-func .ace_tb.ace_scada-symbol-ctx-api-method{color:#7214d0}.tb-js-func .ace_tb.ace_scada-symbol-ctx-svg,.tb-js-func .ace_tb.ace_scada-symbol-ctx-svg-method{color:#c24c1a}.tb-js-func .ace_tb.ace_scada-symbol-ctx-property,.tb-js-func .ace_tb.ace_scada-symbol-ctx-value,.tb-js-func .ace_tb.ace_scada-symbol-ctx-tag,.tb-js-func .ace_tb.ace_scada-symbol-ctx-api-method{font-weight:700}.tb-js-func .ace_tb.ace_scada-symbol-svg,.tb-js-func .ace_tb.ace_scada-symbol-element,.tb-js-func .ace_tb.ace_scada-symbol-event{color:#c52f00}.tb-js-func .ace_tb.ace_scada-symbol-svg-properties,.tb-js-func .ace_tb.ace_scada-symbol-element-properties,.tb-js-func .ace_tb.ace_scada-symbol-event-properties{color:#7214d0;font-weight:700}
`],encapsulation:2})}}return i})();var N2=["symbolEditor"],k2=["symbolMetadata"];function R2(i,m){if(i&1){let e=O();a(0,"div",22)(1,"div",23)(2,"button",24),y("click",function(){x(e);let t=v();return I(t.exitPreviewMode())}),a(3,"mat-icon"),p(4,"chevron_left"),r(),p(5),d(6,"translate"),r(),f(7,"span",25),a(8,"button",26),y("click",function(){x(e);let t=v();return I(t.onRevertPreviewSettings())}),a(9,"mat-icon"),p(10,"close"),r(),p(11),d(12,"translate"),r(),a(13,"button",27),y("click",function(){x(e);let t=v();return I(t.onApplyPreviewSettings())}),a(14,"mat-icon"),p(15,"done"),r(),p(16),d(17,"translate"),r()(),a(18,"div",28)(19,"div",29)(20,"div",30)(21,"div",31),p(22,"scada.symbol.symbol"),r(),f(23,"tb-scada-symbol-input",32),r(),f(24,"tb-scada-symbol-object-settings",33),r()()()}if(i&2){let e=v();o(5),h(" ",c(6,12,"action.back")," "),o(3),l("disabled",!e.scadaPreviewFormGroup.dirty),o(3),h(" ",c(12,14,"action.decline")," "),o(2),l("disabled",!e.scadaPreviewFormGroup.valid||!e.scadaPreviewFormGroup.dirty),o(3),h(" ",c(17,16,"action.apply")," "),o(2),l("formGroup",e.scadaPreviewFormGroup),o(5),l("scadaSymbolContent",e.symbolData.scadaSymbolContent)("scadaSymbolMetadata",e.previewMetadata),o(),l("scadaSymbolMetadata",e.previewMetadata)("aliasController",e.aliasController)("widgetType",e.widgetType.rpc)("callbacks",e.widgetActionCallbacks)}}function O2(i,m){if(i&1){let e=O();a(0,"div",34)(1,"button",26),y("click",function(){x(e);let t=v();return I(t.onRevertScadaSymbolConfig())}),a(2,"mat-icon"),p(3,"close"),r(),p(4),d(5,"translate"),r(),a(6,"button",27),y("click",function(){x(e);let t=v();return I(t.onApplyScadaSymbolConfig())}),a(7,"mat-icon"),p(8,"done"),r(),p(9),d(10,"translate"),r()()}if(i&2){let e=v();o(),l("disabled",!(e.scadaSymbolFormGroup.dirty||e.symbolEditorDirty)),o(3),h(" ",c(5,4,"action.decline")," "),o(2),l("disabled",!e.scadaSymbolFormGroup.valid||!e.symbolEditorValid||!(e.scadaSymbolFormGroup.dirty||e.symbolEditorDirty)),o(3),h(" ",c(10,6,"action.apply")," ")}}function B2(i,m){if(i&1){let e=O();a(0,"tb-scada-symbol-editor",35,1),pt("showHiddenElementsChange",function(t){x(e);let s=v();return lt(s.showHiddenElements,t)||(s.showHiddenElements=t),I(t)}),y("updateScadaSymbol",function(){x(e);let t=v();return I(t.updateScadaSymbol())})("downloadScadaSymbol",function(){x(e);let t=v();return I(t.downloadScadaSymbol())}),r()}if(i&2){let e=v();l("readonly",e.readonly),st("showHiddenElements",e.showHiddenElements),l("data",e.symbolEditorData)("editObjectCallbacks",e.editObjectCallbacks)}}function V2(i,m){if(i&1&&f(0,"tb-dashboard",36),i&2){let e=v();l("aliasController",e.aliasController)("widgets",e.previewWidgets)("autofillHeight",!1)("gridType",e.previewWidget.sizeX>=e.previewWidget.sizeY?e.GridType.ScrollVertical:e.GridType.ScrollHorizontal)("columns",e.previewWidget.sizeX)("centerVertical",e.previewWidget.sizeX>=e.previewWidget.sizeY)("centerHorizontal",e.previewWidget.sizeX<e.previewWidget.sizeY)("margin",0)("isEdit",!1)("isMobileDisabled",!0)("isEditActionEnabled",!1)("isRemoveActionEnabled",!1)}}var op=(()=>{class i extends It{get isDirty(){return(this.scadaSymbolFormGroup.dirty||this.symbolEditorDirty)&&!this.forcePristine}set isDirty(e){this.forcePristine=!e}constructor(e,n,t,s,u,_,E,w,q,Te){super(e),this.store=e,this.route=n,this.fb=t,this.cd=s,this.entityService=u,this.utils=_,this.translate=E,this.imageService=w,this.widgetService=q,this.dialog=Te,this.widgetType=Fi,this.GridType=r0,this.width="100%",this.height="100%",this.previewMode=!1,this.destroy$=new Ft,this.updateBreadcrumbs=new rt,this.widgetActionCallbacks={fetchDashboardStates:()=>[],fetchCellClickColumns:()=>[]},this.previewWidgets=[],this.editObjectCallbacks=this,this.symbolEditorDirty=!1,this.symbolEditorValid=!0,this.forcePristine=!1,this.authUser=Bt(this.store),this.showHiddenElements=!1}ngOnInit(){this.scadaSymbolFormGroup=this.fb.group({metadata:[null]}),this.scadaPreviewFormGroup=this.fb.group({scadaSymbolObjectSettings:[null]});let e={},n={getStateParams:()=>({})},t={};this.aliasController=new sg(this.utils,this.entityService,this.translate,()=>n,e,t),this.route.data.pipe(dt(this.destroy$)).subscribe(()=>{this.reset(),this.init(this.route.snapshot.data.symbolData)})}ngAfterViewInit(){}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}onApplyScadaSymbolConfig(){if(this.scadaSymbolFormGroup.valid){if(this.symbolEditor.editorMode==="xml"){let _=this.symbolEditor.getTags();this.editObjectCallbacks.tagsUpdated(_)}let e=this.scadaSymbolFormGroup.get("metadata").value,n=this.prepareScadaSymbolContent(e),t=uu(n,this.symbolData.imageResource.fileName,this.symbolData.imageResource.descriptor.mediaType),s=T0(this.symbolData.imageResource),u=this.imageService.updateImage(s,this.symbolData.imageResource.resourceKey,t);e.title!==this.symbolData.imageResource.title&&(u=u.pipe(sa(_=>(_.title=e.title,this.imageService.updateImageInfo(_))))),u.pipe(sa(_=>this.imageService.getImageString(`${Fs}/${s}/${encodeURIComponent(_.resourceKey)}`).pipe(mt(E=>({imageResource:_,scadaSymbolContent:E}))))).subscribe(_=>{this.init(_),this.updateBreadcrumbs.emit()})}}onRevertScadaSymbolConfig(){this.init(this.origSymbolData)}enterPreviewMode(){this.previewMetadata=this.scadaSymbolFormGroup.get("metadata").value,this.symbolData.scadaSymbolContent=this.prepareScadaSymbolContent(this.previewMetadata),this.previewScadaSymbolObjectSettings={behavior:{},properties:{}},this.scadaPreviewFormGroup.patchValue({scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings},{emitEvent:!1}),this.scadaPreviewFormGroup.markAsPristine();let e=$i(_e({},lg),{simulated:!0,scadaSymbolUrl:null,scadaSymbolContent:this.symbolData.scadaSymbolContent,scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings,padding:"0",background:c0("rgba(0,0,0,0)")});this.previewWidget={typeFullFqn:"system.scada_symbol",type:Fi.rpc,sizeX:this.previewMetadata.widgetSizeX||3,sizeY:this.previewMetadata.widgetSizeY||3,row:0,col:0,config:{settings:e,showTitle:!1,dropShadow:!1,padding:"0",margin:"0",backgroundColor:"rgba(0,0,0,0)"}},this.previewWidgets=[this.previewWidget],this.previewMode=!0}exitPreviewMode(){this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent},this.previewMode=!1}onRevertPreviewSettings(){this.scadaPreviewFormGroup.patchValue({scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings},{emitEvent:!1}),this.scadaPreviewFormGroup.markAsPristine()}onApplyPreviewSettings(){this.scadaPreviewFormGroup.markAsPristine(),this.previewScadaSymbolObjectSettings=this.scadaPreviewFormGroup.get("scadaSymbolObjectSettings").value,this.updatePreviewWidgetSettings()}tagsUpdated(e){this.tags=e}tagHasStateRenderFunction(e){let n=this.scadaSymbolFormGroup.get("metadata").value;return n.tags?!!n.tags.find(s=>s.tag===e)?.stateRenderFunction:!1}tagHasClickAction(e){let n=this.scadaSymbolFormGroup.get("metadata").value;return n.tags?!!n.tags.find(s=>s.tag===e)?.actions?.click?.actionFunction:!1}editTagStateRenderFunction(e){this.symbolMetadata.editTagStateRenderFunction(e)}editTagClickAction(e){this.symbolMetadata.editTagClickAction(e)}onSymbolEditObjectDirty(e){this.symbolEditorDirty=e}onSymbolEditObjectValid(e){this.symbolEditorValid=e}updateScadaSymbol(){this.dialog.open(Lf,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{imageSubType:this.symbolData.imageResource.resourceSubType,image:this.symbolData.imageResource}}).afterClosed().subscribe(e=>{e?.scadaSymbolContent&&(this.symbolData.scadaSymbolContent=e.scadaSymbolContent,this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent},this.symbolEditorDirty=!0,this.symbolEditorValid=!0)})}downloadScadaSymbol(){let e;this.scadaSymbolFormGroup.valid?e=this.scadaSymbolFormGroup.get("metadata").value:e=rc(this.origSymbolData.scadaSymbolContent);let n=document.createElement("a"),t=this.prepareScadaSymbolContent(e),s=new Blob([t],{type:this.symbolData.imageResource.descriptor.mediaType}),u=URL.createObjectURL(s);n.setAttribute("href",u),n.setAttribute("download",this.symbolData.imageResource.fileName);let _=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});n.dispatchEvent(_)}createWidget(){let e=this.scadaSymbolFormGroup.get("metadata").value;this.dialog.open(rr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{title:e.title,dialogTitle:"scada.create-widget-from-symbol",saveAsActionTitle:"action.create"}}).afterClosed().subscribe(n=>{n&&this.widgetService.getWidgetType("system.scada_symbol").subscribe(t=>{let s=x0+this.symbolData.imageResource.link,u=_e({image:s,description:e.description,tags:e.searchTags},t);u.fqn=void 0,u.id=void 0,u.name=n.widgetName;let _=u.descriptor;_.sizeX=e.widgetSizeX,_.sizeY=e.widgetSizeY,_.controllerScript=_.controllerScript.replace(/previewWidth: '\d*px'/gm,`previewWidth: '${e.widgetSizeX*100}px'`),_.controllerScript=_.controllerScript.replace(/previewHeight: '\d*px'/gm,`previewHeight: '${e.widgetSizeY*100+20}px'`);let E=JSON.parse(_.defaultConfig);E.title=n.widgetName,E.settings=E.settings||{},E.settings.scadaSymbolUrl=s,_.defaultConfig=JSON.stringify(E),this.widgetService.saveWidgetType(u).subscribe(w=>{n.widgetBundleId&&this.widgetService.addWidgetFqnToWidgetBundle(n.widgetBundleId,w.fqn).subscribe()})})})}updatePreviewWidgetSettings(){this.previewWidget=Ue(this.previewWidget),this.previewWidget.config.settings.scadaSymbolObjectSettings=this.previewScadaSymbolObjectSettings,this.previewWidgets=[this.previewWidget]}prepareScadaSymbolContent(e){let n=this.symbolEditor.getContent();return Nf(n,e)}reset(){this.symbolMetadata&&(this.symbolMetadata.selectedOption="general"),this.previewMode=!1}init(e){this.authUser.authority===M.TENANT_ADMIN?this.readonly=e.imageResource.tenantId.id===Be:this.readonly=this.authUser.authority!==M.SYS_ADMIN,this.origSymbolData=e,this.symbolData=Ue(e),this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent};let n=rc(this.symbolData.scadaSymbolContent);this.scadaSymbolFormGroup.patchValue({metadata:n},{emitEvent:!1}),this.readonly?this.scadaSymbolFormGroup.disable({emitEvent:!1}):this.scadaSymbolFormGroup.enable({emitEvent:!1}),this.scadaSymbolFormGroup.markAsPristine(),this.symbolEditorDirty=!1,this.symbolEditorValid=!0,this.cd.markForCheck()}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(Si),g(se),g(Xe),g(Q0),g(Ca),g(ie),g(Gs),g(fi),g(je))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-scada-symbol"]],viewQuery:function(n,t){if(n&1&&(be(N2,5),be(k2,5)),n&2){let s;ve(s=ye())&&(t.symbolEditor=s.first),ve(s=ye())&&(t.symbolMetadata=s.first)}},hostVars:4,hostBindings:function(n,t){n&2&&Qi("width",t.width)("height",t.height)},features:[G],decls:31,vars:27,consts:[["symbolMetadata",""],["symbolEditor",""],[1,"tb-scada-symbol-editor","mat-content","flex","flex-col"],[1,"tb-scada-symbol-editor-container","flex","flex-1","flex-col"],[1,"tb-scada-symbol-editor-layout","flex","flex-1","flex-row"],[1,"size-full"],["disableClose","true","mode","side","opened","","position","end",1,"tb-scada-symbol-editor-details-drawer","mat-elevation-z4"],["headerHeightPx","64",1,"flex-1",3,"isReadOnly","showCloseDetails","headerTitle"],[1,"details-buttons","flex","flex-row","items-center","justify-start","gap-4"],["tb-help","scadaSymbolDev"],["mat-stroked-button","",3,"click","disabled"],["class","tb-scada-symbol-editor-preview-content tb-absolute-fill",4,"ngIf"],[3,"formGroup"],["formControlName","metadata",3,"tags","aliasController","callbacks"],[1,"tb-scada-symbol-metadata-header-prefix"],["mat-button","","color","primary",1,"gt-sm:!hidden",3,"click","disabled"],[1,"tb-scada-symbol-metadata-header-suffix","flex","flex-row","items-center","justify-end","gap-3","lt-md:flex-1"],["mat-button","","color","primary",1,"lt-md:!hidden",3,"click","disabled"],["class","flex flex-row items-center justify-start gap-3",4,"ngIf"],[1,"tb-scada-symbol-editor-content"],[3,"readonly","showHiddenElements","data","editObjectCallbacks","showHiddenElementsChange","updateScadaSymbol","downloadScadaSymbol",4,"ngIf"],["class","tb-absolute-fill","displayGrid","always","setGridSize","",3,"aliasController","widgets","autofillHeight","gridType","columns","centerVertical","centerHorizontal","margin","isEdit","isMobileDisabled","isEditActionEnabled","isRemoveActionEnabled",4,"ngIf"],[1,"tb-scada-symbol-editor-preview-content","tb-absolute-fill"],[1,"tb-scada-symbol-editor-preview-header"],["mat-button","",3,"click"],[2,"flex","1"],["mat-stroked-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"tb-scada-symbol-editor-preview-settings",3,"formGroup"],[1,"mat-content"],[1,"tb-form-panel"],["translate","",1,"tb-form-panel-title"],[3,"scadaSymbolContent","scadaSymbolMetadata"],["formControlName","scadaSymbolObjectSettings",3,"scadaSymbolMetadata","aliasController","widgetType","callbacks"],[1,"flex","flex-row","items-center","justify-start","gap-3"],[3,"showHiddenElementsChange","updateScadaSymbol","downloadScadaSymbol","readonly","showHiddenElements","data","editObjectCallbacks"],["displayGrid","always","setGridSize","",1,"tb-absolute-fill",3,"aliasController","widgets","autofillHeight","gridType","columns","centerVertical","centerHorizontal","margin","isEdit","isMobileDisabled","isEditActionEnabled","isRemoveActionEnabled"]],template:function(n,t){if(n&1){let s=O();a(0,"div",2)(1,"section",3)(2,"div",4)(3,"mat-drawer-container",5)(4,"mat-drawer",6)(5,"tb-details-panel",7)(6,"div",8),f(7,"div",9),a(8,"button",10),y("click",function(){return x(s),I(t.createWidget())}),p(9),d(10,"translate"),r()(),b(11,R2,25,18,"div",11),a(12,"div",12)(13,"tb-scada-symbol-metadata",13,0)(15,"div",14)(16,"button",15),y("click",function(){return x(s),I(t.enterPreviewMode())}),a(17,"mat-icon"),p(18,"visibility"),r(),p(19),d(20,"translate"),r()(),a(21,"div",16)(22,"button",17),y("click",function(){return x(s),I(t.enterPreviewMode())}),a(23,"mat-icon"),p(24,"visibility"),r(),p(25),d(26,"translate"),r(),b(27,O2,11,8,"div",18),r()()()()(),a(28,"mat-drawer-content",19),b(29,B2,2,4,"tb-scada-symbol-editor",20)(30,V2,1,12,"tb-dashboard",21),r()()()()()}n&2&&(o(5),T("headerTitle",t.symbolData==null||t.symbolData.imageResource==null?null:t.symbolData.imageResource.title),l("isReadOnly",!0)("showCloseDetails",!1),o(3),l("disabled",t.scadaSymbolFormGroup.invalid),o(),h(" ",c(10,21,"scada.create-widget")," "),o(2),l("ngIf",t.previewMode),o(),L("!hidden",t.previewMode),l("formGroup",t.scadaSymbolFormGroup),o(),l("tags",t.tags)("aliasController",t.aliasController)("callbacks",t.widgetActionCallbacks),o(3),l("disabled",t.scadaSymbolFormGroup.invalid||!t.symbolEditorValid),o(3),h(" ",c(20,23,"scada.preview")," "),o(3),l("disabled",t.scadaSymbolFormGroup.invalid||!t.symbolEditorValid),o(3),h(" ",c(26,25,"scada.preview")," "),o(2),l("ngIf",!t.readonly),o(),L("preview",t.previewMode),o(),l("ngIf",!t.previewMode),o(),l("ngIf",t.previewMode))},dependencies:[V,Tt,K,ee,Ts,xs,Ss,W,z,X,oe,H,jf,nl,_g,jr,yg,Xl,k],styles:[`@charset "UTF-8";.tb-scada-symbol-editor{width:100%;height:100%}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer{width:50%}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content{display:flex;flex-direction:column;gap:8px}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-header{padding:24px 24px 0;display:flex;gap:12px;flex-direction:row;align-items:center;justify-content:space-between}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings{flex:1;overflow:auto}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>.mat-content{padding-top:8px}@media screen and (max-width: 599px){.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>.mat-content{padding-left:8px;padding-right:8px}}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>div{padding:16px}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings .mat-content{display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 599px){.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings .mat-content{gap:8px}}.tb-scada-symbol-editor .tb-scada-symbol-editor-content{flex:1;min-width:0;min-height:0;width:50%;max-width:50%;background:#fff}.tb-scada-symbol-editor .tb-scada-symbol-editor-content.preview #gridster-parent #gridster-background{background-color:#eee}
`],encapsulation:2})}}return i})();var L2=(i,m,e=Zt(de),n=Zt(Gs))=>{let t=i.params.type,s=decodeURIComponent(i.params.key);return Gt({imageResource:n.getImageInfo(t,s),scadaSymbolContent:n.getImageString(`${Fs}/${t}/${encodeURIComponent(s)}`)}).pipe(cn(()=>(e.navigate(["/resources/scada-symbols"]),ot(null))))},j2=(i,m,e)=>e.symbolData?.imageResource?.title,G2=[{path:"resources",data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],breadcrumb:{menuId:xe.resources}},children:[{path:"",children:[],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],redirectTo:"/resources/widgets-library"}},...Jg,{path:"images",data:{breadcrumb:{menuId:xe.images}},children:[{path:"",component:sc,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"image.gallery",imageSubType:qd.IMAGE}}]},{path:"scada-symbols",data:{breadcrumb:{menuId:xe.scada_symbols}},children:[{path:"",component:sc,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"scada.symbols",imageSubType:qd.SCADA_SYMBOL}},{path:":type/:key",component:op,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:j2,icon:"view_in_ar"},auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"scada.symbol.symbol"},resolve:{symbolData:L2}}]},{path:"resources-library",data:{breadcrumb:{menuId:xe.resources_library}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"resource.resources-library"},resolve:{entitiesTableConfig:wl}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"mdi:rhombus-split"},auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"resource.resources-library"},resolve:{entitiesTableConfig:wl}}]}]},{path:"settings",component:Tn,data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],showMainLoadingBar:!1,breadcrumb:{menuId:xe.settings}},children:[{path:"",children:[],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/settings/general",TENANT_ADMIN:"/settings/home"}}},{path:"general",component:_l,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN],title:"admin.general-settings",breadcrumb:{menuId:xe.general}}},{path:"outgoing-mail",component:bl,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN],title:"admin.outgoing-mail-settings",breadcrumb:{menuId:xe.mail_server}}},{path:"notifications",component:Tl,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"admin.notifications-settings",breadcrumb:{menuId:xe.notification_settings}}},{path:"queues",data:{breadcrumb:{menuId:xe.queues}},children:[{path:"",component:qe,data:{auth:[M.SYS_ADMIN],title:"admin.queues"},resolve:{entitiesTableConfig:Pl}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"swap_calls"},auth:[M.SYS_ADMIN],title:"admin.queues"},resolve:{entitiesTableConfig:Pl}}]},{path:"home",component:xl,canDeactivate:[Fe],data:{auth:[M.TENANT_ADMIN],title:"admin.home-settings",breadcrumb:{menuId:xe.home_settings}}},{path:"repository",component:Fl,canDeactivate:[Fe],data:{auth:[M.TENANT_ADMIN],title:"admin.repository-settings",breadcrumb:{menuId:xe.repository_settings}}},{path:"auto-commit",component:Al,canDeactivate:[Fe],data:{auth:[M.TENANT_ADMIN],title:"admin.auto-commit-settings",breadcrumb:{menuId:xe.auto_commit_settings}}},{path:"security-settings",redirectTo:"/security-settings/general"},{path:"oauth2",redirectTo:"/security-settings/oauth2"},{path:"resources-library",pathMatch:"full",redirectTo:"/resources/resources-library"},{path:"resources-library/:entityId",redirectTo:"/resources/resources-library/:entityId"},{path:"2fa",redirectTo:"/security-settings/2fa"},{path:"sms-provider",redirectTo:"/settings/notifications"}]},{path:"security-settings",data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],breadcrumb:{menuId:xe.security_settings}},children:[{path:"",children:[],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/security-settings/general",TENANT_ADMIN:"/security-settings/auditLogs"}}},{path:"general",component:Cl,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN],title:"admin.general",breadcrumb:{menuId:xe.security_settings_general}}},{path:"2fa",component:Nl,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN],title:"admin.2fa.2fa",breadcrumb:{menuId:xe.two_fa}}},...Cc,...Kg]}],ap=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[wl,Pl],imports:[j.forChild(G2),j]})}}return i})();(function(){Y(ap,{imports:[j],exports:[j]})})();C();var rp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[Ql,ae,re,Ee]})}}return i})();(function(){Y(rp,{declarations:[oo,lr,Wl,zl,$l],imports:[Ql,ae,re,Ee]})})();var sp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,ap,rp]})}}return i})();(function(){Y(sp,{declarations:[_l,bl,Tl,Sl,Cl,xl,Il,El,Ml,Fl,Al,Nl],imports:[ae,re,Ee,ap,rp]})})();C();C();C();function U2(i,m){if(i&1&&f(0,"tb-dashboard-page",2),i&2){let e=v();l("embedded",!0)("dashboard",e.homeDashboard)("hideToolbar",e.homeDashboard.hideDashboardToolbar)}}function q2(i,m){if(i&1&&(a(0,"mat-grid-tile")(1,"a",10)(2,"tb-icon",11),p(3),r(),a(4,"span"),p(5),d(6,"customTranslate"),d(7,"translate"),r()()()),i&2){let e=m.$implicit;o(),T("routerLink",e.path),o(2),R(e.icon),o(2),R(e.customTranslate?c(6,3,e.name):c(7,5,e.name))}}function W2(i,m){if(i&1&&(a(0,"mat-grid-tile",5)(1,"mat-card",6)(2,"mat-card-title")(3,"span",7),p(4),r()(),a(5,"mat-card-content")(6,"mat-grid-list",8),b(7,q2,8,7,"mat-grid-tile",9),r()()()()),i&2){let e=m.$implicit,n=v(2);l("colspan",n.sectionColspan(e)),o(4),R(e.name),o(2),l("cols",e.places.length),o(),l("ngForOf",e.places)}}function H2(i,m){if(i&1&&(a(0,"mat-grid-list",3),b(1,W2,8,4,"mat-grid-tile",4),d(2,"async"),r()),i&2){let e=v();l("cols",e.cols),o(),l("ngForOf",c(2,2,e.homeSections$))}}var lp=(()=>{class i{constructor(e,n,t,s){this.menuService=e,this.breakpointObserver=n,this.cd=t,this.route=s,this.homeSections$=this.menuService.homeSections(),this.cols=2,this.homeDashboard=this.route.snapshot.data.homeDashboard}ngOnInit(){this.homeDashboard||(this.updateColumnCount(),this.breakpointObserver.observe([Ri.lg,Ri["gt-lg"]]).subscribe(e=>this.updateColumnCount()))}updateColumnCount(){this.cols=2,this.breakpointObserver.isMatched(Ri.lg)&&(this.cols=3),this.breakpointObserver.isMatched(Ri["gt-lg"])&&(this.cols=4),this.cd.detectChanges()}sectionColspan(e){if(this.breakpointObserver.isMatched(Ri["gt-sm"])){let n=this.cols;return e&&e.places&&e.places.length<=n&&(n=e.places.length),n}else return 2}static{this.\u0275fac=function(n){return new(n||i)(g(ju),g(ho),g(Xe),g(Si))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-home-links"]],decls:3,vars:2,consts:[["homeLinks",""],[3,"embedded","dashboard","hideToolbar",4,"ngIf","ngIfElse"],[3,"embedded","dashboard","hideToolbar"],["rowHeight","280px",1,"tb-home-links",3,"cols"],[3,"colspan",4,"ngFor","ngForOf"],[3,"colspan"],["appearance","outlined",2,"width","100%"],["translate","",1,"mat-headline-5"],["rowHeight","170px",3,"cols"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"tb-card-button",3,"routerLink"],["matButtonIcon","",1,"tb-mat-96"]],template:function(n,t){if(n&1&&b(0,U2,1,3,"tb-dashboard-page",1)(1,H2,3,4,"ng-template",null,0,xt),n&2){let s=U(2);l("ngIf",t.homeDashboard)("ngIfElse",s)}},dependencies:[we,V,Sa,ti,pi,vi,Yu,Ku,su,H,ji,ir,le,Ya,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .tb-home-links .mat-headline-5{font-size:20px}@media screen and (min-width: 1600px){[_nghost-%COMP%]     .tb-home-links .mat-headline-5{font-size:24px}}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card{padding:0;margin:8px}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-title{margin:0;padding:24px 16px 16px}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-title+.mat-mdc-card-content{padding-top:0}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-content{padding:16px}[_nghost-%COMP%]     .tb-home-links .tb-card-button{width:100%;height:100%;max-width:240px;display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]     .tb-home-links .tb-card-button:hover{border-bottom:none}[_nghost-%COMP%]     .tb-home-links .tb-card-button:focus{border-bottom:none}[_nghost-%COMP%]     .tb-home-links .tb-card-button .mat-icon{margin:auto}[_nghost-%COMP%]     .tb-home-links .tb-card-button span.mdc-button__label{height:18px;min-height:36px;max-height:36px;padding:0 0 20px;margin:auto;font-size:18px;font-weight:400;line-height:18px;white-space:normal;text-align:center}[_nghost-%COMP%]     .tb-home-links .tb-card-button.mat-mdc-raised-button.mat-primary .mat-ripple-element{opacity:.3;background-color:#ffffff4d}'],changeDetection:0})}}return i})();var z2="/assets/dashboard/sys_admin_home_page.json",$2="/assets/dashboard/tenant_admin_home_page.json",Q2="/assets/dashboard/customer_user_home_page.json",J2=(i,m)=>{let e=Bt(i).authority;switch(e){case M.SYS_ADMIN:return Ac(i,m.loadJsonResource(z2),e);case M.TENANT_ADMIN:return Ac(i,m.loadJsonResource($2),e);case M.CUSTOMER_USER:return Ac(i,m.loadJsonResource(Q2),e);default:return ot(null)}},Ac=(i,m,e)=>{let n;switch(e){case M.SYS_ADMIN:n=i.pipe(Ht(Cu),mt(t=>({mobileQrEnabled:t})));break;case M.TENANT_ADMIN:n=i.pipe(Ht(Su));break;case M.CUSTOMER_USER:n=i.pipe(Ht(as),mt(t=>({persistDeviceStateToTelemetry:t})));break}return n.pipe(yt(t=>m.pipe(mt(s=>{if(t.persistDeviceStateToTelemetry)for(let u of Object.keys(s.configuration.filters))["Active Devices","Inactive Devices"].includes(s.configuration.filters[u].filter)&&(s.configuration.filters[u].keyFilters[0].key.type=V0.TIME_SERIES);if(Re(t.mobileQrEnabled)){for(let u of Object.keys(s.configuration.widgets))if(s.configuration.widgets[u].config.title==="Select show mobile QR code"){s.configuration.widgets[u].config.settings.markdownTextFunction=s.configuration.widgets[u].config.settings.markdownTextFunction.replace(/\${mobileQrEnabled:([^}]+)}/,`\${mobileQrEnabled:${String(t.mobileQrEnabled)}}`);break}}return s.hideDashboardToolbar=!0,s}))))},K2=(i,m,e=Zt(Ps),n=Zt(Na),t=Zt(P))=>e.getHomeDashboard().pipe(yt(s=>s?ot(s):J2(t,n))),Y2=[{path:"home",component:lp,data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN,M.CUSTOMER_USER],title:"home.home",breadcrumb:{menuId:xe.home}},resolve:{homeDashboard:K2}}],pp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(Y2),j]})}}return i})();(function(){Y(pp,{imports:[j],exports:[j]})})();var mp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,pp]})}}return i})();(function(){Y(mp,{declarations:[lp],imports:[ae,re,Ee,pp]})})();C();C();function X2(i,m){i&1&&f(0,"mat-progress-bar",25)}function Z2(i,m){i&1&&f(0,"div",26)}function eS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"user.email-required")," "))}function tS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"user.invalid-email-format")," "))}function iS(i,m){if(i&1&&(a(0,"mat-option",27),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",e?c(2,2,"language.locales."+e):""," ")}}function nS(i,m){if(i&1&&(a(0,"section",28),f(1,"tb-dashboard-autocomplete",29),d(2,"translate"),a(3,"mat-checkbox",30),p(4),d(5,"translate"),r()()),i&2){let e=v();o(),T("label",c(2,6,"dashboard.home-dashboard")),l("dashboardsScope",(e.user==null?null:e.user.authority)===e.authorities.TENANT_ADMIN?"tenant":"customer")("tenantId",e.user==null||e.user.tenantId==null?null:e.user.tenantId.id)("customerId",e.user==null||e.user.customerId==null?null:e.user.customerId.id)("selectFirstDashboard",!1),o(3),h(" ",c(5,8,"dashboard.home-dashboard-hide-toolbar")," ")}}var cp=(()=>{class i extends It{constructor(e,n,t,s,u,_){super(e),this.store=e,this.route=n,this.userService=t,this.authService=s,this.translate=u,this.fb=_,this.authorities=M,this.languageList=Vu.supportedLangs,this.authUser=Bt(this.store)}ngOnInit(){this.buildProfileForm(),this.userLoaded(this.route.snapshot.data.user)}buildProfileForm(){this.profile=this.fb.group({email:["",[S.required,S.email]],firstName:[""],lastName:[""],phone:[""],language:[""],homeDashboardId:[null],homeDashboardHideToolbar:[!0]})}save(){this.user=_e(_e({},this.user),this.profile.value),this.user.additionalInfo||(this.user.additionalInfo={}),this.user.additionalInfo.lang=this.profile.get("language").value,this.user.additionalInfo.homeDashboardId=this.profile.get("homeDashboardId").value,this.user.additionalInfo.homeDashboardHideToolbar=this.profile.get("homeDashboardHideToolbar").value,this.userService.saveUser(this.user).subscribe(e=>{this.userLoaded(e),this.store.dispatch(new vu({userDetails:{additionalInfo:_e({},e.additionalInfo),authority:e.authority,createdTime:e.createdTime,tenantId:e.tenantId,customerId:e.customerId,email:e.email,phone:e.phone,firstName:e.firstName,id:e.id,lastName:e.lastName}})),this.store.dispatch(new Lu({userLang:e.additionalInfo.lang})),this.authService.refreshJwtToken(!1)})}userLoaded(e){this.user=e,this.profile.reset(e);let n,t,s=!0;e.additionalInfo&&(e.additionalInfo.lang&&(n=e.additionalInfo.lang),t=e.additionalInfo.homeDashboardId,Re(e.additionalInfo.homeDashboardHideToolbar)&&(s=e.additionalInfo.homeDashboardHideToolbar)),n||(n=this.translate.currentLang),this.profile.get("language").setValue(n),this.profile.get("homeDashboardId").setValue(t),this.profile.get("homeDashboardHideToolbar").setValue(s)}confirmForm(){return this.profile}isSysAdmin(){return this.authUser.authority===M.SYS_ADMIN}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(Si),g(Bn),g(gn),g(ie),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-profile"]],features:[G],decls:50,vars:30,consts:[["appearance","outlined",1,"profile-card"],[1,"flex","flex-1","flex-row","items-start","justify-between","xs:flex-col","xs:justify-start","xs:gap-2"],[1,"flex","flex-1","flex-col"],["translate","",1,"mat-headline-5"],[1,"profile-email",2,"opacity","0.7"],[1,"flex","flex-col"],["translate","",1,"mat-mdc-subheader"],[1,"profile-last-login-ts",2,"opacity","0.7"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["formControlName","phone",3,"required","label","enableFlagsSelect"],["formControlName","language"],[3,"value",4,"ngFor","ngForOf"],["class","tb-home-dashboard flex flex-1 flex-col gt-sm:flex-row",4,"ngIf"],[1,"flex","flex-row","items-start","justify-end"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],[1,"tb-home-dashboard","flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(n,t){n&1&&(a(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"div",1)(4,"div",2)(5,"span",3),p(6,"profile.profile"),r(),a(7,"span",4),p(8),r()(),a(9,"div",5)(10,"span",6),p(11,"profile.last-login-time"),r(),a(12,"span",7),p(13),d(14,"date"),r()()()(),b(15,X2,1,0,"mat-progress-bar",8),d(16,"async"),b(17,Z2,1,0,"div",9),d(18,"async"),a(19,"mat-card-content",10)(20,"form",11),y("ngSubmit",function(){return t.save()}),a(21,"fieldset",12),d(22,"async"),a(23,"mat-form-field",13)(24,"mat-label",14),p(25,"user.email"),r(),f(26,"input",15),b(27,eS,3,3,"mat-error",16)(28,tS,3,3,"mat-error",16),r(),a(29,"mat-form-field",13)(30,"mat-label",14),p(31,"user.first-name"),r(),f(32,"input",17),r(),a(33,"mat-form-field",13)(34,"mat-label",14),p(35,"user.last-name"),r(),f(36,"input",18),r(),f(37,"tb-phone-input",19),d(38,"translate"),a(39,"mat-form-field",13)(40,"mat-label",14),p(41,"language.language"),r(),a(42,"mat-select",20),b(43,iS,3,4,"mat-option",21),r()(),b(44,nS,6,10,"section",22),a(45,"div",23)(46,"button",24),d(47,"async"),p(48),d(49,"translate"),r()()()()()()()),n&2&&(o(8),R(t.profile?t.profile.get("email").value:""),o(5),R(Nt(14,15,t.user==null||t.user.additionalInfo==null?null:t.user.additionalInfo.lastLoginTs,"yyyy-MM-dd HH:mm:ss")),o(2),l("ngIf",c(16,18,t.isLoading$)),o(2),l("ngIf",!c(18,20,t.isLoading$)),o(3),l("formGroup",t.profile),o(),l("disabled",c(22,22,t.isLoading$)),o(6),l("ngIf",t.profile.get("email").hasError("required")),o(),l("ngIf",t.profile.get("email").hasError("email")),o(9),T("label",c(38,24,"contact.phone")),l("required",!1)("enableFlagsSelect",!0),o(6),l("ngForOf",t.languageList),o(),l("ngIf",!t.isSysAdmin()),o(2),l("disabled",c(47,26,t.isLoading$)||t.profile.invalid||!t.profile.dirty),o(2),h(" ",c(49,28,"action.save")," "))},dependencies:[we,V,_n,K,$t,ti,pi,yi,Oe,ge,me,Ie,De,St,ct,fe,ue,W,z,ce,X,oe,H,xo,le,Ge,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{margin:8px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .profile-email[_ngcontent-%COMP%]{font-size:16px;font-weight:400}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-mdc-subheader[_ngcontent-%COMP%]{line-height:24px;color:#0000008a;font-size:14px;font-weight:400}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .profile-last-login-ts[_ngcontent-%COMP%]{font-size:16px;font-weight:400}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}return i})();C();var bh=(()=>{class i{constructor(e,n){this.store=e,this.userService=n}resolve(){let e=Bt(this.store).userId;return this.userService.getUser(e)}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(Bn))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),vh=[{path:"profile",component:cp,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN,M.CUSTOMER_USER],title:"profile.profile",breadcrumb:{label:"profile.profile",icon:"account_circle"}},resolve:{user:bh}}],oS=[{path:"profile",redirectTo:"account/profile"}],up=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[bh],imports:[j.forChild(oS),j]})}}return i})();(function(){Y(up,{imports:[j],exports:[j]})})();var fp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,up]})}}return i})();(function(){Y(fp,{declarations:[cp],imports:[ae,re,up]})})();C();C();C();C();var aS=["stepper"],rS=["canvas"];function sS(i,m){i&1&&f(0,"mat-progress-bar",28)}function lS(i,m){i&1&&f(0,"div",29)}function pS(i,m){i&1&&(a(0,"mat-icon"),p(1,"done"),r())}function mS(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.totp-step-label"))}function dS(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.verification-step-label"))}function cS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function uS(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.activation-step-label"))}var gp=(()=>{class i extends et{constructor(e,n,t,s,u){super(e,n,s),this.store=e,this.router=n,this.twoFaService=t,this.dialogRef=s,this.fb=u,this.twoFaService.generateTwoFaAccountConfig(Et.TOTP).subscribe(_=>{this.authAccountConfig=_,this.totpAuthURL=this.authAccountConfig.authUrl,this.authAccountConfig.useByDefault=!0,import("./chunk-GULTETXF.js").then(E=>{bu(E).toCanvas(this.canvasRef.nativeElement,this.totpAuthURL),this.canvasRef.nativeElement.style.width="auto",this.canvasRef.nativeElement.style.height="auto"})}),this.totpConfigForm=this.fb.group({verificationCode:["",[S.required,S.minLength(6),S.maxLength(6),S.pattern(/^\d*$/)]]})}onSaveConfig(){this.totpConfigForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.totpConfigForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):Object.keys(this.totpConfigForm.controls).forEach(e=>{this.totpConfigForm.get(e).markAsTouched({onlySelf:!0})})}closeDialog(){return this.dialogRef.close(this.config)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(rn),g(Ze),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-totp-auth-dialog"]],viewQuery:function(n,t){if(n&1&&(be(aS,5),be(rS,5)),n&2){let s;ve(s=ye())&&(t.stepper=s.first),ve(s=ye())&&(t.canvasRef=s.first)}},features:[G],decls:55,vars:26,consts:[["stepper",""],["canvas",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],["linear",""],["matStepperIcon","edit"],["matStepLabel",""],["translate","",1,"mat-body-2"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary","matStepperNext",""],[3,"stepControl"],[1,"flex","flex-col","items-center","justify-start",3,"ngSubmit","formGroup"],["translate","",1,"mat-body","qr-code-description"],["translate","",1,"mat-body","qr-code-description",2,"margin-top","30px"],[1,"mat-block","code-container","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[4,"ngIf"],["mat-raised-button","","type","button","color","primary",3,"click","disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-toolbar",2)(1,"h2",3),p(2,"security.2fa.dialog.enable-totp-title"),r(),f(3,"span",4),a(4,"button",5),y("click",function(){return x(s),I(t.closeDialog())}),a(5,"mat-icon",6),p(6,"close"),r()()(),b(7,sS,1,0,"mat-progress-bar",7),d(8,"async"),b(9,lS,1,0,"div",8),d(10,"async"),a(11,"div",9)(12,"mat-stepper",10,0),b(14,pS,2,0,"ng-template",11),a(15,"mat-step"),b(16,mS,2,3,"ng-template",12),a(17,"div")(18,"p",13),p(19,"security.2fa.dialog.totp-step-description-open"),r(),a(20,"p",13),p(21,"security.2fa.dialog.totp-step-description-install"),r(),a(22,"div",14)(23,"button",15),p(24),d(25,"translate"),r()()()(),a(26,"mat-step",16),b(27,dS,2,3,"ng-template",12),a(28,"form",17),y("ngSubmit",function(){return x(s),I(t.onSaveConfig())}),a(29,"p",18),p(30,"security.2fa.dialog.scan-qr-code"),r(),f(31,"canvas",4,1),a(33,"p",19),p(34,"security.2fa.dialog.enter-verification-code"),r(),a(35,"mat-form-field",20),f(36,"input",21),d(37,"translate"),b(38,cS,3,3,"mat-error",22),r()(),a(39,"div",14)(40,"button",23),d(41,"async"),y("click",function(){return x(s),I(t.onSaveConfig())}),p(42),d(43,"translate"),r()()(),a(44,"mat-step"),b(45,uS,2,3,"ng-template",24),a(46,"div")(47,"h3",25),p(48,"security.2fa.dialog.success"),r(),a(49,"p",26),p(50,"security.2fa.dialog.activation-step-description-totp"),r(),a(51,"div",14)(52,"button",27),y("click",function(){return x(s),I(t.closeDialog())}),p(53),d(54,"translate"),r()()()()()()}n&2&&(o(7),l("ngIf",c(8,12,t.isLoading$)),o(2),l("ngIf",!c(10,14,t.isLoading$)),o(15),h(" ",c(25,16,"security.2fa.dialog.next")," "),o(2),l("stepControl",t.totpConfigForm),o(2),l("formGroup",t.totpConfigForm),o(3),Qi("display",t.totpAuthURL?"block":"none"),o(5),T("placeholder",c(37,18,"security.2fa.dialog.verification-code")),o(2),l("ngIf",t.totpConfigForm.get("verificationCode").invalid),o(2),l("disabled",c(41,20,t.isLoading$)||t.totpConfigForm.invalid),o(2),h(" ",c(43,22,"security.2fa.dialog.next")," "),o(11),h(" ",c(54,24,"action.done")," "))},dependencies:[V,Vi,K,Ce,ee,Oe,ge,me,De,He,Je,vn,hn,yn,a0,bn,fe,ue,W,z,ce,nn,Ia,X,oe,H,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}return i})();C();var fS=["stepper"],gS=i=>({address:i});function hS(i,m){i&1&&f(0,"mat-progress-bar",30)}function bS(i,m){i&1&&f(0,"div",31)}function vS(i,m){i&1&&(a(0,"mat-icon"),p(1,"done"),r())}function yS(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.sms-step-label"))}function _S(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.verification-step-label"))}function CS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function SS(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.activation-step-label"))}var hp=(()=>{class i extends et{constructor(e,n,t,s,u){super(e,n,s),this.store=e,this.router=n,this.twoFaService=t,this.dialogRef=s,this.fb=u,this.phoneNumberPattern=Xa,this.smsConfigForm=this.fb.group({phone:["",[S.required,S.pattern(Xa)]]}),this.smsVerificationForm=this.fb.group({verificationCode:["",[S.required,S.minLength(6),S.maxLength(6),S.pattern(/^\d*$/)]]})}nextStep(){switch(this.stepper.selectedIndex){case 0:this.smsConfigForm.valid?(this.authAccountConfig={providerType:Et.SMS,useByDefault:!0,phoneNumber:this.smsConfigForm.get("phone").value},this.twoFaService.submitTwoFaAccountConfig(this.authAccountConfig).subscribe(()=>{this.stepper.next()})):this.showFormErrors(this.smsConfigForm);break;case 1:this.smsVerificationForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.smsVerificationForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):this.showFormErrors(this.smsVerificationForm);break}}closeDialog(){return this.dialogRef.close(this.config)}showFormErrors(e){Object.keys(e.controls).forEach(n=>{e.get(n).markAsTouched({onlySelf:!0})})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(rn),g(Ze),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-sms-auth-dialog"]],viewQuery:function(n,t){if(n&1&&be(fS,5),n&2){let s;ve(s=ye())&&(t.stepper=s.first)}},features:[G],decls:58,vars:45,consts:[["stepper",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],["linear",""],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"ngSubmit","formGroup"],["translate","",1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","gap-3.75"],["formControlName","phone",1,"flex-1",3,"floatLabel","placeholder"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","xs:flex-col","xs:items-end","xs:justify-start"],[1,"mat-block","code-container","full-width-xs","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[4,"ngIf"],[1,"flex","gap-2"],["mat-button","","matStepperPrevious","",3,"disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-toolbar",1)(1,"h2",2),p(2,"security.2fa.dialog.enable-sms-title"),r(),f(3,"span",3),a(4,"button",4),y("click",function(){return x(s),I(t.closeDialog())}),a(5,"mat-icon",5),p(6,"close"),r()()(),b(7,hS,1,0,"mat-progress-bar",6),d(8,"async"),b(9,bS,1,0,"div",7),d(10,"async"),a(11,"div",8)(12,"mat-stepper",9,0),b(14,vS,2,0,"ng-template",10),a(15,"mat-step",11),b(16,yS,2,3,"ng-template",12),a(17,"form",13),y("ngSubmit",function(){return x(s),I(t.nextStep())}),a(18,"p",14),p(19,"security.2fa.dialog.sms-step-description"),r(),a(20,"div",15),f(21,"tb-phone-input",16),d(22,"translate"),a(23,"button",17),d(24,"async"),p(25),d(26,"translate"),r()()()(),a(27,"mat-step",11),b(28,_S,2,3,"ng-template",12),a(29,"form",13),y("ngSubmit",function(){return x(s),I(t.nextStep())}),a(30,"p",18),p(31),d(32,"translate"),r(),a(33,"div",19)(34,"mat-form-field",20),f(35,"input",21),d(36,"translate"),b(37,CS,3,3,"mat-error",22),r(),a(38,"div",23)(39,"button",24),d(40,"async"),p(41),d(42,"translate"),r(),a(43,"button",17),d(44,"async"),p(45),d(46,"translate"),r()()()()(),a(47,"mat-step"),b(48,SS,2,3,"ng-template",25),a(49,"div")(50,"h3",26),p(51,"security.2fa.dialog.success"),r(),a(52,"p",27),p(53,"security.2fa.dialog.activation-step-description-sms"),r(),a(54,"div",28)(55,"button",29),y("click",function(){return x(s),I(t.closeDialog())}),p(56),d(57,"translate"),r()()()()()()}n&2&&(o(7),l("ngIf",c(8,18,t.isLoading$)),o(2),l("ngIf",!c(10,20,t.isLoading$)),o(6),l("stepControl",t.smsConfigForm),o(2),l("formGroup",t.smsConfigForm),o(4),T("placeholder",c(22,22,"security.2fa.dialog.sms-step-label")),l("floatLabel","never"),o(2),l("disabled",c(24,24,t.isLoading$)||t.smsConfigForm.invalid),o(2),h(" ",c(26,26,"security.2fa.dialog.send-code")," "),o(2),l("stepControl",t.smsVerificationForm),o(2),l("formGroup",t.smsVerificationForm),o(2),h(" ",Nt(32,28,"security.2fa.dialog.verification-step-description",at(43,gS,t.smsConfigForm.get("phone").value))," "),o(4),T("placeholder",c(36,31,"security.2fa.dialog.verification-code")),o(2),l("ngIf",t.smsVerificationForm.get("verificationCode").invalid),o(2),l("disabled",c(40,33,t.isLoading$)),o(2),h(" ",c(42,35,"action.back")," "),o(2),l("disabled",c(44,37,t.isLoading$)||t.smsVerificationForm.invalid),o(2),h(" ",c(46,39,"action.activate")," "),o(11),h(" ",c(57,41,"action.done")," "))},dependencies:[V,Vi,K,Ce,ee,Oe,ge,me,De,He,Je,vn,hn,yn,Is,bn,fe,ue,W,z,ce,nn,Ia,X,oe,H,xo,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}return i})();C();var TS=["stepper"],xS=i=>({address:i});function IS(i,m){i&1&&f(0,"mat-progress-bar",31)}function ES(i,m){i&1&&f(0,"div",32)}function wS(i,m){i&1&&(a(0,"mat-icon"),p(1,"done"),r())}function MS(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.email-step-label"))}function DS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"user.email-required")," "))}function PS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"user.invalid-email-format")," "))}function FS(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.verification-step-label"))}function AS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function NS(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"security.2fa.dialog.activation-step-label"))}var bp=(()=>{class i extends et{constructor(e,n,t,s,u,_){super(e,n,u),this.store=e,this.router=n,this.twoFaService=t,this.data=s,this.dialogRef=u,this.fb=_,this.emailConfigForm=this.fb.group({email:[this.data.email,[S.required,S.email]]}),this.emailVerificationForm=this.fb.group({verificationCode:["",[S.required,S.minLength(6),S.maxLength(6),S.pattern(/^\d*$/)]]})}nextStep(){switch(this.stepper.selectedIndex){case 0:this.emailConfigForm.valid?(this.authAccountConfig={providerType:Et.EMAIL,useByDefault:!0,email:this.emailConfigForm.get("email").value},this.twoFaService.submitTwoFaAccountConfig(this.authAccountConfig).subscribe(()=>{this.stepper.next()})):this.showFormErrors(this.emailConfigForm);break;case 1:this.emailVerificationForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.emailVerificationForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):this.showFormErrors(this.emailVerificationForm);break}}closeDialog(){return this.dialogRef.close(this.config)}showFormErrors(e){Object.keys(e.controls).forEach(n=>{e.get(n).markAsTouched({onlySelf:!0})})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(rn),g(Mt),g(Ze),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-email-auth-dialog"]],viewQuery:function(n,t){if(n&1&&be(TS,5),n&2){let s;ve(s=ye())&&(t.stepper=s.first)}},features:[G],decls:61,vars:47,consts:[["stepper",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],[3,"linear"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"ngSubmit","formGroup"],["translate","",1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","gap-2"],[1,"mat-block","input-container","flex-1"],["matInput","","formControlName","email","type","email","required","",3,"placeholder"],[4,"ngIf"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","xs:flex-col","xs:items-end","xs:justify-start"],[1,"mat-block","code-container","full-width-xs","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[1,"flex","gap-2"],["mat-button","","matStepperPrevious","",3,"disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-toolbar",1)(1,"h2",2),p(2,"security.2fa.dialog.enable-email-title"),r(),f(3,"span",3),a(4,"button",4),y("click",function(){return x(s),I(t.closeDialog())}),a(5,"mat-icon",5),p(6,"close"),r()()(),b(7,IS,1,0,"mat-progress-bar",6),d(8,"async"),b(9,ES,1,0,"div",7),d(10,"async"),a(11,"div",8)(12,"mat-stepper",9,0),b(14,wS,2,0,"ng-template",10),a(15,"mat-step",11),b(16,MS,2,3,"ng-template",12),a(17,"form",13),y("ngSubmit",function(){return x(s),I(t.nextStep())}),a(18,"p",14),p(19,"security.2fa.dialog.email-step-description"),r(),a(20,"div",15)(21,"mat-form-field",16),f(22,"input",17),d(23,"translate"),b(24,DS,3,3,"mat-error",18)(25,PS,3,3,"mat-error",18),r(),a(26,"button",19),d(27,"async"),p(28),d(29,"translate"),r()()()(),a(30,"mat-step",11),b(31,FS,2,3,"ng-template",12),a(32,"form",13),y("ngSubmit",function(){return x(s),I(t.nextStep())}),a(33,"p",20),p(34),d(35,"translate"),r(),a(36,"div",21)(37,"mat-form-field",22),f(38,"input",23),d(39,"translate"),b(40,AS,3,3,"mat-error",18),r(),a(41,"div",24)(42,"button",25),d(43,"async"),p(44),d(45,"translate"),r(),a(46,"button",19),d(47,"async"),p(48),d(49,"translate"),r()()()()(),a(50,"mat-step"),b(51,NS,2,3,"ng-template",26),a(52,"div")(53,"h3",27),p(54,"security.2fa.dialog.success"),r(),a(55,"p",28),p(56,"security.2fa.dialog.activation-step-description-email"),r(),a(57,"div",29)(58,"button",30),y("click",function(){return x(s),I(t.closeDialog())}),p(59),d(60,"translate"),r()()()()()()}n&2&&(o(7),l("ngIf",c(8,20,t.isLoading$)),o(2),l("ngIf",!c(10,22,t.isLoading$)),o(3),l("linear",!0),o(3),l("stepControl",t.emailConfigForm),o(2),l("formGroup",t.emailConfigForm),o(5),T("placeholder",c(23,24,"security.2fa.dialog.email-step-label")),o(2),l("ngIf",t.emailConfigForm.get("email").hasError("required")),o(),l("ngIf",t.emailConfigForm.get("email").hasError("email")),o(),l("disabled",c(27,26,t.isLoading$)||t.emailConfigForm.invalid),o(2),h(" ",c(29,28,"security.2fa.dialog.send-code")," "),o(2),l("stepControl",t.emailVerificationForm),o(2),l("formGroup",t.emailVerificationForm),o(2),h(" ",Nt(35,30,"security.2fa.dialog.verification-step-description",at(45,xS,t.emailConfigForm.get("email").value))," "),o(4),T("placeholder",c(39,33,"security.2fa.dialog.verification-code")),o(2),l("ngIf",t.emailVerificationForm.get("verificationCode").invalid),o(2),l("disabled",c(43,35,t.isLoading$)),o(2),h(" ",c(45,37,"action.back")," "),o(2),l("disabled",c(47,39,t.isLoading$)||t.emailVerificationForm.invalid),o(2),h(" ",c(49,41,"action.activate")," "),o(11),h(" ",c(60,43,"action.done")," "))},dependencies:[V,Vi,K,Ce,ee,Oe,ge,me,De,He,Je,vn,hn,yn,Is,bn,fe,ue,W,z,ce,nn,Ia,X,oe,H,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}return i})();C();var yh=`<html lang="en">\r
<head>\r
    <meta name="viewport" content="width=device-width" />\r
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\r
    <title>Backup code</title>\r
\r
    <style>\r
        .code-block {\r
            display: flex;\r
            flex-wrap: wrap;\r
            margin-bottom: 16px;\r
        }\r
        .code-row {\r
            margin: 0 6px 8px;\r
            display: flex;\r
            min-width: 130px;\r
        }\r
        .code {\r
            font: 400 16px / 20px Roboto Mono, "Helvetica Neue", monospace;\r
            margin-left: 6px;\r
        }\r
        input[type="checkbox"] {\r
            -webkit-appearance: none;\r
            appearance: none;\r
            background-color: #fff;\r
            margin: 0;\r
            font: inherit;\r
            color: currentColor;\r
            width: 1em;\r
            height: 1em;\r
            border: 0.1em solid currentColor;\r
            border-radius: 0.15em;\r
            transform: translateY(0em);\r
        }\r
    </style>\r
</head>\r
\r
<body style="margin: 0">\r
    <div style="margin: 8px; max-width: 286px">\r
        <div style="border: #d0d7de solid 1px; border-radius:4px">\r
            <h3 style="padding: 16px 24px; margin: 0; font: 500 20px / 24px Roboto, 'Helvetica Neue', sans-serif; text-align: center">\r
                Backup codes\r
            </h3>\r
            <div class="code-block">\r
                \${codesBlock}\r
            </div>\r
        </div>\r
    </div>\r
</body>\r
</html>\r
`;function RS(i,m){i&1&&f(0,"mat-progress-bar",15)}function OS(i,m){i&1&&f(0,"div",16)}function BS(i,m){if(i&1&&(a(0,"div",17),p(1),r()),i&2){let e=m.$implicit,n=m.even;L("even",n),o(),h(" ",e," ")}}var vp=(()=>{class i extends et{constructor(e,n,t,s,u,_){super(e,n,u),this.store=e,this.router=n,this.twoFaService=t,this.importExportService=s,this.dialogRef=u,this.fb=_,this.twoFaService.generateTwoFaAccountConfig(Et.BACKUP_CODE).pipe(wt(E=>this.backupCode=E),yt(E=>this.twoFaService.verifyAndSaveTwoFaAccountConfig(E,null,{ignoreLoading:!0}))).subscribe(E=>{this.config=E})}closeDialog(){this.dialogRef.close(this.config)}downloadFile(){this.importExportService.exportText(this.backupCode.codes,"backup-codes")}printCode(){let e=Ue(this.backupCode.codes).map(s=>`<div class="code-row"><input type="checkbox"><span class="code">${s}</span></div>`).join(""),n=yh.replace("${codesBlock}",e),t=window.open("","Print backup code");t.document.open(),t.document.write(n),setTimeout(()=>{t.print(),t.document.close(),setTimeout(()=>{t.close()},10)},0)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(rn),g(Gi),g(Ze),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-backup-code-auth-dialog"]],features:[G],decls:29,vars:16,consts:[["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",1,"backup-code"],["translate","",1,"mat-body-2","description"],[1,"container","flex","flex-row","flex-wrap"],["class","code max-w-50% flex-full",3,"even",4,"ngFor","ngForOf"],[1,"action-buttons","flex","flex-row","items-center","justify-start","gap-4"],["type","button","mat-stroked-button","","color","primary",3,"click"],["type","button","mat-raised-button","","color","primary",3,"click"],[1,"flex","flex-row","items-start","justify-end"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"code","max-w-50%","flex-full"]],template:function(n,t){n&1&&(a(0,"mat-toolbar",0)(1,"h2",1),p(2,"security.2fa.dialog.get-backup-code-title"),r(),f(3,"span",2),a(4,"button",3),y("click",function(){return t.closeDialog()}),a(5,"mat-icon",4),p(6,"close"),r()()(),b(7,RS,1,0,"mat-progress-bar",5),d(8,"async"),b(9,OS,1,0,"div",6),d(10,"async"),a(11,"div",7)(12,"p",8),p(13,"security.2fa.dialog.backup-code-description"),r(),a(14,"div",9),b(15,BS,2,3,"div",10),r(),a(16,"div",11)(17,"button",12),y("click",function(){return t.downloadFile()}),p(18),d(19,"translate"),r(),a(20,"button",13),y("click",function(){return t.printCode()}),p(21),d(22,"translate"),r()(),a(23,"p",8),p(24,"security.2fa.dialog.backup-code-warn"),r(),a(25,"div",14)(26,"button",13),y("click",function(){return t.closeDialog()}),p(27),d(28,"translate"),r()()()),n&2&&(o(7),l("ngIf",c(8,6,t.isLoading$)),o(2),l("ngIf",!c(10,8,t.isLoading$)),o(6),l("ngForOf",t.backupCode==null?null:t.backupCode.codes),o(3),h(" ",c(19,10,"security.2fa.dialog.download-txt")," "),o(3),h(" ",c(22,12,"action.print")," "),o(6),h(" ",c(28,14,"action.done")," "))},dependencies:[we,V,Vi,K,Ce,ee,Oe,He,Je,H,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}return i})();var _h=new Map([[Et.TOTP,gp],[Et.SMS,hp],[Et.EMAIL,bp],[Et.BACKUP_CODE,vp]]);var dr=i=>({count:i});function VS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.incorrect-password-try-again")," "))}function LS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.password-not-meet-requirements")," "))}function jS(i,m){if(i&1&&(a(0,"mat-error"),p(1),r()),i&2){let e=v();o(),h(" ",e.changePassword.get("newPassword").getError("alreadyUsed")," ")}}function GS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.password-should-difference")," "))}function US(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.password-should-not-contain-spaces")," "))}function qS(i,m){i&1&&At(0)}function WS(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.new-passwords-not-match")," "))}function HS(i,m){i&1&&At(0)}function zS(i,m){if(i&1&&(a(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),d(4,"translate"),r()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("notUpperCase")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Nt(4,2,"security.password-requirement.uppercase-letter",at(5,dr,e.passwordPolicy.minimumUppercaseLetters))," ")}}function $S(i,m){if(i&1&&(a(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),d(4,"translate"),r()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("notLowerCase")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Nt(4,2,"security.password-requirement.lowercase-letter",at(5,dr,e.passwordPolicy.minimumLowercaseLetters))," ")}}function QS(i,m){if(i&1&&(a(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),d(4,"translate"),r()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("notNumeric")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Nt(4,2,"security.password-requirement.digit",at(5,dr,e.passwordPolicy.minimumDigits))," ")}}function JS(i,m){if(i&1&&(a(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),d(4,"translate"),r()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("notSpecial")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Nt(4,2,"security.password-requirement.special-character",at(5,dr,e.passwordPolicy.minimumSpecialCharacters))," ")}}function KS(i,m){if(i&1&&(a(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),d(4,"translate"),r()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("minLength")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Nt(4,2,"security.password-requirement.character",at(5,dr,e.passwordPolicy.minimumLength))," ")}}function YS(i,m){if(i&1&&(a(0,"div",34)(1,"h4",35),p(2,"security.password-requirement.at-most"),r(),a(3,"p",37),f(4,"mat-icon",39),p(5),d(6,"translate"),r()()),i&2){let e=v(3);o(4),l("svgIcon",e.changePassword.get("newPassword").hasError("maxLength")?"mdi:circle-small":"mdi:check"),o(),h(" ",Nt(6,2,"security.password-requirement.character",at(5,dr,e.passwordPolicy.maximumLength))," ")}}function XS(i,m){if(i&1&&(a(0,"div",34)(1,"h3",15),p(2,"security.password-requirement.password-requirements"),r(),a(3,"h4",35),p(4,"security.password-requirement.at-least"),r(),b(5,zS,5,7,"p",36)(6,$S,5,7,"p",36)(7,QS,5,7,"p",36)(8,JS,5,7,"p",36)(9,KS,5,7,"p",36)(10,YS,7,7,"div",33),r()),i&2){let e=v(2);o(5),l("ngIf",e.passwordPolicy.minimumUppercaseLetters>0),o(),l("ngIf",e.passwordPolicy.minimumLowercaseLetters>0),o(),l("ngIf",e.passwordPolicy.minimumDigits>0),o(),l("ngIf",e.passwordPolicy.minimumSpecialCharacters>0),o(),l("ngIf",e.passwordPolicy.minimumLength>0),o(),l("ngIf",e.passwordPolicy.maximumLength>0)}}function ZS(i,m){if(i&1&&b(0,XS,11,6,"div",33),i&2){let e=v();l("ngIf",e.passwordPolicy)}}function eT(i,m){if(i&1&&(a(0,"div",54),p(1),d(2,"translate"),r()),i&2){let e=v().$implicit,n=v(2);o(),h(" ",c(2,1,n.providersData.get(e).description)," ")}}function tT(i,m){if(i&1&&(a(0,"div",54),p(1),d(2,"translate"),r()),i&2){let e=v().$implicit,n=v(2);o(),h(" ",Nt(2,1,n.providersData.get(e).activatedHint,n.providerDataInfo(e))," ")}}function iT(i,m){if(i&1){let e=O();a(0,"mat-checkbox",55),d(1,"async"),y("change",function(t){x(e);let s=v().$implicit,u=v(2);return I(u.changeDefaultProvider(t,s))}),a(2,"span",56),p(3,"security.2fa.main-2fa-method"),r()()}if(i&2){let e=v().$implicit,n=v(2);l("value",e)("checked",n.useByDefault===e)("disabled",c(1,3,n.isLoading$))}}function nT(i,m){if(i&1){let e=O();a(0,"button",57),y("click",function(){x(e);let t=v(3);return I(t.generateNewBackupCode())}),p(1),d(2,"translate"),r()}i&2&&(o(),h(" ",c(2,1,"security.2fa.get-new-code")," "))}function oT(i,m){i&1&&f(0,"mat-divider")}function aT(i,m){if(i&1){let e=O();Ut(0),a(1,"div",47)(2,"h4",48),p(3),d(4,"translate"),r(),a(5,"div",49),b(6,eT,3,3,"div",50)(7,tT,3,4,"ng-template",null,2,xt),a(9,"mat-slide-toggle",51),y("mousedown",function(t){let s=x(e).$implicit,u=v(2);return I(u.confirm2FAChange(t,s))}),r()(),b(10,iT,4,5,"mat-checkbox",52)(11,nT,3,3,"button",53),r(),b(12,oT,1,0,"mat-divider",20),qt()}if(i&2){let e=m.$implicit,n=m.last,t=U(8),s=v(2);o(3),R(c(4,7,s.providersData.get(e).name)),o(3),l("ngIf",!s.twoFactorAuth.get(e).value)("ngIfElse",t),o(3),l("formControlName",e),o(),l("ngIf",s.twoFactorAuth.get(e).value&&e!==s.twoFactorAuthProviderType.BACKUP_CODE&&!s.activeSingleProvider),o(),l("ngIf",s.twoFactorAuth.get(e).value&&e===s.twoFactorAuthProviderType.BACKUP_CODE),o(),l("ngIf",!n)}}function rT(i,m){if(i&1&&(a(0,"mat-card",40)(1,"mat-card-title",41)(2,"span",6),p(3,"admin.2fa.2fa"),r()(),a(4,"mat-card-subtitle",42)(5,"div",43),p(6,"security.2fa.2fa-description"),r()(),a(7,"h3",44),p(8,"security.2fa.authenticate-with"),r(),a(9,"form",45),b(10,aT,13,9,"ng-container",46),r()()),i&2){let e=v();o(9),l("formGroup",e.twoFactorAuth),o(),l("ngForOf",e.allowTwoFactorProviders)("ngForTrackBy",e.trackByProvider)}}var yp=(()=>{class i extends It{get jwtToken(){return`Bearer ${localStorage.getItem("jwt_token")}`}get jwtTokenExpiration(){return localStorage.getItem("jwt_token_expiration")}get expirationJwtData(){let e=this.datePipe.transform(this.jwtTokenExpiration,"yyyy-MM-dd HH:mm:ss");return this.translate.instant("profile.valid-till",{expirationData:e})}constructor(e,n,t,s,u,_,E,w,q,Te){super(e),this.store=e,this.route=n,this.translate=t,this.twoFaService=s,this.dialog=u,this.dialogService=_,this.fb=E,this.datePipe=w,this.authService=q,this.clipboardService=Te,this.destroy$=new Ft,this.allowTwoFactorProviders=[],this.providersData=il,this.twoFactorAuthProviderType=Et,this.useByDefault=null,this.activeSingleProvider=!0}ngOnInit(){this.buildTwoFactorForm(),this.user=this.route.snapshot.data.user,this.twoFactorLoad(this.route.snapshot.data.providers),this.buildChangePasswordForm(),this.loadPasswordPolicy()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildTwoFactorForm(){this.twoFactorAuth=this.fb.group({TOTP:[!1],SMS:[!1],EMAIL:[!1],BACKUP_CODE:[{value:!1,disabled:!0}]}),this.twoFactorAuth.valueChanges.pipe(dt(this.destroy$)).subscribe(e=>{let n=Object.keys(e).filter(t=>e[t]&&t!==Et.BACKUP_CODE);this.activeSingleProvider=n.length<2,n.length?this.twoFactorAuth.get("BACKUP_CODE").enable({emitEvent:!1}):this.twoFactorAuth.get("BACKUP_CODE").disable({emitEvent:!1})})}twoFactorLoad(e){e.length&&(this.twoFaService.getAccountTwoFaSettings().subscribe(n=>this.processTwoFactorAuthConfig(n)),Object.values(Et).forEach(n=>{e.includes(n)&&this.allowTwoFactorProviders.push(n)}))}processTwoFactorAuthConfig(e){this.accountConfig=e?.configs||{},Object.values(Et).forEach(n=>{this.accountConfig[n]?(this.twoFactorAuth.get(n).setValue(!0),this.accountConfig[n].useByDefault&&(this.useByDefault=n)):this.twoFactorAuth.get(n).setValue(!1)})}buildChangePasswordForm(){this.changePassword=this.fb.group({currentPassword:[""],newPassword:["",S.required],newPassword2:["",this.samePasswordValidation(!1,"newPassword")]})}loadPasswordPolicy(){this.authService.getUserPasswordPolicy().subscribe(e=>{this.passwordPolicy=e,this.changePassword.get("newPassword").setValidators([this.passwordStrengthValidator(),this.samePasswordValidation(!0,"currentPassword"),S.required]),this.changePassword.get("newPassword").updateValueAndValidity({emitEvent:!1})})}passwordStrengthValidator(){return e=>{let n=e.value,t={};return this.passwordPolicy.minimumUppercaseLetters>0&&!new RegExp(`(?:.*?[A-Z]){${this.passwordPolicy.minimumUppercaseLetters}}`).test(n)&&(t.notUpperCase=!0),this.passwordPolicy.minimumLowercaseLetters>0&&!new RegExp(`(?:.*?[a-z]){${this.passwordPolicy.minimumLowercaseLetters}}`).test(n)&&(t.notLowerCase=!0),this.passwordPolicy.minimumDigits>0&&!new RegExp(`(?:.*?\\d){${this.passwordPolicy.minimumDigits}}`).test(n)&&(t.notNumeric=!0),this.passwordPolicy.minimumSpecialCharacters>0&&!new RegExp(`(?:.*?[\\W_]){${this.passwordPolicy.minimumSpecialCharacters}}`).test(n)&&(t.notSpecial=!0),!this.passwordPolicy.allowWhitespaces&&/\s/.test(n)&&(t.hasWhitespaces=!0),this.passwordPolicy.minimumLength>0&&n.length<this.passwordPolicy.minimumLength&&(t.minLength=!0),(!n.length||this.passwordPolicy.maximumLength>0&&n.length>this.passwordPolicy.maximumLength)&&(t.maxLength=!0),ns(t,{})?null:t}}samePasswordValidation(e,n){return t=>{let s=t.value,u=t.parent?.value[n];return e?s===u?{samePassword:!0}:null:s!==u?{differencePassword:!0}:null}}trackByProvider(e,n){return n}copyToken(){+this.jwtTokenExpiration<Date.now()?this.store.dispatch(new tt({message:this.translate.instant("profile.tokenCopiedWarnMessage"),type:"warn",duration:1500,verticalPosition:"bottom",horizontalPosition:"right"})):(this.clipboardService.copyFromContent(this.jwtToken),this.store.dispatch(new tt({message:this.translate.instant("profile.tokenCopiedSuccessMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"})))}confirm2FAChange(e,n){if(e.stopPropagation(),e.preventDefault(),!this.twoFactorAuth.get(n).disabled)if(this.twoFactorAuth.get(n).value){let t=this.translate.instant(`security.2fa.provider.${n.toLowerCase()}`);this.dialogService.confirm(this.translate.instant("security.2fa.disable-2fa-provider-title",{name:t}),this.translate.instant("security.2fa.disable-2fa-provider-text",{name:t})).subscribe(s=>{s&&(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.deleteTwoFaAccountConfig(n).pipe(wt(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(u=>this.processTwoFactorAuthConfig(u)))})}else this.createdNewAuthConfig(n)}createdNewAuthConfig(e){let n=e===Et.EMAIL?{email:this.user.email}:{};this.dialog.open(_h.get(e),{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:n}).afterClosed().subscribe(t=>{Re(t)&&this.processTwoFactorAuthConfig(t)})}changeDefaultProvider(e,n){this.useByDefault!==n?(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.updateTwoFaAccountConfig(n,!0).pipe(wt(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(t=>this.processTwoFactorAuthConfig(t))):e.source.checked=!0}generateNewBackupCode(){let e=this.accountConfig[Et.BACKUP_CODE].codesLeft,n;e?n=this.dialogService.confirm("Get new set of backup codes?",`If you get new backup codes, ${e} remaining codes you have left will be unusable.`,"","Get new codes"):n=ot(!0),n.subscribe(t=>{t&&(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.deleteTwoFaAccountConfig(Et.BACKUP_CODE).pipe(wt(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(()=>this.createdNewAuthConfig(Et.BACKUP_CODE)))})}providerDataInfo(e){let n={info:null},t=this.accountConfig[e];if(Re(t))switch(e){case Et.EMAIL:n.info=t.email;break;case Et.SMS:n.info=t.phoneNumber;break;case Et.BACKUP_CODE:n.info=t.codesLeft;break}return n}onChangePassword(e){this.changePassword.valid?this.authService.changePassword(this.changePassword.get("currentPassword").value,this.changePassword.get("newPassword").value,{ignoreErrors:!0}).subscribe(()=>{this.discardChanges(e)},n=>{n.status===400&&n.error.message==="Current password doesn't match!"?this.changePassword.get("currentPassword").setErrors({differencePassword:!0}):n.status===400&&n.error.message.startsWith("Password must")?this.loadPasswordPolicy():n.status===400&&n.error.message.startsWith("Password was already used")?this.changePassword.get("newPassword").setErrors({alreadyUsed:n.error.message}):this.store.dispatch(new tt({message:n.error.message,type:"error",target:"changePassword"}))}):this.changePassword.markAllAsTouched()}discardChanges(e,n){n&&n.stopPropagation(),e.resetForm({currentPassword:"",newPassword:"",newPassword2:""})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(Si),g(ie),g(rn),g(je),g(Lt),g(se),g(Ge),g(gn),g(f0))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-security"]],features:[G],decls:63,vars:41,consts:[["changePasswordForm","ngForm"],["passwordRequirements",""],["providerInfo",""],[1,"profile-container","flex","flex-col","gap-2"],["appearance","outlined",1,"profile-card","flex","flex-col"],[2,"margin-bottom","8px"],["translate","",1,"mat-headline-5","card-title"],[1,"flex","flex-row","items-center","justify-between"],[1,"token-text"],[1,"date"],["mat-raised-button","","color","primary","type","button",3,"click"],["tb-toast","","toastTarget","changePassword",1,"change-password"],[3,"ngSubmit","formGroup"],[1,"flex","flex-row","gap-6.25","xs:flex-col","xs:gap-0"],[1,"min-w-72.5","max-w-72.5","flex-1","basis-72.5","xs:min-w-0","xs:max-w-full","xs:basis-full","sm:min-w-62.5","sm:max-w-62.5","sm:basis-62.5"],["translate","",1,"card-title"],["appearance","fill","color","primary",1,"mat-block","same-color"],["translate",""],["matInput","","type","password","name","current-password","formControlName","currentPassword","autocomplete","current-password"],["matSuffix",""],[4,"ngIf"],["hideRequiredMarker","","appearance","fill","color","primary","subscriptSizing","dynamic",1,"mat-block","same-color"],["matInput","","type","password","name","new-password","formControlName","newPassword","autocomplete","new-password","required",""],[1,"flex","flex-1","items-center","justify-start","gt-xs:!hidden"],[4,"ngTemplateOutlet"],["hideRequiredMarker","","appearance","fill","color","primary",1,"mat-block","same-color"],["matInput","","type","password","name","new-password","formControlName","newPassword2","autocomplete","new-password","required",""],[3,"vertical"],[1,"flex","flex-1","items-start","justify-start","xs:!hidden"],[1,"flex","flex-row","gap-2",2,"margin-top","18px"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outlined","class","profile-card",4,"ngIf"],["class","password-requirements",4,"ngIf"],[1,"password-requirements"],["translate","",1,"mat-h4"],["class","mat-body",4,"ngIf"],[1,"mat-body"],[1,"tb-mat-20"],[1,"tb-mat-20",3,"svgIcon"],["appearance","outlined",1,"profile-card"],[2,"margin-bottom","20px"],[2,"margin-bottom","40px"],["translate","",1,"mat-body-2","description"],["translate","",1,"mat-h3","auth-title"],[3,"formGroup"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"provider"],[1,"provider-title"],[1,"flex","flex-row","items-start","justify-between"],["class","mat-body-2 description",4,"ngIf","ngIfElse"],[3,"mousedown","formControlName"],[3,"value","checked","disabled","change",4,"ngIf"],["type","button","mat-stroked-button","","color","primary",3,"click",4,"ngIf"],[1,"mat-body-2","description"],[3,"change","value","checked","disabled"],["translate","",1,"checkbox-label"],["type","button","mat-stroked-button","","color","primary",3,"click"]],template:function(n,t){if(n&1){let s=O();a(0,"div",3)(1,"mat-card",4)(2,"mat-card-title",5)(3,"span",6),p(4,"profile.jwt-token"),r()(),a(5,"div",7)(6,"div",8),p(7),d(8,"translate"),a(9,"span",9),p(10),d(11,"date"),r()(),a(12,"button",10),y("click",function(){return x(s),I(t.copyToken())}),a(13,"span"),p(14),d(15,"translate"),r()()()(),a(16,"mat-card",4)(17,"div",11)(18,"form",12,0),y("ngSubmit",function(){x(s);let _=U(19);return I(t.onChangePassword(_))}),a(20,"div",13)(21,"div",14)(22,"h3",15),p(23,"profile.change-password"),r(),a(24,"mat-form-field",16)(25,"mat-label",17),p(26,"profile.current-password"),r(),f(27,"input",18)(28,"tb-toggle-password",19),b(29,VS,3,3,"mat-error",20),r(),a(30,"mat-form-field",21)(31,"mat-label",17),p(32,"login.new-password"),r(),f(33,"input",22)(34,"tb-toggle-password",19)(35,"mat-hint"),b(36,LS,3,3,"mat-error",20)(37,jS,2,1,"mat-error",20)(38,GS,3,3,"mat-error",20)(39,US,3,3,"mat-error",20),r(),a(40,"div",23),b(41,qS,1,0,"ng-container",24),r(),a(42,"mat-form-field",25)(43,"mat-label",17),p(44,"login.new-password-again"),r(),f(45,"input",26)(46,"tb-toggle-password",19),b(47,WS,3,3,"mat-error",20),r()(),f(48,"mat-divider",27),a(49,"div",28),b(50,HS,1,0,"ng-container",24),r()(),b(51,ZS,1,1,"ng-template",null,1,xt),a(53,"div",29)(54,"button",30),d(55,"async"),y("click",function(_){x(s);let E=U(19);return I(t.discardChanges(E,_))}),p(56),d(57,"translate"),r(),a(58,"button",31),d(59,"async"),p(60),d(61,"translate"),r()()()()(),b(62,rT,11,3,"mat-card",32),r()}if(n&2){let s=U(52);o(7),h("",c(8,26,"profile.token-valid-till")," "),o(3),R(Nt(11,28,t.jwtTokenExpiration,"yyyy-MM-dd HH:mm:ss")),o(4),R(c(15,31,"profile.copy-jwt-token")),o(4),l("formGroup",t.changePassword),o(10),L("!hidden",!t.changePassword.get("currentPassword").dirty&&!t.changePassword.get("currentPassword").touched),o(),l("ngIf",t.changePassword.get("currentPassword").hasError("differencePassword")),o(5),L("!hidden",!t.changePassword.get("newPassword").dirty&&!t.changePassword.get("newPassword").touched),o(2),l("ngIf",t.changePassword.get("newPassword").errors&&!t.changePassword.get("newPassword").hasError("alreadyUsed")&&!t.changePassword.get("newPassword").hasError("hasWhitespaces")&&!t.changePassword.get("newPassword").hasError("samePassword")),o(),l("ngIf",t.changePassword.get("newPassword").hasError("alreadyUsed")),o(),l("ngIf",t.changePassword.get("newPassword").hasError("samePassword")),o(),l("ngIf",t.changePassword.get("newPassword").hasError("hasWhitespaces")),o(2),l("ngTemplateOutlet",s),o(5),L("!hidden",!t.changePassword.get("newPassword2").dirty&&!t.changePassword.get("newPassword2").touched),o(),l("ngIf",t.changePassword.get("newPassword2").hasError("differencePassword")),o(),l("vertical",!0),o(2),l("ngTemplateOutlet",s),o(3),L("!hidden",!t.changePassword.dirty&&!t.changePassword.touched),o(),l("disabled",c(55,33,t.isLoading$)),o(2),h(" ",c(57,35,"action.discard-changes")," "),o(2),l("disabled",c(59,37,t.isLoading$)),o(2),h(" ",c(61,39,"profile.change-password")," "),o(2),l("ngIf",t.allowTwoFactorProviders.length)}},dependencies:[we,V,go,Vi,K,$t,ee,ti,Ju,vi,ge,me,Ie,zt,De,ei,xi,it,fe,ue,W,z,ce,X,oe,H,Qs,ji,le,Ge,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .profile-container[_ngcontent-%COMP%]{padding:8px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{padding:24px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:55%}}@media screen and (min-width: 1920px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.15px;margin-top:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-h4[_ngcontent-%COMP%]{font-weight:500;font-size:14px;letter-spacing:.25px;margin:0 0 4px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-divider.mat-divider-vertical[_ngcontent-%COMP%]{margin-bottom:25px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:4px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .password-requirements[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{margin:0 0 8px;letter-spacing:.25px;color:#000000de}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-icon[data-mat-icon-name=check][_ngcontent-%COMP%]{color:#24a148}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .auth-title[_ngcontent-%COMP%]{font-weight:500;margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .token-text[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;letter-spacing:.25px;padding:8px 0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .token-text[_ngcontent-%COMP%] > .date[_ngcontent-%COMP%]{opacity:.7}[_nghost-%COMP%]   .description[_ngcontent-%COMP%]{color:#0000008a;letter-spacing:.25px;margin-right:8px}[_nghost-%COMP%]   .mat-divider-horizontal[_ngcontent-%COMP%]{left:16px;right:16px;width:auto}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]{padding:24px 0}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .provider-title[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;letter-spacing:.25px;margin:0 0 8px}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{max-width:85%}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.25px;opacity:.87}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:8px}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .mat-mdc-outlined-button[_ngcontent-%COMP%]{margin-top:8px}']})}}return i})();C();var Ch=(()=>{class i{constructor(e,n){this.store=e,this.userService=n}resolve(){let e=Bt(this.store).userId;return this.userService.getUser(e)}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(Bn))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),Sh=(()=>{class i{constructor(e){this.twoFactorAuthService=e}resolve(){return this.twoFactorAuthService.getAvailableTwoFaProviders()}static{this.\u0275fac=function(n){return new(n||i)(N(rn))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),Th=[{path:"security",component:yp,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN,M.CUSTOMER_USER],title:"security.security",breadcrumb:{label:"security.security",icon:"lock"}},resolve:{user:Ch,providers:Sh}}],sT=[{path:"security",redirectTo:"/account/security"}],_p=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Ch,Sh],imports:[j.forChild(sT),j]})}}return i})();(function(){Y(_p,{imports:[j],exports:[j]})})();var Cp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,_p]})}}return i})();(function(){Y(Cp,{declarations:[yp,gp,hp,bp,vp],imports:[ae,re,_p]})})();C();C();C();var Sp=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,n,t,s,u),this.store=e,this.fb=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.cd=u,this.countryData=_}buildForm(e){let n=this.buildEntityForm(e);return n.addControl("country",this.fb.control(e?e.country:"",[S.maxLength(255)])),n.addControl("city",this.fb.control(e?e.city:"",[S.maxLength(255)])),n.addControl("state",this.fb.control(e?e.state:"",[S.maxLength(255)])),n.addControl("zip",this.fb.control(e?e.zip:"",this.zipValidators(e?e.country:""))),n.addControl("address",this.fb.control(e?e.address:"",[])),n.addControl("address2",this.fb.control(e?e.address2:"",[])),n.addControl("phone",this.fb.control(e?e.phone:"",[S.maxLength(255)])),n.addControl("email",this.fb.control(e?e.email:"",[S.email])),n}updateForm(e){this.updateEntityForm(e),this.entityForm.patchValue({country:e.country}),this.entityForm.patchValue({city:e.city}),this.entityForm.patchValue({state:e.state}),this.entityForm.get("zip").setValidators(this.zipValidators(e.country)),this.entityForm.patchValue({zip:e.zip}),this.entityForm.patchValue({address:e.address}),this.entityForm.patchValue({address2:e.address2}),this.entityForm.patchValue({phone:e.phone}),this.entityForm.patchValue({email:e.email})}ngAfterViewInit(){this.entityForm.get("country").valueChanges.subscribe(e=>{this.entityForm.get("zip").setValidators(this.zipValidators(e)),this.entityForm.get("zip").updateValueAndValidity({onlySelf:!0}),this.entityForm.get("zip").markAsTouched({onlySelf:!0})})}zipValidators(e){let n=[];if(e){let t=this.countryData.allCountries.find(s=>s.name===e)?.postCodePattern;t&&n.push(S.pattern(t))}return n}static{this.\u0275fac=function(n){iu()}}static{this.\u0275dir=Kr({type:i,features:[G]})}}return i})();function mT(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"tenant.title-required")," "))}function dT(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"tenant.title-max-length")," "))}function cT(i,m){if(i&1&&(a(0,"section",17)(1,"section",18),f(2,"tb-dashboard-autocomplete",19),d(3,"translate"),a(4,"mat-checkbox",20),p(5),d(6,"translate"),r()()()),i&2){let e=v();o(2),T("label",c(3,5,"dashboard.home-dashboard")),l("dashboardsScope","tenant")("tenantId",e.entity==null?null:e.entity.id.id)("selectFirstDashboard",!1),o(3),h(" ",c(6,7,"dashboard.home-dashboard-hide-toolbar")," ")}}var Tp=(()=>{class i extends Sp{constructor(e,n,t,s,u,_,E){super(e,u,t,s,_,E),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.fb=u,this.cd=_,this.countryData=E}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildEntityForm(e){return this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],tenantProfileId:[e?e.tenantProfileId:null,[S.required]],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Re(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateEntityForm(e){this.entityForm.patchValue({title:e.title}),this.entityForm.patchValue({tenantProfileId:e.tenantProfileId}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Re(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}updateFormState(){this.entityForm&&(this.isEditValue?this.entityForm.enable({emitEvent:!1}):this.entityForm.disable({emitEvent:!1}))}onTenantIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("tenant.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onTenantProfileUpdated(){this.entitiesTableConfig.updateData(!1)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(se),g(Xe),g(Js))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-tenant"]],features:[G],decls:36,vars:38,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["required","","formControlName","tenantProfileId",3,"tenantProfileUpdated","selectDefaultProfile","showDetailsPageLink"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[3,"parentForm","isEdit"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"manageTenantAdmins")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(11),d(12,"translate"),r(),a(13,"div",2)(14,"button",3),y("cbOnSuccess",function(u){return t.onTenantIdCopied(u)}),f(15,"mat-icon",4),a(16,"span",5),p(17,"tenant.copyId"),r()()()(),a(18,"div",6)(19,"form",7)(20,"fieldset",8),d(21,"async"),a(22,"mat-form-field",9)(23,"mat-label",5),p(24,"tenant.title"),r(),f(25,"input",10),b(26,mT,3,3,"mat-error",11)(27,dT,3,3,"mat-error",11),r(),a(28,"tb-tenant-profile-autocomplete",12),y("tenantProfileUpdated",function(){return t.onTenantProfileUpdated()}),r(),a(29,"div",13)(30,"mat-form-field",9)(31,"mat-label",5),p(32,"tenant.description"),r(),f(33,"textarea",14),r(),b(34,cT,7,9,"section",15),r(),f(35,"tb-contact",16),r()()()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,24,t.isLoading$)),o(2),h(" ",c(4,26,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(6,28,t.isLoading$)),o(2),h(" ",c(8,30,"tenant.manage-tenant-admins")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(10,32,t.isLoading$)),o(2),h(" ",c(12,34,"tenant.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),l("formGroup",t.entityForm),o(),l("disabled",c(21,36,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("title").hasError("required")),o(),l("ngIf",t.entityForm.get("title").hasError("maxlength")),o(),l("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),o(6),l("ngIf",t.entity==null?null:t.entity.id),o(),l("parentForm",t.entityForm)("isEdit",t.isEdit))},dependencies:[V,_n,K,$t,ee,ge,me,Ie,De,ii,fe,ue,W,z,ce,X,oe,ft,H,$s,Sg,le,k],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}return i})();C();C();C();function uT(i,m){if(i&1&&(a(0,"mat-tab",6,0),d(2,"translate"),f(3,"tb-attribute-table",7),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function fT(i,m){if(i&1&&(a(0,"mat-tab",6,1),d(2,"translate"),f(3,"tb-attribute-table",8),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function gT(i,m){if(i&1&&(a(0,"mat-tab",6,2),d(2,"translate"),f(3,"tb-alarm-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function hT(i,m){if(i&1&&(a(0,"mat-tab",6,3),d(2,"translate"),f(3,"tb-event-table",10),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"tenant.events")),o(3),l("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.nullUid)("entityId",n.entity.id)}}function bT(i,m){if(i&1&&(a(0,"mat-tab",6,4),d(2,"translate"),f(3,"tb-relation-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}var xp=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-tenant-tabs"]],features:[G],decls:5,vars:5,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"]],template:function(n,t){n&1&&b(0,uT,4,7,"mat-tab",5)(1,fT,4,7,"mat-tab",5)(2,gT,4,5,"mat-tab",5)(3,hT,4,7,"mat-tab",5)(4,bT,4,5,"mat-tab",5),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity))},dependencies:[V,Pt,qi,Wi,Ei,wi,k],encapsulation:2})}}return i})();var Ip=(()=>{class i{constructor(e,n,t,s){this.tenantService=e,this.translate=n,this.datePipe=t,this.router=s,this.config=new Qe,this.config.entityType=B.TENANT,this.config.entityComponent=Tp,this.config.entityTabsComponent=xp,this.config.entityTranslations=$e.get(B.TENANT),this.config.entityResources=_t.get(B.TENANT),this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("title","tenant.title","20%"),new te("tenantProfileName","tenant-profile.tenant-profile","20%"),new te("email","contact.email","20%"),new te("country","contact.country","20%"),new te("city","contact.city","20%")),this.config.cellActionDescriptors.push({name:this.translate.instant("tenant.manage-tenant-admins"),icon:"account_circle",isEnabled:()=>!0,onAction:(u,_)=>this.manageTenantAdmins(u,_)}),this.config.deleteEntityTitle=u=>this.translate.instant("tenant.delete-tenant-title",{tenantTitle:u.title}),this.config.deleteEntityContent=()=>this.translate.instant("tenant.delete-tenant-text"),this.config.deleteEntitiesTitle=u=>this.translate.instant("tenant.delete-tenants-title",{count:u}),this.config.deleteEntitiesContent=()=>this.translate.instant("tenant.delete-tenants-text"),this.config.entitiesFetchFunction=u=>this.tenantService.getTenantInfos(u),this.config.loadEntity=u=>this.tenantService.getTenantInfo(u.id),this.config.saveEntity=u=>this.tenantService.saveTenant(u).pipe(yt(_=>this.tenantService.getTenantInfo(_.id.id))),this.config.deleteEntity=u=>this.tenantService.deleteTenant(u.id),this.config.onEntityAction=u=>this.onTenantAction(u,this.config)}resolve(){return this.config.tableTitle=this.translate.instant("tenant.tenants"),this.config}openTenant(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}manageTenantAdmins(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`tenants/${n.id.id}/users`)}onTenantAction(e,n){switch(e.action){case"open":return this.openTenant(e.event,e.entity,n),!0;case"manageTenantAdmins":return this.manageTenantAdmins(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(As),N(ie),N(Ge),N(de))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();function yT(i,m){if(i&1){let e=O();a(0,"button",1),d(1,"async"),y("click",function(t){x(e);let s=v();return I(s.onEntityAction(t,"loginAsUser"))}),p(2),d(3,"translate"),r()}if(i&2){let e=v();L("!hidden",e.isEdit),l("disabled",c(1,4,e.isLoading$)),o(2),h(" ",c(3,6,(e.entity==null?null:e.entity.authority)===e.authority.TENANT_ADMIN?"user.login-as-tenant-admin":"user.login-as-customer-user")," ")}}function _T(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"user.invalid-email-format")," "))}function CT(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"user.email-required")," "))}function ST(i,m){if(i&1&&(a(0,"section",19)(1,"section",20),f(2,"tb-dashboard-autocomplete",21),d(3,"translate"),a(4,"mat-checkbox",22),p(5),d(6,"translate"),r()(),a(7,"section",20),f(8,"tb-dashboard-autocomplete",23),d(9,"translate"),a(10,"mat-checkbox",24),p(11),d(12,"translate"),r()()()),i&2){let e=v();o(2),T("label",c(3,12,"user.default-dashboard")),l("dashboardsScope",(e.entity==null?null:e.entity.authority)===e.authority.TENANT_ADMIN?"tenant":"customer")("tenantId",e.entity==null||e.entity.tenantId==null?null:e.entity.tenantId.id)("customerId",e.entity==null||e.entity.customerId==null?null:e.entity.customerId.id)("selectFirstDashboard",!1),o(3),h(" ",c(6,14,"user.always-fullscreen")," "),o(3),T("label",c(9,16,"dashboard.home-dashboard")),l("dashboardsScope",(e.entity==null?null:e.entity.authority)===e.authority.TENANT_ADMIN?"tenant":"customer")("tenantId",e.entity==null||e.entity.tenantId==null?null:e.entity.tenantId.id)("customerId",e.entity==null||e.entity.customerId==null?null:e.entity.customerId.id)("selectFirstDashboard",!1),o(3),h(" ",c(12,18,"dashboard.home-dashboard-hide-toolbar")," ")}}var No=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,s,n,t,u),this.store=e,this.entityValue=n,this.entitiesTableConfigValue=t,this.fb=s,this.cd=u,this.translate=_,this.authority=M,this.loginAsUserEnabled$=this.store.pipe(Ht(os),mt(E=>E.userTokenAccessEnabled))}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isUserCredentialsEnabled(){return this.entity.additionalInfo.userCredentialsEnabled===!0}isUserCredentialPresent(){return Re(this.entity?.additionalInfo?.userCredentialsEnabled)}buildForm(e){return this.fb.group({email:[e?e.email:"",[S.required,S.email]],firstName:[e?e.firstName:""],lastName:[e?e.lastName:""],phone:[e?e.phone:""],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],defaultDashboardId:[e&&e.additionalInfo?e.additionalInfo.defaultDashboardId:null],defaultDashboardFullscreen:[e&&e.additionalInfo?e.additionalInfo.defaultDashboardFullscreen:!1],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Re(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateForm(e){this.entityForm.patchValue({email:e.email}),this.entityForm.patchValue({firstName:e.firstName}),this.entityForm.patchValue({lastName:e.lastName}),this.entityForm.patchValue({phone:e.phone}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{defaultDashboardId:e.additionalInfo?e.additionalInfo.defaultDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{defaultDashboardFullscreen:e.additionalInfo?e.additionalInfo.defaultDashboardFullscreen:!1}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Re(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}onUserIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("user.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(n){return new(n||i)(g(P),g("entity",8),g("entitiesTableConfig",8),g(se),g(Xe),g(ie))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-user"]],features:[G],decls:59,vars:69,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled","!hidden","click",4,"ngIf"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["formControlName","phone",3,"required","label","enableFlagsSelect"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","defaultDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","defaultDashboardFullscreen",1,"flex-1"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"disableAccount")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"enableAccount")}),p(11),d(12,"translate"),r(),a(13,"button",1),d(14,"async"),y("click",function(u){return t.onEntityAction(u,"displayActivationLink")}),p(15),d(16,"translate"),r(),a(17,"button",1),d(18,"async"),y("click",function(u){return t.onEntityAction(u,"resendActivation")}),p(19),d(20,"translate"),r(),b(21,yT,4,8,"button",2),d(22,"async"),a(23,"button",1),d(24,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(25),d(26,"translate"),r(),a(27,"div",3)(28,"button",4),d(29,"async"),y("cbOnSuccess",function(u){return t.onUserIdCopied(u)}),f(30,"mat-icon",5),a(31,"span",6),p(32,"user.copyId"),r()()()(),a(33,"div",7)(34,"form",8)(35,"fieldset",9),d(36,"async"),a(37,"mat-form-field",10)(38,"mat-label",6),p(39,"user.email"),r(),f(40,"input",11),b(41,_T,3,3,"mat-error",12)(42,CT,3,3,"mat-error",12),r(),a(43,"mat-form-field",10)(44,"mat-label",6),p(45,"user.first-name"),r(),f(46,"input",13),r(),a(47,"mat-form-field",10)(48,"mat-label",6),p(49,"user.last-name"),r(),f(50,"input",14),r(),f(51,"tb-phone-input",15),d(52,"translate"),a(53,"div",16)(54,"mat-form-field",10)(55,"mat-label",6),p(56,"user.description"),r(),f(57,"textarea",17),r(),b(58,ST,13,20,"section",18),r()()()()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,37,t.isLoading$)),o(2),h(" ",c(4,39,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit||!t.isUserCredentialPresent()||!t.isUserCredentialsEnabled()),l("disabled",c(6,41,t.isLoading$)),o(2),h(" ",c(8,43,"user.disable-account")," "),o(2),L("!hidden",t.isEdit||!t.isUserCredentialPresent()||t.isUserCredentialsEnabled()),l("disabled",c(10,45,t.isLoading$)),o(2),h(" ",c(12,47,"user.enable-account")," "),o(2),L("!hidden",t.isEdit||t.isUserCredentialPresent()),l("disabled",c(14,49,t.isLoading$)),o(2),h(" ",c(16,51,"user.display-activation-link")," "),o(2),L("!hidden",t.isEdit||t.isUserCredentialPresent()),l("disabled",c(18,53,t.isLoading$)),o(2),h(" ",c(20,55,"user.resend-activation")," "),o(2),l("ngIf",c(22,57,t.loginAsUserEnabled$)),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(24,59,t.isLoading$)),o(2),h(" ",c(26,61,"user.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",c(29,63,t.isLoading$)),o(6),l("formGroup",t.entityForm),o(),l("disabled",c(36,65,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("email").hasError("email")),o(),l("ngIf",t.entityForm.get("email").hasError("required")),o(9),T("label",c(52,67,"contact.phone")),l("required",!1)("enableFlagsSelect",!0),o(7),l("ngIf",t.entity==null?null:t.entity.id))},dependencies:[V,_n,K,$t,ee,ge,me,Ie,De,ii,fe,ue,W,z,ce,X,oe,ft,H,xo,le,k],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}return i})();C();C();var xT=(i,m)=>({activationLink:i,activationLinkTtl:m});function IT(i,m){i&1&&f(0,"mat-progress-bar",17)}function ET(i,m){i&1&&f(0,"div",18)}var cr=(()=>{class i extends et{constructor(e,n,t,s,u,_){super(e,n,s),this.store=e,this.router=n,this.data=t,this.dialogRef=s,this.translate=u,this.millisecondsToTimeStringPipe=_,this.activationLink=this.data.activationLinkInfo.value,this.activationLinkTtl=this.millisecondsToTimeStringPipe.transform(this.data.activationLinkInfo.ttlMs)}close(){this.dialogRef.close()}onActivationLinkCopied(){this.store.dispatch(new tt({message:this.translate.instant("user.activation-link-copied-message"),type:"success",target:"activationLinkDialogContent",duration:1200,verticalPosition:"bottom",horizontalPosition:"left"}))}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(Ze),g(ie),g(m0))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-activation-link-dialog"]],features:[G],decls:28,vars:24,consts:[[2,"min-width","400px","position","relative"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","activationLinkDialogContent"],[1,"mat-content","flex","flex-col"],[3,"innerHTML"],[1,"flex","flex-row","items-center","justify-start"],[1,"tb-highlight","flex-1"],["mat-icon-button","","color","primary","ngxClipboard","","matTooltipPosition","above",3,"cbOnSuccess","cbContent","matTooltip"],["svgIcon","mdi:clipboard-arrow-left"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(a(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"user.activation-link"),r(),f(4,"span",3),a(5,"button",4),y("click",function(){return t.close()}),a(6,"mat-icon",5),p(7,"close"),r()()(),b(8,IT,1,0,"mat-progress-bar",6),d(9,"async"),b(10,ET,1,0,"div",7),d(11,"async"),a(12,"div",8)(13,"div",9),f(14,"span",10),d(15,"translate"),a(16,"div",11)(17,"pre",12)(18,"code"),p(19),r()(),a(20,"button",13),d(21,"translate"),y("cbOnSuccess",function(){return t.onActivationLinkCopied()}),f(22,"mat-icon",14),r()()()(),a(23,"div",15)(24,"button",16),d(25,"async"),y("click",function(){return t.close()}),p(26),d(27,"translate"),r()()()),n&2&&(o(8),l("ngIf",c(9,8,t.isLoading$)),o(2),l("ngIf",!c(11,10,t.isLoading$)),o(4),l("innerHTML",Nt(15,12,"user.activation-link-text",ma(21,xT,t.activationLink,t.activationLinkTtl)),sn),o(5),R(t.activationLink),o(),T("cbContent",t.activationLink),T("matTooltip",c(21,15,"user.copy-activation-link")),o(4),l("disabled",c(25,17,t.isLoading$)),o(2),h(" ",c(27,19,"action.ok")," "))},dependencies:[V,Vi,K,Ce,ee,Oe,He,Ct,Je,Dt,ii,fe,z,Yi,H,le,k],encapsulation:2})}}return i})();var wT=()=>({standalone:!0});function MT(i,m){i&1&&f(0,"mat-progress-bar",16)}function DT(i,m){i&1&&f(0,"div",17)}function PT(i,m){if(i&1&&(a(0,"mat-option",18),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.activationMethodTranslations.get(n.activationMethodEnum[e]))," ")}}var Ep=(()=>{class i extends et{constructor(e,n,t,s,u,_){super(e,n,s),this.store=e,this.router=n,this.data=t,this.dialogRef=s,this.userService=u,this.dialog=_,this.activationMethods=Object.keys(Za),this.activationMethodEnum=Za,this.activationMethodTranslations=ng,this.activationMethod=Za.DISPLAY_ACTIVATION_LINK}ngOnInit(){this.user={},this.userComponent.isEdit=!0,this.userComponent.entity=this.user,this.detailsForm=this.userComponent.entityForm}cancel(){this.dialogRef.close(null)}add(){if(this.detailsForm.valid){this.user=_e(_e({},this.user),this.userComponent.entityForm.value),this.user.authority=this.data.authority,this.user.tenantId=new rs(this.data.tenantId),this.user.customerId=new va(this.data.customerId);let e=this.activationMethod===Za.SEND_ACTIVATION_MAIL;this.userService.saveUser(this.user,e).subscribe(n=>{this.activationMethod===Za.DISPLAY_ACTIVATION_LINK?this.userService.getActivationLinkInfo(n.id.id).subscribe(t=>{this.displayActivationLink(t).subscribe(()=>{this.dialogRef.close(n)})}):this.dialogRef.close(n)})}}displayActivationLink(e){return this.dialog.open(cr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{activationLinkInfo:e}}).afterClosed()}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(Ze),g(Bn),g(je))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-add-user-dialog"]],viewQuery:function(n,t){if(n&1&&be(No,7),n&2){let s;ve(s=ye())&&(t.userComponent=s.first)}},features:[G],decls:29,vars:23,consts:[[2,"min-width","450px",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block"],[3,"ngModelChange","ngModelOptions","ngModel"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"]],template:function(n,t){n&1&&(a(0,"form",0),y("ngSubmit",function(){return t.add()}),a(1,"mat-toolbar",1)(2,"h2",2),p(3,"user.add"),r(),f(4,"span",3)(5,"div",4),a(6,"button",5),y("click",function(){return t.cancel()}),a(7,"mat-icon",6),p(8,"close"),r()()(),b(9,MT,1,0,"mat-progress-bar",7),d(10,"async"),b(11,DT,1,0,"div",8),d(12,"async"),a(13,"div",9),f(14,"tb-user"),a(15,"mat-form-field",10)(16,"mat-label",2),p(17,"user.activation-method"),r(),a(18,"mat-select",11),pt("ngModelChange",function(u){return lt(t.activationMethod,u)||(t.activationMethod=u),u}),b(19,PT,3,4,"mat-option",12),r()()(),a(20,"div",13)(21,"button",14),d(22,"async"),y("click",function(){return t.cancel()}),p(23),d(24,"translate"),r(),a(25,"button",15),d(26,"async"),p(27),d(28,"translate"),r()()()),n&2&&(o(5),l("tb-help","users"),o(4),l("ngIf",c(10,10,t.isLoading$)),o(2),l("ngIf",!c(12,12,t.isLoading$)),o(7),l("ngModelOptions",Rt(22,wT)),st("ngModel",t.activationMethod),o(),l("ngForOf",t.activationMethods),o(2),l("disabled",c(22,14,t.isLoading$)),o(2),h(" ",c(24,16,"action.cancel")," "),o(2),l("disabled",c(26,18,t.isLoading$)||t.detailsForm.invalid||!t.detailsForm.dirty),o(2),h(" ",c(28,20,"action.add")," "))},dependencies:[we,V,Tt,K,Ce,ee,Oe,me,Ie,He,Ct,Je,St,ct,fe,W,z,ut,Yi,H,No,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-padding{padding:0}']})}}return i})();C();function FT(i,m){if(i&1&&(a(0,"mat-tab",5,0),d(2,"translate"),f(3,"tb-attribute-table",6),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function AT(i,m){if(i&1&&(a(0,"mat-tab",5,1),d(2,"translate"),f(3,"tb-attribute-table",7),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function NT(i,m){if(i&1&&(a(0,"mat-tab",5,2),d(2,"translate"),f(3,"tb-relation-table",8),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function kT(i,m){if(i&1&&(a(0,"mat-tab",5,3),d(2,"translate"),f(3,"tb-audit-log-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.USER)("userId",n.entity.id)}}var wp=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-user-tabs"]],features:[G],decls:4,vars:4,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],["detailsMode","true",3,"active","auditLogMode","userId"]],template:function(n,t){n&1&&b(0,FT,4,7,"mat-tab",4)(1,AT,4,7,"mat-tab",4)(2,NT,4,5,"mat-tab",4)(3,kT,4,6,"mat-tab",4),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[V,Pt,Ci,Wi,wi,k],encapsulation:2})}}return i})();var so=(()=>{class i{constructor(e,n,t,s,u,_,E,w,q){this.store=e,this.userService=n,this.authService=t,this.tenantService=s,this.customerService=u,this.translate=_,this.datePipe=E,this.router=w,this.dialog=q,this.config=new Qe,this.config.entityType=B.USER,this.config.entityComponent=No,this.config.entityTabsComponent=wp,this.config.entityTranslations=$e.get(B.USER),this.config.entityResources=_t.get(B.USER),this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("firstName","user.first-name","33%"),new te("lastName","user.last-name","33%"),new te("email","user.email","33%")),this.config.deleteEnabled=Te=>Te&&Te.id&&Te.id.id!==this.authUser.id.id,this.config.deleteEntityTitle=Te=>this.translate.instant("user.delete-user-title",{userEmail:Te.email}),this.config.deleteEntityContent=()=>this.translate.instant("user.delete-user-text"),this.config.deleteEntitiesTitle=Te=>this.translate.instant("user.delete-users-title",{count:Te}),this.config.deleteEntitiesContent=()=>this.translate.instant("user.delete-users-text"),this.config.loadEntity=Te=>this.userService.getUser(Te.id),this.config.saveEntity=Te=>this.saveUser(Te),this.config.deleteEntity=Te=>this.userService.deleteUser(Te.id),this.config.onEntityAction=Te=>this.onUserAction(Te,this.config),this.config.addEntity=()=>this.addUser()}resolve(e){let n=e.params;return this.store.pipe(Ht(os),gi(1)).pipe(wt(t=>{this.authUser=t.userDetails,this.authority=n.tenantId?M.TENANT_ADMIN:M.CUSTOMER_USER,this.authority===M.TENANT_ADMIN?(this.tenantId=n.tenantId,this.customerId=Be,this.config.entitiesFetchFunction=s=>this.userService.getTenantAdmins(this.tenantId,s)):(this.tenantId=this.authUser.tenantId.id,this.customerId=n.customerId,this.config.entitiesFetchFunction=s=>this.userService.getCustomerUsers(this.customerId,s)),this.updateActionCellDescriptors(t)}),yt(()=>this.authority===M.TENANT_ADMIN?this.tenantService.getTenant(this.tenantId):Re(this.customerId)?this.customerService.getCustomer(this.customerId):ot({title:""})),mt(t=>(this.authority===M.TENANT_ADMIN?this.config.tableTitle=t.title+": "+this.translate.instant("user.tenant-admins"):this.config.tableTitle=t.title+": "+this.translate.instant("user.customer-users"),this.config)))}updateActionCellDescriptors(e){this.config.cellActionDescriptors.splice(0),e.userTokenAccessEnabled&&this.config.cellActionDescriptors.push({name:this.authority===M.TENANT_ADMIN?this.translate.instant("user.login-as-tenant-admin"):this.translate.instant("user.login-as-customer-user"),icon:"mdi:login",isEnabled:()=>!0,onAction:(n,t)=>this.loginAsUser(n,t)})}saveUser(e){return e.tenantId=new rs(this.tenantId),e.customerId=new va(this.customerId),e.authority=this.authority,this.userService.saveUser(e)}addUser(){return this.dialog.open(Ep,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{tenantId:this.tenantId,customerId:this.customerId,authority:this.authority}}).afterClosed()}openUser(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}loginAsUser(e,n){e&&e.stopPropagation(),this.authService.loginAsUser(n.id.id).subscribe()}displayActivationLink(e,n){e&&e.stopPropagation(),this.userService.getActivationLinkInfo(n.id.id).subscribe(t=>{this.dialog.open(cr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{activationLinkInfo:t}})})}resendActivation(e,n){e&&e.stopPropagation(),this.userService.sendActivationEmail(n.email).subscribe(()=>{this.store.dispatch(new tt({message:this.translate.instant("user.activation-email-sent-message"),type:"success"}))})}setUserCredentialsEnabled(e,n,t){e&&e.stopPropagation(),this.userService.setUserCredentialsEnabled(n.id.id,t).subscribe(()=>{n.additionalInfo||(n.additionalInfo={}),n.additionalInfo.userCredentialsEnabled=t,this.store.dispatch(new tt({message:this.translate.instant(t?"user.enable-account-message":"user.disable-account-message"),type:"success"}))})}onUserAction(e,n){switch(e.action){case"open":return this.openUser(e.event,e.entity,n),!0;case"loginAsUser":return this.loginAsUser(e.event,e.entity),!0;case"displayActivationLink":return this.displayActivationLink(e.event,e.entity),!0;case"resendActivation":return this.resendActivation(e.event,e.entity),!0;case"disableAccount":return this.setUserCredentialsEnabled(e.event,e.entity,!1),!0;case"enableAccount":return this.setUserCredentialsEnabled(e.event,e.entity,!0),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(Bn),N(gn),N(As),N(on),N(ie),N(Ge),N(de),N(je))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var RT=[{path:"tenants",data:{breadcrumb:{menuId:xe.tenants}},children:[{path:"",component:qe,data:{auth:[M.SYS_ADMIN],title:"tenant.tenants"},resolve:{entitiesTableConfig:Ip}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"supervisor_account"},auth:[M.SYS_ADMIN],title:"tenant.tenants"},resolve:{entitiesTableConfig:Ip}},{path:":tenantId/users",data:{breadcrumb:{label:"user.tenant-admins",icon:"account_circle"}},children:[{path:"",component:qe,data:{auth:[M.SYS_ADMIN],title:"user.tenant-admins"},resolve:{entitiesTableConfig:so}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"account_circle"},auth:[M.SYS_ADMIN],title:"user.tenant-admins"},resolve:{entitiesTableConfig:so}}]}]}],Mp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Ip],imports:[j.forChild(RT),j]})}}return i})();(function(){Y(Mp,{imports:[j],exports:[j]})})();var Dp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Mp]})}}return i})();(function(){Y(Dp,{declarations:[Tp,xp],imports:[ae,re,Ee,Mp]})})();C();C();function OT(i,m){if(i&1){let e=O();a(0,"button",1),d(1,"async"),y("click",function(t){x(e);let s=v();return I(s.onEntityAction(t,"manageEdges"))}),p(2),d(3,"translate"),r()}if(i&2){let e=v();L("!hidden",e.isEdit),l("disabled",c(1,4,e.isLoading$)),o(2),h(" ",c(3,6,"customer.manage-edges")," ")}}function BT(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"customer.title-required")," "))}function VT(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"customer.title-max-length")," "))}function LT(i,m){if(i&1&&(a(0,"section",17)(1,"section",18),f(2,"tb-dashboard-autocomplete",19),d(3,"translate"),a(4,"mat-checkbox",20),p(5),d(6,"translate"),r()()()),i&2){let e=v();o(2),T("label",c(3,5,"dashboard.home-dashboard")),l("dashboardsScope","customer")("customerId",e.entity==null?null:e.entity.id.id)("selectFirstDashboard",!1),o(3),h(" ",c(6,7,"dashboard.home-dashboard-hide-toolbar")," ")}}var Pp=(()=>{class i extends Sp{constructor(e,n,t,s,u,_,E){super(e,u,t,s,_,E),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.fb=u,this.cd=_,this.countryData=E,this.isPublic=!1,this.authState=fn(this.store)}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildEntityForm(e){return this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Re(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateEntityForm(e){this.isPublic=e.additionalInfo&&e.additionalInfo.isPublic,this.entityForm.patchValue({title:e.title}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Re(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}onCustomerIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("customer.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}edgesSupportEnabled(){return this.authState.edgesSupportEnabled}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(se),g(Xe),g(Js))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-customer"]],features:[G],decls:48,vars:63,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled","!hidden","click",4,"ngIf"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[3,"parentForm","isEdit"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"manageUsers")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"manageAssets")}),p(11),d(12,"translate"),r(),a(13,"button",1),d(14,"async"),y("click",function(u){return t.onEntityAction(u,"manageDevices")}),p(15),d(16,"translate"),r(),a(17,"button",1),d(18,"async"),y("click",function(u){return t.onEntityAction(u,"manageDashboards")}),p(19),d(20,"translate"),r(),b(21,OT,4,8,"button",2),a(22,"button",1),d(23,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(24),d(25,"translate"),r(),a(26,"div",3)(27,"button",4),y("cbOnSuccess",function(u){return t.onCustomerIdCopied(u)}),f(28,"mat-icon",5),a(29,"span",6),p(30,"customer.copyId"),r()()()(),a(31,"div",7)(32,"form",8)(33,"fieldset",9),d(34,"async"),a(35,"mat-form-field",10)(36,"mat-label",6),p(37,"customer.title"),r(),f(38,"input",11),b(39,BT,3,3,"mat-error",12)(40,VT,3,3,"mat-error",12),r(),a(41,"div",13)(42,"mat-form-field",10)(43,"mat-label",6),p(44,"customer.description"),r(),f(45,"textarea",14),r(),b(46,LT,7,9,"section",15),r(),f(47,"tb-contact",16),r()()()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,37,t.isLoading$)),o(2),h(" ",c(4,39,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit||t.isPublic),l("disabled",c(6,41,t.isLoading$)),o(2),h(" ",c(8,43,"customer.manage-users")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(10,45,t.isLoading$)),o(2),h(" ",c(12,47,"customer.manage-assets")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(14,49,t.isLoading$)),o(2),h(" ",c(16,51,"customer.manage-devices")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(18,53,t.isLoading$)),o(2),h(" ",c(20,55,"customer.manage-dashboards")," "),o(2),l("ngIf",t.edgesSupportEnabled()),o(),L("!hidden",t.hideDelete()||t.isEdit||t.isPublic),l("disabled",c(23,57,t.isLoading$)),o(2),h(" ",c(25,59,"customer.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),l("formGroup",t.entityForm),o(),L("!hidden",t.isPublic),l("disabled",c(34,61,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("title").hasError("required")),o(),l("ngIf",t.entityForm.get("title").hasError("maxlength")),o(6),l("ngIf",t.entity==null?null:t.entity.id),o(),l("parentForm",t.entityForm)("isEdit",t.isEdit))},dependencies:[V,_n,K,$t,ee,ge,me,Ie,De,ii,fe,ue,W,z,ce,X,oe,ft,H,$s,le,k],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}return i})();C();C();C();function jT(i,m){if(i&1&&(a(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function GT(i,m){if(i&1&&(a(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function UT(i,m){if(i&1&&(a(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function qT(i,m){if(i&1&&(a(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"customer.events")),o(3),l("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function WT(i,m){if(i&1&&(a(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-relation-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function HT(i,m){if(i&1&&(a(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",13),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.CUSTOMER)("customerId",n.entity.id)}}function zT(i,m){if(i&1){let e=O();a(0,"mat-tab",8,6),d(2,"translate"),a(3,"tb-version-control",14),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Fp=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-customer-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","customerId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,jT,4,7,"mat-tab",7)(1,GT,4,7,"mat-tab",7)(2,UT,4,5,"mat-tab",7)(3,qT,4,7,"mat-tab",7)(4,WT,4,5,"mat-tab",7)(5,HT,4,6,"mat-tab",7)(6,zT,4,7,"mat-tab",7),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[V,Pt,Ci,qi,Wi,Ei,wi,di,k],encapsulation:2})}}return i})();var Ap=(()=>{class i{constructor(e,n,t,s,u,_){this.customerService=e,this.homeDialogs=n,this.translate=t,this.datePipe=s,this.router=u,this.store=_,this.config=new Qe,this.config.entityType=B.CUSTOMER,this.config.entityComponent=Pp,this.config.entityTabsComponent=Fp,this.config.entityTranslations=$e.get(B.CUSTOMER),this.config.entityResources=_t.get(B.CUSTOMER);let E=fn(this.store);this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("title","customer.title","25%"),new te("email","contact.email","25%"),new te("country","contact.country","25%"),new te("city","contact.city","25%")),this.config.cellActionDescriptors.push({name:this.translate.instant("customer.manage-customer-users"),icon:"account_circle",isEnabled:w=>!w.additionalInfo||!w.additionalInfo.isPublic,onAction:(w,q)=>this.manageCustomerUsers(w,q)},{name:this.translate.instant("customer.manage-customer-assets"),nameFunction:w=>w.additionalInfo&&w.additionalInfo.isPublic?this.translate.instant("customer.manage-public-assets"):this.translate.instant("customer.manage-customer-assets"),icon:"domain",isEnabled:w=>!0,onAction:(w,q)=>this.manageCustomerAssets(w,q)},{name:this.translate.instant("customer.manage-customer-devices"),nameFunction:w=>w.additionalInfo&&w.additionalInfo.isPublic?this.translate.instant("customer.manage-public-devices"):this.translate.instant("customer.manage-customer-devices"),icon:"devices_other",isEnabled:w=>!0,onAction:(w,q)=>this.manageCustomerDevices(w,q)},{name:this.translate.instant("customer.manage-customer-dashboards"),nameFunction:w=>w.additionalInfo&&w.additionalInfo.isPublic?this.translate.instant("customer.manage-public-dashboards"):this.translate.instant("customer.manage-customer-dashboards"),icon:"dashboard",isEnabled:w=>!0,onAction:(w,q)=>this.manageCustomerDashboards(w,q)}),E.edgesSupportEnabled&&this.config.cellActionDescriptors.push({name:this.translate.instant("customer.manage-customer-edges"),nameFunction:w=>w.additionalInfo&&w.additionalInfo.isPublic?this.translate.instant("customer.manage-public-edges"):this.translate.instant("customer.manage-customer-edges"),icon:"router",isEnabled:w=>!0,onAction:(w,q)=>this.manageCustomerEdges(w,q)}),this.config.deleteEntityTitle=w=>this.translate.instant("customer.delete-customer-title",{customerTitle:w.title}),this.config.deleteEntityContent=()=>this.translate.instant("customer.delete-customer-text"),this.config.deleteEntitiesTitle=w=>this.translate.instant("customer.delete-customers-title",{count:w}),this.config.deleteEntitiesContent=()=>this.translate.instant("customer.delete-customers-text"),this.config.entitiesFetchFunction=w=>this.customerService.getCustomers(w),this.config.loadEntity=w=>this.customerService.getCustomer(w.id),this.config.saveEntity=w=>this.customerService.saveCustomer(w),this.config.deleteEntity=w=>this.customerService.deleteCustomer(w.id),this.config.onEntityAction=w=>this.onCustomerAction(w,this.config),this.config.deleteEnabled=w=>w&&(!w.additionalInfo||!w.additionalInfo.isPublic),this.config.entitySelectionEnabled=w=>w&&(!w.additionalInfo||!w.additionalInfo.isPublic),this.config.detailsReadonly=w=>w&&w.additionalInfo&&w.additionalInfo.isPublic}resolve(){return this.config.tableTitle=this.translate.instant("customer.customers"),this.config}openCustomer(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}manageCustomerUsers(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/users`)}manageCustomerAssets(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/assets`)}manageCustomerDevices(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/devices`)}manageCustomerDashboards(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/dashboards`)}manageCustomerEdges(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/edgeInstances`)}onCustomerAction(e,n){switch(e.action){case"open":return this.openCustomer(e.event,e.entity,n),!0;case"manageUsers":return this.manageCustomerUsers(e.event,e.entity),!0;case"manageAssets":return this.manageCustomerAssets(e.event,e.entity),!0;case"manageDevices":return this.manageCustomerDevices(e.event,e.entity),!0;case"manageDashboards":return this.manageCustomerDashboards(e.event,e.entity),!0;case"manageEdges":return this.manageCustomerEdges(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(on),N(Ui),N(ie),N(Ge),N(de),N(P))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();C();C();C();var Np=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.defaultDeviceConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.defaultDeviceConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.defaultDeviceConfigurationFormGroup.disable({emitEvent:!1}):this.defaultDeviceConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.defaultDeviceConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.defaultDeviceConfigurationFormGroup.valid&&(e=this.defaultDeviceConfigurationFormGroup.getRawValue().configuration,e.type=Ns.DEFAULT),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-default-device-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(n,t){n&1&&f(0,"form",0),n&2&&l("formGroup",t.defaultDeviceConfigurationFormGroup)},dependencies:[fe,z,X],encapsulation:2})}}return i})();function QT(i,m){if(i&1&&f(0,"tb-default-device-configuration",3),i&2){let e=v();l("required",e.required)}}var kp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.deviceProfileType=Ns,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.deviceConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceConfigurationFormGroup.disable({emitEvent:!1}):this.deviceConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.type=e?.type;let n=Ue(e);n&&delete n.type,this.deviceConfigurationFormGroup.patchValue({configuration:n},{emitEvent:!1})}updateModel(){let e=null;this.deviceConfigurationFormGroup.valid&&(e=this.deviceConfigurationFormGroup.getRawValue().configuration,e.type=this.type),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:3,vars:3,consts:[[3,"formGroup"],[3,"ngSwitch"],[3,"ngSwitchCase"],["formControlName","configuration",3,"required"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1),b(2,QT,1,1,"ng-template",2),r()()),n&2&&(l("formGroup",t.deviceConfigurationFormGroup),o(),l("ngSwitch",t.type),o(),l("ngSwitchCase",t.deviceProfileType.DEFAULT))},dependencies:[Rn,On,W,z,ce,X,oe,Np],encapsulation:2})}}return i})();C();C();var Rp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.defaultDeviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.defaultDeviceTransportConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.defaultDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.defaultDeviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.defaultDeviceTransportConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.defaultDeviceTransportConfigurationFormGroup.valid&&(e=this.defaultDeviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=Ai.DEFAULT),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-default-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(n,t){n&1&&f(0,"form",0),n&2&&l("formGroup",t.defaultDeviceTransportConfigurationFormGroup)},dependencies:[fe,z,X],encapsulation:2})}}return i})();C();var Op=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.mqttDeviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.mqttDeviceTransportConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.mqttDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.mqttDeviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.mqttDeviceTransportConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.mqttDeviceTransportConfigurationFormGroup.valid&&(e=this.mqttDeviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=Ai.MQTT),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mqtt-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(n,t){n&1&&f(0,"form",0),n&2&&l("formGroup",t.mqttDeviceTransportConfigurationFormGroup)},dependencies:[fe,z,X],encapsulation:2})}}return i})();C();var Bp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.destroy$=new Ft,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.coapDeviceTransportForm=this.fb.group({powerMode:[null],edrxCycle:[{disabled:!0,value:0},S.required],psmActivityTimer:[{disabled:!0,value:0},S.required],pagingTransmissionWindow:[{disabled:!0,value:0},S.required]}),this.coapDeviceTransportForm.valueChanges.pipe(dt(this.destroy$)).subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.coapDeviceTransportForm.disable({emitEvent:!1}):(this.coapDeviceTransportForm.enable({emitEvent:!1}),this.coapDeviceTransportForm.get("powerMode").updateValueAndValidity({onlySelf:!0}))}writeValue(e){Re(e)?this.coapDeviceTransportForm.patchValue(e,{emitEvent:!1}):this.coapDeviceTransportForm.get("powerMode").patchValue(null,{emitEvent:!1}),this.disabled||this.coapDeviceTransportForm.get("powerMode").updateValueAndValidity({onlySelf:!0})}updateModel(){let e=null;this.coapDeviceTransportForm.valid&&(e=this.coapDeviceTransportForm.value,e.type=Ai.COAP),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-coap-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:2,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],[3,"parentForm","isDeviceSetting"]],template:function(n,t){n&1&&(a(0,"form",0),f(1,"tb-power-mode-settings",1),r()),n&2&&(l("formGroup",t.coapDeviceTransportForm),o(),l("parentForm",t.coapDeviceTransportForm)("isDeviceSetting",!0))},dependencies:[fe,z,X,sl],encapsulation:2})}}return i})();C();var Vp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.destroy$=new Ft,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.lwm2mDeviceTransportConfigurationFormGroup=this.fb.group({powerMode:[null],edrxCycle:[{disabled:!0,value:0},S.required],psmActivityTimer:[{disabled:!0,value:0},S.required],pagingTransmissionWindow:[{disabled:!0,value:0},S.required]}),this.lwm2mDeviceTransportConfigurationFormGroup.valueChanges.pipe(dt(this.destroy$)).subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.lwm2mDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):(this.lwm2mDeviceTransportConfigurationFormGroup.enable({emitEvent:!1}),this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").updateValueAndValidity({onlySelf:!0}))}writeValue(e){Re(e)?this.lwm2mDeviceTransportConfigurationFormGroup.patchValue(e,{emitEvent:!1}):this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").patchValue(null,{emitEvent:!1}),this.disabled||this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").updateValueAndValidity({onlySelf:!0})}updateModel(){let e=null;this.lwm2mDeviceTransportConfigurationFormGroup.valid&&(e=this.lwm2mDeviceTransportConfigurationFormGroup.value,e.type=Ai.LWM2M),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-lwm2m-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:2,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],[3,"parentForm","isDeviceSetting"]],template:function(n,t){n&1&&(a(0,"form",0),f(1,"tb-power-mode-settings",1),r()),n&2&&(l("formGroup",t.lwm2mDeviceTransportConfigurationFormGroup),o(),l("parentForm",t.lwm2mDeviceTransportConfigurationFormGroup)("isDeviceSetting",!0))},dependencies:[fe,z,X,sl],encapsulation:2})}}return i})();C();function tx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.host-required")," "))}function ix(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.port-required")," "))}function nx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.port-format")," "))}function ox(i,m){if(i&1&&(a(0,"mat-option",10),p(1),d(2,"lowercase"),r()),i&2){let e=m.$implicit;l("value",e),o(),h(" ",c(2,2,e)," ")}}function ax(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.protocol-version-required")," "))}function rx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.community-required")," "))}function sx(i,m){if(i&1&&(a(0,"section")(1,"mat-form-field",11)(2,"mat-label",3),p(3,"device-profile.snmp.community"),r(),f(4,"input",12),b(5,rx,3,3,"mat-error",5),r()()),i&2){let e=v();o(5),l("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("community").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("community").hasError("pattern"))}}function lx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.user-name-required")," "))}function px(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.security-name-required")," "))}function mx(i,m){if(i&1&&(a(0,"mat-option",10),p(1),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",n.snmpAuthenticationProtocolTranslation.get(e)," ")}}function dx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.authentication-protocol-required")," "))}function cx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.authentication-passphrase-required")," "))}function ux(i,m){if(i&1&&(a(0,"mat-option",10),p(1),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",n.snmpPrivacyProtocolTranslation.get(e)," ")}}function fx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.privacy-protocol-required")," "))}function gx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.privacy-passphrase-required")," "))}function hx(i,m){if(i&1&&(a(0,"section")(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"device-profile.snmp.user-name"),r(),f(5,"input",13),b(6,lx,3,3,"mat-error",5),r(),a(7,"mat-form-field",2)(8,"mat-label",3),p(9,"device-profile.snmp.security-name"),r(),f(10,"input",14),b(11,px,3,3,"mat-error",5),r()(),a(12,"div",1)(13,"mat-form-field",15)(14,"mat-label",3),p(15,"device-profile.snmp.authentication-protocol"),r(),a(16,"mat-select",16),b(17,mx,2,2,"mat-option",9),r(),b(18,dx,3,3,"mat-error",5),r(),a(19,"mat-form-field",2)(20,"mat-label",3),p(21,"device-profile.snmp.authentication-passphrase"),r(),f(22,"input",17),b(23,cx,3,3,"mat-error",5),r()(),a(24,"div",1)(25,"mat-form-field",15)(26,"mat-label",3),p(27,"device-profile.snmp.privacy-protocol"),r(),a(28,"mat-select",18),b(29,ux,2,2,"mat-option",9),r(),b(30,fx,3,3,"mat-error",5),r(),a(31,"mat-form-field",2)(32,"mat-label",3),p(33,"device-profile.snmp.privacy-passphrase"),r(),f(34,"input",19),b(35,gx,3,3,"mat-error",5),r()(),a(36,"div",1)(37,"mat-form-field",2)(38,"mat-label",3),p(39,"device-profile.snmp.context-name"),r(),f(40,"input",20),r(),a(41,"mat-form-field",2)(42,"mat-label",3),p(43,"device-profile.snmp.engine-id"),r(),f(44,"input",21),r()()()),i&2){let e=v();o(6),l("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("username").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("username").hasError("pattern")),o(5),l("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("securityName").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("securityName").hasError("pattern")),o(6),l("ngForOf",e.snmpAuthenticationProtocols),o(),l("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").hasError("required")),o(5),l("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").hasError("pattern")),o(6),l("ngForOf",e.snmpPrivacyProtocols),o(),l("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").hasError("required")),o(5),l("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").hasError("pattern"))}}var Lp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.snmpDeviceProtocolVersions=Object.values(Oo),this.snmpAuthenticationProtocols=Object.values(Qd),this.snmpAuthenticationProtocolTranslation=k0,this.snmpPrivacyProtocols=Object.values(Jd),this.snmpPrivacyProtocolTranslation=R0,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.snmpDeviceTransportConfigurationFormGroup=this.fb.group({host:["",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],port:[null,[S.required,S.min(0),S.pattern("[0-9]*")]],protocolVersion:[Oo.V2C,S.required],community:["public",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],username:["",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],securityName:["public",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],contextName:[null],authenticationProtocol:[Qd.SHA_512,S.required],authenticationPassphrase:["",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],privacyProtocol:[Jd.DES,S.required],privacyPassphrase:["",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],engineId:[""]}),this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").valueChanges.subscribe(e=>{this.updateDisabledFormValue(e)}),this.snmpDeviceTransportConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}validate(){return this.snmpDeviceTransportConfigurationFormGroup.valid?null:{snmpDeviceTransportConfiguration:!1}}setDisabledState(e){this.disabled=e,this.disabled?this.snmpDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):(this.snmpDeviceTransportConfigurationFormGroup.enable({emitEvent:!1}),this.updateDisabledFormValue(this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").value||Oo.V2C))}writeValue(e){Re(e)&&(this.snmpDeviceTransportConfigurationFormGroup.patchValue(e,{emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.enabled&&this.updateDisabledFormValue(e.protocolVersion||Oo.V2C))}isV3protocolVersion(){return this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").value===Oo.V3}updateDisabledFormValue(e){e===Oo.V3?(this.snmpDeviceTransportConfigurationFormGroup.get("community").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("username").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("securityName").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("contextName").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("engineId").enable({emitEvent:!1})):(this.snmpDeviceTransportConfigurationFormGroup.get("community").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("username").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("securityName").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("contextName").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("engineId").disable({emitEvent:!1}))}updateModel(){let e=null;this.snmpDeviceTransportConfigurationFormGroup.valid&&(e=this.snmpDeviceTransportConfigurationFormGroup.value,e.type=Ai.SNMP),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-snmp-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:21,vars:8,consts:[[1,"flex","flex-col","gap-2","pb-4",3,"formGroup"],[1,"flex","flex-row","gap-2","xs:flex-col"],[1,"flex-1"],["translate",""],["matInput","","formControlName","host","required",""],[4,"ngIf"],["matInput","","formControlName","port","type","number","min","0","required",""],["floatLabel","always","hideRequiredMarker","",1,"mat-block"],["formControlName","protocolVersion","required",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mat-block"],["matInput","","formControlName","community","required",""],["matInput","","formControlName","username","required",""],["matInput","","formControlName","securityName","required",""],["floatLabel","always","hideRequiredMarker","",1,"flex-1"],["formControlName","authenticationProtocol","required",""],["matInput","","formControlName","authenticationPassphrase","required",""],["formControlName","privacyProtocol","required",""],["matInput","","formControlName","privacyPassphrase","required",""],["matInput","","formControlName","contextName"],["matInput","","formControlName","engineId"]],template:function(n,t){n&1&&(a(0,"form",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"device-profile.snmp.host"),r(),f(5,"input",4),b(6,tx,3,3,"mat-error",5),r(),a(7,"mat-form-field",2)(8,"mat-label",3),p(9,"device-profile.snmp.port"),r(),f(10,"input",6),b(11,ix,3,3,"mat-error",5)(12,nx,3,3,"mat-error",5),r()(),a(13,"mat-form-field",7)(14,"mat-label",3),p(15,"device-profile.snmp.protocol-version"),r(),a(16,"mat-select",8),b(17,ox,3,4,"mat-option",9),r(),b(18,ax,3,3,"mat-error",5),r(),b(19,sx,6,1,"section",5)(20,hx,45,8,"section",5),r()),n&2&&(l("formGroup",t.snmpDeviceTransportConfigurationFormGroup),o(6),l("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("host").hasError("required")||t.snmpDeviceTransportConfigurationFormGroup.get("host").hasError("pattern")),o(5),l("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("required")),o(),l("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("pattern")||t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("min")),o(5),l("ngForOf",t.snmpDeviceProtocolVersions),o(),l("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").hasError("required")),o(),l("ngIf",!t.isV3protocolVersion()),o(),l("ngIf",t.isV3protocolVersion()))},dependencies:[we,V,ge,me,Ie,De,St,ct,fe,ue,Ti,W,z,ce,Li,X,oe,H,au,k],encapsulation:2})}}return i})();function vx(i,m){if(i&1&&f(0,"tb-default-device-transport-configuration",3),i&2){let e=v();l("required",e.required)}}function yx(i,m){if(i&1&&f(0,"tb-mqtt-device-transport-configuration",3),i&2){let e=v();l("required",e.required)}}function _x(i,m){if(i&1&&f(0,"tb-lwm2m-device-transport-configuration",3),i&2){let e=v();l("required",e.required)}}function Cx(i,m){if(i&1&&f(0,"tb-coap-device-transport-configuration",3),i&2){let e=v();l("required",e.required)}}function Sx(i,m){if(i&1&&f(0,"tb-snmp-device-transport-configuration",3),i&2){let e=v();l("required",e.required)}}var jp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.deviceTransportType=Ai,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.deviceTransportConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.deviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.transportType=e?.type;let n=Ue(e);n&&delete n.type,this.deviceTransportConfigurationFormGroup.patchValue({configuration:n},{emitEvent:!1})}validate(){return this.deviceTransportConfigurationFormGroup.valid?null:{deviceTransportConfiguration:!1}}updateModel(){let e=null;this.deviceTransportConfigurationFormGroup.valid&&(e=this.deviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=this.transportType),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:7,vars:7,consts:[[3,"formGroup"],[3,"ngSwitch"],[3,"ngSwitchCase"],["formControlName","configuration",3,"required"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1),b(2,vx,1,1,"ng-template",2)(3,yx,1,1,"ng-template",2)(4,_x,1,1,"ng-template",2)(5,Cx,1,1,"ng-template",2)(6,Sx,1,1,"ng-template",2),r()()),n&2&&(l("formGroup",t.deviceTransportConfigurationFormGroup),o(),l("ngSwitch",t.transportType),o(),l("ngSwitchCase",t.deviceTransportType.DEFAULT),o(),l("ngSwitchCase",t.deviceTransportType.MQTT),o(),l("ngSwitchCase",t.deviceTransportType.LWM2M),o(),l("ngSwitchCase",t.deviceTransportType.COAP),o(),l("ngSwitchCase",t.deviceTransportType.SNMP))},dependencies:[Rn,On,W,z,ce,X,oe,Rp,Op,Bp,Vp,Lp],encapsulation:2})}}return i})();function xx(i,m){i&1&&(a(0,"mat-expansion-panel",3)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",4),p(4,"device.device-configuration"),r()()(),f(5,"tb-device-configuration",5),r()),i&2&&l("expanded",!0)}function Ix(i,m){i&1&&(a(0,"mat-expansion-panel",3)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",4),p(4,"device.transport-configuration"),r()()(),f(5,"tb-device-transport-configuration",6),r()),i&2&&l("expanded",!0)}var Gp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}constructor(e,n){this.store=e,this.fb=n,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceDataFormGroup=this.fb.group({configuration:[null,S.required],transportConfiguration:[null,S.required]}),this.deviceDataFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceDataFormGroup.disable({emitEvent:!1}):this.deviceDataFormGroup.enable({emitEvent:!1})}writeValue(e){let n=e?.configuration?.type;this.displayDeviceConfiguration=n&&F0.get(n).hasDeviceConfiguration;let t=e?.transportConfiguration?.type;this.displayTransportConfiguration=t&&N0.get(t).hasDeviceConfiguration,this.deviceDataFormGroup.patchValue({configuration:e?.configuration},{emitEvent:!1}),this.deviceDataFormGroup.patchValue({transportConfiguration:e?.transportConfiguration},{emitEvent:!1})}validate(){return this.deviceDataFormGroup.valid?null:{deviceDataForm:!1}}updateModel(){let e=null;this.deviceDataFormGroup.valid&&(e=this.deviceDataFormGroup.getRawValue()),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device-data"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:4,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],["multi","true"],[3,"expanded",4,"ngIf"],[3,"expanded"],["translate",""],["formControlName","configuration","required",""],["formControlName","transportConfiguration","required",""]],template:function(n,t){n&1&&(a(0,"div",0)(1,"mat-accordion",1),b(2,xx,6,1,"mat-expansion-panel",2)(3,Ix,6,1,"mat-expansion-panel",2),r()()),n&2&&(l("formGroup",t.deviceDataFormGroup),o(2),l("ngIf",t.displayDeviceConfiguration),o(),l("ngIf",t.displayTransportConfiguration))},dependencies:[V,us,bi,Oi,Bi,W,z,ce,X,oe,H,kp,jp],encapsulation:2})}}return i})();function Mx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device.name-required")," "))}function Dx(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device.name-max-length")," "))}function Px(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device.label-max-length")," "))}function Fx(i,m){i&1&&(a(0,"mat-slide-toggle",26),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device.overwrite-activity-time")," "))}var Up=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,u,t,s,_),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.fb=u,this.cd=_,this.entityType=B,this.otaUpdateType=Tr}ngOnInit(){this.deviceScope=this.entitiesTableConfig.componentsData.deviceScope,this.deviceCredentials$=this.entitiesTableConfigValue.componentsData.deviceCredentials$,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Be}buildForm(e){let n=this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],deviceProfileId:[e?e.deviceProfileId:null,[S.required]],firmwareId:[e?e.firmwareId:null],softwareId:[e?e.softwareId:null],label:[e?e.label:"",[S.maxLength(255)]],deviceData:[e?e.deviceData:null,[S.required]],additionalInfo:this.fb.group({gateway:[e&&e.additionalInfo?e.additionalInfo.gateway:!1],overwriteActivityTime:[e&&e.additionalInfo?e.additionalInfo.overwriteActivityTime:!1],description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return n.get("deviceProfileId").valueChanges.pipe(ra((t,s)=>t?.id===s?.id)).subscribe(t=>{t&&this.isEdit&&this.entityForm.patchValue({firmwareId:null,softwareId:null},{emitEvent:!1})}),n}updateForm(e){this.entityForm.patchValue({name:e.name,deviceProfileId:e.deviceProfileId,firmwareId:e.firmwareId,softwareId:e.softwareId,label:e.label,deviceData:e.deviceData,additionalInfo:{gateway:e.additionalInfo?e.additionalInfo.gateway:!1,overwriteActivityTime:e.additionalInfo?e.additionalInfo.overwriteActivityTime:!1,description:e.additionalInfo?e.additionalInfo.description:""}})}onDeviceIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("device.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onDeviceProfileUpdated(){this.entitiesTableConfig.updateData(!1)}onDeviceProfileChanged(e){if(e&&this.isEdit){let n=e.type,t=e.transportType,s=this.entityForm.getRawValue().deviceData;if(!s)s={configuration:zd(n),transportConfiguration:$d(t)},this.entityForm.patchValue({deviceData:s}),this.entityForm.markAsDirty();else{let u=!1;s.configuration.type!==n&&(s.configuration=zd(n),u=!0),s.transportConfiguration.type!==t&&(s.transportConfiguration=$d(t),u=!0),u&&(this.entityForm.patchValue({deviceData:s}),this.entityForm.markAsDirty())}}}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(se),g(Xe))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device"]],features:[G],decls:77,vars:106,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[3,"disabled","credentials$","deviceId"],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["required","","formControlName","deviceProfileId",3,"deviceProfileUpdated","deviceProfileChanged","selectDefaultProfile","showDetailsPageLink"],["matInput","","formControlName","label"],["formControlName","firmwareId",3,"useFullEntityId","showDetailsPageLink","type","deviceProfileId"],["formControlName","softwareId",3,"useFullEntityId","showDetailsPageLink","type","deviceProfileId"],["formControlName","deviceData","required",""],["formGroupName","additionalInfo",1,"flex","flex-col"],[1,"toggle-group"],["formControlName","gateway",2,"min-width","165px"],["formControlName","overwriteActivityTime",4,"ngIf"],["matInput","","formControlName","description","rows","2"],["formControlName","overwriteActivityTime"]],template:function(n,t){if(n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"makePublic")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"assignToCustomer")}),p(11),d(12,"translate"),r(),a(13,"button",1),d(14,"async"),y("click",function(u){return t.onEntityAction(u,"unassignFromCustomer")}),p(15),d(16,"translate"),r(),a(17,"button",1),d(18,"async"),y("click",function(u){return t.onEntityAction(u,"manageCredentials")}),p(19),d(20,"translate"),r(),a(21,"button",1),d(22,"async"),y("click",function(u){return t.onEntityAction(u,"checkConnectivity")}),p(23),d(24,"translate"),r(),a(25,"button",1),d(26,"async"),y("click",function(u){return t.onEntityAction(u,"unassignFromEdge")}),p(27),d(28,"translate"),r(),a(29,"button",2),d(30,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(31),d(32,"translate"),r(),a(33,"div",3)(34,"button",4),d(35,"async"),y("cbOnSuccess",function(u){return t.onDeviceIdCopied(u)}),f(36,"mat-icon",5),a(37,"span",6),p(38,"device.copyId"),r()(),f(39,"tb-copy-device-credentials",7),d(40,"async"),r()(),a(41,"div",8)(42,"mat-form-field",9)(43,"mat-label",6),p(44,"device.assignedToCustomer"),r(),f(45,"input",10),r(),a(46,"div",11),p(47),d(48,"translate"),r(),a(49,"form",12)(50,"fieldset",13),d(51,"async"),a(52,"mat-form-field",9)(53,"mat-label",6),p(54,"device.name"),r(),f(55,"input",14),b(56,Mx,3,3,"mat-error",15)(57,Dx,3,3,"mat-error",15),r(),a(58,"tb-device-profile-autocomplete",16),y("deviceProfileUpdated",function(){return t.onDeviceProfileUpdated()})("deviceProfileChanged",function(u){return t.onDeviceProfileChanged(u)}),r(),a(59,"mat-form-field",9)(60,"mat-label",6),p(61,"device.label"),r(),f(62,"input",17),b(63,Px,3,3,"mat-error",15),r(),f(64,"tb-ota-package-autocomplete",18)(65,"tb-ota-package-autocomplete",19)(66,"tb-device-data",20),a(67,"div",21)(68,"div",22)(69,"mat-slide-toggle",23),p(70),d(71,"translate"),r(),b(72,Fx,3,3,"mat-slide-toggle",24),r(),a(73,"mat-form-field",9)(74,"mat-label",6),p(75,"device.description"),r(),f(76,"textarea",25),r()()()()()),n&2){let s,u;o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,64,t.isLoading$)),o(2),h(" ",c(4,66,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit||t.deviceScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),l("disabled",c(6,68,t.isLoading$)),o(2),h(" ",c(8,70,"device.make-public")," "),o(2),L("!hidden",t.isEdit||t.deviceScope!=="tenant"||t.isAssignedToCustomer(t.entity)),l("disabled",c(10,72,t.isLoading$)),o(2),h(" ",c(12,74,"device.assign-to-customer")," "),o(2),L("!hidden",t.isEdit||t.deviceScope!=="customer"&&t.deviceScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),l("disabled",c(14,76,t.isLoading$)),o(2),h(" ",c(16,78,t.entity!=null&&t.entity.customerIsPublic?"device.make-private":"device.unassign-from-customer")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(18,80,t.isLoading$)),o(2),h(" ",c(20,82,t.deviceScope==="customer_user"||t.deviceScope==="edge_customer_user"?"device.view-credentials":"device.manage-credentials")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(22,84,t.isLoading$)),o(2),h(" ",c(24,86,"device.connectivity.check-connectivity")," "),o(2),L("!hidden",t.isEdit||t.deviceScope!=="edge"),l("disabled",c(26,88,t.isLoading$)),o(2),h(" ",c(28,90,"edge.unassign-from-edge")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(30,92,t.isLoading$)),o(2),h(" ",c(32,94,"device.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",c(35,96,t.isLoading$)),o(5),L("!hidden",t.isEdit),l("disabled",c(40,98,t.isLoading$))("credentials$",t.deviceCredentials$)("deviceId",t.entity==null?null:t.entity.id),o(3),L("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.deviceScope!=="tenant"),o(3),l("ngModel",t.entity==null?null:t.entity.customerTitle),o(),L("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.deviceScope!=="customer"&&t.deviceScope!=="tenant"),o(),h(" ",c(48,100,"device.device-public")," "),o(2),l("formGroup",t.entityForm),o(),l("disabled",c(51,102,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("name").hasError("required")),o(),l("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),l("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),o(5),l("ngIf",t.entityForm.get("label").hasError("maxlength")),o(),l("useFullEntityId",!0)("showDetailsPageLink",!0)("type",t.otaUpdateType.FIRMWARE)("deviceProfileId",(s=t.entityForm.get("deviceProfileId").value)==null?null:s.id),o(),l("useFullEntityId",!0)("showDetailsPageLink",!0)("type",t.otaUpdateType.SOFTWARE)("deviceProfileId",(u=t.entityForm.get("deviceProfileId").value)==null?null:u.id),o(5),h(" ",c(71,104,"device.is-gateway")," "),o(2),l("ngIf",t.entityForm.get("additionalInfo.gateway").value)}},dependencies:[V,K,ee,ge,me,Ie,De,it,ii,fe,ue,W,z,ce,ut,X,oe,ft,H,df,ll,Ag,Gp,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .toggle-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:16px;margin-bottom:16px}']})}}return i})();C();var qp=(()=>{class i extends Jt{constructor(e){super(e),this.store=e,this.entityType=B}deviceInfoFilterChanged(e){this.entitiesTableConfig.componentsData.deviceInfoFilter=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device-table-header"]],features:[G],decls:1,vars:1,consts:[[3,"ngModelChange","ngModel"]],template:function(n,t){n&1&&(a(0,"tb-device-info-filter",0),y("ngModelChange",function(u){return t.deviceInfoFilterChanged(u)}),r()),n&2&&l("ngModel",t.entitiesTableConfig.componentsData.deviceInfoFilter)},dependencies:[W,ut,Og],encapsulation:2})}}return i})();C();function Nx(i,m){i&1&&f(0,"mat-progress-bar",11)}function kx(i,m){if(i&1&&(a(0,"section")(1,"form",12),f(2,"tb-device-credentials",13),r()()),i&2){let e=v();o(),l("formGroup",e.deviceCredentialsFormGroup),o(),l("deviceTransportType",e.deviceTransportType)}}function Rx(i,m){i&1&&(a(0,"div",14),f(1,"mat-spinner",15),a(2,"span",16),p(3),d(4,"translate"),r()()),i&2&&(o(3),h(" ",c(4,1,"device.loading-device-credentials")," "))}function Ox(i,m){if(i&1){let e=O();a(0,"button",17),d(1,"async"),y("click",function(){x(e);let t=v();return I(t.save())}),p(2),d(3,"translate"),r()}if(i&2){let e=v();l("disabled",c(1,2,e.isLoading$)||e.deviceCredentialsFormGroup.invalid||!e.deviceCredentialsFormGroup.dirty),o(2),h(" ",c(3,4,"action.save")," ")}}var Wp=(()=>{class i extends et{constructor(e,n,t,s,u,_,E,w){super(e,n,E),this.store=e,this.router=n,this.data=t,this.deviceService=s,this.deviceProfileService=u,this.errorStateMatcher=_,this.dialogRef=E,this.fb=w,this.loadingCredentials=!0,this.submitted=!1,this.isReadOnly=t.isReadOnly}ngOnInit(){this.deviceCredentialsFormGroup=this.fb.group({credential:[null]}),this.isReadOnly&&this.deviceCredentialsFormGroup.disable({emitEvent:!1}),this.loadDeviceCredentials()}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),s=!!(e&&e.invalid&&this.submitted);return t||s}loadDeviceCredentials(){let e=[this.deviceService.getDeviceCredentials(this.data.deviceId),this.deviceProfileService.getDeviceProfileInfo(this.data.deviceProfileId)];Gt(e).subscribe(([n,t])=>{this.deviceTransportType=t.transportType,this.deviceCredentials=n,this.deviceCredentialsFormGroup.patchValue({credential:n},{emitEvent:!1}),this.loadingCredentials=!1})}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0;let e=this.deviceCredentialsFormGroup.value.credential;this.deviceCredentials=_e(_e({},this.deviceCredentials),e),this.deviceService.saveDeviceCredentials(this.deviceCredentials).pipe(cn(n=>n.status===ca.Conflict?this.deviceService.getDeviceCredentials(this.deviceCredentials.deviceId.id):aa(()=>n))).subscribe(n=>{this.dialogRef.close(n)})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(ka),g(Bs),g(hi,4),g(Ze),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device-credentials-dialog"]],features:[ke([{provide:hi,useExisting:i}]),G],decls:20,vars:15,consts:[["loadCredentials",""],["color","primary"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["color","warn","mode","indeterminate"],[3,"formGroup"],["formControlName","credential",3,"deviceTransportType"],[1,"flex","flex-col","items-center","justify-center"],["color","accent","diameter","65","strokeWidth","4",2,"margin-bottom","18px"],[1,"mat-subtitle-1",2,"margin-bottom","0"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-toolbar",1)(1,"h2"),p(2),d(3,"translate"),r(),f(4,"span",2),a(5,"button",3),y("click",function(){return x(s),I(t.cancel())}),a(6,"mat-icon",4),p(7,"close"),r()()(),b(8,Nx,1,0,"mat-progress-bar",5),d(9,"async"),a(10,"div",6),b(11,kx,3,2,"section",7)(12,Rx,5,3,"ng-template",null,0,xt),r(),a(14,"div",8)(15,"button",9),d(16,"async"),y("click",function(){return x(s),I(t.cancel())}),p(17),d(18,"translate"),r(),b(19,Ox,4,6,"button",10),r()}if(n&2){let s=U(13);o(2),R(c(3,7,"device.device-credentials")),o(6),l("ngIf",c(9,9,t.isLoading$)),o(3),l("ngIf",!t.loadingCredentials)("ngIfElse",s),o(4),l("disabled",c(16,11,t.isLoading$)),o(2),h(" ",c(18,13,t.isReadOnly?"action.close":"action.cancel")," "),o(2),l("ngIf",!t.isReadOnly)}},dependencies:[V,K,Ce,ee,Oe,He,Ct,Je,_o,fe,W,z,X,oe,Dg,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;display:grid;grid-template-rows:min-content 4px auto min-content}@media screen and (min-width: 600px){[_nghost-%COMP%]{min-width:420px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{grid-row:4;display:flex;gap:8px;justify-content:flex-end;flex:1}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{grid-row:3;padding:24px 24px 4px}']})}}return i})();C();function Bx(i,m){if(i&1&&(a(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.CLIENT_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Vx(i,m){if(i&1&&(a(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Lx(i,m){if(i&1&&(a(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function jx(i,m){if(i&1&&(a(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"device.events")),o(3),l("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function Gx(i,m){if(i&1&&(a(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-relation-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function Ux(i,m){if(i&1&&(a(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",13),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function qx(i,m){if(i&1){let e=O();a(0,"mat-tab",8,6),d(2,"translate"),a(3,"tb-version-control",14),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Hp=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,Bx,4,7,"mat-tab",7)(1,Vx,4,7,"mat-tab",7)(2,Lx,4,5,"mat-tab",7)(3,jx,4,7,"mat-tab",7)(4,Gx,4,5,"mat-tab",7)(5,Ux,4,6,"mat-tab",7)(6,qx,4,7,"mat-tab",7),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[V,Pt,Ci,qi,Wi,Ei,wi,di,k],encapsulation:2})}}return i})();C();var Nc=()=>({text:"",href:""}),kc=(i,m,e)=>({noSecLabel:"HTTP",noSec:i,secLabel:"HTTPs",sec:m,doc:e}),lo=i=>({cmd:i}),Wx=()=>({text:"device.connectivity.sparkplug-command",href:"https://thingsboard.io/docs/reference/mqtt-sparkplug-api/"}),ur=i=>({doc:i}),Hx=()=>({text:"device.connectivity.install-mqtt-windows",href:"https://thingsboard.io/docs/reference/mqtt-api/?connectdevice=mqtt-windows#mqtt-connect"}),zp=()=>({text:"device.connectivity.mqtts-x509-command",href:"https://thingsboard.io/docs/user-guide/mqtt-over-ssl/"}),$p=(i,m,e)=>({noSecLabel:"MQTT",noSec:i,secLabel:"MQTTs",sec:m,doc:e}),Eh=()=>({text:"device.connectivity.coaps-x509-command",href:"https://thingsboard.io/docs/user-guide/ssl/coap-x509-certificates/"}),wh=(i,m,e)=>({noSecLabel:"CoAP",noSec:i,secLabel:"CoAPs",sec:m,doc:e}),zx=()=>({text:"device.connectivity.install-coap-client",href:"https://thingsboard.io/docs/user-guide/ssl/coap-access-token/"}),$x=()=>({text:"device.connectivity.snmp-command",href:"https://thingsboard.io/docs/reference/snmp-api/"}),Qx=()=>({text:"device.connectivity.lwm2m-command",href:"https://thingsboard.io/docs/reference/lwm2m-api/"});function Jx(i,m){if(i&1&&(a(0,"tb-toggle-option",32),p(1),d(2,"translate"),r()),i&2){let e=v(2);l("value",e.BasicTransportType.HTTP),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.BasicTransportType.HTTP))," ")}}function Kx(i,m){if(i&1&&(a(0,"tb-toggle-option",32),p(1),d(2,"translate"),r()),i&2){let e=v(2);l("value",e.DeviceTransportType.MQTT),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.DeviceTransportType.MQTT))," ")}}function Yx(i,m){if(i&1&&(a(0,"tb-toggle-option",32),p(1),d(2,"translate"),r()),i&2){let e=v(2);l("value",e.DeviceTransportType.COAP),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.DeviceTransportType.COAP))," ")}}function Xx(i,m){if(i&1&&(a(0,"tb-toggle-option",32),p(1),d(2,"translate"),r()),i&2){let e=v(2);l("value",e.DeviceTransportType.SNMP),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.DeviceTransportType.SNMP))," ")}}function Zx(i,m){if(i&1&&(a(0,"tb-toggle-option",32),p(1),d(2,"translate"),r()),i&2){let e=v(2);l("value",e.DeviceTransportType.LWM2M),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.DeviceTransportType.LWM2M))," ")}}function eI(i,m){i&1&&(f(0,"mat-icon",37),p(1," Windows "))}function tI(i,m){i&1&&At(0)}function iI(i,m){if(i&1&&(a(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),r(),a(4,"div",39),p(5,"device.connectivity.install-curl-windows"),r()(),b(6,tI,1,0,"ng-container",40),r()),i&2){let e=v(3),n=U(23);o(6),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(7,lo,kn(3,kc,e.commands.http.http,e.commands.http.https,Rt(2,Nc))))}}function nI(i,m){i&1&&(f(0,"mat-icon",41),p(1," MacOS "))}function oI(i,m){i&1&&At(0)}function aI(i,m){if(i&1&&(a(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),r(),a(4,"div",39),p(5,"device.connectivity.install-curl-macos"),r()(),b(6,oI,1,0,"ng-container",40),r()),i&2){let e=v(3),n=U(23);o(6),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(7,lo,kn(3,kc,e.commands.http.http,e.commands.http.https,Rt(2,Nc))))}}function rI(i,m){i&1&&(f(0,"mat-icon",42),p(1," Linux "))}function sI(i,m){i&1&&At(0)}function lI(i,m){if(i&1&&(a(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),r(),f(4,"tb-markdown",43),r(),b(5,sI,1,0,"ng-container",40),r()),i&2){let e=v(3),n=U(23);o(4),l("data",e.createMarkDownCommand("sudo apt-get install curl")),o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(8,lo,kn(4,kc,e.commands.http.http,e.commands.http.https,Rt(3,Nc))))}}function pI(i,m){if(i&1){let e=O();a(0,"div",33),p(1,"device.connectivity.use-following-instructions"),r(),a(2,"mat-tab-group",34),pt("selectedIndexChange",function(t){x(e);let s=v(2);return lt(s.httpTabIndex,t)||(s.httpTabIndex=t),I(t)}),a(3,"mat-tab"),b(4,eI,2,0,"ng-template",35)(5,iI,7,9,"ng-template",36),r(),a(6,"mat-tab"),b(7,nI,2,0,"ng-template",35)(8,aI,7,9,"ng-template",36),r(),a(9,"mat-tab"),b(10,rI,2,0,"ng-template",35)(11,lI,6,10,"ng-template",36),r()()}if(i&2){let e=v(2);o(2),st("selectedIndex",e.httpTabIndex)}}function mI(i,m){i&1&&At(0)}function dI(i,m){if(i&1&&(a(0,"div",23),b(1,mI,1,0,"ng-container",40),r()),i&2){v(3);let e=U(25);o(),l("ngTemplateOutlet",e)("ngTemplateOutletContext",at(3,ur,Rt(2,Wx)))}}function cI(i,m){i&1&&(f(0,"mat-icon",37),p(1," Windows "))}function uI(i,m){i&1&&At(0)}function fI(i,m){i&1&&At(0)}function gI(i,m){if(i&1&&(a(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),r(),a(4,"div",46),b(5,uI,1,0,"ng-container",40),r()(),b(6,fI,1,0,"ng-container",40),r()),i&2){let e=v(4),n=U(23),t=U(25);o(5),l("ngTemplateOutlet",t)("ngTemplateOutletContext",at(5,ur,Rt(4,Hx))),o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(12,lo,kn(8,$p,e.commands.mqtt.mqtt,e.commands.mqtt.mqtts,Rt(7,zp))))}}function hI(i,m){i&1&&(f(0,"mat-icon",41),p(1," MacOS "))}function bI(i,m){i&1&&At(0)}function vI(i,m){if(i&1&&(a(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),r(),f(4,"tb-markdown",43),r(),b(5,bI,1,0,"ng-container",40),r()),i&2){let e=v(4),n=U(23);o(4),l("data",e.createMarkDownCommand("brew install mosquitto")),o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(8,lo,kn(4,$p,e.commands.mqtt.mqtt,e.commands.mqtt.mqtts,Rt(3,zp))))}}function yI(i,m){i&1&&(f(0,"mat-icon",42),p(1," Linux "))}function _I(i,m){i&1&&At(0)}function CI(i,m){if(i&1&&(a(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),r(),f(4,"tb-markdown",43),r(),b(5,_I,1,0,"ng-container",40),r()),i&2){let e=v(4),n=U(23);o(4),l("data",e.createMarkDownCommand("sudo apt-get install curl mosquitto-clients")),o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(8,lo,kn(4,$p,e.commands.mqtt.mqtt,e.commands.mqtt.mqtts,Rt(3,zp))))}}function SI(i,m){i&1&&(f(0,"mat-icon",47),p(1," Docker "))}function TI(i,m){i&1&&At(0)}function xI(i,m){if(i&1&&(a(0,"div",38),b(1,TI,1,0,"ng-container",40),r()),i&2){let e=v(5),n=U(23);o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(7,lo,kn(3,$p,e.commands.mqtt.docker.mqtt,e.commands.mqtt.docker.mqtts,Rt(2,zp))))}}function II(i,m){i&1&&(a(0,"mat-tab"),b(1,SI,2,0,"ng-template",35)(2,xI,2,9,"ng-template",36),r())}function EI(i,m){if(i&1){let e=O();a(0,"div",33),p(1,"device.connectivity.use-following-instructions"),r(),a(2,"mat-tab-group",34),pt("selectedIndexChange",function(t){x(e);let s=v(3);return lt(s.mqttTabIndex,t)||(s.mqttTabIndex=t),I(t)}),a(3,"mat-tab"),b(4,cI,2,0,"ng-template",35)(5,gI,7,14,"ng-template",36),r(),a(6,"mat-tab"),b(7,hI,2,0,"ng-template",35)(8,vI,6,10,"ng-template",36),r(),a(9,"mat-tab"),b(10,yI,2,0,"ng-template",35)(11,CI,6,10,"ng-template",36),r(),b(12,II,3,0,"mat-tab",45),r()}if(i&2){let e=v(3);o(2),st("selectedIndex",e.mqttTabIndex),o(10),l("ngIf",!!e.commands.mqtt.docker)}}function wI(i,m){if(i&1&&b(0,dI,2,5,"div",44)(1,EI,13,2,"ng-template",null,5,xt),i&2){let e=U(2),n=v(2);l("ngIf",n.commands.mqtt.sparkplug)("ngIfElse",e)}}function MI(i,m){i&1&&(f(0,"mat-icon",42),p(1," Linux "))}function DI(i,m){i&1&&At(0)}function PI(i,m){if(i&1&&(a(0,"div",23)(1,"div",25),p(2,"device.connectivity.install-necessary-client-tools"),r(),a(3,"div",46),b(4,DI,1,0,"ng-container",40),r()()),i&2){v(4);let e=U(25);o(4),l("ngTemplateOutlet",e)("ngTemplateOutletContext",at(3,ur,Rt(2,zx)))}}function FI(i,m){i&1&&At(0)}function AI(i,m){if(i&1&&(a(0,"div",38),b(1,PI,5,5,"div",48)(2,FI,1,0,"ng-container",40),r()),i&2){let e=v(3),n=U(23);o(),l("ngIf",e.commands.coap.coaps!=="Check documentation"),o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(8,lo,kn(4,wh,e.commands.coap.coap,e.commands.coap.coaps,Rt(3,Eh))))}}function NI(i,m){i&1&&(f(0,"mat-icon",47),p(1," Docker "))}function kI(i,m){i&1&&At(0)}function RI(i,m){if(i&1&&(a(0,"div",38),b(1,kI,1,0,"ng-container",40),r()),i&2){let e=v(4),n=U(23);o(),l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(7,lo,kn(3,wh,e.commands.coap.docker.coap,e.commands.coap.docker.coaps,Rt(2,Eh))))}}function OI(i,m){i&1&&(a(0,"mat-tab"),b(1,NI,2,0,"ng-template",35)(2,RI,2,9,"ng-template",36),r())}function BI(i,m){if(i&1){let e=O();a(0,"div",33),p(1,"device.connectivity.use-following-instructions"),r(),a(2,"mat-tab-group",34),pt("selectedIndexChange",function(t){x(e);let s=v(2);return lt(s.coapTabIndex,t)||(s.coapTabIndex=t),I(t)}),a(3,"mat-tab"),b(4,MI,2,0,"ng-template",35)(5,AI,3,10,"ng-template",36),r(),b(6,OI,3,0,"mat-tab",45),r()}if(i&2){let e=v(2);o(2),st("selectedIndex",e.coapTabIndex),o(4),l("ngIf",!!e.commands.coap.docker)}}function VI(i,m){i&1&&At(0)}function LI(i,m){if(i&1&&(a(0,"div",23),b(1,VI,1,0,"ng-container",40),r()),i&2){v(2);let e=U(25);o(),l("ngTemplateOutlet",e)("ngTemplateOutletContext",at(3,ur,Rt(2,$x)))}}function jI(i,m){i&1&&At(0)}function GI(i,m){if(i&1&&(a(0,"div",23),b(1,jI,1,0,"ng-container",40),r()),i&2){v(2);let e=U(25);o(),l("ngTemplateOutlet",e)("ngTemplateOutletContext",at(3,ur,Rt(2,Qx)))}}function UI(i,m){if(i&1&&(a(0,"div",51)(1,"div",52),p(2),d(3,"date"),r(),a(4,"div",52),p(5),r(),a(6,"div",52),p(7),r()()),i&2){let e=m.$implicit;o(2),R(Nt(3,3,e.lastUpdateTs,"yyyy-MM-dd HH:mm:ss")),o(3),R(e.key),o(2),R(e.value)}}function qI(i,m){if(i&1&&(a(0,"div",49),b(1,UI,8,6,"div",50),r()),i&2){let e=v(2);o(),l("ngForOf",e.latestTelemetry)}}function WI(i,m){if(i&1&&(a(0,"section",18)(1,"tb-toggle-header",19,4),b(3,Jx,3,4,"tb-toggle-option",20)(4,Kx,3,4,"tb-toggle-option",20)(5,Yx,3,4,"tb-toggle-option",20)(6,Xx,3,4,"tb-toggle-option",20)(7,Zx,3,4,"tb-toggle-option",20),r(),a(8,"div",18),Ut(9,21),b(10,pI,12,1,"ng-template",22)(11,wI,3,2,"ng-template",22)(12,BI,7,2,"ng-template",22)(13,LI,2,5,"ng-template",22)(14,GI,2,5,"ng-template",22),qt(),r(),a(15,"div",23)(16,"div",24)(17,"div",25),p(18,"device.state"),r(),a(19,"div",26),p(20),d(21,"translate"),r()(),a(22,"div",27),p(23,"attribute.latest-telemetry"),r(),a(24,"div",28)(25,"div",29)(26,"div",30),p(27,"device.time"),r(),a(28,"div",30),p(29,"attribute.key"),r(),a(30,"div",30),p(31,"attribute.value"),r()(),b(32,qI,2,1,"div",31),r()()()),i&2){let e=U(2),n=v(),t=U(21);o(),L("!hidden",n.allowTransportType.size<2),T("value",n.selectTransportType),o(2),l("ngIf",n.allowTransportType.has(n.BasicTransportType.HTTP)),o(),l("ngIf",n.allowTransportType.has(n.DeviceTransportType.MQTT)),o(),l("ngIf",n.allowTransportType.has(n.DeviceTransportType.COAP)),o(),l("ngIf",n.allowTransportType.has(n.DeviceTransportType.SNMP)),o(),l("ngIf",n.allowTransportType.has(n.DeviceTransportType.LWM2M)),o(),L("!hidden",!n.allowTransportType.size),o(),l("ngSwitch",e.value),o(),l("ngSwitchCase",n.BasicTransportType.HTTP),o(),l("ngSwitchCase",n.DeviceTransportType.MQTT),o(),l("ngSwitchCase",n.DeviceTransportType.COAP),o(),l("ngSwitchCase",n.DeviceTransportType.SNMP),o(),l("ngSwitchCase",n.DeviceTransportType.LWM2M),o(5),L("inactive",!n.status)("hide",n.status===void 0),o(),h(" ",c(21,23,n.status?"device.active":"device.inactive")," "),o(12),l("ngIf",n.latestTelemetry.length)("ngIfElse",t)}}function HI(i,m){i&1&&(a(0,"div",53),f(1,"mat-spinner",54),a(2,"span",55),p(3),d(4,"translate"),r()()),i&2&&(o(3),h(" ",c(4,1,"device.connectivity.loading-check-connectivity-command")," "))}function zI(i,m){i&1&&(a(0,"div",56),f(1,"div",57),a(2,"div",33),p(3,"attribute.no-latest-telemetry"),r()())}function $I(i,m){if(i&1&&f(0,"tb-markdown",43),i&2){let e=v().cmd,n=v();l("data",n.createMarkDownCommand(e.noSec))}}function QI(i,m){if(i&1&&(a(0,"div"),f(1,"tb-markdown",43),r()),i&2){let e=v(2).cmd,n=v();o(),l("data",n.createMarkDownCommand(e.sec))}}function JI(i,m){i&1&&At(0)}function KI(i,m){if(i&1&&b(0,JI,1,0,"ng-container",40),i&2){let e=v(2).cmd;v();let n=U(25);l("ngTemplateOutlet",n)("ngTemplateOutletContext",at(2,ur,e.doc))}}function YI(i,m){if(i&1&&b(0,QI,2,1,"div",62)(1,KI,1,4,"ng-template",null,7,xt),i&2){let e=U(2),n=v().cmd;l("ngIf",n.sec!=="Check documentation")("ngIfElse",e)}}function XI(i,m){if(i&1&&(a(0,"div",23)(1,"div",58)(2,"div",25),p(3,"device.connectivity.execute-following-command"),r(),a(4,"tb-toggle-header",59,6)(6,"tb-toggle-option",60),p(7),r(),a(8,"tb-toggle-option",61),p(9),r()()(),Ut(10,21),b(11,$I,1,1,"ng-template",22)(12,YI,3,2,"ng-template",22),qt(),r()),i&2){let e=m.cmd,n=U(5);o(),L("!hidden",!(e.noSec||e.sec!=="Check documentation")),o(3),L("!hidden",!e.noSec||!e.sec),T("value",e.noSec?"noSec":"sec"),o(3),R(e.noSecLabel),o(2),R(e.secLabel),o(),l("ngSwitch",n.value),o(),l("ngSwitchCase","noSec"),o(),l("ngSwitchCase","sec")}}function ZI(i,m){if(i&1&&(a(0,"div",63)(1,"div",64),p(2),d(3,"translate"),r(),a(4,"a",65)(5,"mat-icon"),p(6,"description"),r(),p(7),d(8,"translate"),r()()),i&2){let e=m.doc;o(2),R(c(3,3,e.text)),o(2),T("href",e.href,Nn),o(3),h(" ",c(8,5,"common.documentation")," ")}}var Qp=(()=>{class i extends et{constructor(e,n,t,s,u,_,E){super(e,n,s),this.store=e,this.router=n,this.data=t,this.dialogRef=s,this.deviceService=u,this.telemetryWsService=_,this.zone=E,this.loadedCommand=!1,this.latestTelemetry=[],this.allowTransportType=new Set,this.BasicTransportType=Hd,this.DeviceTransportType=Ai,this.deviceTransportTypeTranslationMap=Oa,this.notShowAgain=!1,this.httpTabIndex=0,this.mqttTabIndex=0,this.coapTabIndex=0,this.currentTime=Date.now(),this.transportTypes=[...Object.keys(Hd),...Object.keys(Ai)],this.data.afterAdd?(this.dialogTitle="device.connectivity.device-created-check-connectivity",this.showDontShowAgain=!0):(this.dialogTitle="device.connectivity.check-connectivity",this.showDontShowAgain=!1)}ngOnInit(){this.loadCommands(),this.subscribeToLatestTelemetry()}ngOnDestroy(){super.ngOnDestroy(),this.telemetrySubscriber?.complete(),this.telemetrySubscriber?.unsubscribe()}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new ha({notDisplayConnectivityAfterAddDevice:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}createMarkDownCommand(e){if(Array.isArray(e)){let n=[];return e.forEach(t=>n.push(this.createMarkDownSingleCommand(t))),n.join(`
<br />

`)}else return this.createMarkDownSingleCommand(e)}createMarkDownSingleCommand(e){return"```bash\n"+e+"{:copy-code}\n```"}loadCommands(){this.deviceService.getDevicePublishTelemetryCommands(this.data.deviceId.id).subscribe(e=>{this.commands=e;let n=Object.keys(e);this.transportTypes.forEach(t=>{n.find(u=>u.toUpperCase().startsWith(t))&&this.allowTransportType.add(t)}),this.selectTransportType=this.allowTransportType.values().next().value,this.selectTabIndexForUserOS(),this.loadedCommand=!0})}subscribeToLatestTelemetry(){this.store.pipe(Ht(as)).pipe(gi(1)).subscribe(e=>{if(this.telemetrySubscriber=Pu.createEntityAttributesSubscription(this.telemetryWsService,this.data.deviceId,Mu.LATEST_TELEMETRY,this.zone),!e){let n=new Du;n.entityType=this.data.deviceId.entityType,n.entityId=this.data.deviceId.id,n.scope=ss.SERVER_SCOPE,n.keys="active",this.telemetrySubscriber.subscriptionCommands.push(n)}this.telemetrySubscriber.subscribe(),this.telemetrySubscriber.attributeData$().subscribe(n=>{let t=n.reduce((s,u)=>(u.key==="active"?this.status=Vt(u.value):u.lastUpdateTs>this.currentTime&&s.push(u),s),[]);this.latestTelemetry=t.sort((s,u)=>u.lastUpdateTs-s.lastUpdateTs)})})}selectTabIndexForUserOS(){switch(hu()){case"linux":case"android":this.httpTabIndex=2,this.mqttTabIndex=2;break;case"macos":case"ios":this.httpTabIndex=1,this.mqttTabIndex=1,this.coapTabIndex=1;break;case"windows":this.httpTabIndex=0,this.mqttTabIndex=0,this.coapTabIndex=1;break;default:this.mqttTabIndex=this.commands.mqtt?.docker?3:0,this.coapTabIndex=this.commands.coap?.docker?1:0}}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(Ze),g(ka),g(Uf),g(Xr))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device-check-connectivity-dialog"]],features:[G],decls:26,vars:15,consts:[["loadingCommand",""],["noData",""],["executeCommand",""],["seeDocumentation",""],["transportProtocol",""],["mqttCommands",""],["protocolType",""],["checkDocumentation",""],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],["class","tb-form-panel no-padding no-border",4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],[3,"ngModelChange","ngModel"],["mat-button","",3,"click","disabled"],[1,"tb-form-panel","no-padding","no-border"],["name","TransportProtocol","useSelectOnMdLg","false","appearance","fill",3,"value"],[3,"value",4,"ngIf"],[3,"ngSwitch"],[3,"ngSwitchCase"],[1,"tb-form-panel","stroked"],[1,"flex","flex-1","flex-row"],["translate","",1,"tb-form-panel-title"],[1,"status"],["translate","",1,"tb-form-panel-hint","tb-font-14"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","flex-1"],["class","tb-form-table-body",4,"ngIf","ngIfElse"],[3,"value"],["translate","",1,"tb-no-data-text"],[3,"selectedIndexChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],["svgIcon","windows",1,"tabs-icon"],[1,"tb-form-panel","no-padding","no-border","tb-tab-body"],["translate","",1,"tb-install-instruction-text"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["svgIcon","macos",1,"tabs-icon"],["svgIcon","linux",1,"tabs-icon"],["usePlainMarkdown","","containerClass","tb-command-code",3,"data"],["class","tb-form-panel stroked",4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"tb-install-instruction-text"],["svgIcon","docker",1,"tabs-icon"],["class","tb-form-panel stroked",4,"ngIf"],[1,"tb-form-table-body"],["class","tb-form-table-row",4,"ngFor","ngForOf"],[1,"tb-form-table-row"],[1,"tb-form-table-row-cell","flex-1"],[1,"tb-loader"],["color","accent","diameter","65","strokeWidth","4"],[1,"mat-subtitle-1","label"],[1,"tb-no-data-available"],[1,"tb-no-data-bg"],[1,"flex","flex-row","items-center","justify-between"],["name","protocolType","useSelectOnMdLg","false",3,"value"],["value","noSec"],["value","sec"],[4,"ngIf","ngIfElse"],[1,"tb-form-row","no-border","no-padding","space-between"],[1,"tb-font-14","tb-flex-1"],["mat-stroked-button","","color","primary","target","_blank",3,"href"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-toolbar",8)(1,"h2",9),p(2),r(),f(3,"span",10),a(4,"button",11),y("click",function(){return x(s),I(t.close())}),a(5,"mat-icon",12),p(6,"close"),r()()(),a(7,"div",13),b(8,WI,33,25,"section",14),r(),a(9,"div",15)(10,"mat-slide-toggle",16),pt("ngModelChange",function(_){return x(s),lt(t.notShowAgain,_)||(t.notShowAgain=_),I(_)}),p(11),d(12,"translate"),r(),f(13,"span",10),a(14,"button",17),d(15,"async"),y("click",function(){return x(s),I(t.close())}),p(16),d(17,"translate"),r()(),b(18,HI,5,3,"ng-template",null,0,xt)(20,zI,4,0,"ng-template",null,1,xt)(22,XI,13,10,"ng-template",null,2,xt)(24,ZI,9,7,"ng-template",null,3,xt)}if(n&2){let s=U(19);o(2),R(t.dialogTitle),o(6),l("ngIf",t.loadedCommand)("ngIfElse",s),o(2),L("!hidden",!t.showDontShowAgain),st("ngModel",t.notShowAgain),o(),R(c(12,9,"action.dont-show-again")),o(3),l("disabled",c(15,11,t.isLoading$)),o(2),R(c(17,13,"action.close"))}},dependencies:[we,V,go,Rn,On,Ha,Sa,K,Ce,ee,He,Ct,Je,_o,Es,ws,Pt,Co,it,W,ut,H,xf,qn,le,Ge,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:300px;max-height:100%}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:0;text-align:center}[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{margin-left:12px;border-radius:12px;height:24px;line-height:24px;padding:0 8px;width:fit-content;color:#198038;background-color:#19803814;font-size:14px}[_nghost-%COMP%]   .status.inactive[_ngcontent-%COMP%]{color:#d12730;background-color:#d1273014}[_nghost-%COMP%]   .tb-hint-instruction[_ngcontent-%COMP%]{border-radius:6px;background-color:#3056800a;padding:6px 16px}[_nghost-%COMP%]   .tb-hint-instruction[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   .tb-font-14[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .tb-flex-1[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .tb-form-table-body[_ngcontent-%COMP%]{max-height:108px;min-height:108px;overflow-y:auto;scrollbar-gutter:stable}[_nghost-%COMP%]   .tb-form-table-body[_ngcontent-%COMP%]   .tb-form-table-row[_ngcontent-%COMP%]{min-height:38px}[_nghost-%COMP%]   .tb-no-data-available[_ngcontent-%COMP%]   .tb-no-data-bg[_ngcontent-%COMP%]{min-height:68px}[_nghost-%COMP%]   .tb-install-instruction-text[_ngcontent-%COMP%]{min-height:42px}@media screen and (min-width: 600px) and (max-width: 959px){[_nghost-%COMP%]{width:470px}}@media screen and (min-width: 960px){[_nghost-%COMP%]{width:720px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:8px 16px}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:16px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper{padding:0}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]{margin:0;background:#f3f6fa;border-color:#305680;padding-right:38px;overflow:scroll;padding-bottom:4px;min-height:42px;scrollbar-width:thin}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]::-webkit-scrollbar{width:4px;height:4px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn{right:-2px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p{color:#305680}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}']})}}return i})();var zn=(()=>{class i{constructor(e,n,t,s,u,_,E,w,q,Te,Le){this.store=e,this.broadcast=n,this.deviceService=t,this.customerService=s,this.dialogService=u,this.edgeService=_,this.homeDialogs=E,this.translate=w,this.datePipe=q,this.router=Te,this.dialog=Le,this.config=new Qe,this.config.entityType=B.DEVICE,this.config.entityComponent=Up,this.config.entityTabsComponent=Hp,this.config.entityTranslations=$e.get(B.DEVICE),this.config.entityResources=_t.get(B.DEVICE),this.config.addDialogStyle={width:"600px"},this.config.deleteEntityTitle=gt=>this.translate.instant("device.delete-device-title",{deviceName:gt.name}),this.config.deleteEntityContent=()=>this.translate.instant("device.delete-device-text"),this.config.deleteEntitiesTitle=gt=>this.translate.instant("device.delete-devices-title",{count:gt}),this.config.deleteEntitiesContent=()=>this.translate.instant("device.delete-devices-text"),this.config.loadEntity=gt=>this.deviceService.getDeviceInfo(gt.id),this.config.saveEntity=gt=>this.deviceService.saveDevice(gt).pipe(wt(()=>{this.broadcast.broadcast("deviceSaved")}),yt(ui=>this.deviceService.getDeviceInfo(ui.id.id))),this.config.onEntityAction=gt=>this.onDeviceAction(gt,this.config),this.config.detailsReadonly=()=>this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user",this.config.onLoadAction=gt=>this.onLoadAction(gt),this.config.headerComponent=qp}resolve(e){let n=e.params;return this.config.componentsData={deviceScope:e.data.devicesType,deviceInfoFilter:{},deviceCredentials$:new Ft,edgeId:n.edgeId},this.customerId=n.customerId,this.config.componentsData.edgeId=n.edgeId,this.store.pipe(Ht(Vn),gi(1)).pipe(wt(t=>{t.authority===M.CUSTOMER_USER&&(e.data.devicesType==="edge"?this.config.componentsData.deviceScope="edge_customer_user":this.config.componentsData.deviceScope="customer_user",this.customerId=t.customerId)}),yt(()=>this.customerId?this.customerService.getCustomer(this.customerId):ot(null)),mt(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-devices"):this.config.tableTitle=t.title+": "+this.translate.instant("device.devices"):this.config.componentsData.deviceScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(s=>this.config.tableTitle=s.name+": "+this.translate.instant("device.devices")):this.config.tableTitle=this.translate.instant("device.devices"),this.config.columns=this.configureColumns(this.config.componentsData.deviceScope),this.configureEntityFunctions(this.config.componentsData.deviceScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.deviceScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.deviceScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.deviceScope),this.config.addEnabled=!(this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.deviceScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.deviceScope==="tenant",this.config)))}onLoadAction(e){let n=e.snapshot.queryParams;if(n){let t=Ue(n),s=!1;n?.deviceProfileId&&(this.config.componentsData.deviceInfoFilter.deviceProfileId=new Qf(n?.deviceProfileId),delete t.deviceProfileId,s=!0),eo(n?.active)&&(this.config.componentsData.deviceInfoFilter.active=n?.active===!0||n?.active==="true",delete t.active,s=!0),s&&this.router.navigate([],{relativeTo:e,queryParams:t,queryParamsHandling:"",replaceUrl:!0})}}configureColumns(e){let n=[new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","device.name","25%"),new te("deviceProfileName","device-profile.device-profile","25%"),new te("label","device.label","25%"),new te("active","device.state","80px",t=>this.deviceState(t),t=>this.deviceStateStyle(t))];return e==="tenant"&&n.push(new te("customerTitle","customer.customer","25%"),new te("customerIsPublic","device.public","60px",t=>Ot(t.customerIsPublic),()=>({}))),n.push(new te("gateway","device.is-gateway","60px",t=>Ot(t.additionalInfo&&t.additionalInfo.gateway),()=>({}),!1)),n}deviceState(e){let n="device.active",t="rgba(25, 128, 56, 0.08)";return e.active||(n="device.inactive",t="rgba(209, 39, 48, 0.08)"),`<div class="status" style="border-radius: 16px; height: 32px;
                line-height: 32px; padding: 0 12px; width: fit-content; background-color: ${t}">
                ${this.translate.instant(n)}
            </div>`}deviceStateStyle(e){let n={fontSize:"14px",color:"#198038",cursor:"pointer"};return e.active||(n.color="#d12730"),n}configureEntityFunctions(e){this.config.entitiesFetchFunction=n=>this.deviceService.getDeviceInfosByQuery(this.prepareDeviceInfoQuery(n)),e==="tenant"?this.config.deleteEntity=n=>this.deviceService.deleteDevice(n.id):this.config.deleteEntity=()=>ot()}prepareDeviceInfoQuery(e){let n=Ue(this.config.componentsData.deviceInfoFilter);return this.config.componentsData.deviceScope==="edge"||this.config.componentsData.deviceScope==="edge_customer_user"?n.edgeId=new Jf(this.config.componentsData.edgeId):this.config.componentsData.deviceScope!=="tenant"&&(n.customerId=new va(this.customerId)),new O0(e,n)}configureCellActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("device.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Be,onAction:(t,s)=>this.makePublic(t,s)},{name:this.translate.instant("device.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Be,onAction:(t,s)=>this.assignToCustomer(t,[s.id])},{name:this.translate.instant("device.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&!t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("device.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("device.manage-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,s)=>this.manageCredentials(t,s)}),e==="customer"&&n.push({name:this.translate.instant("device.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&!t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("device.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("device.manage-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,s)=>this.manageCredentials(t,s)}),(e==="customer_user"||e==="edge_customer_user")&&n.push({name:this.translate.instant("device.view-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,s)=>this.manageCredentials(t,s)}),e==="edge"&&n.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>!0,onAction:(t,s)=>this.unassignFromEdge(t,s)}),n}configureGroupActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("device.assign-devices"),icon:"assignment_ind",isEnabled:!0,onAction:(t,s)=>this.assignToCustomer(t,s.map(u=>u.id))}),e==="customer"&&n.push({name:this.translate.instant("device.unassign-devices"),icon:"assignment_return",isEnabled:!0,onAction:(t,s)=>this.unassignDevicesFromCustomer(t,s)}),e==="edge"&&n.push({name:this.translate.instant("device.unassign-devices-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,s)=>this.unassignDevicesFromEdge(t,s)}),n}configureAddActions(e){this.config.addEntity=null;let n=[];return e==="tenant"&&(n.push({name:this.translate.instant("device.add-device-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.deviceWizard(t)},{name:this.translate.instant("device.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importDevices(t)}),this.config.addEntity=()=>(this.deviceWizard(null),ot(null))),e==="customer"&&n.push({name:this.translate.instant("device.assign-new-device"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDevicesToCustomer(t)}),e==="edge"&&n.push({name:this.translate.instant("device.assign-new-device"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDevicesToEdge(t)}),n}openDevice(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}importDevices(e){this.homeDialogs.importEntities(B.DEVICE).subscribe(n=>{n&&(this.broadcast.broadcast("deviceSaved"),this.config.updateData())})}deviceWizard(e){this.dialog.open(Pg,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(n=>{n&&this.store.pipe(Ht(ba("notDisplayConnectivityAfterAddDevice"))).pipe(gi(1)).subscribe(t=>{t?this.config.updateData():this.checkConnectivity(null,n.id,!0)})})}addDevicesToCustomer(e){e&&e.stopPropagation(),this.dialog.open(Eo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:B.DEVICE}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}makePublic(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.make-public-device-title",{deviceName:n.name}),this.translate.instant("device.make-public-device-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceService.makeDevicePublic(n.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,n){e&&e.stopPropagation(),this.dialog.open(Io,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:n,entityType:B.DEVICE}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,n){e&&e.stopPropagation();let t=n.customerIsPublic,s,u;t?(s=this.translate.instant("device.make-private-device-title",{deviceName:n.name}),u=this.translate.instant("device.make-private-device-text")):(s=this.translate.instant("device.unassign-device-title",{deviceName:n.name}),u=this.translate.instant("device.unassign-device-text")),this.dialogService.confirm(s,u,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(_=>{_&&this.deviceService.unassignDeviceFromCustomer(n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.deviceScope!=="tenant")})})}unassignDevicesFromCustomer(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-devices-title",{count:n.length}),this.translate.instant("device.unassign-devices-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let s=[];n.forEach(u=>{s.push(this.deviceService.unassignDeviceFromCustomer(u.id.id))}),Gt(s).subscribe(()=>{this.config.updateData()})}})}manageCredentials(e,n){e&&e.stopPropagation(),this.dialog.open(Wp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceId:n.id.id,deviceProfileId:n.deviceProfileId.id,isReadOnly:this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user"}}).afterClosed().subscribe(t=>{Re(t)&&this.config.componentsData.deviceCredentials$.next(t)})}onDeviceAction(e,n){switch(e.action){case"open":return this.openDevice(e.event,e.entity,n),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0;case"manageCredentials":return this.manageCredentials(e.event,e.entity),!0;case"checkConnectivity":return this.checkConnectivity(e.event,e.entity.id),!0}return!1}addDevicesToEdge(e){e&&e.stopPropagation(),this.dialog.open(wo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:B.DEVICE}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-device-from-edge-title",{deviceName:n.name}),this.translate.instant("device.unassign-device-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceService.unassignDeviceFromEdge(this.config.componentsData.edgeId,n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.deviceScope!=="tenant")})})}unassignDevicesFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-devices-from-edge-title",{count:n.length}),this.translate.instant("device.unassign-devices-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let s=[];n.forEach(u=>{s.push(this.deviceService.unassignDeviceFromEdge(this.config.componentsData.edgeId,u.id.id))}),Gt(s).subscribe(()=>{this.config.updateData()})}})}checkConnectivity(e,n,t=!1){e&&e.stopPropagation(),this.dialog.open(Qp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceId:n,afterAdd:t}}).afterClosed().subscribe(()=>{t&&this.config.updateData()})}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(jn),N(ka),N(on),N(Lt),N(an),N(Ui),N(ie),N(Ge),N(de),N(je))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();function tE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"asset.name-required")," "))}function iE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"asset.name-max-length")," "))}function nE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"asset.label-max-length")," "))}function oE(i,m){if(i&1&&f(0,"tb-entity-autocomplete",19),i&2){let e=v();l("entityType",e.entityType.CUSTOMER)}}var Jp=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,u,t,s,_),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.fb=u,this.cd=_,this.entityType=B}ngOnInit(){this.assetScope=this.entitiesTableConfig.componentsData.assetScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Be}buildForm(e){return this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],assetProfileId:[e?e.assetProfileId:null,[S.required]],label:[e?e.label:"",S.maxLength(255)],customerId:[e?e.customerId:""],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({assetProfileId:e.assetProfileId}),this.entityForm.patchValue({label:e.label}),this.entityForm.patchValue({customerId:e.customerId}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onAssetIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("asset.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onAssetProfileUpdated(){this.entitiesTableConfig.updateData(!1)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(se),g(Xe))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-asset"]],features:[G],decls:59,vars:69,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["matInput","","formControlName","label"],["required","","formControlName","assetProfileId",3,"assetProfileUpdated","selectDefaultProfile","showDetailsPageLink"],["useFullEntityId","","formControlName","customerId","labelText","asset.assign-to-customer",3,"entityType",4,"ngIf"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"],["useFullEntityId","","formControlName","customerId","labelText","asset.assign-to-customer",3,"entityType"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"makePublic")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"assignToCustomer")}),p(11),d(12,"translate"),r(),a(13,"button",1),d(14,"async"),y("click",function(u){return t.onEntityAction(u,"unassignFromCustomer")}),p(15),d(16,"translate"),r(),a(17,"button",1),d(18,"async"),y("click",function(u){return t.onEntityAction(u,"unassignFromEdge")}),p(19),d(20,"translate"),r(),a(21,"button",1),d(22,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(23),d(24,"translate"),r(),a(25,"div",2)(26,"button",3),y("cbOnSuccess",function(u){return t.onAssetIdCopied(u)}),f(27,"mat-icon",4),a(28,"span",5),p(29,"asset.copyId"),r()()()(),a(30,"div",6)(31,"mat-form-field",7)(32,"mat-label",5),p(33,"asset.assignedToCustomer"),r(),f(34,"input",8),r(),a(35,"div",9),p(36),d(37,"translate"),r(),a(38,"form",10)(39,"fieldset",11),d(40,"async"),a(41,"mat-form-field",7)(42,"mat-label",5),p(43,"asset.name"),r(),f(44,"input",12),b(45,tE,3,3,"mat-error",13)(46,iE,3,3,"mat-error",13),r(),a(47,"mat-form-field",7)(48,"mat-label",5),p(49,"asset.label"),r(),f(50,"input",14),b(51,nE,3,3,"mat-error",13),r(),a(52,"tb-asset-profile-autocomplete",15),y("assetProfileUpdated",function(){return t.onAssetProfileUpdated()}),r(),b(53,oE,1,1,"tb-entity-autocomplete",16),a(54,"div",17)(55,"mat-form-field",7)(56,"mat-label",5),p(57,"asset.description"),r(),f(58,"textarea",18),r()()()()()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,41,t.isLoading$)),o(2),h(" ",c(4,43,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit||t.assetScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),l("disabled",c(6,45,t.isLoading$)),o(2),h(" ",c(8,47,"asset.make-public")," "),o(2),L("!hidden",t.isEdit||t.assetScope!=="tenant"||t.isAssignedToCustomer(t.entity)),l("disabled",c(10,49,t.isLoading$)),o(2),h(" ",c(12,51,"asset.assign-to-customer")," "),o(2),L("!hidden",t.isEdit||t.assetScope!=="customer"&&t.assetScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),l("disabled",c(14,53,t.isLoading$)),o(2),h(" ",c(16,55,t.entity!=null&&t.entity.customerIsPublic?"asset.make-private":"asset.unassign-from-customer")," "),o(2),L("!hidden",t.isEdit||t.assetScope!=="edge"),l("disabled",c(18,57,t.isLoading$)),o(2),h(" ",c(20,59,"edge.unassign-from-edge")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(22,61,t.isLoading$)),o(2),h(" ",c(24,63,"asset.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),L("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.assetScope!=="tenant"),o(3),l("ngModel",t.entity==null?null:t.entity.customerTitle),o(),L("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.assetScope!=="customer"&&t.assetScope!=="tenant"),o(),h(" ",c(37,65,"asset.asset-public")," "),o(2),l("formGroup",t.entityForm),o(),l("disabled",c(40,67,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("name").hasError("required")),o(),l("ngIf",t.entityForm.get("name").hasError("maxlength")),o(5),l("ngIf",t.entityForm.get("label").hasError("maxlength")),o(),l("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),o(),l("ngIf",t.isAdd))},dependencies:[V,Ba,K,ee,ge,me,Ie,De,ii,fe,ue,W,z,ce,ut,X,oe,ft,H,pl,le,k],styles:['@charset "UTF-8";']})}}return i})();C();var Kp=(()=>{class i extends Jt{constructor(e){super(e),this.store=e,this.entityType=B}assetProfileChanged(e){this.entitiesTableConfig.componentsData.assetProfileId=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-asset-table-header"]],features:[G],decls:1,vars:4,consts:[["subscriptSizing","dynamic",3,"ngModelChange","ngModel","addNewProfile","displayAllOnEmpty","editProfileEnabled"]],template:function(n,t){n&1&&(a(0,"tb-asset-profile-autocomplete",0),y("ngModelChange",function(u){return t.assetProfileChanged(u)}),r()),n&2&&l("ngModel",t.entitiesTableConfig.componentsData.assetProfileId)("addNewProfile",!1)("displayAllOnEmpty",!0)("editProfileEnabled",!1)},dependencies:[W,ut,pl],encapsulation:2})}}return i})();C();function aE(i,m){if(i&1&&(a(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function rE(i,m){if(i&1&&(a(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function sE(i,m){if(i&1&&(a(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function lE(i,m){if(i&1&&(a(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"asset.events")),o(3),l("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function pE(i,m){if(i&1&&(a(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-relation-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function mE(i,m){if(i&1&&(a(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",13),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function dE(i,m){if(i&1){let e=O();a(0,"mat-tab",8,6),d(2,"translate"),a(3,"tb-version-control",14),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Yp=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-asset-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,aE,4,7,"mat-tab",7)(1,rE,4,7,"mat-tab",7)(2,sE,4,5,"mat-tab",7)(3,lE,4,7,"mat-tab",7)(4,pE,4,5,"mat-tab",7)(5,mE,4,6,"mat-tab",7)(6,dE,4,7,"mat-tab",7),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[V,Pt,Ci,qi,Wi,Ei,wi,di,k],encapsulation:2})}}return i})();var $n=(()=>{class i{constructor(e,n,t,s,u,_,E,w,q,Te,Le){this.store=e,this.broadcast=n,this.assetService=t,this.customerService=s,this.edgeService=u,this.dialogService=_,this.homeDialogs=E,this.translate=w,this.datePipe=q,this.router=Te,this.dialog=Le,this.config=new Qe,this.config.entityType=B.ASSET,this.config.entityComponent=Jp,this.config.entityTabsComponent=Yp,this.config.entityTranslations=$e.get(B.ASSET),this.config.entityResources=_t.get(B.ASSET),this.config.deleteEntityTitle=gt=>this.translate.instant("asset.delete-asset-title",{assetName:gt.name}),this.config.deleteEntityContent=()=>this.translate.instant("asset.delete-asset-text"),this.config.deleteEntitiesTitle=gt=>this.translate.instant("asset.delete-assets-title",{count:gt}),this.config.deleteEntitiesContent=()=>this.translate.instant("asset.delete-assets-text"),this.config.loadEntity=gt=>this.assetService.getAssetInfo(gt.id),this.config.saveEntity=gt=>this.assetService.saveAsset(gt).pipe(wt(()=>{this.broadcast.broadcast("assetSaved")}),yt(ui=>this.assetService.getAssetInfo(ui.id.id))),this.config.onEntityAction=gt=>this.onAssetAction(gt,this.config),this.config.detailsReadonly=()=>this.config.componentsData.assetScope==="customer_user"||this.config.componentsData.assetScope==="edge_customer_user",this.config.headerComponent=Kp}resolve(e){let n=e.params;return this.config.componentsData={assetScope:e.data.assetsType,assetProfileId:null,assetType:"",edgeId:n.edgeId},this.customerId=n.customerId,this.store.pipe(Ht(Vn),gi(1)).pipe(wt(t=>{t.authority===M.CUSTOMER_USER&&(e.data.assetsType==="edge"?this.config.componentsData.assetScope="edge_customer_user":this.config.componentsData.assetScope="customer_user",this.customerId=t.customerId)}),yt(()=>this.customerId?this.customerService.getCustomer(this.customerId):ot(null)),mt(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-assets"):this.config.tableTitle=t.title+": "+this.translate.instant("asset.assets"):this.config.componentsData.assetScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(s=>this.config.tableTitle=s.name+": "+this.translate.instant("asset.assets")):this.config.tableTitle=this.translate.instant("asset.assets"),this.config.columns=this.configureColumns(this.config.componentsData.assetScope),this.configureEntityFunctions(this.config.componentsData.assetScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.assetScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.assetScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.assetScope),this.config.addEnabled=!(this.config.componentsData.assetScope==="customer_user"||this.config.componentsData.assetScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.assetScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.assetScope==="tenant",this.config)))}configureColumns(e){let n=[new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","asset.name","25%"),new te("assetProfileName","asset-profile.asset-profile","25%"),new te("label","asset.label","25%")];return e==="tenant"&&n.push(new te("customerTitle","customer.customer","25%"),new te("customerIsPublic","asset.public","60px",t=>Ot(t.customerIsPublic),()=>({}),!1)),n}configureEntityFunctions(e){e==="tenant"?(this.config.entitiesFetchFunction=n=>this.assetService.getTenantAssetInfosByAssetProfileId(n,this.config.componentsData.assetProfileId!==null?this.config.componentsData.assetProfileId.id:""),this.config.deleteEntity=n=>this.assetService.deleteAsset(n.id)):e==="edge"||e==="edge_customer_user"?this.config.entitiesFetchFunction=n=>this.assetService.getEdgeAssets(this.config.componentsData.edgeId,n,this.config.componentsData.assetType):(this.config.entitiesFetchFunction=n=>this.assetService.getCustomerAssetInfosByAssetProfileId(this.customerId,n,this.config.componentsData.assetProfileId!==null?this.config.componentsData.assetProfileId.id:""),this.config.deleteEntity=n=>this.assetService.unassignAssetFromCustomer(n.id))}configureCellActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("asset.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Be,onAction:(t,s)=>this.makePublic(t,s)},{name:this.translate.instant("asset.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Be,onAction:(t,s)=>this.assignToCustomer(t,[s.id])},{name:this.translate.instant("asset.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&!t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("asset.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)}),e==="customer"&&n.push({name:this.translate.instant("asset.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&!t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("asset.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)}),e==="edge"&&n.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>!0,onAction:(t,s)=>this.unassignFromEdge(t,s)}),n}configureGroupActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("asset.assign-assets"),icon:"assignment_ind",isEnabled:!0,onAction:(t,s)=>this.assignToCustomer(t,s.map(u=>u.id))}),e==="customer"&&n.push({name:this.translate.instant("asset.unassign-assets"),icon:"assignment_return",isEnabled:!0,onAction:(t,s)=>this.unassignAssetsFromCustomer(t,s)}),e==="edge"&&n.push({name:this.translate.instant("asset.unassign-assets-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,s)=>this.unassignAssetsFromEdge(t,s)}),n}configureAddActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("asset.add-asset-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("asset.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importAssets(t)}),e==="customer"&&n.push({name:this.translate.instant("asset.assign-new-asset"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addAssetsToCustomer(t)}),e==="edge"&&n.push({name:this.translate.instant("asset.assign-new-asset"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addAssetsToEdge(t)}),n}importAssets(e){this.homeDialogs.importEntities(B.ASSET).subscribe(n=>{n&&(this.broadcast.broadcast("assetSaved"),this.config.updateData())})}openAsset(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}addAssetsToCustomer(e){e&&e.stopPropagation(),this.dialog.open(Eo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:B.ASSET}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}makePublic(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.make-public-asset-title",{assetName:n.name}),this.translate.instant("asset.make-public-asset-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetService.makeAssetPublic(n.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,n){e&&e.stopPropagation(),this.dialog.open(Io,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:n,entityType:B.ASSET}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,n){e&&e.stopPropagation();let t=n.customerIsPublic,s,u;t?(s=this.translate.instant("asset.make-private-asset-title",{assetName:n.name}),u=this.translate.instant("asset.make-private-asset-text")):(s=this.translate.instant("asset.unassign-asset-title",{assetName:n.name}),u=this.translate.instant("asset.unassign-asset-text")),this.dialogService.confirm(s,u,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(_=>{_&&this.assetService.unassignAssetFromCustomer(n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.assetScope!=="tenant")})})}unassignAssetsFromCustomer(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-assets-title",{count:n.length}),this.translate.instant("asset.unassign-assets-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let s=[];n.forEach(u=>{s.push(this.assetService.unassignAssetFromCustomer(u.id.id))}),Gt(s).subscribe(()=>{this.config.updateData()})}})}onAssetAction(e,n){switch(e.action){case"open":return this.openAsset(e.event,e.entity,n),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0}return!1}addAssetsToEdge(e){e&&e.stopPropagation(),this.dialog.open(wo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:B.ASSET}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-asset-from-edge-title",{assetName:n.name}),this.translate.instant("asset.unassign-asset-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetService.unassignAssetFromEdge(this.config.componentsData.edgeId,n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.assetScope!=="tenant")})})}unassignAssetsFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-assets-from-edge-title",{count:n.length}),this.translate.instant("asset.unassign-assets-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let s=[];n.forEach(u=>{s.push(this.assetService.unassignAssetFromEdge(this.config.componentsData.edgeId,u.id.id))}),Gt(s).subscribe(()=>{this.config.updateData()})}})}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(jn),N(I0),N(on),N(an),N(Lt),N(Ui),N(ie),N(Ge),N(de),N(je))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();function uE(i,m){if(i&1){let e=O();Ut(0),a(1,"button",1),d(2,"async"),y("click",function(t){x(e);let s=v();return I(s.onEntityAction(t,"openInstallInstructions"))}),a(3,"mat-icon"),p(4,"info_outline"),r(),a(5,"span"),p(6),d(7,"translate"),r()(),qt()}if(i&2){let e=v();o(),L("!hidden",e.isEdit||e.edgeScope==="customer_user"),l("disabled",c(2,4,e.isLoading$)),o(5),R(c(7,6,"edge.install-connect-instructions"))}}function fE(i,m){if(i&1){let e=O();Ut(0),a(1,"button",1),d(2,"async"),y("click",function(t){x(e);let s=v();return I(s.onEntityAction(t,"openUpgradeInstructions"))}),a(3,"mat-icon"),p(4,"info_outline"),r(),a(5,"span"),p(6),d(7,"translate"),r()(),qt()}if(i&2){let e=v();o(),L("!hidden",e.isEdit||e.edgeScope==="customer_user"),l("disabled",c(2,4,e.isLoading$)),o(5),R(c(7,6,"edge.upgrade-instructions"))}}function gE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"edge.name-required")," "))}function hE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"edge.name-max-length")," "))}function bE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"edge.label-max-length")," "))}var Xp=(()=>{class i extends jt{constructor(e,n,t,s,u,_,E){super(e,_,s,u,E),this.store=e,this.translate=n,this.edgeService=t,this.entityValue=s,this.entitiesTableConfigValue=u,this.fb=_,this.cd=E,this.entityType=B,this.upgradeAvailable=!1}ngOnInit(){this.edgeScope=this.entitiesTableConfig.componentsData.edgeScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Be}buildForm(e){let n=this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],type:[e?.type?e.type:"default",[S.required,S.maxLength(255)]],label:[e?e.label:"",S.maxLength(255)],routingKey:this.fb.control({value:e?e.routingKey:null,disabled:!0}),secret:this.fb.control({value:e?e.secret:null,disabled:!0}),additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return this.generateRoutingKeyAndSecret(e,n),n}updateForm(e){this.entityForm.patchValue({name:e.name,type:e.type,label:e.label,routingKey:e.routingKey,secret:e.secret,additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.generateRoutingKeyAndSecret(e,this.entityForm),this.edgeService.isEdgeUpgradeAvailable(this.entity.id.id).subscribe(n=>{this.upgradeAvailable=n})}updateFormState(){super.updateFormState(),this.entityForm.get("routingKey").disable({emitEvent:!1}),this.entityForm.get("secret").disable({emitEvent:!1})}onEdgeIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("edge.id-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onEdgeInfoCopied(e){let n=e==="key"?"edge.edge-key-copied-message":"edge.edge-secret-copied-message";this.store.dispatch(new tt({message:this.translate.instant(n),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}generateRoutingKeyAndSecret(e,n){e&&!e.id&&(n.get("routingKey").patchValue(fu(),{emitEvent:!1}),n.get("secret").patchValue(gu(20),{emitEvent:!1}))}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g(an),g("entity"),g("entitiesTableConfig"),g(se),g(Xe))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-edge"]],features:[G],decls:112,vars:138,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","flex-wrap","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],["mat-raised-button","","ngxClipboard","",3,"click","disabled"],["svgIcon","mdi:sync"],[1,"flex","flex-row","xs:flex-col"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type",3,"required","entityType"],[1,"flex","flex-row"],[1,"mat-block","flex-1"],["matInput","","formControlName","routingKey"],["mat-icon-button","","type","button","ngxClipboard","",3,"cbOnSuccess","cbContent","matTooltip"],["matInput","","formControlName","secret"],["matInput","","formControlName","label"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"makePublic")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"assignToCustomer")}),p(11),d(12,"translate"),r(),a(13,"button",1),d(14,"async"),y("click",function(u){return t.onEntityAction(u,"unassignFromCustomer")}),p(15),d(16,"translate"),r(),a(17,"button",1),d(18,"async"),y("click",function(u){return t.onEntityAction(u,"openEdgeAssets")}),p(19),d(20,"translate"),r(),a(21,"button",1),d(22,"async"),y("click",function(u){return t.onEntityAction(u,"openEdgeDevices")}),p(23),d(24,"translate"),r(),a(25,"button",1),d(26,"async"),y("click",function(u){return t.onEntityAction(u,"openEdgeEntityViews")}),p(27),d(28,"translate"),r(),a(29,"button",1),d(30,"async"),y("click",function(u){return t.onEntityAction(u,"openEdgeDashboards")}),p(31),d(32,"translate"),r(),a(33,"button",1),d(34,"async"),y("click",function(u){return t.onEntityAction(u,"openEdgeRuleChains")}),p(35),d(36,"translate"),r(),a(37,"button",2),d(38,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(39),d(40,"translate"),r(),a(41,"div",3)(42,"button",4),d(43,"async"),y("cbOnSuccess",function(u){return t.onEdgeIdCopied(u)}),f(44,"mat-icon",5),a(45,"span",6),p(46,"edge.copy-id"),r()(),a(47,"button",4),d(48,"async"),y("cbOnSuccess",function(){return t.onEdgeInfoCopied("key")}),f(49,"mat-icon",5),a(50,"span",6),p(51,"edge.copy-edge-key"),r()(),a(52,"button",4),d(53,"async"),y("cbOnSuccess",function(){return t.onEdgeInfoCopied("secret")}),f(54,"mat-icon",5),a(55,"span",6),p(56,"edge.copy-edge-secret"),r()(),a(57,"button",7),d(58,"async"),y("click",function(u){return t.onEntityAction(u,"syncEdge")}),f(59,"mat-icon",8),a(60,"span",6),p(61,"edge.sync"),r()()(),a(62,"div",9)(63,"div",10),b(64,uE,8,8,"ng-container",11)(65,fE,8,8,"ng-container",11),r()()(),a(66,"div",12)(67,"mat-form-field",13)(68,"mat-label",6),p(69,"edge.assignedToCustomer"),r(),f(70,"input",14),r(),a(71,"div",15),p(72),d(73,"translate"),r(),a(74,"form",16)(75,"fieldset",17),d(76,"async"),a(77,"mat-form-field",13)(78,"mat-label",6),p(79,"edge.name"),r(),f(80,"input",18),b(81,gE,3,3,"mat-error",19)(82,hE,3,3,"mat-error",19),r(),f(83,"tb-entity-subtype-autocomplete",20),r(),a(84,"div",21)(85,"mat-form-field",22)(86,"mat-label",6),p(87,"edge.edge-key"),r(),f(88,"input",23),r(),a(89,"button",24),d(90,"translate"),y("cbOnSuccess",function(){return t.onEdgeInfoCopied("key")}),f(91,"mat-icon",5),r()(),a(92,"div",21)(93,"mat-form-field",22)(94,"mat-label",6),p(95,"edge.edge-secret"),r(),f(96,"input",25),r(),a(97,"button",24),d(98,"translate"),y("cbOnSuccess",function(){return t.onEdgeInfoCopied("secret")}),f(99,"mat-icon",5),r()(),a(100,"fieldset",17),d(101,"async"),a(102,"mat-form-field",13)(103,"mat-label",6),p(104,"edge.label"),r(),f(105,"input",26),b(106,bE,3,3,"mat-error",19),r(),a(107,"div",27)(108,"mat-form-field",13)(109,"mat-label",6),p(110,"edge.description"),r(),f(111,"textarea",28),r()()()()()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,80,t.isLoading$)),o(2),h(" ",c(4,82,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit||t.edgeScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),l("disabled",c(6,84,t.isLoading$)),o(2),h(" ",c(8,86,"edge.make-public")," "),o(2),L("!hidden",t.isEdit||t.edgeScope!=="tenant"||t.isAssignedToCustomer(t.entity)),l("disabled",c(10,88,t.isLoading$)),o(2),h(" ",c(12,90,"edge.assign-to-customer")," "),o(2),L("!hidden",t.isEdit||t.edgeScope!=="customer"&&t.edgeScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),l("disabled",c(14,92,t.isLoading$)),o(2),h(" ",c(16,94,t.entity!=null&&t.entity.customerIsPublic?"edge.make-private":"edge.unassign-from-customer")," "),o(2),L("!hidden",t.isEdit||t.edgeScope==="customer"),l("disabled",c(18,96,t.isLoading$)),o(2),h(" ",c(20,98,"edge.manage-assets")," "),o(2),L("!hidden",t.isEdit||t.edgeScope==="customer"),l("disabled",c(22,100,t.isLoading$)),o(2),h(" ",c(24,102,"edge.manage-devices")," "),o(2),L("!hidden",t.isEdit||t.edgeScope==="customer"),l("disabled",c(26,104,t.isLoading$)),o(2),h(" ",c(28,106,"edge.manage-entity-views")," "),o(2),L("!hidden",t.isEdit||t.edgeScope==="customer"),l("disabled",c(30,108,t.isLoading$)),o(2),h(" ",c(32,110,"edge.manage-dashboards")," "),o(2),L("!hidden",t.isEdit||t.edgeScope!=="tenant"),l("disabled",c(34,112,t.isLoading$)),o(2),h(" ",c(36,114,"edge.manage-rulechains")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(38,116,t.isLoading$)),o(2),h(" ",c(40,118,"edge.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",c(43,120,t.isLoading$)),o(5),L("!hidden",t.isEdit||t.edgeScope==="customer_user"),l("cbContent",t.entity==null?null:t.entity.routingKey)("disabled",c(48,122,t.isLoading$)),o(5),L("!hidden",t.isEdit||t.edgeScope==="customer_user"),l("cbContent",t.entity==null?null:t.entity.secret)("disabled",c(53,124,t.isLoading$)),o(5),L("!hidden",t.isEdit||t.edgeScope==="customer_user"),l("disabled",c(58,126,t.isLoading$)),o(6),l("ngSwitch",t.upgradeAvailable),o(),l("ngSwitchCase",!1),o(),l("ngSwitchCase",!0),o(2),L("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.edgeScope!=="tenant"),o(3),l("ngModel",t.entity==null?null:t.entity.customerTitle),o(),L("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.edgeScope!=="tenant"),o(),h(" ",c(73,128,"edge.edge-public")," "),o(2),l("formGroup",t.entityForm),o(),l("disabled",c(76,130,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("name").hasError("required")),o(),l("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),l("required",!0)("entityType",t.entityType.EDGE),o(),L("!hidden",t.edgeScope==="customer_user"),o(5),T("matTooltip",c(90,132,"edge.copy-edge-key")),l("cbContent",t.entityForm==null?null:t.entityForm.get("routingKey").value),o(3),L("!hidden",t.edgeScope==="customer_user"),o(5),T("matTooltip",c(98,134,"edge.copy-edge-secret")),l("cbContent",t.entityForm==null?null:t.entityForm.get("secret").value),o(3),l("disabled",c(101,136,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("label").hasError("maxlength")))},dependencies:[V,Rn,On,Vs,K,Ce,ee,ge,me,Ie,De,Dt,ii,fe,ue,W,z,ce,ut,X,oe,ft,H,le,k],styles:['@charset "UTF-8";']})}}return i})();C();var Zp=(()=>{class i extends Jt{constructor(e){super(e),this.store=e,this.entityType=B}edgeTypeChanged(e){this.entitiesTableConfig.componentsData.edgeType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-edge-table-header"]],features:[G],decls:1,vars:3,consts:[["subscriptSizing","dynamic",3,"ngModelChange","showLabel","entityType","ngModel"]],template:function(n,t){n&1&&(a(0,"tb-entity-subtype-select",0),y("ngModelChange",function(u){return t.edgeTypeChanged(u)}),r()),n&2&&l("showLabel",!0)("entityType",t.entityType.EDGE)("ngModel",t.entitiesTableConfig.componentsData.edgeType)},dependencies:[Ls,W,ut],encapsulation:2})}}return i})();C();function yE(i,m){if(i&1&&(a(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function _E(i,m){if(i&1&&(a(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function CE(i,m){if(i&1&&(a(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function SE(i,m){if(i&1&&(a(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"edge.events")),o(3),l("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function TE(i,m){if(i&1&&(a(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-edge-downlink-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"edge.downlinks")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function xE(i,m){if(i&1&&(a(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-relation-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function IE(i,m){if(i&1&&(a(0,"mat-tab",8,6),d(2,"translate"),f(3,"tb-audit-log-table",13),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}var em=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-edge-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["downLinksTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"]],template:function(n,t){n&1&&b(0,yE,4,7,"mat-tab",7)(1,_E,4,7,"mat-tab",7)(2,CE,4,5,"mat-tab",7)(3,SE,4,7,"mat-tab",7)(4,TE,4,5,"mat-tab",7)(5,xE,4,5,"mat-tab",7)(6,IE,4,6,"mat-tab",7),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[V,Pt,Ci,qi,Fg,Wi,Ei,wi,k],encapsulation:2})}}return i})();C();function EE(i,m){i&1&&(f(0,"mat-icon",15),p(1," Ubuntu "))}function wE(i,m){if(i&1&&(a(0,"div",11)(1,"div",16),f(2,"tb-markdown",17),r()()),i&2){let e=v(2);o(2),l("data",e.contentData.ubuntu)}}function ME(i,m){i&1&&(f(0,"mat-icon",18),p(1," CentOS/RHEL "))}function DE(i,m){if(i&1&&(a(0,"div",11)(1,"div",16),f(2,"tb-markdown",17),r()()),i&2){let e=v(2);o(2),l("data",e.contentData.centos)}}function PE(i,m){i&1&&(f(0,"mat-icon",19),p(1," Docker "))}function FE(i,m){if(i&1&&(a(0,"div",11)(1,"div",16),f(2,"tb-markdown",17),r()()),i&2){let e=v(2);o(2),l("data",e.contentData.docker)}}function AE(i,m){if(i&1){let e=O();a(0,"section",11)(1,"div",11)(2,"mat-tab-group",12),pt("selectedIndexChange",function(t){x(e);let s=v();return lt(s.tabIndex,t)||(s.tabIndex=t),I(t)}),y("selectedTabChange",function(){x(e);let t=v();return I(t.selectedTabChange(t.tabIndex))}),a(3,"mat-tab"),b(4,EE,2,0,"ng-template",13)(5,wE,3,1,"ng-template",14),r(),a(6,"mat-tab"),b(7,ME,2,0,"ng-template",13)(8,DE,3,1,"ng-template",14),r(),a(9,"mat-tab"),b(10,PE,2,0,"ng-template",13)(11,FE,3,1,"ng-template",14),r()()()()}if(i&2){let e=v();o(2),st("selectedIndex",e.tabIndex)}}function NE(i,m){i&1&&(a(0,"div",20),f(1,"mat-spinner",21),a(2,"span",22),p(3),d(4,"translate"),r()()),i&2&&(o(3),h(" ",c(4,1,"edge.loading-edge-instructions")," "))}var tm=(()=>{class i extends et{constructor(e,n,t,s,u,_){super(e,n,s),this.store=e,this.router=n,this.data=t,this.dialogRef=s,this.attributeService=u,this.edgeService=_,this.loadedInstructions=!1,this.notShowAgain=!1,this.tabIndex=0,this.instructionsMethod=j0,this.contentData={},this.data.afterAdd?(this.dialogTitle="edge.install-connect-instructions-edge-created",this.showDontShowAgain=!0):this.data.upgradeAvailable?(this.dialogTitle="edge.upgrade-instructions",this.showDontShowAgain=!1):(this.dialogTitle="edge.install-connect-instructions",this.showDontShowAgain=!1)}ngOnInit(){this.getInstructions(this.instructionsMethod[this.tabIndex])}ngOnDestroy(){super.ngOnDestroy()}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new ha({notDisplayInstructionsAfterAddEdge:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}selectedTabChange(e){this.getInstructions(this.instructionsMethod[e])}getInstructions(e){if(!this.contentData[e]){this.loadedInstructions=!1;let n;this.data.upgradeAvailable?n=this.attributeService.getEntityAttributes(this.data.edge.id,ss.SERVER_SCOPE,[G0]).pipe(yt(t=>{if(t.length){let s=t[0].value;return this.edgeService.getEdgeUpgradeInstructions(s,e)}})):n=this.edgeService.getEdgeInstallInstructions(this.data.edge.id.id,e),n.subscribe(t=>{this.contentData[e]=t.instructions,this.loadedInstructions=!0})}}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(Ze),g(B0),g(an))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-edge-installation-dialog"]],features:[G],decls:20,vars:15,consts:[["loadingInstructions",""],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],["class","tb-form-panel no-padding no-border",4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],[3,"ngModelChange","ngModel"],["mat-button","",3,"click","disabled"],[1,"tb-form-panel","no-padding","no-border"],[3,"selectedIndexChange","selectedTabChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],["svgIcon","mdi:ubuntu",1,"tabs-icon"],[1,"tb-form-panel","no-padding","stroked"],[3,"data"],["svgIcon","mdi:centos",1,"tabs-icon"],["svgIcon","docker",1,"tabs-icon"],[1,"tb-loader"],["color","accent","diameter","65","strokeWidth","4"],[1,"mat-subtitle-1","label"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-toolbar",1)(1,"h2",2),p(2),r(),f(3,"span",3),a(4,"button",4),y("click",function(){return x(s),I(t.close())}),a(5,"mat-icon",5),p(6,"close"),r()()(),a(7,"div",6),b(8,AE,12,1,"section",7),r(),a(9,"div",8)(10,"mat-slide-toggle",9),pt("ngModelChange",function(_){return x(s),lt(t.notShowAgain,_)||(t.notShowAgain=_),I(_)}),p(11),d(12,"translate"),r(),f(13,"span",3),a(14,"button",10),d(15,"async"),y("click",function(){return x(s),I(t.close())}),p(16),d(17,"translate"),r()(),b(18,NE,5,3,"ng-template",null,0,xt)}if(n&2){let s=U(19);o(2),R(t.dialogTitle),o(6),l("ngIf",t.loadedInstructions)("ngIfElse",s),o(2),L("!hidden",!t.showDontShowAgain),st("ngModel",t.notShowAgain),o(),R(c(12,9,"action.dont-show-again")),o(3),l("disabled",c(15,11,t.isLoading$)),o(2),R(c(17,13,"action.close"))}},dependencies:[V,Ha,K,Ce,ee,He,Ct,Je,_o,Es,ws,Pt,Co,it,W,ut,H,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:300px;max-height:100%}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:0;text-align:center}[_nghost-%COMP%]   .tb-font-14[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .tb-flex-1[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 600px) and (max-width: 959px){[_nghost-%COMP%]{width:705px}}@media screen and (min-width: 960px){[_nghost-%COMP%]{width:1080px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:8px 16px}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:0 16px 16px;border-top:16px solid #fff}[_nghost-%COMP%]     .tb-markdown-view{padding:16px 16px 32px}[_nghost-%COMP%]     .tb-markdown-view div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn{right:-2px!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn p{color:#359b07!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div{background-color:unset!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#359b07;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn.multiline{right:-2px!important}[_nghost-%COMP%]     .tb-markdown-view>*:not(ul){padding-right:unset!important;padding-left:unset!important}[_nghost-%COMP%]     .tb-markdown-view pre[class*=language-]{border:1px solid #359B07!important}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .mat-mdc-tab-header{position:sticky;top:0;z-index:10;background-color:#fff}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}[_nghost-%COMP%]     .mat-mdc-tab-body{padding:16px 0}']})}}return i})();var ea=(()=>{class i{constructor(e,n,t,s,u,_,E,w,q,Te){this.store=e,this.broadcast=n,this.edgeService=t,this.customerService=s,this.dialogService=u,this.homeDialogs=_,this.translate=E,this.datePipe=w,this.router=q,this.dialog=Te,this.config=new Qe,this.config.entityType=B.EDGE,this.config.entityComponent=Xp,this.config.entityTabsComponent=em,this.config.entityTranslations=$e.get(B.EDGE),this.config.entityResources=_t.get(B.EDGE),this.config.deleteEntityTitle=Le=>this.translate.instant("edge.delete-edge-title",{edgeName:Le.name}),this.config.deleteEntityContent=()=>this.translate.instant("edge.delete-edge-text"),this.config.deleteEntitiesTitle=Le=>this.translate.instant("edge.delete-edges-title",{count:Le}),this.config.deleteEntitiesContent=()=>this.translate.instant("edge.delete-edges-text"),this.config.loadEntity=Le=>this.edgeService.getEdgeInfo(Le.id),this.config.saveEntity=Le=>this.edgeService.saveEdge(Le).pipe(wt(()=>{this.broadcast.broadcast("edgeSaved")}),yt(gt=>this.edgeService.getEdgeInfo(gt.id.id))),this.config.onEntityAction=Le=>this.onEdgeAction(Le,this.config),this.config.detailsReadonly=()=>this.config.componentsData.edgeScope==="customer_user",this.config.headerComponent=Zp}resolve(e){let n=e.params;return this.config.componentsData={edgeScope:e.data.edgesType,edgeType:""},this.customerId=n.customerId,this.store.pipe(Ht(Vn),gi(1)).pipe(wt(t=>{t.authority===M.CUSTOMER_USER&&(this.config.componentsData.edgeScope="customer_user",this.customerId=t.customerId)}),yt(()=>this.customerId?this.customerService.getCustomer(this.customerId):ot(null)),mt(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-edges"):this.config.tableTitle=t.title+": "+this.translate.instant("edge.edge-instances"):this.config.tableTitle=this.translate.instant("edge.edge-instances"),this.config.columns=this.configureColumns(this.config.componentsData.edgeScope),this.configureEntityFunctions(this.config.componentsData.edgeScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.edgeScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.edgeScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.edgeScope),this.config.addEnabled=this.config.componentsData.edgeScope!=="customer_user",this.config.entitiesDeleteEnabled=this.config.componentsData.edgeScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.edgeScope==="tenant",this.config.addEntity=()=>(this.addEdge(),ot(null)),this.config)))}configureColumns(e){let n=[new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","edge.name","25%"),new te("type","edge.edge-type","25%"),new te("label","edge.label","25%")];return e==="tenant"&&n.push(new te("customerTitle","customer.customer","25%"),new te("customerIsPublic","edge.public","60px",t=>Ot(t.customerIsPublic),()=>({}),!1)),n}configureEntityFunctions(e){e==="tenant"&&(this.config.entitiesFetchFunction=n=>this.edgeService.getTenantEdgeInfos(n,this.config.componentsData.edgeType),this.config.deleteEntity=n=>this.edgeService.deleteEdge(n.id)),e==="customer"&&(this.config.entitiesFetchFunction=n=>this.edgeService.getCustomerEdgeInfos(this.customerId,n,this.config.componentsData.edgeType),this.config.deleteEntity=n=>this.edgeService.unassignEdgeFromCustomer(n.id)),e==="customer_user"&&(this.config.entitiesFetchFunction=n=>this.edgeService.getCustomerEdgeInfos(this.customerId,n,this.config.componentsData.edgeType),this.config.deleteEntity=n=>this.edgeService.unassignEdgeFromCustomer(n.id))}configureCellActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("edge.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Be,onAction:(t,s)=>this.makePublic(t,s)},{name:this.translate.instant("edge.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Be,onAction:(t,s)=>this.assignToCustomer(t,[s.id])},{name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&!t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("edge.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("edge.manage-assets"),icon:"domain",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.ASSET)},{name:this.translate.instant("edge.manage-devices"),icon:"devices_other",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.DEVICE)},{name:this.translate.instant("edge.manage-entity-views"),icon:"view_quilt",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.ENTITY_VIEW)},{name:this.translate.instant("edge.manage-dashboards"),icon:"dashboard",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.DASHBOARD)},{name:this.translate.instant("edge.manage-rulechains"),icon:"settings_ethernet",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.RULE_CHAIN)}),e==="customer"&&n.push({name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&!t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("edge.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)}),e==="customer_user"&&n.push({name:this.translate.instant("edge.manage-assets"),icon:"domain",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.ASSET)},{name:this.translate.instant("edge.manage-devices"),icon:"devices_other",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.DEVICE)},{name:this.translate.instant("edge.manage-entity-views"),icon:"view_quilt",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.ENTITY_VIEW)},{name:this.translate.instant("edge.manage-dashboards"),icon:"dashboard",isEnabled:t=>!0,onAction:(t,s)=>this.openEdgeEntitiesByType(t,s,B.DASHBOARD)}),n}configureGroupActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("edge.assign-edge-to-customer-text"),icon:"assignment_ind",isEnabled:!0,onAction:(t,s)=>this.assignToCustomer(t,s.map(u=>u.id))}),e==="customer"&&n.push({name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:!0,onAction:(t,s)=>this.unassignEdgesFromCustomer(t,s)}),n}configureAddActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("edge.add-edge-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("edge.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importEdges(t)}),e==="customer"&&n.push({name:this.translate.instant("edge.assign-new-edge"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEdgesToCustomer(t)}),n}importEdges(e){this.homeDialogs.importEntities(B.EDGE).subscribe(n=>{n&&(this.broadcast.broadcast("edgeSaved"),this.config.updateData())})}addEdgesToCustomer(e){e&&e.stopPropagation(),this.dialog.open(Eo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:B.EDGE}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}openEdge(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}makePublic(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("edge.make-public-edge-title",{edgeName:n.name}),this.translate.instant("edge.make-public-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.edgeService.makeEdgePublic(n.id.id).subscribe(()=>{this.config.updateData()})})}openEdgeEntitiesByType(e,n,t){e&&e.stopPropagation();let s;switch(t){case B.DEVICE:s="devices";break;case B.ASSET:s="assets";break;case B.EDGE:s="assets";break;case B.ENTITY_VIEW:s="entityViews";break;case B.DASHBOARD:s="dashboards";break;case B.RULE_CHAIN:s="ruleChains";break}this.router.navigateByUrl(`edgeManagement/instances/${n.id.id}/${s}`)}assignToCustomer(e,n){e&&e.stopPropagation(),this.dialog.open(Io,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:n,entityType:B.EDGE}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,n){e&&e.stopPropagation();let t=n.customerIsPublic,s,u;t?(s=this.translate.instant("edge.make-private-edge-title",{edgeName:n.name}),u=this.translate.instant("edge.make-private-edge-text")):(s=this.translate.instant("edge.unassign-edge-title",{edgeName:n.name}),u=this.translate.instant("edge.unassign-edge-text")),this.dialogService.confirm(s,u,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(_=>{_&&this.edgeService.unassignEdgeFromCustomer(n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.edgeScope!=="tenant")})})}unassignEdgesFromCustomer(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("edge.unassign-edges-title",{count:n.length}),this.translate.instant("edge.unassign-edges-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let s=[];n.forEach(u=>{s.push(this.edgeService.unassignEdgeFromCustomer(u.id.id))}),Gt(s).subscribe(()=>{this.config.updateData()})}})}syncEdge(e,n){e&&e.stopPropagation(),this.edgeService.syncEdge(n.id.id).subscribe(()=>{this.store.dispatch(new tt({message:this.translate.instant("edge.sync-process-started-successfully"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))})}addEdge(){this.dialog.open($f,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entitiesTableConfig:this.config}}).afterClosed().subscribe(e=>{e&&this.store.pipe(Ht(ba("notDisplayInstructionsAfterAddEdge"))).pipe(gi(1)).subscribe(n=>{n?(this.config.updateData(),this.config.entityAdded(e)):this.openInstructions(null,e,!0)})})}openInstructions(e,n,t=!1,s=!1){e&&e.stopPropagation(),this.dialog.open(tm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edge:n,afterAdd:t,upgradeAvailable:s}}).afterClosed().subscribe(()=>{t&&this.config.updateData()})}onEdgeAction(e,n){switch(e.action){case"open":return this.openEdge(e.event,e.entity,n),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"openEdgeAssets":return this.openEdgeEntitiesByType(e.event,e.entity,B.ASSET),!0;case"openEdgeDevices":return this.openEdgeEntitiesByType(e.event,e.entity,B.DEVICE),!0;case"openEdgeEntityViews":return this.openEdgeEntitiesByType(e.event,e.entity,B.ENTITY_VIEW),!0;case"openEdgeDashboards":return this.openEdgeEntitiesByType(e.event,e.entity,B.DASHBOARD),!0;case"openEdgeRuleChains":return this.openEdgeEntitiesByType(e.event,e.entity,B.RULE_CHAIN),!0;case"syncEdge":return this.syncEdge(e.event,e.entity),!0;case"openInstallInstructions":return this.openInstructions(e.event,e.entity),!0;case"openUpgradeInstructions":return this.openInstructions(e.event,e.entity,!1,!0),!0}}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(jn),N(an),N(on),N(Lt),N(Ui),N(ie),N(Ge),N(de),N(je))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var kE=[{path:"customers",data:{breadcrumb:{menuId:xe.customers}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"customer.customers"},resolve:{entitiesTableConfig:Ap}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"supervisor_account"},auth:[M.TENANT_ADMIN],title:"customer.customers"},resolve:{entitiesTableConfig:Ap}},{path:":customerId/users",data:{breadcrumb:{label:"user.customer-users",icon:"account_circle"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"user.customer-users"},resolve:{entitiesTableConfig:so}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"account_circle"},auth:[M.TENANT_ADMIN],title:"user.customer-users"},resolve:{entitiesTableConfig:so}}]},{path:":customerId/devices",data:{breadcrumb:{label:"customer.devices",icon:"devices_other"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"customer.devices",devicesType:"customer"},resolve:{entitiesTableConfig:zn}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"devices_other"},auth:[M.TENANT_ADMIN],title:"customer.devices",devicesType:"customer"},resolve:{entitiesTableConfig:zn}}]},{path:":customerId/assets",data:{breadcrumb:{label:"customer.assets",icon:"domain"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"customer.assets",assetsType:"customer"},resolve:{entitiesTableConfig:$n}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"domain"},auth:[M.TENANT_ADMIN],title:"customer.assets",assetsType:"customer"},resolve:{entitiesTableConfig:$n}}]},{path:":customerId/edgeInstances",data:{breadcrumb:{label:"customer.edges",icon:"router"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"customer.edges",edgesType:"customer"},resolve:{entitiesTableConfig:ea}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"router"},auth:[M.TENANT_ADMIN],title:"customer.edges",edgesType:"customer"},resolve:{entitiesTableConfig:ea}}]},{path:":customerId/dashboards",data:{breadcrumb:{label:"customer.dashboards",icon:"dashboard"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"customer.dashboards",dashboardsType:"customer"},resolve:{entitiesTableConfig:cl}},{path:":dashboardId",component:ir,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:fl,icon:"dashboard"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"customer.dashboard",widgetEditMode:!1},resolve:{dashboard:ul}}]}]}],im=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Ap],imports:[j.forChild(kE),j]})}}return i})();(function(){Y(im,{imports:[j],exports:[j]})})();var nm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,im]})}}return i})();(function(){Y(nm,{declarations:[Pp,Fp],imports:[ae,re,Ee,im]})})();C();var om=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,ql]})}}return i})();(function(){Y(om,{imports:[ae,re,ql]})})();C();C();var RE=[{path:"users",data:{breadcrumb:{skip:!0}},children:[{path:"",redirectTo:"/",pathMatch:"full"},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"account_circle"},auth:[M.SYS_ADMIN,M.TENANT_ADMIN],title:"user.user"},resolve:{entitiesTableConfig:so}}]}],am=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[so],imports:[j.forChild(RE),j]})}}return i})();(function(){Y(am,{imports:[j],exports:[j]})})();var rm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,am]})}}return i})();(function(){Y(rm,{declarations:[No,wp,Ep,cr],imports:[ae,re,Ee,am]})})();C();C();var Dh=[{path:"devices",data:{breadcrumb:{menuId:xe.devices}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"device.devices",devicesType:"tenant"},resolve:{entitiesTableConfig:zn}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"devices_other"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"device.devices",devicesType:"tenant"},resolve:{entitiesTableConfig:zn}}]}],OE=[{path:"devices",pathMatch:"full",redirectTo:"/entities/devices"},{path:"devices/:entityId",redirectTo:"/entities/devices/:entityId"}],sm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[zn],imports:[j.forChild(OE),j]})}}return i})();(function(){Y(sm,{imports:[j],exports:[j]})})();var lm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Mi,fc,uc,sm]})}}return i})();(function(){Y(lm,{declarations:[Np,kp,Rp,Op,Bp,Vp,Lp,jp,Gp,Up,Hp,qp,Wp,Qp],imports:[ae,re,Ee,Mi,fc,uc,sm]})})();C();C();var Ph=[{path:"assets",data:{breadcrumb:{menuId:xe.assets}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"asset.assets",assetsType:"tenant"},resolve:{entitiesTableConfig:$n}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"domain"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"asset.assets",assetsType:"tenant"},resolve:{entitiesTableConfig:$n}}]}],BE=[{path:"assets",pathMatch:"full",redirectTo:"/entities/assets"},{path:"assets/:entityId",redirectTo:"/entities/assets/:entityId"}],pm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[$n],imports:[j.forChild(BE),j]})}}return i})();(function(){Y(pm,{imports:[j],exports:[j]})})();var mm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Mi,pm]})}}return i})();(function(){Y(mm,{declarations:[Jp,Yp,Kp],imports:[ae,re,Ee,Mi,pm]})})();C();C();function VE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"entity-view.name-required")," "))}function LE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"entity-view.name-max-length")," "))}var dm=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,u,t,s,_),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.fb=u,this.cd=_,this.entityType=B,this.dataKeyType=wu,this.allowedEntityTypes=[B.DEVICE,B.ASSET]}ngOnInit(){this.entityViewScope=this.entitiesTableConfig.componentsData.entityViewScope,super.ngOnInit(),this.maxStartTimeMs=this.entityForm.get("endTimeMs").valueChanges,this.minEndTimeMs=this.entityForm.get("startTimeMs").valueChanges,this.selectedEntityId=this.entityForm.get("entityId").valueChanges}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Be}buildForm(e){return this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],type:[e?e.type:null,S.required],entityId:[e?e.entityId:null,[S.required]],startTimeMs:[e?e.startTimeMs:null],endTimeMs:[e?e.endTimeMs:null],keys:this.fb.group({attributes:this.fb.group({cs:[e&&e.keys&&e.keys.attributes?e.keys.attributes.cs:null],sh:[e&&e.keys&&e.keys.attributes?e.keys.attributes.sh:null],ss:[e&&e.keys&&e.keys.attributes?e.keys.attributes.ss:null]}),timeseries:[e&&e.keys&&e.keys.timeseries?e.keys.timeseries:null]}),additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({type:e.type}),this.entityForm.patchValue({entityId:e.entityId}),this.entityForm.patchValue({startTimeMs:e.startTimeMs}),this.entityForm.patchValue({endTimeMs:e.endTimeMs}),this.entityForm.patchValue({keys:{attributes:{cs:e.keys&&e.keys.attributes?e.keys.attributes.cs:null,sh:e.keys&&e.keys.attributes?e.keys.attributes.sh:null,ss:e.keys&&e.keys.attributes?e.keys.attributes.ss:null},timeseries:e.keys&&e.keys.timeseries?e.keys.timeseries:null}}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onEntityViewIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("entity-view.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(se),g(Xe))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-entity-view"]],features:[G],decls:93,vars:94,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type",3,"required","entityType"],[1,"flex","flex-col"],["translate","",1,"tb-title","no-padding"],["formControlName","entityId",1,"flex-1",3,"required","allowedEntityTypes"],["formGroupName","keys",1,"mat-accordion-container"],[3,"multi"],["formGroupName","attributes",3,"expanded"],["translate","",1,"tb-panel-title"],["translate","",1,"tb-hint"],["formControlName","cs","keysText","entity-view.client-attributes-placeholder",3,"entityId","dataKeyType"],["formControlName","sh","keysText","entity-view.shared-attributes-placeholder",3,"entityId","dataKeyType"],["formControlName","ss","keysText","entity-view.server-attributes-placeholder",3,"entityId","dataKeyType"],[3,"expanded"],["formControlName","timeseries","keysText","entity-view.timeseries-placeholder",3,"entityId","dataKeyType"],["dateText","entity-view.start-date","timeText","entity-view.start-ts","formControlName","startTimeMs",3,"maxDate"],["dateText","entity-view.end-date","timeText","entity-view.end-ts","formControlName","endTimeMs",3,"minDate"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"makePublic")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"assignToCustomer")}),p(11),d(12,"translate"),r(),a(13,"button",1),d(14,"async"),y("click",function(u){return t.onEntityAction(u,"unassignFromCustomer")}),p(15),d(16,"translate"),r(),a(17,"button",1),d(18,"async"),y("click",function(u){return t.onEntityAction(u,"unassignFromEdge")}),p(19),d(20,"translate"),r(),a(21,"button",1),d(22,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(23),d(24,"translate"),r(),a(25,"div",2)(26,"button",3),y("cbOnSuccess",function(u){return t.onEntityViewIdCopied(u)}),f(27,"mat-icon",4),a(28,"span",5),p(29,"entity-view.copyId"),r()()()(),a(30,"div",6)(31,"mat-form-field",7)(32,"mat-label",5),p(33,"entity-view.assignedToCustomer"),r(),f(34,"input",8),r(),a(35,"div",9),p(36),d(37,"translate"),r(),a(38,"form",10)(39,"fieldset",11),d(40,"async"),a(41,"mat-form-field",7)(42,"mat-label",5),p(43,"entity-view.name"),r(),f(44,"input",12),b(45,VE,3,3,"mat-error",13)(46,LE,3,3,"mat-error",13),r(),f(47,"tb-entity-subtype-autocomplete",14),a(48,"section",15)(49,"label",16),p(50,"entity-view.target-entity"),r(),f(51,"tb-entity-select",17),r(),a(52,"div",18)(53,"mat-accordion",19)(54,"mat-expansion-panel",20)(55,"mat-expansion-panel-header")(56,"mat-panel-title")(57,"div",21),p(58,"entity-view.attributes-propagation"),r()()(),a(59,"div",22),p(60,"entity-view.attributes-propagation-hint"),r(),a(61,"label",16),p(62,"entity-view.client-attributes"),r(),f(63,"tb-entity-keys-list",23),d(64,"async"),a(65,"label",16),p(66,"entity-view.shared-attributes"),r(),f(67,"tb-entity-keys-list",24),d(68,"async"),a(69,"label",16),p(70,"entity-view.server-attributes"),r(),f(71,"tb-entity-keys-list",25),d(72,"async"),r(),a(73,"mat-expansion-panel",26)(74,"mat-expansion-panel-header")(75,"mat-panel-title")(76,"div",21),p(77,"entity-view.timeseries-data"),r()()(),a(78,"div",22),p(79,"entity-view.timeseries-data-hint"),r(),a(80,"label",16),p(81,"entity-view.timeseries"),r(),f(82,"tb-entity-keys-list",27),d(83,"async"),r()()(),f(84,"tb-datetime",28),d(85,"async"),f(86,"tb-datetime",29),d(87,"async"),a(88,"div",30)(89,"mat-form-field",7)(90,"mat-label",5),p(91,"entity-view.description"),r(),f(92,"textarea",31),r()()()()()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,54,t.isLoading$)),o(2),h(" ",c(4,56,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit||t.entityViewScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),l("disabled",c(6,58,t.isLoading$)),o(2),h(" ",c(8,60,"entity-view.make-public")," "),o(2),L("!hidden",t.isEdit||t.entityViewScope!=="tenant"||t.isAssignedToCustomer(t.entity)),l("disabled",c(10,62,t.isLoading$)),o(2),h(" ",c(12,64,"entity-view.assign-to-customer")," "),o(2),L("!hidden",t.isEdit||t.entityViewScope!=="customer"&&t.entityViewScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),l("disabled",c(14,66,t.isLoading$)),o(2),h(" ",c(16,68,t.entity!=null&&t.entity.customerIsPublic?"entity-view.make-private":"entity-view.unassign-from-customer")," "),o(2),L("!hidden",t.isEdit||t.entityViewScope!=="edge"),l("disabled",c(18,70,t.isLoading$)),o(2),h(" ",c(20,72,"edge.unassign-from-edge")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(22,74,t.isLoading$)),o(2),h(" ",c(24,76,"entity-view.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),L("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.entityViewScope!=="tenant"),o(3),l("ngModel",t.entity==null?null:t.entity.customerTitle),o(),L("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.entityViewScope!=="customer"&&t.entityViewScope!=="tenant"),o(),h(" ",c(37,78,"entity-view.entity-view-public")," "),o(2),l("formGroup",t.entityForm),o(),l("disabled",c(40,80,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("name").hasError("required")),o(),l("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),l("required",!0)("entityType",t.entityType.ENTITY_VIEW),o(4),l("required",!0)("allowedEntityTypes",t.allowedEntityTypes),o(2),l("multi",!0),o(),l("expanded",!0),o(9),l("entityId",c(64,82,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),o(4),l("entityId",c(68,84,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),o(4),l("entityId",c(72,86,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),o(2),l("expanded",!0),o(9),l("entityId",c(83,88,t.selectedEntityId))("dataKeyType",t.dataKeyType.timeseries),o(2),l("maxDate",c(85,90,t.maxStartTimeMs)),o(2),l("minDate",c(87,92,t.minEndTimeMs)))},dependencies:[V,K0,Vs,J0,Y0,K,ee,ge,me,Ie,De,us,bi,Oi,Bi,ii,fe,ue,W,z,ce,ut,X,oe,ft,H,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-accordion-container[_ngcontent-%COMP%]{margin-bottom:16px}']})}}return i})();C();var cm=(()=>{class i extends Jt{constructor(e){super(e),this.store=e,this.entityType=B}entityViewTypeChanged(e){this.entitiesTableConfig.componentsData.entityViewType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-entity-view-table-header"]],features:[G],decls:1,vars:3,consts:[["subscriptSizing","dynamic",3,"ngModelChange","showLabel","entityType","ngModel"]],template:function(n,t){n&1&&(a(0,"tb-entity-subtype-select",0),y("ngModelChange",function(u){return t.entityViewTypeChanged(u)}),r()),n&2&&l("showLabel",!0)("entityType",t.entityType.ENTITY_VIEW)("ngModel",t.entitiesTableConfig.componentsData.entityViewType)},dependencies:[Ls,W,ut],encapsulation:2})}}return i})();C();C();C();function jE(i,m){if(i&1&&(a(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.CLIENT_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function GE(i,m){if(i&1&&(a(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function UE(i,m){if(i&1&&(a(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function qE(i,m){if(i&1&&(a(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"entity-view.events")),o(3),l("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function WE(i,m){if(i&1&&(a(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-relation-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function HE(i,m){if(i&1&&(a(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",13),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function zE(i,m){if(i&1){let e=O();a(0,"mat-tab",8,6),d(2,"translate"),a(3,"tb-version-control",14),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var um=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-entity-view-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,jE,4,7,"mat-tab",7)(1,GE,4,7,"mat-tab",7)(2,UE,4,5,"mat-tab",7)(3,qE,4,7,"mat-tab",7)(4,WE,4,5,"mat-tab",7)(5,HE,4,6,"mat-tab",7)(6,zE,4,7,"mat-tab",7),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[V,Pt,Ci,qi,Wi,Ei,wi,di,k],encapsulation:2})}}return i})();var ta=(()=>{class i{constructor(e,n,t,s,u,_,E,w,q,Te){this.store=e,this.broadcast=n,this.entityViewService=t,this.customerService=s,this.edgeService=u,this.dialogService=_,this.translate=E,this.datePipe=w,this.router=q,this.dialog=Te,this.config=new Qe,this.config.entityType=B.ENTITY_VIEW,this.config.entityComponent=dm,this.config.entityTabsComponent=um,this.config.entityTranslations=$e.get(B.ENTITY_VIEW),this.config.entityResources=_t.get(B.ENTITY_VIEW),this.config.addDialogStyle={maxWidth:"800px"},this.config.deleteEntityTitle=Le=>this.translate.instant("entity-view.delete-entity-view-title",{entityViewName:Le.name}),this.config.deleteEntityContent=()=>this.translate.instant("entity-view.delete-entity-view-text"),this.config.deleteEntitiesTitle=Le=>this.translate.instant("entity-view.delete-entity-views-title",{count:Le}),this.config.deleteEntitiesContent=()=>this.translate.instant("entity-view.delete-entity-views-text"),this.config.loadEntity=Le=>this.entityViewService.getEntityViewInfo(Le.id),this.config.saveEntity=Le=>this.entityViewService.saveEntityView(Le).pipe(wt(()=>{this.broadcast.broadcast("entityViewSaved")}),yt(gt=>this.entityViewService.getEntityViewInfo(gt.id.id))),this.config.onEntityAction=Le=>this.onEntityViewAction(Le,this.config),this.config.detailsReadonly=()=>this.config.componentsData.entityViewScope==="customer_user"||this.config.componentsData.entityViewScope==="edge_customer_user",this.config.headerComponent=cm}resolve(e){let n=e.params;return this.config.componentsData={entityViewScope:e.data.entityViewsType,entityViewType:"",edgeId:n.edgeId},this.customerId=n.customerId,this.store.pipe(Ht(Vn),gi(1)).pipe(wt(t=>{t.authority===M.CUSTOMER_USER&&(e.data.entityViewsType==="edge"?this.config.componentsData.entityViewScope="edge_customer_user":this.config.componentsData.entityViewScope="customer_user",this.customerId=t.customerId)}),yt(()=>this.customerId?this.customerService.getCustomer(this.customerId):ot(null)),mt(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-entity-views"):this.config.tableTitle=t.title+": "+this.translate.instant("entity-view.entity-views"):this.config.componentsData.entityViewScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(s=>this.config.tableTitle=s.name+": "+this.translate.instant("entity-view.entity-views")):this.config.tableTitle=this.translate.instant("entity-view.entity-views"),this.config.columns=this.configureColumns(this.config.componentsData.entityViewScope),this.configureEntityFunctions(this.config.componentsData.entityViewScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.entityViewScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.entityViewScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.entityViewScope),this.config.addEnabled=!(this.config.componentsData.entityViewScope==="customer_user"||this.config.componentsData.entityViewScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.entityViewScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.entityViewScope==="tenant",this.config)))}configureColumns(e){let n=[new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","entity-view.name","33%"),new te("type","entity-view.entity-view-type","33%")];return e==="tenant"&&n.push(new te("customerTitle","customer.customer","33%"),new te("customerIsPublic","entity-view.public","60px",t=>Ot(t.customerIsPublic),()=>({}),!1)),n}configureEntityFunctions(e){e==="tenant"?(this.config.entitiesFetchFunction=n=>this.entityViewService.getTenantEntityViewInfos(n,this.config.componentsData.entityViewType),this.config.deleteEntity=n=>this.entityViewService.deleteEntityView(n.id)):e==="edge"||e==="edge_customer_user"?this.config.entitiesFetchFunction=n=>this.entityViewService.getEdgeEntityViews(this.config.componentsData.edgeId,n,this.config.componentsData.entityViewType):(this.config.entitiesFetchFunction=n=>this.entityViewService.getCustomerEntityViewInfos(this.customerId,n,this.config.componentsData.entityViewType),this.config.deleteEntity=n=>this.entityViewService.unassignEntityViewFromCustomer(n.id))}configureCellActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("entity-view.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Be,onAction:(t,s)=>this.makePublic(t,s)},{name:this.translate.instant("entity-view.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Be,onAction:(t,s)=>this.assignToCustomer(t,[s.id])},{name:this.translate.instant("entity-view.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&!t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("entity-view.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)}),e==="customer"&&n.push({name:this.translate.instant("entity-view.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&!t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)},{name:this.translate.instant("entity-view.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Be&&t.customerIsPublic,onAction:(t,s)=>this.unassignFromCustomer(t,s)}),e==="edge"&&n.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:()=>!0,onAction:(t,s)=>this.unassignFromEdge(t,s)}),n}configureGroupActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("entity-view.assign-entity-views"),icon:"assignment_ind",isEnabled:!0,onAction:(t,s)=>this.assignToCustomer(t,s.map(u=>u.id))}),e==="customer"&&n.push({name:this.translate.instant("entity-view.unassign-entity-views"),icon:"assignment_return",isEnabled:!0,onAction:(t,s)=>this.unassignEntityViewsFromCustomer(t,s)}),e==="edge"&&n.push({name:this.translate.instant("entity-view.unassign-entity-views-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,s)=>this.unassignEntityViewsFromEdge(t,s)}),n}configureAddActions(e){let n=[];return e==="customer"&&n.push({name:this.translate.instant("entity-view.assign-new-entity-view"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEntityViewsToCustomer(t)}),e==="edge"&&n.push({name:this.translate.instant("entity-view.assign-new-entity-view"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEntityViewsToEdge(t)}),n}addEntityViewsToCustomer(e){e&&e.stopPropagation(),this.dialog.open(Eo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:B.ENTITY_VIEW}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}openEntityView(e,n,t){e&&e.stopPropagation();let s=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(s)}makePublic(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.make-public-entity-view-title",{entityViewName:n.name}),this.translate.instant("entity-view.make-public-entity-view-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.entityViewService.makeEntityViewPublic(n.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,n){e&&e.stopPropagation(),this.dialog.open(Io,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:n,entityType:B.ENTITY_VIEW}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,n){e&&e.stopPropagation();let t=n.customerIsPublic,s,u;t?(s=this.translate.instant("entity-view.make-private-entity-view-title",{entityViewName:n.name}),u=this.translate.instant("entity-view.make-private-entity-view-text")):(s=this.translate.instant("entity-view.unassign-entity-view-title",{entityViewName:n.name}),u=this.translate.instant("entity-view.unassign-entity-view-text")),this.dialogService.confirm(s,u,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(_=>{_&&this.entityViewService.unassignEntityViewFromCustomer(n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.entityViewScope!=="tenant")})})}unassignEntityViewsFromCustomer(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-views-title",{count:n.length}),this.translate.instant("entity-view.unassign-entity-views-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let s=[];n.forEach(u=>{s.push(this.entityViewService.unassignEntityViewFromCustomer(u.id.id))}),Gt(s).subscribe(()=>{this.config.updateData()})}})}onEntityViewAction(e,n){switch(e.action){case"open":return this.openEntityView(e.event,e.entity,n),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0}return!1}addEntityViewsToEdge(e){e&&e.stopPropagation(),this.dialog.open(wo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:B.ENTITY_VIEW}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-view-from-edge-title",{entityViewName:n.name}),this.translate.instant("entity-view.unassign-entity-view-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.entityViewService.unassignEntityViewFromEdge(this.config.componentsData.edgeId,n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.entityViewScope!=="tenant")})})}unassignEntityViewsFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-views-from-edge-title",{count:n.length}),this.translate.instant("entity-view.unassign-entity-views-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let s=[];n.forEach(u=>{s.push(this.entityViewService.unassignEntityViewFromEdge(this.config.componentsData.edgeId,u.id.id))}),Gt(s).subscribe(()=>{this.config.updateData()})}})}static{this.\u0275fac=function(n){return new(n||i)(N(P),N(jn),N(E0),N(on),N(an),N(Lt),N(ie),N(Ge),N(de),N(je))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var Fh=[{path:"entityViews",data:{breadcrumb:{menuId:xe.entity_views}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"entity-view.entity-views",entityViewsType:"tenant"},resolve:{entitiesTableConfig:ta}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"view_quilt"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"entity-view.entity-views",entityViewsType:"tenant"},resolve:{entitiesTableConfig:ta}}]}],$E=[{path:"entityViews",pathMatch:"full",redirectTo:"/entities/entityViews"},{path:"entityViews/:entityId",redirectTo:"/entities/entityViews/:entityId"}],fm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[ta],imports:[j.forChild($E),j]})}}return i})();(function(){Y(fm,{imports:[j],exports:[j]})})();var gm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Mi,fm]})}}return i})();(function(){Y(gm,{declarations:[dm,um,cm],imports:[ae,re,Ee,Mi,fm]})})();C();C();function QE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"rulechain.name-required")," "))}function JE(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"rulechain.name-max-length")," "))}var hm=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,u,t,s,_),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.fb=u,this.cd=_}ngOnInit(){this.ruleChainScope=this.entitiesTableConfig.componentsData.ruleChainScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],debugMode:[e?e.debugMode:!1],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({debugMode:e.debugMode}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onRuleChainIdCopied(e){this.store.dispatch(new tt({message:this.translate.instant("rulechain.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}isEdgeRootRuleChain(){return this.entitiesTableConfig&&this.entityValue?this.entitiesTableConfig.componentsData.edge?.rootRuleChainId?.id==this.entityValue.id.id:!1}isAutoAssignToEdgeRuleChain(){return this.entitiesTableConfig&&this.entityValue?!this.entityValue.root&&this.entitiesTableConfig.componentsData?.autoAssignToEdgeRuleChainIds?.includes(this.entityValue.id.id):!1}isNotAutoAssignToEdgeRuleChain(){return this.entitiesTableConfig&&this.entityValue?!this.entityValue.root&&!this.entitiesTableConfig.componentsData?.autoAssignToEdgeRuleChainIds?.includes(this.entityValue.id.id):!1}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(se),g(Xe))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-rulechain"]],features:[G],decls:56,vars:76,consts:[[1,"tb-details-buttons"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","debugMode",1,"flex-1",2,"padding-bottom","16px"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"export")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"setRoot")}),p(11),d(12,"translate"),r(),a(13,"button",1),d(14,"async"),y("click",function(u){return t.onEntityAction(u,"setEdgeTemplateRoot")}),p(15),d(16,"translate"),r(),a(17,"button",1),d(18,"async"),y("click",function(u){return t.onEntityAction(u,"setAutoAssignToEdge")}),p(19),d(20,"translate"),r(),a(21,"button",1),d(22,"async"),y("click",function(u){return t.onEntityAction(u,"unsetAutoAssignToEdge")}),p(23),d(24,"translate"),r(),a(25,"button",1),d(26,"async"),y("click",function(u){return t.onEntityAction(u,"unassignFromEdge")}),p(27),d(28,"translate"),r(),a(29,"button",1),d(30,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(31),d(32,"translate"),r(),a(33,"div",2)(34,"button",3),y("cbOnSuccess",function(u){return t.onRuleChainIdCopied(u)}),f(35,"mat-icon",4),a(36,"span",5),p(37,"rulechain.copyId"),r()()()(),a(38,"div",6)(39,"form",7)(40,"fieldset",8),d(41,"async"),a(42,"mat-form-field",9)(43,"mat-label",5),p(44,"rulechain.name"),r(),f(45,"input",10),b(46,QE,3,3,"mat-error",11)(47,JE,3,3,"mat-error",11),r(),a(48,"mat-checkbox",12),p(49),d(50,"translate"),r(),a(51,"div",13)(52,"mat-form-field",9)(53,"mat-label",5),p(54,"rulechain.description"),r(),f(55,"textarea",14),r()()()()()),n&2&&(o(),L("!hidden",t.isEdit),l("disabled",c(2,40,t.isLoading$)),o(2),h(" ",c(4,42,"rulechain.open-rulechain")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(6,44,t.isLoading$)),o(2),h(" ",c(8,46,"rulechain.export")," "),o(2),L("!hidden",t.isEdit||!(!(t.entity!=null&&t.entity.root)&&t.ruleChainScope==="tenant"||!t.isEdgeRootRuleChain()&&t.ruleChainScope==="edge")),l("disabled",c(10,48,t.isLoading$)),o(2),h(" ",c(12,50,"rulechain.set-root")," "),o(2),L("!hidden",t.isEdit||(t.entity==null?null:t.entity.root)||t.ruleChainScope!=="edges"),l("disabled",c(14,52,t.isLoading$)),o(2),h(" ",c(16,54,"rulechain.set-edge-template-root-rulechain")," "),o(2),L("!hidden",t.isEdit||!t.isNotAutoAssignToEdgeRuleChain()||t.ruleChainScope!=="edges"),l("disabled",c(18,56,t.isLoading$)),o(2),h(" ",c(20,58,"rulechain.set-auto-assign-to-edge")," "),o(2),L("!hidden",t.isEdit||!t.isAutoAssignToEdgeRuleChain()||t.ruleChainScope!=="edges"),l("disabled",c(22,60,t.isLoading$)),o(2),h(" ",c(24,62,"rulechain.unset-auto-assign-to-edge")," "),o(2),L("!hidden",t.isEdit||t.isEdgeRootRuleChain()||t.ruleChainScope!=="edges"),l("disabled",c(26,64,t.isLoading$)),o(2),h(" ",c(28,66,"edge.unassign-from-edge")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit||t.ruleChainScope==="edge"),l("disabled",c(30,68,t.isLoading$)),o(2),h(" ",c(32,70,"rulechain.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),l("formGroup",t.entityForm),o(),l("disabled",c(41,72,t.isLoading$)||!t.isEdit),o(6),l("ngIf",t.entityForm.get("name").hasError("required")),o(),l("ngIf",t.entityForm.get("name").hasError("maxlength")),o(2),h(" ",c(50,74,"rulechain.debug-mode")," "))},dependencies:[V,K,$t,ee,ge,me,Ie,De,ii,fe,ue,W,z,ce,X,oe,ft,H,le,k],styles:['@charset "UTF-8";']})}}return i})();C();C();C();var KE=i=>[i];function YE(i,m){if(i&1&&(a(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function XE(i,m){if(i&1&&(a(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function ZE(i,m){if(i&1&&(a(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function ew(i,m){if(i&1&&(a(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),r()),i&2){let e=U(1),n=v();T("label",c(2,6,"rulechain.events")),o(3),l("debugEventTypes",at(8,KE,n.debugEventTypes.DEBUG_RULE_CHAIN))("defaultEventType",n.debugEventTypes.DEBUG_RULE_CHAIN)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function tw(i,m){if(i&1&&(a(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-relation-table",11),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}function iw(i,m){if(i&1&&(a(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",13),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function nw(i,m){if(i&1){let e=O();a(0,"mat-tab",8,6),d(2,"translate"),a(3,"tb-version-control",14),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var bm=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-rulechain-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"debugEventTypes","defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,YE,4,7,"mat-tab",7)(1,XE,4,7,"mat-tab",7)(2,ZE,4,5,"mat-tab",7)(3,ew,4,10,"mat-tab",7)(4,tw,4,5,"mat-tab",7)(5,iw,4,6,"mat-tab",7)(6,nw,4,7,"mat-tab",7),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[V,Pt,Ci,qi,Wi,Ei,wi,di,k],encapsulation:2})}}return i})();var gr=(()=>{class i{constructor(e,n,t,s,u,_,E,w,q,Te){this.ruleChainService=e,this.dialogService=n,this.dialog=t,this.importExport=s,this.itembuffer=u,this.edgeService=_,this.homeDialogs=E,this.translate=w,this.datePipe=q,this.router=Te,this.config=new Qe,this.config.entityType=B.RULE_CHAIN,this.config.entityComponent=hm,this.config.entityTabsComponent=bm,this.config.entityTranslations=$e.get(B.RULE_CHAIN),this.config.entityResources=_t.get(B.RULE_CHAIN),this.config.rowPointer=!0,this.config.deleteEntityTitle=Le=>this.translate.instant("rulechain.delete-rulechain-title",{ruleChainName:Le.name}),this.config.deleteEntityContent=()=>this.translate.instant("rulechain.delete-rulechain-text"),this.config.deleteEntitiesTitle=Le=>this.translate.instant("rulechain.delete-rulechains-title",{count:Le}),this.config.deleteEntitiesContent=()=>this.translate.instant("rulechain.delete-rulechains-text"),this.config.loadEntity=Le=>this.ruleChainService.getRuleChain(Le.id),this.config.saveEntity=Le=>this.saveRuleChain(Le),this.config.deleteEntity=Le=>this.ruleChainService.deleteRuleChain(Le.id),this.config.onEntityAction=Le=>this.onRuleChainAction(Le),this.config.handleRowClick=(Le,gt)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(Le,gt):this.openRuleChain(Le,gt),!0)}resolve(e){let n=e.params?.edgeId,t=e.data?.ruleChainsType?e.data?.ruleChainsType:"tenant";return this.config.componentsData={ruleChainScope:t,edgeId:n},this.config.columns=this.configureEntityTableColumns(t),this.config.entitiesFetchFunction=this.configureEntityFunctions(t,n),this.config.groupActionDescriptors=this.configureGroupActions(t),this.config.addActionDescriptors=this.configureAddActions(t),this.config.cellActionDescriptors=this.configureCellActions(t),t==="tenant"||t==="edges"?(this.config.entitySelectionEnabled=s=>s&&!s.root,this.config.deleteEnabled=s=>s&&!s.root,this.config.entitiesDeleteEnabled=!0,this.config.tableTitle=this.configureTableTitle(t,null)):t==="edge"&&(this.config.entitySelectionEnabled=s=>this.config.componentsData.edge.rootRuleChainId.id!==s.id.id,this.edgeService.getEdge(n).subscribe(s=>{this.config.componentsData.edge=s,this.config.tableTitle=this.configureTableTitle(t,s)}),this.config.entitiesDeleteEnabled=!1),this.config}configureEntityTableColumns(e){let n=[];return n.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","rulechain.name","50%"),new te("description","rulechain.description","50%",t=>t.additionalInfo?.description??"")),e==="tenant"||e==="edge"?n.push(new te("root","rulechain.root","60px",t=>e==="edge"?Ot(this.config.componentsData.edge.rootRuleChainId.id===t.id.id):Ot(t.root))):e==="edges"&&n.push(new te("root","rulechain.edge-template-root","100px",t=>Ot(t.root)),new te("assignToEdge","rulechain.assign-to-edge","100px",t=>Ot(this.isAutoAssignToEdgeRuleChain(t)),()=>({}),!1)),n}configureAddActions(e){let n=[];return(e==="tenant"||e==="edges")&&n.push({name:this.translate.instant("rulechain.create-new-rulechain"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("rulechain.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importRuleChain(t)}),e==="edge"&&n.push({name:this.translate.instant("rulechain.assign-to-edge"),icon:"add",isEnabled:()=>!0,onAction:t=>this.assignRuleChainsToEdge(t)}),n}configureEntityFunctions(e,n){if(e==="tenant")return t=>this.fetchRuleChains(t);if(e==="edges")return t=>this.fetchEdgeRuleChains(t);if(e==="edge")return t=>this.ruleChainService.getEdgeRuleChains(n,t)}configureTableTitle(e,n){if(e==="tenant")return this.translate.instant("rulechain.rulechains");if(e==="edges")return this.translate.instant("edge.rulechain-templates");if(e==="edge")return this.config.tableTitle=n.name+": "+this.translate.instant("rulechain.rulechains")}configureGroupActions(e){let n=[];return e==="edge"&&n.push({name:this.translate.instant("rulechain.unassign-rulechains"),icon:"assignment_return",isEnabled:!0,onAction:(t,s)=>this.unassignRuleChainsFromEdge(t,s)}),n}configureCellActions(e){let n=[];return n.push({name:this.translate.instant("rulechain.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,s)=>this.exportRuleChain(t,s)}),e==="tenant"&&n.push({name:this.translate.instant("rulechain.set-root"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,s)=>this.setRootRuleChain(t,s)}),e==="edges"&&n.push({name:this.translate.instant("rulechain.set-edge-template-root-rulechain"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,s)=>this.setEdgeTemplateRootRuleChain(t,s)},{name:this.translate.instant("rulechain.set-auto-assign-to-edge"),icon:"bookmark_outline",isEnabled:t=>this.isNotAutoAssignToEdgeRuleChain(t),onAction:(t,s)=>this.setAutoAssignToEdgeRuleChain(t,s)},{name:this.translate.instant("rulechain.unset-auto-assign-to-edge"),icon:"bookmark",isEnabled:t=>this.isAutoAssignToEdgeRuleChain(t),onAction:(t,s)=>this.unsetAutoAssignToEdgeRuleChain(t,s)}),e==="edge"&&n.push({name:this.translate.instant("rulechain.set-root"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,s)=>this.setRootRuleChain(t,s)},{name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>t.id.id!==this.config.componentsData.edge.rootRuleChainId.id,onAction:(t,s)=>this.unassignFromEdge(t,s)}),n.push({name:this.translate.instant("rulechain.rulechain-details"),icon:"edit",isEnabled:()=>!0,onAction:(t,s)=>this.config.toggleEntityDetails(t,s)}),n}importRuleChain(e){e&&e.stopPropagation();let n=this.config.componentsData.ruleChainScope==="tenant"?mi.CORE:mi.EDGE;this.importExport.importRuleChain(n).subscribe(t=>{t&&(this.itembuffer.storeRuleChainImport(t),this.config.componentsData.ruleChainScope==="edges"?this.router.navigateByUrl("edgeManagement/ruleChains/ruleChain/import"):this.router.navigateByUrl("ruleChains/ruleChain/import"))})}openRuleChain(e,n){e&&e.stopPropagation(),this.config.componentsData.ruleChainScope==="edges"?this.router.navigateByUrl(`edgeManagement/ruleChains/${n.id.id}`):this.config.componentsData.ruleChainScope==="edge"?this.router.navigateByUrl(`edgeInstances/${this.config.componentsData.edgeId}/ruleChains/${n.id.id}`):this.router.navigateByUrl(`ruleChains/${n.id.id}`)}saveRuleChain(e){return du(e.type)&&(this.config.componentsData.ruleChainScope==="tenant"?e.type=mi.CORE:this.config.componentsData.ruleChainScope==="edges"?e.type=mi.EDGE:e.type=mi.CORE),this.ruleChainService.saveRuleChain(e)}exportRuleChain(e,n){e&&e.stopPropagation(),this.importExport.exportRuleChain(n.id.id)}setRootRuleChain(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-root-rulechain-title",{ruleChainName:n.name}),this.translate.instant("rulechain.set-root-rulechain-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&(this.config.componentsData.ruleChainScope==="edge"?this.ruleChainService.setEdgeRootRuleChain(this.config.componentsData.edgeId,n.id.id).subscribe(s=>{this.config.componentsData.edge=s,this.config.updateData()}):this.ruleChainService.setRootRuleChain(n.id.id).subscribe(()=>{this.config.updateData()}))})}onRuleChainAction(e){switch(e.action){case"open":return this.openRuleChain(e.event,e.entity),!0;case"export":return this.exportRuleChain(e.event,e.entity),!0;case"setRoot":return this.setRootRuleChain(e.event,e.entity),!0;case"setEdgeTemplateRoot":return this.setEdgeTemplateRootRuleChain(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0;case"setAutoAssignToEdge":return this.setAutoAssignToEdgeRuleChain(e.event,e.entity),!0;case"unsetAutoAssignToEdge":return this.unsetAutoAssignToEdgeRuleChain(e.event,e.entity),!0}return!1}setEdgeTemplateRootRuleChain(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-edge-template-root-rulechain-title",{ruleChainName:n.name}),this.translate.instant("rulechain.set-edge-template-root-rulechain-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.setEdgeTemplateRootRuleChain(n.id.id).subscribe(()=>{this.config.updateData()})})}checkMissingToRelatedRuleChains(){this.edgeService.findMissingToRelatedRuleChains(this.config.componentsData.edgeId).subscribe(e=>{if(e&&Object.keys(e).length>0){let n=new Array;for(let s of Object.keys(e)){let u=e[s],_="- '"+s+"': '"+u.join("', ")+"'";n.push(_)}let t=this.translate.instant("edge.missing-related-rule-chains-text",{missingRuleChains:n.join("<br>")});this.dialogService.alert(this.translate.instant("edge.missing-related-rule-chains-title"),t,this.translate.instant("action.close"),!0).subscribe(()=>{this.config.updateData()})}else this.config.updateData()})}assignRuleChainsToEdge(e){e&&e.stopPropagation(),this.dialog.open(wo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:B.RULE_CHAIN}}).afterClosed().subscribe(n=>{n&&this.checkMissingToRelatedRuleChains()})}unassignFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unassign-rulechain-title",{ruleChainName:n.name}),this.translate.instant("rulechain.unassign-rulechain-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.unassignRuleChainFromEdge(this.config.componentsData.edgeId,n.id.id).subscribe(()=>{this.checkMissingToRelatedRuleChains()})})}unassignRuleChainsFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unassign-rulechains-from-edge-title",{count:n.length}),this.translate.instant("rulechain.unassign-rulechains-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let s=[];n.forEach(u=>{s.push(this.ruleChainService.unassignRuleChainFromEdge(this.config.componentsData.edgeId,u.id.id))}),Gt(s).subscribe(()=>{this.checkMissingToRelatedRuleChains()})}})}setAutoAssignToEdgeRuleChain(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-auto-assign-to-edge-title",{ruleChainName:n.name}),this.translate.instant("rulechain.set-auto-assign-to-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.setAutoAssignToEdgeRuleChain(n.id.id).subscribe(()=>{this.config.updateData()})})}unsetAutoAssignToEdgeRuleChain(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unset-auto-assign-to-edge-title",{ruleChainName:n.name}),this.translate.instant("rulechain.unset-auto-assign-to-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.unsetAutoAssignToEdgeRuleChain(n.id.id).subscribe(()=>{this.config.updateData()})})}isNonRootRuleChain(e){return this.config.componentsData.ruleChainScope==="edge"?this.config.componentsData.edge.rootRuleChainId&&this.config.componentsData.edge.rootRuleChainId.id!==e.id.id:!e.root}isAutoAssignToEdgeRuleChain(e){return!e.root&&this.config.componentsData.autoAssignToEdgeRuleChainIds.includes(e.id.id)}isNotAutoAssignToEdgeRuleChain(e){return!e.root&&!this.config.componentsData.autoAssignToEdgeRuleChainIds.includes(e.id.id)}fetchRuleChains(e){return this.ruleChainService.getRuleChains(e,mi.CORE)}fetchEdgeRuleChains(e){return this.ruleChainService.getAutoAssignToEdgeRuleChains().pipe(yt(n=>(this.config.componentsData.autoAssignToEdgeRuleChainIds=[],n.map(t=>this.config.componentsData.autoAssignToEdgeRuleChainIds.push(t.id.id)),this.ruleChainService.getRuleChains(e,mi.EDGE))))}static{this.\u0275fac=function(n){return new(n||i)(N(ln),N(Lt),N(je),N(Gi),N(Ja),N(an),N(Ui),N(ie),N(Ge),N(de))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();C();var aw=["definedConfigContent"],rw=["jsonObjectEditComponent"];function sw(i,m){if(i&1&&(a(0,"div",5),p(1),r()),i&2){let e=v();o(),R(e.definedDirectiveError)}}function lw(i,m){if(i&1&&(f(0,"tb-json-object-edit",6,1),d(2,"translate")),i&2){let e=v();l("label",c(2,3,"rulenode.configuration"))("jsonRequired",e.required)("fillHeight",!0)}}var ym=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}set nodeDefinition(e){this.nodeDefinitionValue!==e&&(this.nodeDefinitionValue=e,this.nodeDefinitionValue&&this.validateDefinedDirective(),setTimeout(()=>this.initRuleNode.emit()))}get nodeDefinition(){return this.nodeDefinitionValue}constructor(e,n){this.ruleChainService=e,this.fb=n,this.initRuleNode=new rt,this.changeScript=new rt,this.propagateChange=t=>{},this.ruleNodeConfigFormGroup=this.fb.group({configuration:[null,S.required]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnDestroy(){this.definedConfigComponentRef&&this.definedConfigComponentRef.destroy(),this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.changeScriptSubscription&&(this.changeScriptSubscription.unsubscribe(),this.changeScriptSubscription=null)}setDisabledState(e){this.disabled=e,this.disabled?this.ruleNodeConfigFormGroup.disable({emitEvent:!1}):this.ruleNodeConfigFormGroup.enable({emitEvent:!1}),this.definedConfigComponent&&(this.definedConfigComponent.disabled=this.disabled)}writeValue(e){this.configuration=Ue(e),this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.definedConfigComponent?(this.definedConfigComponent.configuration=this.configuration,this.changeSubscription=this.definedConfigComponent.configurationChanged.subscribe(n=>{this.updateModel(n)})):(this.ruleNodeConfigFormGroup.get("configuration").patchValue(this.configuration,{emitEvent:!1}),this.changeSubscription=this.ruleNodeConfigFormGroup.get("configuration").valueChanges.subscribe(n=>{this.updateModel(n)}))}useDefinedDirective(){return this.nodeDefinition&&this.nodeDefinition.configDirective&&this.nodeDefinition.configDirective.length&&!this.definedDirectiveError}updateModel(e){this.definedConfigComponent||this.ruleNodeConfigFormGroup.valid?this.propagateChange(e):this.propagateChange(this.required?null:e)}validateDefinedDirective(){if(this.definedConfigComponentRef&&(this.definedConfigComponentRef.destroy(),this.definedConfigComponentRef=null),this.nodeDefinition.uiResourceLoadError&&this.nodeDefinition.uiResourceLoadError.length)this.definedDirectiveError=this.nodeDefinition.uiResourceLoadError;else if(this.nodeDefinition.configDirective&&this.nodeDefinition.configDirective.length){this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.definedConfigContainer.clear();let e=this.ruleChainService.getRuleNodeConfigComponent(this.nodeDefinition.configDirective);this.definedConfigComponentRef=this.definedConfigContainer.createComponent(e),this.definedConfigComponent=this.definedConfigComponentRef.instance,this.definedConfigComponent.ruleNodeId=this.ruleNodeId,this.definedConfigComponent.ruleChainId=this.ruleChainId,this.definedConfigComponent.ruleChainType=this.ruleChainType,this.definedConfigComponent.configuration=this.configuration,this.changeSubscription=this.definedConfigComponent.configurationChanged.subscribe(n=>{this.updateModel(n)}),this.definedConfigComponent?.changeScript&&(this.changeScriptSubscription=this.definedConfigComponent.changeScript.subscribe(()=>this.changeScript.emit()))}}validate(){this.useDefinedDirective()&&this.definedConfigComponent.validate()}static{this.\u0275fac=function(n){return new(n||i)(g(ln),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-rule-node-config"]],viewQuery:function(n,t){if(n&1&&(be(aw,7,ki),be(rw,5)),n&2){let s;ve(s=ye())&&(t.definedConfigContainer=s.first),ve(s=ye())&&(t.jsonObjectEditComponent=s.first)}},inputs:{required:"required",disabled:"disabled",ruleNodeId:"ruleNodeId",ruleChainId:"ruleChainId",ruleChainType:"ruleChainType",nodeDefinition:"nodeDefinition"},outputs:{initRuleNode:"initRuleNode",changeScript:"changeScript"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:5,vars:3,consts:[["definedConfigContent",""],["jsonObjectEditComponent",""],[3,"formGroup"],["class","tb-rulenode-directive-error",4,"ngIf"],["class","tb-rule-node-configuration-json","formControlName","configuration",3,"label","jsonRequired","fillHeight",4,"ngIf"],[1,"tb-rulenode-directive-error"],["formControlName","configuration",1,"tb-rule-node-configuration-json",3,"label","jsonRequired","fillHeight"]],template:function(n,t){n&1&&(a(0,"div",2),At(1,null,0),b(3,sw,2,1,"div",3)(4,lw,3,5,"tb-json-object-edit",4),r()),n&2&&(l("formGroup",t.ruleNodeConfigFormGroup),o(3),l("ngIf",t.definedDirectiveError),o(),l("ngIf",!t.useDefinedDirective()))},dependencies:[V,X0,W,z,X,oe,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   tb-json-object-edit.tb-rule-node-configuration-json[_ngcontent-%COMP%]{display:block;height:300px}[_nghost-%COMP%]   .tb-rulenode-directive-error[_ngcontent-%COMP%]{font-size:13px;font-weight:400;color:#dd2c00}']})}}return i})();var mw=["ruleNodeConfigComponent"];function dw(i,m){if(i&1){let e=O();a(0,"div",17)(1,"button",18),y("click",function(t){x(e);let s=v();return I(s.openRuleChain(t))}),p(2),d(3,"translate"),r()()}i&2&&(o(2),h(" ",c(3,1,"rulechain.open-rulechain")," "))}function cw(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"rulenode.name-required")," "))}function uw(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"rulenode.name-max-length")," "))}function fw(i,m){i&1&&(a(0,"mat-slide-toggle",19),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"rulenode.singleton-mode")," "))}function gw(i,m){if(i&1&&f(0,"tb-queue-autocomplete",20),i&2){let e=v();l("queueType",e.serviceType)("autocompleteHint",e.isSingleton()?"rulenode.queue-singleton-hint":"rulenode.queue-hint")}}var po=class i extends It{constructor(m,e,n){super(m),this.store=m,this.fb=e,this.router=n,this.disabled=!1,this.isAdd=!1,this.initRuleNode=new rt,this.changeScript=new rt,this.ruleNodeType=_i,this.entityType=B,this.serviceType=zs.TB_RULE_ENGINE,this.destroy$=new Ft,this.ruleNodeFormGroup=this.fb.group({})}buildForm(){this.ruleNode?(this.ruleNodeFormGroup=this.fb.group({name:[this.ruleNode.name,[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*"),S.maxLength(255)]],debugMode:[this.ruleNode.debugMode,[]],singletonMode:[this.ruleNode.singletonMode,[]],configuration:[this.ruleNode.configuration,[S.required]],additionalInfo:this.fb.group({description:[this.ruleNode.additionalInfo?this.ruleNode.additionalInfo.description:""]})}),this.isAddQueue()&&(this.ruleNodeFormGroup.addControl("queueName",this.fb.control(this.ruleNode?.queueName?this.ruleNode.queueName:null)),this.isSingleton()&&(this.isSingletonEditAllowed()||this.ruleNodeFormGroup.get("singletonMode").disable({emitEvent:!1}),this.ruleNodeFormGroup.get("singletonMode").value||this.ruleNodeFormGroup.get("queueName").disable({emitEvent:!1}),this.ruleNodeFormGroup.get("singletonMode").valueChanges.pipe(dt(this.destroy$)).subscribe(m=>{m?this.ruleNodeFormGroup.get("queueName").enable({emitEvent:!1}):this.ruleNodeFormGroup.get("queueName").disable({emitEvent:!1})}))),this.ruleNodeFormGroup.valueChanges.pipe(dt(this.destroy$)).subscribe(()=>this.updateRuleNode())):this.ruleNodeFormGroup=this.fb.group({}),this.disabled&&this.ruleNodeFormGroup.disable({emitEvent:!1})}updateRuleNode(){let m=this.ruleNodeFormGroup.value||{};m.name=m.name.trim(),Object.assign(this.ruleNode,m)}ngOnInit(){this.disabled&&this.ruleNodeFormGroup.disable({emitEvent:!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnChanges(m){for(let e of Object.keys(m)){let n=m[e];n.currentValue!==n.previousValue&&e==="ruleNode"&&this.buildForm()}}validate(){this.ruleNodeConfigComponent.validate()}openRuleChain(m){m&&m.stopPropagation();let e=this.ruleNodeFormGroup.get("configuration")?.value?.ruleChainId;e&&(this.ruleChainType===mi.EDGE?this.router.navigateByUrl(`/edgeManagement/ruleChains/${e}`):this.router.navigateByUrl(`/ruleChains/${e}`))}isAddQueue(){return this.isSingleton()||this.ruleNode.component.hasQueueName}isSingleton(){return this.ruleNode.component.clusteringMode===Ra.SINGLETON||this.ruleNode.component.clusteringMode===Ra.USER_PREFERENCE}isSingletonEditAllowed(){return this.ruleNode.component.clusteringMode===Ra.USER_PREFERENCE}static{this.\u0275fac=function(e){return new(e||i)(g(P),g(se),g(de))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-rule-node"]],viewQuery:function(e,n){if(e&1&&be(mw,5),e&2){let t;ve(t=ye())&&(n.ruleNodeConfigComponent=t.first)}},inputs:{ruleNode:"ruleNode",ruleChainId:"ruleChainId",ruleChainType:"ruleChainType",disabled:"disabled",isAdd:"isAdd"},outputs:{initRuleNode:"initRuleNode",changeScript:"changeScript"},features:[G,Fn],decls:23,vars:13,consts:[["ruleNodeConfigComponent",""],["class","tb-details-buttons",4,"ngIf"],[1,"mat-padding",3,"formGroup"],[1,"title-row"],[1,"mat-block","flex-1"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],[1,"node-setting"],["formControlName","debugMode"],["formControlName","singletonMode",4,"ngIf"],["formControlName","configuration",3,"initRuleNode","changeScript","ruleNodeId","ruleChainId","ruleChainType","nodeDefinition"],[1,"description-block"],["subscriptSizing","dynamic","formControlName","queueName",3,"queueType","autocompleteHint",4,"ngIf"],["formGroupName","additionalInfo"],[1,"mat-block"],["matInput","","formControlName","description","rows","1"],[1,"tb-details-buttons"],["mat-raised-button","","color","primary",3,"click"],["formControlName","singletonMode"],["subscriptSizing","dynamic","formControlName","queueName",3,"queueType","autocompleteHint"]],template:function(e,n){if(e&1){let t=O();b(0,dw,4,3,"div",1),a(1,"form",2)(2,"section",3)(3,"mat-form-field",4)(4,"mat-label",5),p(5,"rulenode.name"),r(),f(6,"input",6),b(7,cw,3,3,"mat-error",7)(8,uw,3,3,"mat-error",7),r(),a(9,"section",8)(10,"mat-slide-toggle",9),p(11),d(12,"translate"),r(),b(13,fw,3,3,"mat-slide-toggle",10),r()(),a(14,"tb-rule-node-config",11,0),y("initRuleNode",function(u){return x(t),I(n.initRuleNode.emit(u))})("changeScript",function(u){return x(t),I(n.changeScript.emit(u))}),r(),a(16,"div",12),b(17,gw,1,2,"tb-queue-autocomplete",13),a(18,"div",14)(19,"mat-form-field",15)(20,"mat-label",5),p(21,"rulenode.rule-node-description"),r(),f(22,"textarea",16),r()()()()}e&2&&(l("ngIf",!n.isAdd&&(n.ruleNode.component==null||n.ruleNode.component.configurationDescriptor==null||n.ruleNode.component.configurationDescriptor.nodeDefinition==null?null:n.ruleNode.component.configurationDescriptor.nodeDefinition.ruleChainNode)),o(),l("formGroup",n.ruleNodeFormGroup),o(6),l("ngIf",n.ruleNodeFormGroup.get("name").hasError("required")||n.ruleNodeFormGroup.get("name").hasError("pattern")),o(),l("ngIf",n.ruleNodeFormGroup.get("name").hasError("maxlength")),o(3),h(" ",c(12,11,"rulenode.debug-mode")," "),o(2),l("ngIf",n.isSingleton()),o(),l("ruleNodeId",n.ruleNode.ruleNodeId==null?null:n.ruleNode.ruleNodeId.id)("ruleChainId",n.ruleChainId)("ruleChainType",n.ruleChainType)("nodeDefinition",n.ruleNode.component.configurationDescriptor.nodeDefinition),o(3),l("ngIf",n.isAddQueue()))},dependencies:[V,mf,K,ge,me,Ie,De,it,fe,ue,W,z,ce,X,oe,ft,H,ym,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   form[_ngcontent-%COMP%]{overflow-x:hidden!important}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]   .node-setting[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-bottom:22px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]{flex-direction:row;gap:8px;align-items:center}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]   .node-setting[_ngcontent-%COMP%]{margin-top:5px}}[_nghost-%COMP%]   .description-block[_ngcontent-%COMP%]{margin-top:22px}']})}};Kn([io(),Yn("design:type",Object)],po.prototype,"disabled",void 0);Kn([io(),Yn("design:type",Object)],po.prototype,"isAdd",void 0);C();C();var bw=["chipList"],vw=["labelAutocomplete"],yw=["labelInput"],_w=i=>({label:i});function Cw(i,m){i&1&&(a(0,"mat-icon",13),p(1,"close"),r())}function Sw(i,m){if(i&1){let e=O();a(0,"mat-chip-row",11),y("removed",function(){let t=x(e).$implicit,s=v();return I(s.remove(t))}),p(1),b(2,Cw,2,0,"mat-icon",12),r()}if(i&2){let e=m.$implicit,n=v();l("removable",!n.disabled),o(),h(" ",e.name," "),o(),l("ngIf",!n.disabled)}}function Tw(i,m){if(i&1&&(a(0,"mat-option",14),f(1,"span",15),d(2,"highlight"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),l("innerHTML",Nt(2,2,e.name,n.searchText),sn)}}function xw(i,m){i&1&&(a(0,"div")(1,"span",5),p(2,"rulenode.no-link-labels-found"),r()())}function Iw(i,m){if(i&1&&(a(0,"span"),p(1),d(2,"async"),r()),i&2){let e=v(2);o(),h(" ",c(2,1,e.translate.get("rulenode.no-link-label-matching",at(3,_w,e.truncate.transform(e.searchText,!0,6,"..."))))," ")}}function Ew(i,m){if(i&1){let e=O();a(0,"span")(1,"a",20),y("click",function(t){x(e);let s=v(2);return I(s.createLinkLabel(t,s.searchText))}),p(2,"rulenode.create-new-link-label"),r()()}}function ww(i,m){if(i&1){let e=O();a(0,"mat-option",16)(1,"div",17),y("click",function(t){return x(e),I(t.stopPropagation())}),b(2,xw,3,0,"div",18)(3,Iw,3,5,"ng-template",null,3,xt)(5,Ew,3,0,"span",19),r()()}if(i&2){let e=U(4),n=v();l("value",null),o(2),l("ngIf",!n.textIsNotEmpty(n.searchText))("ngIfElse",e),o(3),l("ngIf",n.allowCustom)}}var _m=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}get allowCustom(){return this.allowCustomValue}set allowCustom(e){this.allowCustomValue=Vt(e),this.separatorKeysCodes=this.allowCustomValue?[13,188,186]:[]}constructor(e,n,t,s){this.fb=e,this.truncate=n,this.translate=t,this.ruleChainService=s,this.labelsList=[],this.separatorKeysCodes=[],this.labels=[],this.searchText="",this.propagateChange=u=>{},this.linksFormGroup=this.fb.group({label:[null]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.filteredLabels=this.linksFormGroup.get("label").valueChanges.pipe(Xn(""),mt(e=>e||""),yt(e=>this.fetchLabels(e)),Jr())}ngOnChanges(e){let n=!1;for(let t of Object.keys(e)){let s=e[t];s.currentValue!==s.previousValue&&["allowCustom","allowedLabels","sourceRuleChainId"].includes(t)&&(n=!0)}n&&this.linksFormGroup.get("label").patchValue("",{emitEvent:!0})}setDisabledState(e){this.disabled=e,this.disabled?this.linksFormGroup.disable({emitEvent:!1}):this.linksFormGroup.enable({emitEvent:!1})}writeValue(e){this.searchText="",this.labelsList.length=0,this.labels.length=0,this.modelValue=e,this.prepareLabelsList().subscribe(n=>{this.labelsList=n,e&&e.forEach(t=>{this.allowedLabels[t]?this.labels.push(Ue(this.allowedLabels[t])):this.labels.push({name:t,value:t})}),this.chipList&&this.required&&(this.chipList.errorState=!this.labels.length),this.linksFormGroup.get("label").patchValue("",{emitEvent:!0})})}prepareLabelsList(){let e=[];if(this.sourceRuleChainId)return this.ruleChainService.getRuleChainOutputLabels(this.sourceRuleChainId,{ignoreErrors:!0}).pipe(mt(n=>{for(let t of n)e.push({name:t,value:t});return e}),cn(()=>ot(e)));for(let n of Object.keys(this.allowedLabels))e.push({name:this.allowedLabels[n].name,value:this.allowedLabels[n].value});return ot(e)}displayLabelFn(e){return e?e.name:void 0}textIsNotEmpty(e){return e&&e.length>0}createLinkLabel(e,n){e.preventDefault(),this.transformLinkLabel(n)}add(e){(!this.matAutocomplete.isOpen||this.allowCustom)&&this.transformLinkLabel(e.value)}fetchLabels(e){if(this.searchText=e,this.searchText&&this.searchText.length){let n=this.searchText.toUpperCase();return ot(this.labelsList.filter(t=>t.name.toUpperCase().includes(n)))}else return ot(this.labelsList)}transformLinkLabel(e){if((e||"").trim()){let n=null,t=e.trim(),s=this.labelsList.find(u=>u.name===t);s?n=Ue(s):this.allowCustom&&(n={name:t,value:t}),n&&this.addLabel(n)}this.clear("")}remove(e){let n=this.labels.indexOf(e);n>=0&&(this.labels.splice(n,1),this.labels.length||this.required&&(this.chipList.errorState=!0),this.updateModel())}selected(e){this.addLabel(e.option.value),this.clear("")}addLabel(e){this.labels.findIndex(t=>t.value===e.value)===-1&&(this.labels.push(e),this.required&&(this.chipList.errorState=!1),this.updateModel())}onFocus(){this.linksFormGroup.get("label").updateValueAndValidity({onlySelf:!0,emitEvent:!0})}clear(e=""){this.labelInput.nativeElement.value=e,this.linksFormGroup.get("label").patchValue(null,{emitEvent:!0}),setTimeout(()=>{this.labelInput.nativeElement.blur(),this.labelInput.nativeElement.focus()},0)}updateModel(){let e=this.labels.map(n=>n.value);this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(Ga),g(ie),g(ln))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-link-labels"]],viewQuery:function(n,t){if(n&1&&(be(bw,5),be(vw,5),be(yw,5)),n&2){let s;ve(s=ye())&&(t.chipList=s.first),ve(s=ye())&&(t.matAutocomplete=s.first),ve(s=ye())&&(t.labelInput=s.first)}},inputs:{required:"required",disabled:"disabled",allowCustom:"allowCustom",allowedLabels:"allowedLabels",sourceRuleChainId:"sourceRuleChainId"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}]),Fn],decls:16,vars:16,consts:[["chipList",""],["labelInput","","origin","matAutocompleteOrigin"],["labelAutocomplete","matAutocomplete"],["searchNotEmpty",""],[2,"width","100%",3,"formGroup"],["translate",""],[3,"removable","removed",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","label","matAutocompleteOrigin","",2,"max-width","200px",3,"focusin","matChipInputTokenEnd","placeholder","matAutocompleteConnectedTo","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes"],[1,"tb-autocomplete",3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["class","tb-not-found",3,"value",4,"ngIf"],[3,"removed","removable"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"],[3,"innerHTML"],[1,"tb-not-found",3,"value"],[1,"tb-not-found-content",3,"click"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["translate","",3,"click"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-form-field",4)(1,"mat-label",5),p(2,"rulenode.link-labels"),r(),a(3,"mat-chip-grid",null,0),b(5,Sw,3,3,"mat-chip-row",6),a(6,"input",7,1),d(9,"translate"),y("focusin",function(){return x(s),I(t.onFocus())})("matChipInputTokenEnd",function(_){return x(s),I(t.add(_))}),r()(),a(10,"mat-autocomplete",8,2),y("optionSelected",function(_){return x(s),I(t.selected(_))}),b(12,Tw,3,5,"mat-option",9),d(13,"async"),b(14,ww,6,4,"mat-option",10),d(15,"async"),r()()}if(n&2){let s,u=U(4),_=U(8),E=U(11);l("formGroup",t.linksFormGroup),o(5),l("ngForOf",t.labels),o(),T("placeholder",t.disabled?"":c(9,10,"rulenode.link-label")),l("matAutocompleteConnectedTo",_)("matAutocomplete",E)("matChipInputFor",u)("matChipInputSeparatorKeyCodes",t.separatorKeysCodes),o(4),l("displayWith",t.displayLabelFn),o(2),l("ngForOf",c(13,12,t.filteredLabels)),o(2),l("ngIf",((s=c(15,14,t.filteredLabels))==null?null:s.length)===0)}},dependencies:[we,V,ee,ge,me,Ie,ct,fs,gs,Qu,_s,Cs,bs,vs,ue,W,z,X,oe,H,le,Ds,k],encapsulation:2})}}return i})();var Ur=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=Vt(e)}get allowCustom(){return this.allowCustomValue}set allowCustom(e){this.allowCustomValue=Vt(e)}constructor(e,n,t){this.fb=e,this.truncate=n,this.translate=t,this.propagateChange=s=>{},this.ruleNodeLinkFormGroup=this.fb.group({labels:[[],S.required]}),this.ruleNodeLinkFormGroup.get("labels").valueChanges.subscribe(s=>this.updateModel(s))}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){}setDisabledState(e){this.disabled=e,this.disabled?this.ruleNodeLinkFormGroup.disable({emitEvent:!1}):this.ruleNodeLinkFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e;let n=this.modelValue&&this.modelValue.labels?this.modelValue.labels:[];this.ruleNodeLinkFormGroup.get("labels").patchValue(n,{emitEvent:!1})}updateModel(e){e&&e.length?(this.modelValue.labels=e,this.modelValue.label=e.join(" / "),this.propagateChange(this.modelValue)):this.propagateChange(this.required?null:this.modelValue)}static{this.\u0275fac=function(n){return new(n||i)(g(se),g(Ga),g(ie))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-rule-node-link"]],inputs:{required:"required",disabled:"disabled",allowCustom:"allowCustom",allowedLabels:"allowedLabels",sourceRuleChainId:"sourceRuleChainId"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:3,vars:4,consts:[[1,"mat-padding","flex","flex-col"],[3,"formGroup"],["required","","formControlName","labels",3,"allowedLabels","allowCustom","sourceRuleChainId"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"form",1),f(2,"tb-link-labels",2),r()()),n&2&&(o(),l("formGroup",t.ruleNodeLinkFormGroup),o(),l("allowedLabels",t.allowedLabels)("allowCustom",t.allowCustom)("sourceRuleChainId",t.sourceRuleChainId))},dependencies:[fe,W,z,ce,X,oe,_m],encapsulation:2})}}return i})();var Fw=["ruleChainCanvas"],Aw=["ruleChainMenuTrigger"],Nw=["drawer"],Nh=["tbRuleNode"],kw=["tbRuleNodeLink"],Rw=["ruleNodeTypeExpansionPanels"],Ow=i=>[i];function Bw(i,m){if(i&1){let e=O();a(0,"tb-rule-chain-select",38),pt("ngModelChange",function(t){x(e);let s=v();return lt(s.ruleChain,t)||(s.ruleChain=t),I(t)}),y("ngModelChange",function(){x(e);let t=v();return I(t.currentRuleChainIdChanged(t.ruleChain.id==null?null:t.ruleChain.id.id))}),r()}if(i&2){let e=v();l("ruleChainType",e.ruleChainType)("disabled",e.isDirtyValue),st("ngModel",e.ruleChain)}}function Vw(i,m){if(i&1){let e=O();a(0,"mat-expansion-panel",39,5)(2,"mat-expansion-panel-header",40),y("mouseenter",function(t){let s=x(e).$implicit,u=v();return I(u.typeHeaderMouseEnter(t,s))})("mouseleave",function(){x(e);let t=v();return I(t.destroyTooltips())}),a(3,"mat-panel-title")(4,"mat-icon"),p(5),r(),a(6,"div",41),p(7),r()()(),f(8,"fc-canvas",42),r()}if(i&2){let e=m.$implicit,n=v();l("expanded",!0),o(5),R(n.ruleNodeTypeDescriptorsMap.get(e).icon),o(2),R(n.ruleNodeTypeDescriptorsMap.get(e).name),o(),Zn("id","tb-rulchain-",e,""),l("model",n.ruleNodeTypesModel[e].model)("selectedObjects",n.ruleNodeTypesModel[e].selectedObjects)("automaticResize",!1)("userCallbacks",n.nodeLibCallbacks)("nodeWidth",170)("nodeHeight",50)("dropTargetId","tb-rulchain-canvas")}}function Lw(i,m){if(i&1){let e=O();a(0,"mat-tab",47,7),d(2,"translate"),a(3,"tb-event-table",55),y("debugEventSelected",function(t){x(e);let s=v(2);return I(s.onDebugEventSelected(t))}),r()()}if(i&2){let e=U(1),n=v(2);T("label",c(2,7,"rulenode.events")),o(3),l("debugEventTypes",at(9,Ow,n.debugEventTypes.DEBUG_RULE_NODE))("defaultEventType",n.debugEventTypes.DEBUG_RULE_NODE)("active",e.isActive)("tenantId",n.ruleChain.tenantId.id)("entityId",n.editingRuleNode.ruleNodeId)("functionTestButtonLabel",n.ruleNodeTestButtonLabel)}}function jw(i,m){if(i&1){let e=O();a(0,"tb-details-panel",43),d(1,"translate"),y("closeDetails",function(){x(e);let t=v();return I(t.onEditRuleNodeClosed())})("toggleDetailsEditMode",function(){x(e);let t=v();return I(t.onRevertRuleNodeEdit())})("applyDetails",function(){x(e);let t=v();return I(t.saveRuleNode())}),a(2,"div",44),f(3,"div",45),r(),a(4,"mat-tab-group",46),pt("selectedIndexChange",function(t){x(e);let s=v();return lt(s.selectedRuleNodeTabIndex,t)||(s.selectedRuleNodeTabIndex=t),I(t)}),a(5,"mat-tab",47),d(6,"translate"),a(7,"tb-rule-node",48,6),y("initRuleNode",function(){x(e);let t=v();return I(t.onRuleNodeInit())})("changeScript",function(){x(e);let t=v();return I(t.switchToFirstTab())}),r()(),b(9,Lw,4,11,"mat-tab",49),a(10,"mat-tab",47),d(11,"translate"),a(12,"div",50)(13,"div",51)(14,"div",52),p(15),r(),a(16,"div"),p(17,"\xA0"),r(),f(18,"div",53),d(19,"safe"),a(20,"div"),p(21,"\xA0"),r(),f(22,"div",54),d(23,"safe"),r()()()()()}if(i&2){let e=U(8),n=v();T("headerTitle",n.editingRuleNode.name),T("headerSubtitle",c(1,16,n.ruleNodeTypeDescriptorsMap.get(n.editingRuleNode.component.type).name)+" - "+n.editingRuleNode.component.name),l("isReadOnly",n.selectedRuleNodeTabIndex>0)("isAlwaysEdit",!0)("theForm",e.ruleNodeFormGroup),o(3),l("tb-help",n.helpLinkIdForRuleNodeType()),o(),st("selectedIndex",n.selectedRuleNodeTabIndex),o(),T("label",c(6,18,"rulenode.details")),o(2),l("ruleNode",n.editingRuleNode)("ruleChainId",n.ruleChain.id==null?null:n.ruleChain.id.id)("ruleChainType",n.ruleChainType),o(2),l("ngIf",n.editingRuleNode.ruleNodeId),o(),T("label",c(11,20,"rulenode.help")),o(5),R(n.editingRuleNode.component.name),o(3),l("innerHtml",Nt(19,22,n.editingRuleNode.component.configurationDescriptor.nodeDefinition.description,"html"),sn),o(4),l("innerHtml",Nt(23,25,n.editingRuleNode.component.configurationDescriptor.nodeDefinition.details,"html"),sn)}}function Gw(i,m){if(i&1){let e=O();a(0,"tb-details-panel",43),d(1,"translate"),y("closeDetails",function(){x(e);let t=v();return I(t.onEditRuleNodeLinkClosed())})("toggleDetailsEditMode",function(){x(e);let t=v();return I(t.onRevertRuleNodeLinkEdit())})("applyDetails",function(){x(e);let t=v();return I(t.saveRuleNodeLink())}),a(2,"div",44),f(3,"div",45),r(),a(4,"tb-rule-node-link",56,8),pt("ngModelChange",function(t){x(e);let s=v();return lt(s.editingRuleNodeLink,t)||(s.editingRuleNodeLink=t),I(t)}),r()()}if(i&2){let e=U(5),n=v();T("headerTitle",n.editingRuleNodeLink.label),T("headerSubtitle",c(1,10,"rulenode.link-details")),l("isReadOnly",!1)("isAlwaysEdit",!0)("theForm",e.ruleNodeLinkFormGroup),o(3),l("tb-help","ruleEngine"),o(),st("ngModel",n.editingRuleNodeLink),l("allowedLabels",n.editingRuleNodeLinkLabels)("allowCustom",n.editingRuleNodeAllowCustomLabels)("sourceRuleChainId",n.editingRuleNodeSourceRuleChainId)}}function Uw(i,m){if(i&1){let e=O();a(0,"button",57,9),d(2,"translate"),y("click",function(t){x(e);let s=U(1),u=v();return I(u.toggleVersionControl(t,s))}),a(3,"mat-icon"),p(4,"history"),r()()}i&2&&T("matTooltip",c(2,1,"version-control.version-control"))}function qw(i,m){if(i&1&&(a(0,"mat-icon"),p(1),r()),i&2){let e=v().contextInfo;o(),R(e.icon)}}function Ww(i,m){if(i&1&&f(0,"img",65),i&2){let e=v().contextInfo;l("src",e.iconUrl,Nn)}}function Hw(i,m){i&1&&f(0,"mat-divider")}function zw(i,m){if(i&1&&(a(0,"span",70),p(1),d(2,"keyboardShortcut"),r()),i&2){let e=v(2).$implicit;o(),h(" ",c(2,1,e.shortcut),"")}}function $w(i,m){if(i&1&&(a(0,"mat-icon"),p(1),r()),i&2){let e=v(2).$implicit;o(),R(e.icon)}}function Qw(i,m){if(i&1){let e=O();a(0,"button",67),y("click",function(){x(e);let t=v().$implicit,s=v(2);return I(t.action(s.contextMenuEvent))}),b(1,zw,3,3,"span",68)(2,$w,2,1,"mat-icon",59),a(3,"span",69),p(4),r()()}if(i&2){let e=v().$implicit;l("disabled",!e.enabled),o(),l("ngIf",e.shortcut),o(),l("ngIf",e.icon),o(2),R(e.value)}}function Jw(i,m){if(i&1&&(a(0,"div"),b(1,Hw,1,0,"mat-divider",59)(2,Qw,5,4,"button",66),r()),i&2){let e=m.$implicit;o(),l("ngIf",e.divider),o(),l("ngIf",!e.divider)}}function Kw(i,m){if(i&1){let e=O();a(0,"div",58),y("mouseleave",function(){x(e);let t=v();return I(t.onRuleChainContextMenuMouseLeave())}),a(1,"div"),b(2,qw,2,1,"mat-icon",59)(3,Ww,1,1,"img",60),a(4,"div",61)(5,"div",62),p(6),r(),a(7,"div",63),p(8),r()()(),b(9,Jw,3,2,"div",64),r()}if(i&2){let e=m.contextInfo;o(),Zr("tb-context-menu-header ",e.headerClass,""),o(),l("ngIf",!e.iconUrl),o(),l("ngIf",e.iconUrl),o(3),R(e.title),o(2),R(e.subtitle),o(),l("ngForOf",e.menuItems)}}function Yw(i,m){i&1&&f(0,"mat-progress-bar",14)}function Xw(i,m){i&1&&f(0,"mat-progress-bar",14)}function Zw(i,m){i&1&&f(0,"mat-progress-bar",19)}function eM(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"rulechain.name-required")," "))}function tM(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"rulechain.name-max-length")," "))}var mo=(()=>{class i extends It{get isDirty(){return this.isDirtyValue||this.isImport}set isDirty(e){this.isDirtyValue=e}constructor(e,n,t,s,u,_,E,w,q,Te,Le,gt,ui,co){super(e),this.store=e,this.route=n,this.router=t,this.ruleChainService=s,this.authService=u,this.translate=_,this.itembuffer=E,this.popoverService=w,this.renderer=q,this.viewContainerRef=Te,this.changeDetector=Le,this.dialog=gt,this.dialogService=ui,this.fb=co,this.width="100%",this.height="100%",this.eventTypes=Zf,this.debugEventTypes=eg,this.ruleChainMenuPosition={x:"0px",y:"0px"},this.ruleNodeTypeDescriptorsMap=Cn,this.ruleNodeTypesLibraryArray=Sr,this.isInvalid=!1,this.errorTooltips={},this.isFullscreen=!1,this.selectedRuleNodeTabIndex=0,this.editingRuleNode=null,this.isEditingRuleNode=!1,this.editingRuleNodeIndex=-1,this.editingRuleNodeAllowCustomLabels=!1,this.editingRuleNodeLink=null,this.isEditingRuleNodeLink=!1,this.editingRuleNodeLinkIndex=-1,this.hotKeys=[],this.enableHotKeys=!0,this.ruleNodeSearch="",this.ruleNodeTypeSearch=this.fb.control("",{nonNullable:!0}),this.ruleChainModel={nodes:[],edges:[]},this.selectedObjects=[],this.editCallbacks={edgeDoubleClick:(Qn,Ne)=>{this.openLinkDetails(Ne)},edgeEdit:(Qn,Ne)=>{this.openLinkDetails(Ne)},nodeCallbacks:{doubleClick:(Qn,Ne)=>{this.openNodeDetails(Ne)},nodeEdit:(Qn,Ne)=>{this.openNodeDetails(Ne)},mouseEnter:this.displayNodeDescriptionTooltip.bind(this),mouseLeave:this.destroyTooltips.bind(this),mouseDown:this.destroyTooltips.bind(this)},isValidEdge:(Qn,Ne)=>Qn.type===li.rightConnectorType&&Ne.type===li.leftConnectorType,createEdge:(Qn,Ne)=>{let si=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(Ne.source);if(si.component.type===_i.INPUT){let zi=this.ruleChainModel.edges.find(Pi=>Pi.source===this.inputConnectorId+"");return zi&&this.ruleChainCanvas.modelService.edges.delete(zi),ot(Ne)}else{if(Ne.label)return Ne.labels||(Ne.labels=Ne.label.split(" / ")),ot(Ne);{let zi=this.ruleChainService.getRuleNodeSupportedLinks(si.component),Pi=this.ruleChainService.ruleNodeAllowCustomLinks(si.component),dn=this.ruleChainService.ruleNodeSourceRuleChainId(si.component,si.configuration);return this.enableHotKeys=!1,this.addRuleNodeLink(Ne,zi,Pi,dn).pipe(wt(()=>{this.enableHotKeys=!0}),yt(Dn=>Dn?ot(Dn):Zc))}}},dropNode:(Qn,Ne)=>{this.addRuleNode(Ne)}},this.ruleNodeTypesModel={},this.nodeLibCallbacks={nodeCallbacks:{mouseEnter:this.displayLibNodeDescriptionTooltip.bind(this),mouseLeave:this.destroyTooltips.bind(this),mouseDown:this.destroyTooltips.bind(this)}},this.flowchartConstants=li,this.updateBreadcrumbs=new rt,this.destroy$=new Ft,this.route.data.pipe(dt(this.destroy$)).subscribe(()=>{this.reset(),this.init()})}ngOnInit(){this.ruleNodeTypeSearch.valueChanges.pipe(Qr(150),Xn(""),ra((e,n)=>e.trim()===n.trim()),tu(1),dt(this.destroy$)).subscribe(()=>this.updateRuleChainLibrary())}ngAfterViewChecked(){this.changeDetector.detectChanges()}ngAfterViewInit(){this.ruleChainCanvas.adjustCanvasSize(!0)}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}currentRuleChainIdChanged(e){this.ruleChainType===mi.CORE?this.router.navigateByUrl(`ruleChains/${e}`):this.router.navigateByUrl(`edgeManagement/ruleChains/${e}`)}onSearchTextUpdated(e){this.ruleNodeSearch=e,this.updateRuleNodesHighlight()}init(){if(this.initHotKeys(),this.isImport=this.route.snapshot.data.import,this.ruleChainType=this.route.snapshot.data.ruleChainType,this.isImport){let e=this.itembuffer.getRuleChainImport();this.ruleChain=e.ruleChain,this.ruleChainMetaData=e.metadata}else this.ruleChain=this.route.snapshot.data.ruleChain,this.ruleChainMetaData=this.route.snapshot.data.ruleChainMetaData;this.ruleNodeComponents=this.route.snapshot.data.ruleNodeComponents;for(let e of Sr)Cn.get(e).special||(this.ruleNodeTypesModel[e]={model:{nodes:[],edges:[]},selectedObjects:[]});this.updateRuleChainLibrary(),this.createRuleChainModel()}reset(){this.selectedObjects=[],this.ruleChainModel.nodes=[],this.ruleChainModel.edges=[],this.ruleNodeTypesModel={},this.ruleChainCanvas&&this.ruleChainCanvas.adjustCanvasSize(!0),this.isEditingRuleNode=!1,this.isEditingRuleNodeLink=!1,this.updateRuleNodesHighlight()}initHotKeys(){this.hotKeys.length||(this.hotKeys.push(new Ki("ctrl+a",e=>this.enableHotKeys?(e.preventDefault(),this.ruleChainCanvas.modelService.selectAll(),!1):!0,[],this.translate.instant("rulenode.select-all-objects"))),this.hotKeys.push(new Ki("ctrl+c",e=>this.enableHotKeys?(e.preventDefault(),this.copyRuleNodes(),!1):!0,[],this.translate.instant("rulenode.copy-selected"))),this.hotKeys.push(new Ki("ctrl+v",e=>this.enableHotKeys?(e.preventDefault(),this.itembuffer.hasRuleNodes()&&this.pasteRuleNodes(),!1):!0,[],this.translate.instant("action.paste"))),this.hotKeys.push(new Ki("esc",e=>this.enableHotKeys?(e.preventDefault(),e.stopPropagation(),this.ruleChainCanvas.modelService.deselectAll(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("rulenode.deselect-all-objects"))),this.hotKeys.push(new Ki("ctrl+s",e=>this.enableHotKeys?(e.preventDefault(),this.saveRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("action.apply"))),this.hotKeys.push(new Ki("ctrl+z",e=>this.enableHotKeys?(e.preventDefault(),this.revertRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("action.decline-changes"))),this.hotKeys.push(new Ki("del",e=>this.enableHotKeys?(e.preventDefault(),this.ruleChainCanvas.modelService.deleteSelected(),!1):!0,[],this.translate.instant("rulenode.delete-selected-objects"))),this.hotKeys.push(new Ki("ctrl+r",e=>this.enableHotKeys&&this.canCreateNestedRuleChain()?(e.preventDefault(),this.createNestedRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("rulenode.create-nested-rulechain"))))}updateRuleChainLibrary(){let e=this.ruleNodeTypeSearch.value.trim().toUpperCase(),n=this.ruleNodeComponents.filter(t=>t.name.toUpperCase().includes(e));this.loadRuleChainLibrary(n)}loadRuleChainLibrary(e){for(let n of Object.keys(this.ruleNodeTypesModel))this.ruleNodeTypesModel[n].model.nodes.length=0;if(e.forEach(n=>{let t=n.type,s=this.ruleNodeTypesModel[t].model,u=Cn.get(_i[t]),_=u.icon,E=null;n.configurationDescriptor.nodeDefinition.icon&&(_=n.configurationDescriptor.nodeDefinition.icon),n.configurationDescriptor.nodeDefinition.iconUrl&&(E=n.configurationDescriptor.nodeDefinition.iconUrl);let w={id:"node-lib-"+t+"-"+s.nodes.length,component:n,name:"",nodeClass:u.nodeClass,singletonMode:n.clusteringMode!==Ra.ENABLED,icon:_,iconUrl:E,x:30,y:10+50*s.nodes.length,connectors:[]};n.configurationDescriptor.nodeDefinition.inEnabled&&w.connectors.push({type:li.leftConnectorType,id:s.nodes.length*2+""}),n.configurationDescriptor.nodeDefinition.outEnabled&&w.connectors.push({type:li.rightConnectorType,id:s.nodes.length*2+1+""}),s.nodes.push(w)}),this.expansionPanels)for(let n=0;n<Sr.length;n++){let t=this.expansionPanels.find((s,u)=>u===n);if(t){let s=Sr[n];this.ruleNodeTypesModel[s].model.nodes.length?t.open():t.close()}}}createRuleChainModel(){this.nextNodeID=1,this.nextConnectorID=1,this.selectedObjects=[],this.ruleChainModel.nodes=[],this.ruleChainModel.edges=[],this.inputConnectorId=this.nextConnectorID++,this.ruleChainModel.nodes.push({id:"rule-chain-node-"+this.nextNodeID++,component:D0,name:"",nodeClass:Cn.get(_i.INPUT).nodeClass,icon:Cn.get(_i.INPUT).icon,readonly:!0,x:50,y:150,connectors:[{type:li.rightConnectorType,id:this.inputConnectorId+""}]});let e=[];if(this.ruleChainMetaData.nodes.forEach(n=>{let t=this.ruleChainService.getRuleNodeComponentByClazz(this.ruleChainType,n.type),s=Cn.get(t.type),u=s.icon,_=null;t.configurationDescriptor.nodeDefinition.icon&&(u=t.configurationDescriptor.nodeDefinition.icon),t.configurationDescriptor.nodeDefinition.iconUrl&&(_=t.configurationDescriptor.nodeDefinition.iconUrl);let E={id:"rule-chain-node-"+this.nextNodeID++,ruleNodeId:n.id,additionalInfo:n.additionalInfo,configuration:n.configuration,configurationVersion:Re(n.configurationVersion)?n.configurationVersion:0,debugMode:n.debugMode,singletonMode:n.singletonMode,queueName:n.queueName,x:Math.round(n.additionalInfo.layoutX),y:Math.round(n.additionalInfo.layoutY),component:t,name:n.name,nodeClass:s.nodeClass,icon:u,iconUrl:_,connectors:[],ruleChainType:this.ruleChainType};t.configurationDescriptor.nodeDefinition.inEnabled&&E.connectors.push({type:li.leftConnectorType,id:this.nextConnectorID+++""}),t.configurationDescriptor.nodeDefinition.outEnabled&&E.connectors.push({type:li.rightConnectorType,id:this.nextConnectorID+++""}),e.push(E),this.ruleChainModel.nodes.push(E)}),this.ruleChainMetaData.firstNodeIndex>-1){let n=e[this.ruleChainMetaData.firstNodeIndex];if(n){let t=n.connectors.filter(s=>s.type===li.leftConnectorType);if(t&&t.length){let s={source:this.inputConnectorId+"",destination:t[0].id};this.ruleChainModel.edges.push(s)}}}if(this.ruleChainMetaData.connections){let n={};this.ruleChainMetaData.connections.forEach(t=>{let s=e[t.fromIndex],u=e[t.toIndex];if(s&&u){let _=s.connectors.filter(w=>w.type===li.rightConnectorType),E=u.connectors.filter(w=>w.type===li.leftConnectorType);if(_&&_.length&&E&&E.length){let w=_[0].id,q=E[0].id,Te=w+"_"+q,Le=n[Te];Le?(Le.label+=" / "+t.type,Le.labels.push(t.type)):(Le={source:w,destination:q,label:t.type,labels:[t.type]},n[Te]=Le,this.ruleChainModel.edges.push(Le))}}})}this.ruleChainCanvas&&this.ruleChainCanvas.adjustCanvasSize(!0),this.isDirtyValue=!1,this.updateRuleNodesHighlight(),this.validate()}openRuleChainContextMenu(e){if(this.ruleChainCanvas.modelService&&!e.ctrlKey&&!e.metaKey){let n=e.clientX,t=e.clientY,s=this.ruleChainCanvas.modelService.getItemInfoAtPoint(n,t),u=this.prepareContextMenu(s);u.menuItems&&u.menuItems.length>0&&(e.preventDefault(),e.stopPropagation(),this.contextMenuEvent=e,this.ruleChainMenuPosition.x=n+"px",this.ruleChainMenuPosition.y=t+"px",this.ruleChainMenuTrigger.menuData={contextInfo:u},this.ruleChainMenuTrigger.openMenu())}}onRuleChainContextMenuMouseLeave(){this.ruleChainMenuTrigger.closeMenu()}prepareContextMenu(e){if(this.objectsSelected()||!e.node&&!e.edge)return this.prepareRuleChainContextMenu();if(e.node)return this.prepareRuleNodeContextMenu(e.node);if(e.edge)return this.prepareEdgeContextMenu(e.edge)}prepareRuleChainContextMenu(){let e={headerClass:"tb-rulechain-header",icon:"settings_ethernet",title:this.ruleChain.name,subtitle:this.translate.instant("rulechain.rulechain"),menuItems:[]};return this.ruleChainCanvas.modelService.nodes.getSelectedNodes().length&&e.menuItems.push({action:()=>{this.copyRuleNodes()},enabled:!0,value:"rulenode.copy-selected",icon:"content_copy",shortcut:"M-C"}),e.menuItems.push({action:n=>{this.pasteRuleNodes(n)},enabled:this.itembuffer.hasRuleNodes(),value:"action.paste",icon:"content_paste",shortcut:"M-V"}),e.menuItems.push({divider:!0}),this.objectsSelected()?(e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.deselectAll()},enabled:!0,value:"rulenode.deselect-all",icon:"tab_unselected",shortcut:"Esc"}),this.canCreateNestedRuleChain()&&e.menuItems.push({action:()=>{this.createNestedRuleChain()},enabled:!0,value:"rulenode.create-nested-rulechain",icon:"settings_ethernet",shortcut:"M-R"}),e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.deleteSelected()},enabled:!0,value:"rulenode.delete-selected",icon:"clear",shortcut:"Del"})):e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.selectAll()},enabled:!0,value:"rulenode.select-all",icon:"select_all",shortcut:"M-A"}),e.menuItems.push({divider:!0}),e.menuItems.push({action:()=>{this.saveRuleChain()},enabled:!(this.isInvalid||!this.isDirty&&!this.isImport),value:"action.apply-changes",icon:"done",shortcut:"M-S"}),e.menuItems.push({action:()=>{this.revertRuleChain()},enabled:this.isDirty,value:"action.decline-changes",icon:"close",shortcut:"M-Z"}),e}prepareRuleNodeContextMenu(e){let n={headerClass:e.nodeClass,icon:e.icon,iconUrl:e.iconUrl,title:e.name,subtitle:e.component.name,menuItems:[]};return e.readonly||(n.menuItems.push({action:()=>{this.openNodeDetails(e)},enabled:!0,value:"rulenode.details",icon:"menu"}),n.menuItems.push({action:()=>{this.copyNode(e)},enabled:!0,value:"action.copy",icon:"content_copy"}),n.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.nodes.delete(e)},enabled:!0,value:"action.delete",icon:"clear",shortcut:"M-X"})),n}prepareEdgeContextMenu(e){let n={headerClass:"tb-link-header",icon:"trending_flat",title:e.label,subtitle:this.translate.instant("rulenode.link"),menuItems:[]};return this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(e.source).component.type!==_i.INPUT&&n.menuItems.push({action:()=>{this.openLinkDetails(e)},enabled:!0,value:"rulenode.details",icon:"menu"}),n.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.edges.delete(e)},enabled:!0,value:"action.delete",icon:"clear",shortcut:"M-X"}),n}canCreateNestedRuleChain(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),n=this.ruleChainCanvas.modelService.edges.getSelectedEdges();if(e.length>1){let t=new Set;return n.forEach(u=>{let _=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(u.source),E=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(u.destination),w=e.indexOf(_),q=e.indexOf(E);w>-1&&q>-1&&t.add(q)}),e.filter((u,_)=>!t.has(_)).filter(u=>u.component.configurationDescriptor.nodeDefinition.inEnabled).length<=1}return!1}createNestedRuleChain(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),n=this.ruleChainCanvas.modelService.edges.getSelectedEdges();this.dialog.open(Bc,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{ruleChainType:this.ruleChainType}}).afterClosed().subscribe(t=>{if(t){this.ruleChainCanvas.modelService.deselectAll();let s={ruleChainId:t.id,nodes:[],connections:[]},u=[],_=null,E=0,w=null,q=0;e.forEach(Ne=>{let si={type:Ne.component.clazz,name:Ne.name,configuration:Ue(Ne.configuration),additionalInfo:Ne.additionalInfo?Ue(Ne.additionalInfo):{},debugMode:Ne.debugMode,singletonMode:Ne.singletonMode,queueName:Ne.queueName};_===null?_=Ne.x:_=Math.min(_,Ne.x),w===null?w=Ne.y:w=Math.min(w,Ne.y),E=Math.max(E,Ne.x),q=Math.max(q,Ne.y),si.additionalInfo.layoutX=Math.round(Ne.x),si.additionalInfo.layoutY=Math.round(Ne.y),s.nodes.push(si),this.ruleChainCanvas.modelService.nodes.getConnectorsByType(Ne,li.rightConnectorType).forEach(Pi=>{let Dn=this.ruleChainCanvas.modelService.model.edges.filter(Pn=>Pn.source===Pi.id).filter(Pn=>{let Jn=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(Pn.destination);return e.indexOf(Jn)===-1});u=u.concat(Dn)})});let Te=new Set;n.forEach(Ne=>{let si=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(Ne.source),zi=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(Ne.destination);if(si.component.type!==_i.INPUT){let Pi=e.indexOf(si),dn=e.indexOf(zi);if(Pi>-1&&dn>-1){let Dn={fromIndex:Pi,toIndex:dn};Ne.labels.forEach(Pn=>{let Jn=Ue(Dn);Jn.type=Pn,s.connections.push(Jn)}),Te.add(dn)}}});let gt=e.filter((Ne,si)=>!Te.has(si)).filter(Ne=>Ne.component.configurationDescriptor.nodeDefinition.inEnabled),ui=[];if(gt.length){let Ne=gt[0],si=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(Ne,li.leftConnectorType);if(si.length){let zi=si[0],Pi=this.ruleChainCanvas.modelService.model.edges.filter(dn=>dn.destination===zi.id);ui=ui.concat(Pi)}s.firstNodeIndex=e.indexOf(Ne)}u.forEach(Ne=>{let si=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(Ne.source),zi=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(Ne.destination),Pi={type:M0,name:Ne.label,configuration:{},additionalInfo:{},debugMode:!1,singletonMode:!1};Pi.additionalInfo.layoutX=Math.round(zi.x),Pi.additionalInfo.layoutY=Math.round(zi.y),s.nodes.push(Pi);let dn=e.indexOf(si),Dn=s.nodes.length-1,Pn={fromIndex:dn,toIndex:Dn};Ne.labels.forEach(Jn=>{let $r=Ue(Pn);$r.type=Jn,s.connections.push($r)})});let co=Math.round(_-375),Qn=Math.round(w-150);s.nodes.forEach(Ne=>{Ne.additionalInfo.layoutX-=co,Ne.additionalInfo.layoutY-=Qn}),this.ruleChainService.saveRuleChainMetadata(s).subscribe(()=>{let Ne=this.ruleChainService.getRuleNodeComponentByClazz(this.ruleChainType,w0),si=Cn.get(Ne.type),zi=si.icon,Pi=null;Ne.configurationDescriptor.nodeDefinition.icon&&(zi=Ne.configurationDescriptor.nodeDefinition.icon),Ne.configurationDescriptor.nodeDefinition.iconUrl&&(Pi=Ne.configurationDescriptor.nodeDefinition.iconUrl);let dn=(_+E)/2,Dn=(w+q)/2,Pn=this.nextConnectorID+++"",Jn=this.nextConnectorID+++"",$r={name:t.name,component:Ne,id:"rule-chain-node-"+this.nextNodeID++,configuration:{ruleChainId:t.id.id},debugMode:!1,singletonMode:!1,x:Math.round(dn),y:Math.round(Dn),nodeClass:si.nodeClass,icon:zi,iconUrl:Pi,ruleChainType:this.ruleChainType,connectors:[{type:li.leftConnectorType,id:Pn},{type:li.rightConnectorType,id:Jn}]};this.ruleChainModel.nodes.push($r),ui.forEach(Ro=>{Ro.destination=Pn}),u.forEach(Ro=>{Ro.source=Jn,Ro.labels=[Ro.label]}),e.forEach(Ro=>{this.ruleChainCanvas.modelService.nodes.delete(Ro)}),this.onModelChanged(),this.updateRuleNodesHighlight()})}})}onModelChanged(){this.isDirtyValue=!0,this.validate()}helpLinkIdForRuleNodeType(){let e=null;return this.editingRuleNode&&(e=this.editingRuleNode.component),Wd(e)}openNodeDetails(e){e.component.type!==_i.INPUT&&(this.enableHotKeys=!1,this.updateErrorTooltips(!0),this.isEditingRuleNodeLink=!1,this.editingRuleNodeLink=null,this.isEditingRuleNode=!0,this.editingRuleNodeIndex=this.ruleChainModel.nodes.indexOf(e),this.editingRuleNode=Ue(e,["component"]),setTimeout(()=>{this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine()},0))}openLinkDetails(e){let n=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(e.source);n.component.type!==_i.INPUT&&(this.enableHotKeys=!1,this.updateErrorTooltips(!0),this.isEditingRuleNode=!1,this.editingRuleNode=null,this.editingRuleNodeLinkLabels=this.ruleChainService.getRuleNodeSupportedLinks(n.component),this.editingRuleNodeAllowCustomLabels=this.ruleChainService.ruleNodeAllowCustomLinks(n.component),this.editingRuleNodeSourceRuleChainId=this.ruleChainService.ruleNodeSourceRuleChainId(n.component,n.configuration),this.isEditingRuleNodeLink=!0,this.editingRuleNodeLinkIndex=this.ruleChainModel.edges.indexOf(e),this.editingRuleNodeLink=Ue(e),setTimeout(()=>{this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine()},0))}copyNode(e){this.itembuffer.copyRuleNodes([e],[])}copyRuleNodes(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),n=this.ruleChainCanvas.modelService.edges.getSelectedEdges(),t=[];n.forEach(s=>{let u=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(s.source),_=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(s.destination),E=u.component.type===_i.INPUT,w=e.indexOf(u),q=e.indexOf(_);if((E||w>-1)&&q>-1){let Te={isInputSource:E,fromIndex:w,toIndex:q,label:s.label,labels:s.labels};t.push(Te)}}),this.itembuffer.copyRuleNodes(e,t)}pasteRuleNodes(e){let n=$(this.ruleChainCanvas.modelService.canvasHtmlElement),t,s;if(e){let _=n.offset();t=Math.round(e.clientX-_.left),s=Math.round(e.clientY-_.top)}else{let _=n.parent(),E=_.scrollTop();t=_.scrollLeft()+_.width()/2,s=E+_.height()/2}let u=this.itembuffer.pasteRuleNodes(t,s);if(u){this.ruleChainCanvas.modelService.deselectAll();let _=[];u.nodes.forEach(E=>{E.id="rule-chain-node-"+this.nextNodeID++;let w=E.component;w.configurationDescriptor.nodeDefinition.inEnabled&&E.connectors.push({type:li.leftConnectorType,id:this.nextConnectorID+++""}),w.configurationDescriptor.nodeDefinition.outEnabled&&E.connectors.push({type:li.rightConnectorType,id:this.nextConnectorID+++""}),_.push(E),this.ruleChainModel.nodes.push(E),this.ruleChainCanvas.modelService.nodes.select(E)}),u.connections.forEach(E=>{let w=_[E.fromIndex],q=_[E.toIndex];if((E.isInputSource||w)&&q){let Te,Le;if(E.isInputSource){Te=this.inputConnectorId+"";let ui=this.ruleChainModel.edges.find(co=>co.source===this.inputConnectorId+"");ui&&this.ruleChainCanvas.modelService.edges.delete(ui)}else{let ui=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(w,li.rightConnectorType);ui&&ui.length&&(Te=ui[0].id)}let gt=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(q,li.leftConnectorType);if(gt&&gt.length&&(Le=gt[0].id),Te&&Le){let ui={source:Te,destination:Le,label:E.label,labels:E.labels};this.ruleChainModel.edges.push(ui),this.ruleChainCanvas.modelService.edges.select(ui)}}}),this.updateRuleNodesHighlight(),this.validate(),this.onModelChanged()}}onDetailsDrawerClosed(){this.onEditRuleNodeClosed(),this.onEditRuleNodeLinkClosed(),this.enableHotKeys=!0,this.updateErrorTooltips(!1)}onEditRuleNodeClosed(){this.editingRuleNode=null,this.isEditingRuleNode=!1}onEditRuleNodeLinkClosed(){this.editingRuleNodeLink=null,this.isEditingRuleNodeLink=!1}onRevertRuleNodeEdit(){this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine();let e=this.ruleChainModel.nodes[this.editingRuleNodeIndex];this.editingRuleNode=Ue(e,["component"])}onRevertRuleNodeLinkEdit(){this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine();let e=this.ruleChainModel.edges[this.editingRuleNodeLinkIndex];this.editingRuleNodeLink=Ue(e)}onDebugEventSelected(e){let n=this.ruleNodeComponent.ruleNodeConfigComponent,t=n.definedConfigComponent;n.useDefinedDirective()&&t.hasScript&&t.testScript&&t.testScript(e)}onRuleNodeInit(){let e=this.ruleNodeComponent.ruleNodeConfigComponent.definedConfigComponent;this.ruleNodeComponent.ruleNodeConfigComponent.useDefinedDirective()&&e.hasScript?this.ruleNodeTestButtonLabel=e.testScriptLabel:this.ruleNodeTestButtonLabel=""}switchToFirstTab(){this.selectedRuleNodeTabIndex=0}saveRuleNode(){this.ruleNodeComponent.validate(),this.ruleNodeComponent.ruleNodeFormGroup.valid&&(this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine(),this.editingRuleNode.error&&delete this.editingRuleNode.error,this.ruleChainModel.nodes[this.editingRuleNodeIndex]=this.editingRuleNode,this.editingRuleNode=Ue(this.editingRuleNode,["component"]),this.onModelChanged(),this.updateRuleNodesHighlight())}saveRuleNodeLink(){this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine(),this.ruleChainModel.edges[this.editingRuleNodeLinkIndex]=this.editingRuleNodeLink,this.editingRuleNodeLink=Ue(this.editingRuleNodeLink),this.onModelChanged()}typeHeaderMouseEnter(e,n){let t=Cn.get(n);this.displayTooltip(e,'<div class="tb-rule-node-tooltip tb-lib-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+this.translate.instant(t.name)+'</div><div class="tb-node-details">'+this.translate.instant(t.details)+"</div></div></div>")}displayLibNodeDescriptionTooltip(e,n){this.displayTooltip(e,'<div class="tb-rule-node-tooltip tb-lib-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+n.component.name+'</div><div class="tb-node-description">'+n.component.configurationDescriptor.nodeDefinition.description+'</div><div class="tb-node-details">'+n.component.configurationDescriptor.nodeDefinition.details+"</div></div></div>")}displayNodeDescriptionTooltip(e,n){if(!this.errorTooltips[n.id]){let t,s,u;n.component.type===_i.INPUT?(t=this.translate.instant(Cn.get(_i.INPUT).name),s=this.translate.instant(Cn.get(_i.INPUT).details)):(t=n.name,s=this.translate.instant(Cn.get(n.component.type).name)+" - "+n.component.name,n.additionalInfo&&(u=n.additionalInfo.description));let _='<div class="tb-rule-node-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+t+'</div><div class="tb-node-description">'+s+"</div>";u&&(_+='<div class="tb-node-details">'+u+"</div>"),_+="</div></div>",this.displayTooltip(e,_)}}destroyTooltips(){this.tooltipTimeout&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null),$.tooltipster.instances().forEach(n=>{n.isErrorTooltip||n.destroy()})}updateRuleNodesHighlight(){for(let e of this.ruleChainModel.nodes)e.highlighted=!1;if(this.ruleNodeSearch){let e=this.ruleNodeSearch.toUpperCase(),n=this.ruleChainModel.nodes.filter(t=>t.name.toUpperCase().includes(e));if(n)for(let t of n)t.highlighted=!0}this.ruleChainCanvas&&this.ruleChainCanvas.modelService.detectChanges()}objectsSelected(){return this.ruleChainCanvas.modelService.nodes.getSelectedNodes().length>0||this.ruleChainCanvas.modelService.edges.getSelectedEdges().length>0}deleteSelected(){this.ruleChainCanvas.modelService.deleteSelected()}isDebugModeEnabled(){return typeof this.ruleChainModel.nodes.find(n=>n.debugMode)<"u"}resetDebugModeInAllNodes(){let e=!1;this.ruleChainModel.nodes.forEach(n=>{n.component.type!==_i.INPUT&&(e=e||n.debugMode,n.debugMode=!1)}),e&&this.onModelChanged()}validate(){setTimeout(()=>{this.isInvalid=!1,this.ruleChainModel.nodes.forEach(e=>{e.error&&(this.isInvalid=!0),this.updateNodeErrorTooltip(e)})},0)}saveRuleChain(){let e=new Kc,n;return this.isImport?n=this.ruleChainService.saveRuleChain(this.ruleChain):n=ot(this.ruleChain),n.subscribe(t=>{this.ruleChain=t;let s={ruleChainId:this.ruleChain.id,nodes:[],connections:[],version:t.version},u=[];this.ruleChainModel.nodes.forEach(E=>{if(E.component.type!==_i.INPUT){let w={id:E.ruleNodeId,type:E.component.clazz,name:E.name,configurationVersion:Re(E.configurationVersion)?E.configurationVersion:E.component.configurationVersion,configuration:E.configuration,additionalInfo:E.additionalInfo?E.additionalInfo:{},debugMode:E.debugMode,singletonMode:E.singletonMode,queueName:E.queueName};w.additionalInfo.layoutX=Math.round(E.x),w.additionalInfo.layoutY=Math.round(E.y),s.nodes.push(w),u.push(E)}});let _=this.ruleChainModel.edges.find(E=>E.source===this.inputConnectorId+"");if(_){let E=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(_.destination);s.firstNodeIndex=u.indexOf(E)}this.ruleChainModel.edges.forEach(E=>{let w=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(E.source),q=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(E.destination);if(w.component.type!==_i.INPUT){let Te=u.indexOf(w),Le=u.indexOf(q),gt={fromIndex:Te,toIndex:Le};E.labels.forEach(ui=>{let co=Ue(gt);co.type=ui,s.connections.push(co)})}}),this.ruleChainService.saveRuleChainMetadata(s).pipe(cn(E=>E.status===ca.Conflict?this.ruleChainService.getRuleChainMetadata(s.ruleChainId.id):aa(()=>E))).subscribe(E=>{this.ruleChain.version=E.version,this.ruleChainMetaData=E,this.isImport?(this.isDirtyValue=!1,this.isImport=!1,this.ruleChainType!==mi.EDGE?this.router.navigateByUrl(`ruleChains/${this.ruleChain.id.id}`):this.router.navigateByUrl(`edgeManagement/ruleChains/${this.ruleChain.id.id}`)):this.createRuleChainModel(),e.next()})}),e}reloadRuleChain(){this.ruleChainService.getRuleChain(this.ruleChain.id.id).subscribe(e=>{this.ruleChain=e,this.updateBreadcrumbs.emit(),this.ruleChainService.getRuleChainMetadata(this.ruleChain.id.id).subscribe(n=>{this.ruleChainMetaData=n,this.isDirtyValue=!1,this.createRuleChainModel()})})}revertRuleChain(){this.createRuleChainModel()}addRuleNode(e){e.configuration=Ue(e.component.configurationDescriptor.nodeDefinition.defaultConfiguration);let n=this.ruleChain.id?this.ruleChain.id.id:null;this.enableHotKeys=!1;let t=this.ruleChainType;this.dialog.open(Oc,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{ruleNode:e,ruleChainId:n,ruleChainType:t}}).afterClosed().subscribe(s=>{s&&(s.id="rule-chain-node-"+this.nextNodeID++,s.connectors=[],s.component.configurationDescriptor.nodeDefinition.inEnabled&&s.connectors.push({id:this.nextConnectorID+++"",type:li.leftConnectorType}),s.component.configurationDescriptor.nodeDefinition.outEnabled&&s.connectors.push({id:this.nextConnectorID+++"",type:li.rightConnectorType}),this.ruleChainModel.nodes.push(s),this.onModelChanged(),this.updateRuleNodesHighlight()),this.enableHotKeys=!0})}addRuleNodeLink(e,n,t,s){return this.dialog.open(Rc,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{link:e,labels:n,allowCustomLabels:t,sourceRuleChainId:s}}).afterClosed()}toggleVersionControl(e,n){e&&e.stopPropagation();let t=n._elementRef.nativeElement;if(this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let s=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,di,"leftTop",!0,null,{detailsMode:!0,active:!0,singleEntityMode:!0,externalEntityId:this.ruleChain.externalId||this.ruleChain.id,entityId:this.ruleChain.id,entityName:this.ruleChain.name,onBeforeCreateVersion:()=>this.isDirty?this.saveRuleChain():ot(null)},{},{},{},!0);s.tbComponentRef.instance.popoverComponent=s,s.tbComponentRef.instance.versionRestored.subscribe(()=>{this.reloadRuleChain()})}}updateNodeErrorTooltip(e){if(e.error){let n=$("#"+e.id),t=this.errorTooltips[e.id];if(!t||!n.hasClass("tooltipstered")){n.tooltipster({theme:"tooltipster-shadow",delay:0,animationDuration:0,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!1,tap:!1,scroll:!1},side:"top",trackOrigin:!0});let s='<div class="tb-rule-node-error-tooltip"><div id="tooltip-content"><div class="tb-node-details">'+e.error+"</div></div></div>",u=$(s);t=n.tooltipster("instance"),t.isErrorTooltip=!0,t.content(u),this.errorTooltips[e.id]=t}setTimeout(()=>{t.open()},0)}else this.errorTooltips[e.id]&&(this.errorTooltips[e.id].destroy(),delete this.errorTooltips[e.id])}updateErrorTooltips(e){for(let n of Object.keys(this.errorTooltips)){let t=this.errorTooltips[n];e?t.close():t.open()}}displayTooltip(e,n){this.destroyTooltips(),this.tooltipTimeout=setTimeout(()=>{let t=$(e.target);t.tooltipster({theme:"tooltipster-shadow",delay:100,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!0,tap:!0,scroll:!0},side:"right",distance:12,trackOrigin:!0});let s=$(n),u=t.tooltipster("instance");u.content(s),u.open()},500)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(Si),g(de),g(ln),g(gn),g(ie),g(Ja),g(Sn),g(un),g(ki),g(Xe),g(je),g(Lt),g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-rulechain-page"]],viewQuery:function(n,t){if(n&1&&(be(Fw,7),be(Aw,7),be(Nw,5),be(Nh,5),be(kw,5),be(Rw,5,bi)),n&2){let s;ve(s=ye())&&(t.ruleChainCanvas=s.first),ve(s=ye())&&(t.ruleChainMenuTrigger=s.first),ve(s=ye())&&(t.drawer=s.first),ve(s=ye())&&(t.ruleNodeComponent=s.first),ve(s=ye())&&(t.ruleNodeLinkComponent=s.first),ve(s=ye())&&(t.expansionPanels=s)}},hostVars:4,hostBindings:function(n,t){n&2&&Qi("width",t.width)("height",t.height)},features:[G],decls:67,vars:70,consts:[["cheatSheetComponent",""],["drawer",""],["ruleChainMenuTrigger","matMenuTrigger"],["ruleChainMenu","matMenu"],["ruleChainCanvas",""],["ruleNodeTypeExpansionPanels",""],["tbRuleNode",""],["eventsTab","matTab"],["tbRuleNodeLink",""],["versionControlButton",""],["tb-fullscreen","",1,"mat-content","tb-rulechain","flex","flex-1","flex-col",3,"fullscreen","tb-hotkeys","cheatSheet"],[1,"tb-rulechain-container","flex","flex-1","flex-col"],[1,"tb-rulechain-layout","flex","flex-1","flex-row"],[1,"size-full"],["disableClose","true","mode","side","opened","","position","start",1,"tb-rulechain-library","mat-elevation-z4","flex","flex-col"],["color","primary",1,"tb-dark"],["class","flex-1",3,"ruleChainType","disabled","ngModel","ngModelChange",4,"ngIf"],[1,"mat-toolbar-tools"],[1,"tb-appearance-transparent","flex-1"],["mat-icon-button","","matPrefix","","matTooltipPosition","above",1,"tb-small",3,"matTooltip"],["matInput","",3,"formControl","placeholder"],["mat-icon-button","","matSuffix","","matTooltipPosition","above",1,"tb-small",3,"click","matTooltip"],[1,"tb-rulechain-library-panel-group"],["class","mat-elevation-z2",3,"expanded",4,"ngFor","ngForOf"],["mode","over","position","end",1,"tb-details-drawer",3,"closed","opened"],["class","flex-1",3,"headerTitle","headerSubtitle","isReadOnly","isAlwaysEdit","theForm","closeDetails","toggleDetailsEditMode","applyDetails",4,"ngIf"],[1,"tb-rulechain-graph-content"],["color","primary","mat-mini-fab","","matTooltipPosition","above",1,"tb-library-node-btn",3,"click","matTooltip"],[1,"tb-library-node-btn-icon"],["color","primary","type","button","mat-mini-fab","","class","version-control-button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-fullscreen-button","tb-mat-40",3,"click","matTooltip"],[1,"tb-absolute-fill","tb-rulechain-graph",3,"tbcontextmenu"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],[1,"tb-rule-chain-context-menu",3,"overlapTrigger"],["matMenuContent",""],["id","tb-rulchain-canvas","fitModelSizeByDefault","false",3,"modelChanged","model","selectedObjects","edgeStyle","automaticResize","nodeWidth","nodeHeight","dragAnimation","userCallbacks"],[1,"tb-footer-buttons","flex","flex-row","flex-wrap","items-end","justify-start"],["mat-fab","","color","accent","matTooltipPosition","above",1,"tb-btn-footer",3,"click","disabled","matTooltip"],[1,"flex-1",3,"ngModelChange","ruleChainType","disabled","ngModel"],[1,"mat-elevation-z2",3,"expanded"],["expandedHeight","48px",3,"mouseenter","mouseleave"],["translate","",1,"tb-panel-title"],["fitModelSizeByDefault","",3,"id","model","selectedObjects","automaticResize","userCallbacks","nodeWidth","nodeHeight","dropTargetId"],[1,"flex-1",3,"closeDetails","toggleDetailsEditMode","applyDetails","headerTitle","headerSubtitle","isReadOnly","isAlwaysEdit","theForm"],[1,"details-buttons"],[3,"tb-help"],["mat-stretch-tabs","false",1,"tb-absolute-fill","tb-rulenode-details","flex-1",3,"selectedIndexChange","selectedIndex"],[3,"label"],[3,"initRuleNode","changeScript","ruleNode","ruleChainId","ruleChainType"],[3,"label",4,"ngIf"],[1,"tb-rule-node-help"],["id","tb-node-content",1,"mat-padding","flex","flex-col"],[1,"tb-node-title"],[1,"tb-node-description",3,"innerHtml"],[1,"tb-node-details",3,"innerHtml"],[3,"debugEventSelected","debugEventTypes","defaultEventType","active","tenantId","entityId","functionTestButtonLabel"],[1,"flex-1",3,"ngModelChange","ngModel","allowedLabels","allowCustom","sourceRuleChainId"],["color","primary","type","button","mat-mini-fab","","matTooltipPosition","above",1,"version-control-button",3,"click","matTooltip"],[1,"tb-rule-chain-context-menu-container",3,"mouseleave"],[4,"ngIf"],[3,"src",4,"ngIf"],[1,"flex-1"],[1,"tb-context-menu-title"],[1,"tb-context-menu-subtitle"],[4,"ngFor","ngForOf"],[3,"src"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],["mat-menu-item","",3,"click","disabled"],["class","tb-alt-text",4,"ngIf"],["translate",""],[1,"tb-alt-text"]],template:function(n,t){if(n&1){let s=O();a(0,"div",10),f(1,"tb-hotkeys-cheatsheet",null,0),a(3,"section",11)(4,"div",12)(5,"mat-drawer-container",13)(6,"mat-drawer",14,1)(8,"mat-toolbar",15),b(9,Bw,1,3,"tb-rule-chain-select",16),r(),a(10,"mat-toolbar")(11,"div",17)(12,"mat-form-field",18)(13,"button",19),d(14,"translate"),a(15,"mat-icon"),p(16,"search"),r()(),f(17,"input",20),d(18,"translate"),a(19,"button",21),d(20,"translate"),y("click",function(){return x(s),I(t.ruleNodeTypeSearch.reset())}),a(21,"mat-icon"),p(22,"close"),r()()()()(),a(23,"div",22),b(24,Vw,9,12,"mat-expansion-panel",23),r()(),a(25,"mat-drawer",24),y("closed",function(){return x(s),I(t.onDetailsDrawerClosed())}),b(26,jw,24,28,"tb-details-panel",25)(27,Gw,6,12,"tb-details-panel",25),r(),a(28,"mat-drawer-content",26)(29,"button",27),d(30,"translate"),y("click",function(){x(s);let _=U(7);return I(_.toggle())}),a(31,"mat-icon",28),p(32,"chevron_right"),r()(),b(33,Uw,5,3,"button",29),a(34,"button",30),d(35,"translate"),y("click",function(){return x(s),I(t.isFullscreen=!t.isFullscreen)}),a(36,"mat-icon"),p(37),r()(),a(38,"div",31),y("tbcontextmenu",function(_){return x(s),I(t.openRuleChainContextMenu(_))}),f(39,"div",32,2),a(41,"mat-menu",33,3),b(43,Kw,10,8,"ng-template",34),r(),a(44,"fc-canvas",35,4),y("modelChanged",function(){return x(s),I(t.onModelChanged())}),r()(),a(46,"section",36)(47,"button",37),d(48,"translate"),d(49,"async"),y("click",function(){return x(s),I(t.deleteSelected())}),a(50,"mat-icon"),p(51,"delete"),r()(),a(52,"button",37),d(53,"translate"),d(54,"async"),y("click",function(){return x(s),I(t.resetDebugModeInAllNodes())}),a(55,"mat-icon"),p(56,"bug_report"),r()(),a(57,"button",37),d(58,"translate"),d(59,"async"),y("click",function(){return x(s),I(t.saveRuleChain())}),a(60,"mat-icon"),p(61,"done"),r()(),a(62,"button",37),d(63,"translate"),d(64,"async"),y("click",function(){return x(s),I(t.revertRuleChain())}),a(65,"mat-icon"),p(66,"close"),r()()()()()()()()}if(n&2){let s=U(2),u=U(7),_=U(42);l("fullscreen",t.isFullscreen)("tb-hotkeys",t.hotKeys)("cheatSheet",s),o(9),l("ngIf",!t.isImport),o(4),T("matTooltip",c(14,44,"rulenode.search")),o(4),T("placeholder",c(18,46,"rulenode.search")),l("formControl",t.ruleNodeTypeSearch),o(2),L("!hidden",t.ruleNodeTypeSearch.value===""),T("matTooltip",c(20,48,"action.clear-search")),o(5),l("ngForOf",t.ruleNodeTypesLibraryArray),o(),l("opened",t.isEditingRuleNode||t.isEditingRuleNodeLink),o(),l("ngIf",t.editingRuleNode),o(),l("ngIf",t.editingRuleNodeLink),o(2),T("matTooltip",c(30,50,u.opened?"rulenode.close-node-library":"rulenode.open-node-library")),o(2),L("tb-library-node-btn-icon-toggled",u.opened),o(2),l("ngIf",!t.isImport),o(),T("matTooltip",c(35,52,t.isFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),R(t.isFullscreen?"fullscreen_exit":"fullscreen"),o(2),Qi("left",t.ruleChainMenuPosition.x)("top",t.ruleChainMenuPosition.y),l("matMenuTriggerFor",_),o(2),l("overlapTrigger",!0),o(3),l("model",t.ruleChainModel)("selectedObjects",t.selectedObjects)("edgeStyle",t.flowchartConstants.curvedStyle)("automaticResize",!0)("nodeWidth",170)("nodeHeight",50)("dragAnimation",t.flowchartConstants.dragAnimationRepaint)("userCallbacks",t.editCallbacks),o(3),L("tb-hide",!t.objectsSelected()),T("matTooltip",c(48,54,"rulenode.delete-selected-objects")),l("disabled",c(49,56,t.isLoading$)),o(5),T("matTooltip",c(53,58,"rulenode.reset-debug-mode")),l("disabled",c(54,60,t.isLoading$)||!t.isDebugModeEnabled()),o(5),T("matTooltip",c(58,62,"action.apply-changes")),l("disabled",c(59,64,t.isLoading$)||t.isInvalid||!t.isDirtyValue&&!t.isImport),o(5),T("matTooltip",c(63,66,"action.decline-changes")),l("disabled",c(64,68,t.isLoading$)||!t.isDirtyValue)}},dependencies:[we,V,Ms,Hs,Tt,Ws,Ce,Nu,Au,ee,ge,me,$u,ei,Ts,xs,Ss,He,Pa,Da,Xu,Fa,Dt,xi,Pt,Co,bi,Oi,Bi,ue,W,ut,Yt,qu,l0,H,If,nl,qi,po,Ur,le,tf,ku,k],styles:[`@charset "UTF-8";.tb-rulechain{width:100%;height:100%}.tb-rulechain .mat-mdc-tab-group.tb-rulenode-details>.mat-mdc-tab-body-wrapper{position:absolute;inset:49px 0 0}.tb-rulechain .mat-mdc-tab-group.tb-rulenode-details>.mat-mdc-tab-header .mat-mdc-tab{min-width:40px}.tb-rulechain button.mdc-icon-button.tb-fullscreen-button{position:absolute;top:10px;right:10px;background:#ccc;color:#666;opacity:.85;margin:0 6px;z-index:2}.tb-rulechain button.mdc-fab.version-control-button{position:absolute;top:10px;right:60px;opacity:.85;margin:0 6px;z-index:2}.tb-rulechain .tb-library-node-btn{width:20px;height:90px;position:absolute;top:50%;z-index:1000;opacity:.5;border-radius:0 15px 15px 0!important;transform:translateY(-50%)}.tb-rulechain .tb-library-node-btn-icon{transition:transform .4s!important}.tb-rulechain .tb-library-node-btn-icon-toggled{transform:rotate(180deg)}.tb-rulechain .tb-library-node-btn:before{width:20px;height:30px;top:-28px;left:0;content:"";pointer-events:none;border-radius:0 0 0 15px;box-shadow:-10px 0 #305680;border:none}.tb-rulechain .tb-library-node-btn:after{position:absolute;width:20px;height:30px;bottom:-28px;left:0;content:"";pointer-events:none;border-top-left-radius:15px;box-shadow:-10px 0 #305680;border:none}.tb-rulechain .tb-rulechain-library{z-index:1;width:250px;min-width:250px}.tb-rulechain .tb-rulechain-library .mat-toolbar{height:min-content;padding:0}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools{height:48px;padding:0 6px;font-size:14px}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button{margin:0}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button.tb-small{width:32px;height:32px;min-height:32px;padding:6px;line-height:20px}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button.tb-small .mat-icon{width:20px;min-width:20px;height:20px;min-height:20px;font-size:20px;line-height:20px}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group{overflow-x:hidden;overflow-y:auto}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel{border-radius:0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel:last-child{margin-bottom:5px}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header{background:#e6e6e6}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header:hover{background:#dadada}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title{line-height:48px;height:48px;overflow:hidden}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title .mat-icon{min-width:24px;margin:auto 8px auto 0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title .tb-panel-title{min-width:130px;-webkit-user-select:none;user-select:none}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel.mat-expanded .mat-expansion-panel-header{border-bottom:1px solid;border-color:#909090}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel-body{padding:0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .fc-canvas{background:#f9f9f9}.tb-rulechain .mat-drawer-content.tb-rulechain-graph-content{overflow:hidden;z-index:0}.tb-rulechain .mat-drawer-content.tb-rulechain-graph-content .tb-rulechain-graph{z-index:0;overflow:auto}.tb-rulechain .fc-canvas .fc-node{border-radius:8px}.tb-rulechain .fc-canvas .fc-node.fc-selected{z-index:2}.tb-rulechain .fc-canvas .fc-node.fc-selected:not(.fc-edit){margin:-3px;border:solid 3px #f00}.tb-rulechain .fc-canvas .fc-edit .fc-nodeedit,.tb-rulechain .fc-canvas .fc-edit .fc-nodedelete{box-sizing:content-box;border:solid 2px #fff;background:#f83e05;outline:none}.tb-rulechain .fc-canvas .fc-nodeopen{display:block;position:absolute;top:11px;right:10px;border:1px solid #FFFFFF;border-radius:4px;line-height:18px;height:22px;width:22px;background:#886cb1;color:#fff;text-align:center;cursor:pointer;box-sizing:border-box}.tb-rulechain .fc-canvas .fc-nodeopen .mat-icon{width:16px;min-width:16px;height:16px;min-height:16px;font-size:16px}.tb-rulechain .fc-canvas .fc-nodeopen:hover{background-color:#4e2d7e}.tb-rulechain .fc-canvas .fc-arrow-marker polygon{fill:gray;stroke:gray}.tb-rulechain .fc-canvas .fc-arrow-marker-selected polygon{fill:red;stroke:red}.tb-rulechain .fc-canvas .fc-edge{outline:none;stroke:gray}.tb-rulechain .fc-canvas .fc-edge.fc-selected{stroke:red}.tb-rulechain .fc-canvas .fc-edge.fc-hover{stroke:gray}.tb-rulechain .fc-canvas .edge-endpoint{fill:gray}.tb-rulechain .fc-canvas .fc-edge-label{opacity:1!important}.tb-rulechain .fc-canvas .fc-edge-label:focus{outline:0}.tb-rulechain .fc-canvas .fc-edge-label.fc-selected .fc-edge-label-text span{color:#fff!important;background-color:red!important;border:solid #f00!important}.tb-rulechain .fc-canvas .fc-edge-label .fc-edge-label-text{font-size:14px!important;font-weight:600!important}.tb-rulechain .fc-canvas .fc-edge-label .fc-edge-label-text span{background-color:#fff!important;color:#003a79!important;border:solid 2px #003a79!important}.tb-rule-node-tooltip,.tb-rule-node-help{color:#333}.tb-rule-node-tooltip{max-width:300px;font-size:14px}.tb-rule-node-tooltip.tb-lib-tooltip{width:300px}.tb-rule-node-help{font-size:16px}.tb-rule-node-error-tooltip{font-size:16px;color:#ea0d0d}.tb-rule-node-tooltip #tb-node-content .tb-node-title,.tb-rule-node-error-tooltip #tb-node-content .tb-node-title,.tb-rule-node-help #tb-node-content .tb-node-title{font-weight:600}.tb-rule-node-tooltip #tb-node-content .tb-node-description,.tb-rule-node-error-tooltip #tb-node-content .tb-node-description,.tb-rule-node-help #tb-node-content .tb-node-description{font-style:italic;color:#555}.tb-rule-node-tooltip #tb-node-content .tb-node-details,.tb-rule-node-error-tooltip #tb-node-content .tb-node-details,.tb-rule-node-help #tb-node-content .tb-node-details{padding-top:10px;padding-bottom:10px}.tb-rule-node-tooltip #tb-node-content code,.tb-rule-node-error-tooltip #tb-node-content code,.tb-rule-node-help #tb-node-content code{padding:0 3px 2px;margin:1px;font-size:12px;color:#ad1625;white-space:nowrap;background-color:#f7f7f9;border:1px solid #e1e1e8;border-radius:2px}.tb-rule-chain-context-menu.mat-mdc-menu-panel{min-width:320px;max-height:404px;border-radius:8px;margin-left:-20px}.tb-rule-chain-context-menu.mat-mdc-menu-panel.mat-menu-below{margin-top:-60px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .mat-mdc-menu-content{padding:0;display:flex;flex-direction:column}.tb-rule-chain-context-menu.mat-mdc-menu-panel .mat-mdc-menu-content .tb-rule-chain-context-menu-container{pointer-events:auto;padding:0 0 8px;display:flex;flex-direction:column;overflow-y:auto}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header{display:flex;box-sizing:content-box;flex-direction:row;height:36px;min-height:36px;padding:8px 5px 5px;font-size:14px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-filter-type{background-color:#f1e861}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-enrichment-type{background-color:#cdf14e}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-transformation-type{background-color:#79cef1}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-action-type{background-color:#f1928f}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-external-type{background-color:#fbc766}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-flow-type{background-color:#d6c4f1}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-unknown-type{background-color:#f16c29}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-rulechain-header,.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-link-header{background-color:#aac7e4}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .mat-icon{margin:auto 10px auto 2px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .tb-context-menu-title{font-weight:500;line-height:normal}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .tb-context-menu-subtitle{font-size:12px;line-height:normal}
`],encapsulation:2})}}return i})(),Rc=(()=>{class i extends et{constructor(e,n,t,s,u,_){super(e,n,u),this.store=e,this.router=n,this.data=t,this.errorStateMatcher=s,this.dialogRef=u,this.fb=_,this.submitted=!1,this.link=this.data.link,this.labels=this.data.labels,this.allowCustomLabels=this.data.allowCustomLabels,this.sourceRuleChainId=this.data.sourceRuleChainId,this.ruleNodeLinkFormGroup=this.fb.group({link:[Ue(this.link),[S.required]]})}ngOnInit(){}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),s=!!(e&&e.invalid&&this.submitted);return t||s}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0;let e=this.ruleNodeLinkFormGroup.get("link").value;this.link=_e(_e({},this.link),e),this.dialogRef.close(this.link)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(hi,4),g(Ze),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-add-rule-node-link-dialog"]],features:[ke([{provide:hi,useExisting:i}]),G],decls:24,vars:23,consts:[[2,"width","480px",3,"ngSubmit","formGroup"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],["required","","formControlName","link",3,"allowedLabels","allowCustom","sourceRuleChainId"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(n,t){n&1&&(a(0,"form",0),y("ngSubmit",function(){return t.add()}),a(1,"mat-toolbar",1)(2,"h2",2),p(3,"rulenode.add-link"),r(),f(4,"span",3)(5,"div",4),a(6,"button",5),y("click",function(){return t.cancel()}),a(7,"mat-icon",6),p(8,"close"),r()()(),b(9,Yw,1,0,"mat-progress-bar",7),d(10,"async"),a(11,"div",8)(12,"fieldset",9),d(13,"async"),f(14,"tb-rule-node-link",10),r()(),a(15,"div",11)(16,"button",12),d(17,"async"),y("click",function(){return t.cancel()}),p(18),d(19,"translate"),r(),a(20,"button",13),d(21,"async"),p(22),d(23,"translate"),r()()()),n&2&&(l("formGroup",t.ruleNodeLinkFormGroup),o(5),l("tb-help","ruleEngine"),o(4),l("ngIf",c(10,11,t.isLoading$)),o(3),l("disabled",c(13,13,t.isLoading$)),o(2),l("allowedLabels",t.labels)("allowCustom",t.allowCustomLabels)("sourceRuleChainId",t.sourceRuleChainId),o(2),l("disabled",c(17,15,t.isLoading$)),o(2),h(" ",c(19,17,"action.cancel")," "),o(2),l("disabled",c(21,19,t.isLoading$)||t.ruleNodeLinkFormGroup.invalid||!t.ruleNodeLinkFormGroup.dirty),o(2),h(" ",c(23,21,"action.add")," "))},dependencies:[V,Tt,K,Ce,ee,Oe,He,Ct,Je,fe,W,z,ce,X,oe,H,Ur,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]     tb-rule-node-link form{overflow:hidden!important}']})}}return i})(),Oc=(()=>{class i extends et{constructor(e,n,t,s,u){super(e,n,u),this.store=e,this.router=n,this.data=t,this.errorStateMatcher=s,this.dialogRef=u,this.submitted=!1,this.ruleNode=this.data.ruleNode,this.ruleChainId=this.data.ruleChainId,this.ruleChainType=this.data.ruleChainType}ngOnInit(){}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),s=!!(e&&e.invalid&&this.submitted);return t||s}helpLinkIdForRuleNodeType(){return Wd(this.ruleNode.component)}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0,this.ruleNodeDetailsComponent.validate(),this.ruleNodeDetailsComponent.ruleNodeFormGroup.valid&&this.dialogRef.close(this.ruleNode)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(hi,4),g(Ze))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-add-rule-node-dialog"]],viewQuery:function(n,t){if(n&1&&be(Nh,7),n&2){let s;ve(s=ye())&&(t.ruleNodeDetailsComponent=s.first)}},features:[ke([{provide:hi,useExisting:i}]),G],decls:24,vars:20,consts:[["tbRuleNode",""],[1,"dialog-container",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],["isAdd","",3,"ruleNode","ruleChainId","ruleChainType"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(n,t){if(n&1){let s=O();a(0,"form",1),y("ngSubmit",function(){return x(s),I(t.add())}),a(1,"mat-toolbar",2)(2,"h2",3),p(3,"rulenode.add"),r(),a(4,"span",4),p(5),r(),f(6,"div",5),a(7,"button",6),y("click",function(){return x(s),I(t.cancel())}),a(8,"mat-icon",7),p(9,"close"),r()()(),b(10,Xw,1,0,"mat-progress-bar",8),d(11,"async"),a(12,"div",9),f(13,"tb-rule-node",10,0),r(),a(15,"div",11)(16,"button",12),d(17,"async"),y("click",function(){return x(s),I(t.cancel())}),p(18),d(19,"translate"),r(),a(20,"button",13),d(21,"async"),p(22),d(23,"translate"),r()()()}if(n&2){let s=U(14);o(5),h(": ",t.ruleNode.component.name,""),o(),l("tb-help",t.helpLinkIdForRuleNodeType()),o(4),l("ngIf",c(11,10,t.isLoading$)),o(3),l("ruleNode",t.ruleNode)("ruleChainId",t.ruleChainId)("ruleChainType",t.ruleChainType),o(3),l("disabled",c(17,12,t.isLoading$)),o(2),h(" ",c(19,14,"action.cancel")," "),o(2),l("disabled",c(21,16,t.isLoading$)||s.ruleNodeFormGroup.invalid||!s.ruleNodeFormGroup.dirty),o(2),h(" ",c(23,18,"action.add")," ")}},dependencies:[V,Tt,K,Ce,ee,Oe,He,Ct,Je,fe,z,Yi,H,po,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]{min-width:750px!important;max-width:750px!important}[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{padding:8px}@media screen and (max-width: 959px){[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]{min-width:100%!important}}']})}}return i})(),Bc=(()=>{class i extends et{constructor(e,n,t,s,u,_,E){super(e,n,E),this.store=e,this.router=n,this.data=t,this.errorStateMatcher=s,this.fb=u,this.ruleChainService=_,this.dialogRef=E,this.submitted=!1}ngOnInit(){this.createNestedRuleChainFormGroup=this.fb.group({name:["",[S.required,S.maxLength(255)]],additionalInfo:this.fb.group({description:[""]})})}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),s=!!(e&&e.invalid&&this.submitted);return t||s}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0;let e={name:this.createNestedRuleChainFormGroup.get("name").value,debugMode:!1,type:this.data.ruleChainType,additionalInfo:{description:this.createNestedRuleChainFormGroup.get("additionalInfo").get("description").value}};this.ruleChainService.saveRuleChain(e).subscribe(n=>{this.dialogRef.close(n)})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(hi,4),g(se),g(ln),g(Ze))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-create-nested-rulechain-dialog"]],features:[ke([{provide:hi,useExisting:i}]),G],decls:34,vars:21,consts:[[2,"min-width","650px",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[1,"mat-padding",3,"formGroup"],[3,"disabled"],[1,"mat-block","flex-1"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formGroupName","additionalInfo"],[1,"mat-block"],["matInput","","formControlName","description","rows","2"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(n,t){n&1&&(a(0,"form",0),y("ngSubmit",function(){return t.add()}),a(1,"mat-toolbar",1)(2,"h2",2),p(3,"rulenode.create-nested-rulechain"),r(),f(4,"span",3),a(5,"button",4),y("click",function(){return t.cancel()}),a(6,"mat-icon",5),p(7,"close"),r()()(),b(8,Zw,1,0,"mat-progress-bar",6),d(9,"async"),a(10,"div",7)(11,"form",8)(12,"fieldset",9),d(13,"async"),a(14,"mat-form-field",10)(15,"mat-label",2),p(16,"rulechain.name"),r(),f(17,"input",11),b(18,eM,3,3,"mat-error",12)(19,tM,3,3,"mat-error",12),r(),a(20,"div",13)(21,"mat-form-field",14)(22,"mat-label",2),p(23,"rulechain.description"),r(),f(24,"textarea",15),r()()()()(),a(25,"div",16)(26,"button",17),d(27,"async"),y("click",function(){return t.cancel()}),p(28),d(29,"translate"),r(),a(30,"button",18),d(31,"async"),p(32),d(33,"translate"),r()()()),n&2&&(o(8),l("ngIf",c(9,9,t.isLoading$)),o(3),l("formGroup",t.createNestedRuleChainFormGroup),o(),l("disabled",c(13,11,t.isLoading$)),o(6),l("ngIf",t.createNestedRuleChainFormGroup.get("name").hasError("required")),o(),l("ngIf",t.createNestedRuleChainFormGroup.get("name").hasError("maxlength")),o(7),l("disabled",c(27,13,t.isLoading$)),o(2),h(" ",c(29,15,"action.cancel")," "),o(2),l("disabled",c(31,17,t.isLoading$)||t.createNestedRuleChainFormGroup.invalid||!t.createNestedRuleChainFormGroup.dirty),o(2),h(" ",c(33,19,"action.create")," "))},dependencies:[V,K,Ce,ee,Oe,ge,me,Ie,De,He,Ct,Je,fe,ue,W,z,ce,Yi,X,oe,ft,H,le,k],encapsulation:2})}}return i})();var qr=(()=>{class i{constructor(e){this.ruleChainService=e}resolve(e){let n=e.params.ruleChainId;return this.ruleChainService.getRuleChain(n)}static{this.\u0275fac=function(n){return new(n||i)(N(ln))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),Wr=(()=>{class i{constructor(e){this.ruleChainService=e}resolve(e){let n=e.params.ruleChainId;return this.ruleChainService.getRuleChainMetadata(n)}static{this.\u0275fac=function(n){return new(n||i)(N(ln))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),ia=(()=>{class i{constructor(e,n){this.ruleChainService=e,this.modulesMap=n}resolve(e){return this.ruleChainService.getRuleNodeComponents(this.modulesMap,e.data.ruleChainType)}static{this.\u0275fac=function(n){return new(n||i)(N(ln),N(mu,8))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),na=(()=>{class i{constructor(){}resolve(e){return vr(import("./chunk-A7EJUMMW.js"))}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),Cm=(()=>{class i{constructor(e,n){this.itembuffer=e,this.router=n}canActivate(e,n){return this.itembuffer.hasRuleChainImport()?!0:this.router.parseUrl("ruleChains")}static{this.\u0275fac=function(n){return new(n||i)(N(Ja),N(de))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})(),Sm=(i,m,e)=>{let n=e.ruleChain.name;return e.ruleChain.root&&(n+=` (${m.instant("rulechain.root")})`),n},Vc=(i,m,e)=>`${m.instant("rulechain.import")}: ${e.ruleChain.name}`,iM=[{path:"ruleChains",data:{breadcrumb:{menuId:xe.rule_chains}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"rulechain.rulechains",ruleChainsType:"tenant"},resolve:{entitiesTableConfig:gr}},{path:":ruleChainId",component:mo,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:Sm,icon:"settings_ethernet"},auth:[M.TENANT_ADMIN],title:"rulechain.rulechain",import:!1,ruleChainType:mi.CORE},resolve:{ruleChain:qr,ruleChainMetaData:Wr,ruleNodeComponents:ia,tooltipster:na}},{path:"ruleChain/import",component:mo,canActivate:[Cm],canDeactivate:[Fe],data:{breadcrumb:{labelFunction:Vc,icon:"settings_ethernet"},auth:[M.TENANT_ADMIN],title:"rulechain.rulechain",import:!0,ruleChainType:mi.CORE},resolve:{ruleNodeComponents:ia,tooltipster:na}}]}],Tm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[gr,qr,Wr,ia,na,Cm],imports:[j.forChild(iM),j]})}}return i})();(function(){Y(Tm,{imports:[j],exports:[j]})})();C();function oM(i,m){if(i&1&&(a(0,"mat-icon",9),p(1),r()),i&2){let e=v();o(),R(e.node.icon)}}function aM(i,m){if(i&1&&f(0,"img",10),i&2){let e=v();l("src",e.iconUrl,Nn)}}function rM(i,m){if(i&1&&(a(0,"span",11),p(1),r()),i&2){let e=v();o(),R(e.node.name)}}function sM(i,m){if(i&1&&(a(0,"div",12),f(1,"div",13),r()),i&2){let e=m.$implicit,n=v();l("connector",e)("callbacks",n.callbacks),o(),l("connector",e)("nodeRectInfo",n.nodeRectInfo)("mouseOverConnector",n.mouseOverConnector)("callbacks",n.callbacks)("modelservice",n.modelservice)}}function lM(i,m){if(i&1&&(a(0,"div",12),f(1,"div",13),r()),i&2){let e=m.$implicit,n=v();l("connector",e)("callbacks",n.callbacks),o(),l("connector",e)("nodeRectInfo",n.nodeRectInfo)("mouseOverConnector",n.mouseOverConnector)("callbacks",n.callbacks)("modelservice",n.modelservice)}}function pM(i,m){if(i&1){let e=O();a(0,"section")(1,"div",14),y("click",function(t){x(e);let s=v();return I(s.userNodeCallbacks.nodeEdit(t,s.node))}),f(2,"i",15),r(),a(3,"div",16),y("click",function(){x(e);let t=v();return I(t.modelservice.nodes.delete(t.node))}),p(4," \xD7 "),r()()}}function mM(i,m){if(i&1){let e=O();a(0,"section")(1,"div",17),y("click",function(t){x(e);let s=v();return I(s.openRuleChain(t,s.node))})("mouseenter",function(t){x(e);let s=v();return I(s.displayOpenRuleChainTooltip(t,s.node))}),f(2,"mat-icon",18),r()()}}var Lc=(()=>{class i extends Uu{constructor(e,n,t){super(),this.sanitizer=e,this.translate=n,this.router=t,this.RuleNodeType=_i}ngOnInit(){super.ngOnInit(),this.node.iconUrl&&(this.iconUrl=this.sanitizer.bypassSecurityTrustResourceUrl(this.node.iconUrl))}openRuleChain(e,n){e&&e.stopPropagation(),n.configuration?.ruleChainId&&(n.ruleChainType===mi.EDGE?this.router.navigateByUrl(`/edgeManagement/ruleChains/${n.configuration?.ruleChainId}`):this.router.navigateByUrl(`/ruleChains/${n.configuration?.ruleChainId}`))}displayOpenRuleChainTooltip(e,n){e&&e.stopPropagation(),this.userNodeCallbacks.mouseLeave(e,n);let t='<div class="tb-rule-node-tooltip"><div id="tb-node-content"><div class="tb-node-description">'+this.translate.instant("rulechain.open-rulechain")+"</div></div></div>",s=$(e.target);s.tooltipster({theme:"tooltipster-shadow",delay:100,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!0,tap:!0,scroll:!0,mouseleave:!0},side:"top",distance:12,trackOrigin:!0});let u=s.tooltipster("instance"),_=$(t);u.content(_),u.open()}static{this.\u0275fac=function(n){return new(n||i)(g(is),g(ie),g(de))}}static{this.\u0275cmp=D({type:i,selectors:[["rule-node"]],features:[G],decls:15,vars:21,consts:[[3,"dblclick","mousedown","mouseenter","mouseleave"],[1,"fc-node-overlay"],["class","max-w-15% flex-full",4,"ngIf"],["class","max-w-15% flex-full",3,"src",4,"ngIf"],[1,"flex","max-w-85%","flex-full","flex-col","items-stretch","justify-center"],[1,"tb-node-type"],["class","tb-node-title",4,"ngIf"],["fc-magnet","",3,"connector","callbacks",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"max-w-15%","flex-full"],[1,"max-w-15%","flex-full",3,"src"],[1,"tb-node-title"],["fc-magnet","",3,"connector","callbacks"],["fc-connector","",3,"connector","nodeRectInfo","mouseOverConnector","callbacks","modelservice"],[1,"fc-nodeedit",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],[1,"fc-nodedelete",3,"click"],[1,"fc-nodeopen",3,"click","mouseenter"],["svgIcon","mdi:login",1,"material-icons"]],template:function(n,t){n&1&&(a(0,"div",0),y("dblclick",function(u){return t.userNodeCallbacks.doubleClick(u,t.node)})("mousedown",function(u){return t.userNodeCallbacks.mouseDown(u,t.node)})("mouseenter",function(u){return t.userNodeCallbacks.mouseEnter(u,t.node)})("mouseleave",function(u){return t.userNodeCallbacks.mouseLeave(u,t.node)}),f(1,"div",1),a(2,"div"),b(3,oM,2,1,"mat-icon",2)(4,aM,1,1,"img",3),a(5,"div",4)(6,"span",5),p(7),r(),b(8,rM,2,1,"span",6),r(),a(9,"div"),b(10,sM,2,7,"div",7),r(),a(11,"div"),b(12,lM,2,7,"div",7),r()(),b(13,pM,5,0,"section",8)(14,mM,3,0,"section",8),r()),n&2&&(o(2),Zr("tb-rule-node ",t.node.nodeClass,""),L("tb-rule-node-highlighted",t.node.highlighted)("tb-rule-node-invalid",t.node.error),o(),l("ngIf",!t.iconUrl),o(),l("ngIf",t.iconUrl),o(3),R(t.node.component.name),o(),l("ngIf",t.node.name),o(),jd(t.flowchartConstants.leftConnectorClass),o(),l("ngForOf",t.modelservice.nodes.getConnectorsByType(t.node,t.flowchartConstants.leftConnectorType)),o(),jd(t.flowchartConstants.rightConnectorClass),o(),l("ngForOf",t.modelservice.nodes.getConnectorsByType(t.node,t.flowchartConstants.rightConnectorType)),o(),l("ngIf",t.modelservice.isEditable()&&!t.node.readonly),o(),l("ngIf",(t.node.component==null||t.node.component.configurationDescriptor==null||t.node.component.configurationDescriptor.nodeDefinition==null?null:t.node.component.configurationDescriptor.nodeDefinition.ruleChainNode)&&t.modelservice.isEditable()))},dependencies:[we,V,ee,Wu,Hu],styles:['@charset "UTF-8";[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;inset:0;background-color:#000;border-radius:5px;opacity:0}[_nghost-%COMP%]   .fc-hover[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%], .fc-hover   [_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{opacity:.25;transition:opacity .2s}[_nghost-%COMP%]   .fc-selected[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%], .fc-selected   [_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{opacity:.25}[_nghost-%COMP%]   .fc-edit[_nghost-%COMP%]   .fc-nodeedit[_ngcontent-%COMP%], .fc-edit   [_nghost-%COMP%]   .fc-nodeedit[_ngcontent-%COMP%], [_nghost-%COMP%]   .fc-edit[_nghost-%COMP%]   .fc-nodedelete[_ngcontent-%COMP%], .fc-edit   [_nghost-%COMP%]   .fc-nodedelete[_ngcontent-%COMP%]{box-sizing:content-box;border:solid 2px #fff;background:#f83e05;outline:none}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]{box-sizing:content-box;display:flex;flex-direction:row;min-width:150px;max-width:150px;height:32px;min-height:32px;max-height:32px;padding:5px 10px;font-size:12px;line-height:16px;color:#333;pointer-events:none;background-color:#f15b26;border:solid 1px #777;border-radius:5px}[_nghost-%COMP%]   .tb-rule-node.tb-filter-type[_ngcontent-%COMP%]{background-color:#f1e861}[_nghost-%COMP%]   .tb-rule-node.tb-enrichment-type[_ngcontent-%COMP%]{background-color:#cdf14e}[_nghost-%COMP%]   .tb-rule-node.tb-transformation-type[_ngcontent-%COMP%]{background-color:#79cef1}[_nghost-%COMP%]   .tb-rule-node.tb-action-type[_ngcontent-%COMP%]{background-color:#f1928f}[_nghost-%COMP%]   .tb-rule-node.tb-external-type[_ngcontent-%COMP%]{background-color:#fbc766}[_nghost-%COMP%]   .tb-rule-node.tb-flow-type[_ngcontent-%COMP%]{background-color:#d6c4f1}[_nghost-%COMP%]   .tb-rule-node.tb-unknown-type[_ngcontent-%COMP%]{background-color:#f16c29}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-highlighted[_ngcontent-%COMP%]:not(.tb-rule-node-invalid){box-shadow:0 0 10px 6px #51cbee}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-highlighted[_ngcontent-%COMP%]:not(.tb-rule-node-invalid)   .tb-node-title[_ngcontent-%COMP%]{font-weight:700;text-decoration:underline}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-invalid[_ngcontent-%COMP%]{box-shadow:0 0 10px 6px #ff5c50}[_nghost-%COMP%]   .tb-rule-node.tb-input-type[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;background-color:#a3eaa9}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:auto;width:20px;min-width:20px;height:20px;min-height:20px;padding-right:4px;font-size:20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-type[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]{position:absolute;top:0;z-index:0;display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%]{left:-20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]{right:-20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%]{display:flex;flex-grow:1;justify-content:center;height:60px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-connector[_ngcontent-%COMP%]{width:14px;height:14px;margin:10px;pointer-events:all;background-color:#ccc;border:1px solid #333;border-radius:5px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-connector.fc-hover[_ngcontent-%COMP%]{background-color:#000}']})}}return i})();var xm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[{provide:Gu,useValue:{nodeComponentType:Lc}}],imports:[ae,re,Ee,Tm]})}}return i})();(function(){Y(xm,{declarations:[hm,bm,mo,Lc,po,ym,_m,Ur,Rc,Oc,Bc],imports:[ae,re,Ee,Tm]})})();C();var Im=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Ul]})}}return i})();(function(){Y(Im,{declarations:[Vl,ja,$o,Gl,Bl,sr,rr,Ll,kl,Xd],imports:[ae,re,Ee,Ul]})})();fo(ja,[V,K,ge,me,Ie,zt,De,it,fe,ue,Ti,W,z,ce,nn,X,oe,H,Ka],[le,k]);fo(Xd,[V,K,Ce,ee,Oe,He,Ct,Je,fe,z,Yi,H,ja],[le,k]);C();var Em=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Mi,hc]})}}return i})();(function(){Y(Em,{declarations:[Bg,jg,Vg,Lg],imports:[ae,re,Ee,Mi,hc]})})();C();C();C();C();function dM(i,m){if(i&1&&(a(0,"mat-tab",4,0),d(2,"translate"),f(3,"tb-attribute-table",5),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),l("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function cM(i,m){if(i&1&&(a(0,"mat-tab",4,1),d(2,"translate"),f(3,"tb-attribute-table",6),r()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),l("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function uM(i,m){if(i&1&&(a(0,"mat-tab",4,2),d(2,"translate"),f(3,"tb-alarm-table",7),r()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),l("active",e.isActive)("entityId",n.entity.id)}}var wm=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-tenant-profile-tabs"]],features:[G],decls:3,vars:3,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"]],template:function(n,t){n&1&&b(0,dM,4,7,"mat-tab",3)(1,cM,4,7,"mat-tab",3)(2,uM,4,5,"mat-tab",3),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity))},dependencies:[V,Pt,Ei,wi,k],encapsulation:2})}}return i})();var Mm=(()=>{class i{constructor(e,n,t,s,u,_){this.tenantProfileService=e,this.importExport=n,this.translate=t,this.datePipe=s,this.router=u,this.dialogService=_,this.config=new Qe,this.config.entityType=B.TENANT_PROFILE,this.config.entityComponent=Cg,this.config.entityTabsComponent=wm,this.config.entityTranslations=$e.get(B.TENANT_PROFILE),this.config.entityResources=_t.get(B.TENANT_PROFILE),this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","tenant-profile.name","40%"),new te("description","tenant-profile.description","60%"),new te("isDefault","tenant-profile.default","60px",E=>Ot(E.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("tenant-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(E,w)=>this.exportTenantProfile(E,w)},{name:this.translate.instant("tenant-profile.set-default"),icon:"flag",isEnabled:E=>!E.default,onAction:(E,w)=>this.setDefaultTenantProfile(E,w)}),this.config.deleteEntityTitle=E=>this.translate.instant("tenant-profile.delete-tenant-profile-title",{tenantProfileName:E.name}),this.config.deleteEntityContent=()=>this.translate.instant("tenant-profile.delete-tenant-profile-text"),this.config.deleteEntitiesTitle=E=>this.translate.instant("tenant-profile.delete-tenant-profiles-title",{count:E}),this.config.deleteEntitiesContent=()=>this.translate.instant("tenant-profile.delete-tenant-profiles-text"),this.config.entitiesFetchFunction=E=>this.tenantProfileService.getTenantProfiles(E),this.config.loadEntity=E=>this.tenantProfileService.getTenantProfile(E.id),this.config.saveEntity=E=>this.tenantProfileService.saveTenantProfile(E),this.config.deleteEntity=E=>this.tenantProfileService.deleteTenantProfile(E.id),this.config.onEntityAction=E=>this.onTenantProfileAction(E),this.config.deleteEnabled=E=>E&&!E.default,this.config.entitySelectionEnabled=E=>E&&!E.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("tenant-profile.tenant-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("tenant-profile.create-tenant-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:n=>this.config.getTable().addEntity(n)},{name:this.translate.instant("tenant-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importTenantProfile(n)}),e}openTenantProfile(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["tenantProfiles",n.id.id]);this.router.navigateByUrl(t)}setDefaultTenantProfile(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("tenant-profile.set-default-tenant-profile-title",{tenantProfileName:n.name}),this.translate.instant("tenant-profile.set-default-tenant-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.tenantProfileService.setDefaultTenantProfile(n.id.id).subscribe(()=>{this.config.updateData()})})}importTenantProfile(e){this.importExport.importTenantProfile().subscribe(n=>{n&&this.config.updateData()})}exportTenantProfile(e,n){e&&e.stopPropagation(),this.importExport.exportTenantProfile(n.id.id)}onTenantProfileAction(e){switch(e.action){case"open":return this.openTenantProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultTenantProfile(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(z0),N(Gi),N(ie),N(Ge),N(de),N(Lt))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var fM=[{path:"tenantProfiles",data:{breadcrumb:{menuId:xe.tenant_profiles}},children:[{path:"",component:qe,data:{auth:[M.SYS_ADMIN],title:"tenant-profile.tenant-profiles"},resolve:{entitiesTableConfig:Mm}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"mdi:alpha-t-box"},auth:[M.SYS_ADMIN],title:"tenant-profile.tenant-profiles"},resolve:{entitiesTableConfig:Mm}}]}],Dm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Mm],imports:[j.forChild(fM),j]})}}return i})();(function(){Y(Dm,{imports:[j],exports:[j]})})();var Pm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Dm]})}}return i})();(function(){Y(Pm,{declarations:[wm],imports:[ae,re,Ee,Dm]})})();C();C();var gM=i=>({count:i});function hM(i,m){if(i&1&&(a(0,"mat-option",17),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(3);l("value",e),o(),h(" ",c(2,2,n.deviceTransportTypeTranslations.get(e))," ")}}function bM(i,m){if(i&1&&(a(0,"mat-hint"),p(1),d(2,"translate"),r()),i&2){let e=v(3);o(),h(" ",c(2,1,e.deviceTransportTypeHints.get(e.detailsForm.get("transportType").value))," ")}}function vM(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"device-profile.transport-type-required")," "))}function yM(i,m){if(i&1&&(a(0,"div",9)(1,"mat-form-field",10)(2,"mat-label",11),p(3,"device-profile.transport-type"),r(),a(4,"mat-select",12),b(5,hM,3,4,"mat-option",13),r(),b(6,bM,3,3,"mat-hint",14)(7,vM,3,3,"mat-error",14),r(),a(8,"div",15),f(9,"tb-device-profile-transport-configuration",16),r()()),i&2){let e=v(2);l("formGroup",e.detailsForm),o(5),l("ngForOf",e.deviceTransportTypes),o(),l("ngIf",e.detailsForm.get("transportType").value),o(),l("ngIf",e.detailsForm.get("transportType").hasError("required")),o(2),l("isAdd",e.isTransportTypeChanged)}}function _M(i,m){if(i&1&&(a(0,"mat-tab",7,0),d(2,"translate"),b(3,yM,10,5,"div",8),r()),i&2){let e=U(1);T("label",c(2,2,"device-profile.transport-configuration")),o(3),l("ngIf",e.isActive)}}function CM(i,m){if(i&1&&(a(0,"div",9)(1,"div",15),f(2,"tb-device-profile-alarms",18),r()()),i&2){let e=v(2);l("formGroup",e.detailsForm),o(2),l("deviceProfileId",e.entity.id)}}function SM(i,m){if(i&1&&(a(0,"mat-tab",7,1),d(2,"translate"),b(3,CM,3,2,"div",8),r()),i&2){let e,n=U(1),t=v();T("label",Nt(2,2,"device-profile.alarm-rules-with-count",at(5,gM,(e=t.detailsForm.get("profileData.alarms").value)!=null&&e.length?t.detailsForm.get("profileData.alarms").value.length:0))),o(3),l("ngIf",n.isActive)}}function TM(i,m){if(i&1&&(a(0,"div",9)(1,"div",15),f(2,"tb-device-profile-provision-configuration",19),r()()),i&2){let e=v(2);l("formGroup",e.detailsForm)}}function xM(i,m){if(i&1&&(a(0,"mat-tab",7,2),d(2,"translate"),b(3,TM,3,1,"div",8),r()),i&2){let e=U(1);T("label",c(2,2,"device-profile.device-provisioning")),o(3),l("ngIf",e.isActive)}}function IM(i,m){if(i&1&&(a(0,"mat-tab",7,3),d(2,"translate"),a(3,"div",9)(4,"div",15),f(5,"tb-device-profile-configuration",20),r()()()),i&2){let e=v();T("label",c(2,2,"device-profile.profile-configuration")),o(3),l("formGroup",e.detailsForm)}}function EM(i,m){if(i&1&&(a(0,"mat-tab",7,4),d(2,"translate"),f(3,"tb-audit-log-table",21),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function wM(i,m){if(i&1){let e=O();a(0,"mat-tab",7,5),d(2,"translate"),a(3,"tb-version-control",22),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Fm=(()=>{class i extends Kt{constructor(e){super(e),this.store=e,this.deviceTransportTypes=Object.values(Ai),this.deviceTransportTypeTranslations=Oa,this.deviceTransportTypeHints=A0,this.isTransportTypeChanged=!1}ngOnInit(){super.ngOnInit(),this.detailsForm.get("transportType").valueChanges.subscribe(()=>{this.isTransportTypeChanged=!0})}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-device-profile-tabs"]],features:[G],decls:6,vars:6,consts:[["transportType","matTab"],["alarmRules","matTab"],["deviceProvisioning","matTab"],["deviceProfile","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["class","mat-padding",3,"formGroup",4,"ngIf"],[1,"mat-padding",3,"formGroup"],[1,"mat-block"],["translate",""],["formControlName","transportType","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formGroupName","profileData"],["formControlName","transportConfiguration",3,"isAdd"],[3,"value"],["formControlName","alarms",3,"deviceProfileId"],["formControlName","provisionConfiguration"],["formControlName","configuration"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,_M,4,4,"mat-tab",6)(1,SM,4,7,"mat-tab",6)(2,xM,4,4,"mat-tab",6)(3,IM,6,4,"mat-tab",6)(4,EM,4,6,"mat-tab",6)(5,wM,4,7,"mat-tab",6),n&2&&(l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",t.entity),o(),l("ngIf",!1),o(),l("ngIf",t.entity&&!t.isEdit),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit))},dependencies:[we,V,me,Ie,zt,De,St,ct,Pt,W,z,ce,X,oe,ft,H,Ci,Tg,xg,Ig,Eg,di,k],encapsulation:2})}}return i})();C();C();var Am=(()=>{class i{constructor(e,n,t,s,u,_,E,w){this.deviceProfileService=e,this.importExport=n,this.homeDialogs=t,this.translate=s,this.datePipe=u,this.dialogService=_,this.router=E,this.dialog=w,this.config=new Qe,this.config.entityType=B.DEVICE_PROFILE,this.config.entityComponent=wg,this.config.entityTabsComponent=Fm,this.config.entityTranslations=$e.get(B.DEVICE_PROFILE),this.config.entityResources=_t.get(B.DEVICE_PROFILE),this.config.hideDetailsTabsOnEdit=!1,this.config.addDialogStyle={width:"1000px"},this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","device-profile.name","20%"),new te("type","device-profile.type","20%",q=>this.translate.instant(P0.get(q.type))),new te("transportType","device-profile.transport-type","20%",q=>this.translate.instant(Oa.get(q.transportType))),new te("description","device-profile.description","40%"),new te("isDefault","device-profile.default","60px",q=>Ot(q.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("device-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(q,Te)=>this.exportDeviceProfile(q,Te)},{name:this.translate.instant("device-profile.set-default"),icon:"flag",isEnabled:q=>!q.default,onAction:(q,Te)=>this.setDefaultDeviceProfile(q,Te)}),this.config.deleteEntityTitle=q=>this.translate.instant("device-profile.delete-device-profile-title",{deviceProfileName:q.name}),this.config.deleteEntityContent=()=>this.translate.instant("device-profile.delete-device-profile-text"),this.config.deleteEntitiesTitle=q=>this.translate.instant("device-profile.delete-device-profiles-title",{count:q}),this.config.deleteEntitiesContent=()=>this.translate.instant("device-profile.delete-device-profiles-text"),this.config.entitiesFetchFunction=q=>this.deviceProfileService.getDeviceProfiles(q),this.config.loadEntity=q=>this.deviceProfileService.getDeviceProfile(q.id),this.config.saveEntity=(q,Te)=>this.deviceProfileService.saveDeviceProfileAndConfirmOtaChange(Te,q),this.config.deleteEntity=q=>this.deviceProfileService.deleteDeviceProfile(q.id),this.config.onEntityAction=q=>this.onDeviceProfileAction(q),this.config.deleteEnabled=q=>q&&!q.default,this.config.entitySelectionEnabled=q=>q&&!q.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("device-profile.device-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("device-profile.create-device-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:()=>this.addDeviceProfile()},{name:this.translate.instant("device-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importDeviceProfile(n)}),e}addDeviceProfile(){this.dialog.open(Mg,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceProfileName:null,transportType:null}}).afterClosed().subscribe(e=>{e&&this.config.updateData()})}setDefaultDeviceProfile(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device-profile.set-default-device-profile-title",{deviceProfileName:n.name}),this.translate.instant("device-profile.set-default-device-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceProfileService.setDefaultDeviceProfile(n.id.id).subscribe(()=>{this.config.updateData()})})}openDeviceProfile(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["profiles","deviceProfiles",n.id.id]);this.router.navigateByUrl(t)}importDeviceProfile(e){this.importExport.importDeviceProfile().subscribe(n=>{n&&this.config.updateData()})}exportDeviceProfile(e,n){e&&e.stopPropagation(),this.importExport.exportDeviceProfile(n.id.id)}onDeviceProfileAction(e){switch(e.action){case"open":return this.openDeviceProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultDeviceProfile(e.event,e.entity),!0;case"export":return this.exportDeviceProfile(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(Bs),N(Gi),N(Ui),N(ie),N(Ge),N(Lt),N(de),N(je))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var kh=[{path:"deviceProfiles",data:{breadcrumb:{menuId:xe.device_profiles}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"device-profile.device-profiles"},resolve:{entitiesTableConfig:Am}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"mdi:alpha-d-box"},auth:[M.TENANT_ADMIN],title:"device-profile.device-profiles"},resolve:{entitiesTableConfig:Am}}]}],jc=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Am]})}}return i})();var Nm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,jc]})}}return i})();(function(){Y(Nm,{declarations:[Fm],imports:[ae,re,Ee,jc]})})();C();C();var MM="/assets/dashboard/api_usage.json",DM=(i,m,e=Zt(Na))=>e.loadJsonResource(MM),PM=[{path:"usage",component:dl,data:{auth:[M.TENANT_ADMIN],title:"api-usage.api-usage",breadcrumb:{menuId:xe.api_usage}},resolve:{dashboard:DM}}],km=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(PM),j]})}}return i})();(function(){Y(km,{imports:[j],exports:[j]})})();var Rm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,km]})}}return i})();(function(){Y(Rm,{imports:[ae,re,Ee,km]})})();C();C();var FM=[{path:"edgeManagement",data:{breadcrumb:{menuId:xe.edge_management}},children:[{path:"",children:[],data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],redirectTo:"/edgeManagement/instances"}},{path:"instances",data:{breadcrumb:{menuId:xe.edges}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.edge-instances",edgesType:"tenant"},resolve:{entitiesTableConfig:ea}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"router"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.edge-instances",edgesType:"tenant"},resolve:{entitiesTableConfig:ea}},{path:":edgeId/assets",data:{breadcrumb:{label:"edge.assets",icon:"domain"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.assets",assetsType:"edge"},resolve:{entitiesTableConfig:$n}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"domain"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.assets",assetsType:"edge"},resolve:{entitiesTableConfig:$n}}]},{path:":edgeId/devices",data:{breadcrumb:{label:"edge.devices",icon:"devices_other"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.devices",devicesType:"edge"},resolve:{entitiesTableConfig:zn}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"devices_other"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.devices",devicesType:"edge"},resolve:{entitiesTableConfig:zn}}]},{path:":edgeId/entityViews",data:{breadcrumb:{label:"edge.entity-views",icon:"view_quilt"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.entity-views",entityViewsType:"edge"},resolve:{entitiesTableConfig:ta}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"devices_other"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.entity-views",entityViewsType:"edge"},resolve:{entitiesTableConfig:ta}}]},{path:":edgeId/dashboards",data:{breadcrumb:{label:"edge.dashboards",icon:"dashboard"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],dashboardsType:"edge"},resolve:{entitiesTableConfig:cl}},{path:":dashboardId",component:ir,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:fl,icon:"dashboard"},auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"edge.dashboard",widgetEditMode:!1},resolve:{dashboard:ul}}]},{path:":edgeId/ruleChains",data:{breadcrumb:{label:"edge.rulechains",icon:"settings_ethernet"}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"edge.rulechains",ruleChainsType:"edge"},resolve:{entitiesTableConfig:gr}},{path:":ruleChainId",component:mo,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:Sm,icon:"settings_ethernet"},auth:[M.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!1,ruleChainType:mi.EDGE},resolve:{ruleChain:qr,ruleChainMetaData:Wr,ruleNodeComponents:ia,tooltipster:na}}]}]},{path:"ruleChains",data:{breadcrumb:{menuId:xe.rulechain_templates}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"edge.rulechain-templates",ruleChainsType:"edges"},resolve:{entitiesTableConfig:gr}},{path:":ruleChainId",component:mo,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:Sm,icon:"settings_ethernet"},auth:[M.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!1,ruleChainType:mi.EDGE},resolve:{ruleChain:qr,ruleChainMetaData:Wr,ruleNodeComponents:ia,tooltipster:na}},{path:"ruleChain/import",component:mo,canActivate:[Cm],canDeactivate:[Fe],data:{breadcrumb:{labelFunction:Vc,icon:"settings_ethernet"},auth:[M.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!0,ruleChainType:mi.EDGE},resolve:{ruleNodeComponents:ia,tooltipster:na}}]}]},{path:"edgeInstances",pathMatch:"full",redirectTo:"/edgeManagement/instances"},{path:"edgeInstances/:entityId",pathMatch:"full",redirectTo:"/edgeManagement/instances/:entityId"},{path:"edgeInstances/:edgeId/assets",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/assets"},{path:"edgeInstances/:edgeId/assets/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/assets/:entityId"},{path:"edgeInstances/:edgeId/devices",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/devices"},{path:"edgeInstances/:edgeId/devices/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/devices/:entityId"},{path:"edgeInstances/:edgeId/entityViews",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/entityViews"},{path:"edgeInstances/:edgeId/entityViews/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/entityViews/:entityId"},{path:"edgeInstances/:edgeId/dashboards",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/dashboards"},{path:"edgeInstances/:edgeId/dashboards/:dashboardId",redirectTo:"/edgeManagement/instances/:edgeId/dashboards/:dashboardId"},{path:"edgeInstances/:edgeId/ruleChains",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/ruleChains"},{path:"edgeInstances/:edgeId/ruleChains/:ruleChainId",redirectTo:"/edgeManagement/instances/:edgeId/ruleChains/:ruleChainId"}],Om=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[ea],imports:[j.forChild(FM),j]})}}return i})();(function(){Y(Om,{imports:[j],exports:[j]})})();var Bm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Mi,Ee,Om]})}}return i})();(function(){Y(Bm,{declarations:[Xp,Zp,em,tm],imports:[ae,re,Mi,Ee,Om]})})();C();C();C();C();function AM(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"ota-update.title-required")," "))}function NM(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"ota-update.title-max-length")," "))}function kM(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"ota-update.version-required")," "))}function RM(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"ota-update.version-max-length")," "))}function OM(i,m){i&1&&(a(0,"mat-hint",5),p(1,"ota-update.version-tag-hint"),r())}function BM(i,m){if(i&1&&(a(0,"mat-option",25),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.otaUpdateTypeTranslationMap.get(e))," ")}}function VM(i,m){i&1&&(a(0,"section")(1,"div",26),p(2,"ota-update.warning-after-save-no-edit"),r(),a(3,"mat-radio-group",27)(4,"mat-radio-button",25),p(5),d(6,"translate"),r(),a(7,"mat-radio-button",25),p(8),d(9,"translate"),r()()()),i&2&&(o(4),l("value",!1),o(),R(c(6,4,"ota-update.upload-binary-file")),o(2),l("value",!0),o(),R(c(9,6,"ota-update.use-external-url")))}function LM(i,m){if(i&1&&(a(0,"section"),f(1,"tb-file-input",29),d(2,"translate"),d(3,"translate"),a(4,"mat-checkbox",30),p(5),d(6,"translate"),r()()),i&2){let e=v(2);o(),T("label",c(2,4,"ota-update.package-file")),T("dropLabel",c(3,6,"ota-update.drop-package-file-or")),l("required",!e.entityForm.get("isURL").value),o(4),h(" ",c(6,8,"ota-update.auto-generate-checksum")," ")}}function jM(i,m){if(i&1&&(a(0,"mat-option",25),p(1),r()),i&2){let e=m.$implicit,n=v(3);l("value",e),o(),h(" ",n.checksumAlgorithmTranslationMap.get(e)," ")}}function GM(i,m){i&1&&(a(0,"mat-hint",5),p(1,"ota-update.checksum-hint"),r())}function UM(i,m){if(i&1&&(a(0,"div",31)(1,"mat-form-field",32)(2,"mat-label",5),p(3,"ota-update.checksum-algorithm"),r(),a(4,"mat-select",33),b(5,jM,2,2,"mat-option",21),r()(),a(6,"mat-form-field",13)(7,"mat-label",5),p(8,"ota-update.checksum"),r(),f(9,"input",34),b(10,GM,2,0,"mat-hint",17),r()()),i&2){let e=v(2);o(5),l("ngForOf",e.checksumAlgorithms),o(5),l("ngIf",e.isAdd)}}function qM(i,m){i&1&&(a(0,"section")(1,"div",35)(2,"mat-form-field",32)(3,"mat-label",5),p(4,"ota-update.file-name"),r(),f(5,"input",36),r(),a(6,"mat-form-field",13)(7,"mat-label",5),p(8,"ota-update.file-size-bytes"),r(),f(9,"input",37),r(),a(10,"mat-form-field",13)(11,"mat-label",5),p(12,"ota-update.content-type"),r(),f(13,"input",38),r()()())}function WM(i,m){if(i&1&&(a(0,"section"),b(1,LM,7,10,"section",12)(2,UM,11,2,"div",28)(3,qM,14,0,"section",12),r()),i&2){let e=v();o(),l("ngIf",e.isAdd),o(),l("ngIf",!(e.isAdd&&e.entityForm.get("generateChecksum").value)),o(),l("ngIf",!e.isAdd)}}function HM(i,m){i&1&&(a(0,"mat-error",5),p(1," ota-update.direct-url-required "),r())}function zM(i,m){if(i&1&&(a(0,"section",39)(1,"mat-form-field",19)(2,"mat-label",5),p(3,"ota-update.direct-url"),r(),f(4,"input",40),b(5,HM,2,0,"mat-error",17),r()()),i&2){let e=v();o(4),l("required",e.entityForm.get("isURL").value),o(),l("ngIf",e.entityForm.get("url").hasError("required")||e.entityForm.get("url").hasError("pattern"))}}var Vm=(()=>{class i extends jt{constructor(e,n,t,s,u,_){super(e,u,t,s,_),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.fb=u,this.cd=_,this.destroy$=new Ft,this.checksumAlgorithms=Object.values(Kd),this.checksumAlgorithmTranslationMap=ks,this.packageTypes=Object.values(Tr),this.otaUpdateTypeTranslationMap=Rs}ngOnInit(){super.ngOnInit(),this.isAdd&&(this.entityForm.get("isURL").valueChanges.pipe(dt(this.destroy$)).subscribe(e=>{e===!1?(this.entityForm.get("url").clearValidators(),this.entityForm.get("file").setValidators(S.required),this.entityForm.get("url").updateValueAndValidity({emitEvent:!1}),this.entityForm.get("file").updateValueAndValidity({emitEvent:!1})):(this.entityForm.get("file").clearValidators(),this.entityForm.get("url").setValidators([S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]),this.entityForm.get("file").updateValueAndValidity({emitEvent:!1}),this.entityForm.get("url").updateValueAndValidity({emitEvent:!1}))}),Yc([this.entityForm.get("title").valueChanges.pipe(Xn("")),this.entityForm.get("version").valueChanges.pipe(Xn(""))]).pipe(eu(()=>this.entityForm.get("tag").pristine),dt(this.destroy$)).subscribe(([e,n])=>{let t=`${e} ${n}`.trim();this.entityForm.get("tag").patchValue(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){let n=this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],version:[e?e.version:"",[S.required,S.maxLength(255)]],tag:[e?e.tag:"",[S.maxLength(255)]],type:[e?.type?e.type:Tr.FIRMWARE,S.required],deviceProfileId:[e?e.deviceProfileId:null,S.required],checksumAlgorithm:[e&&e.checksumAlgorithm?e.checksumAlgorithm:Kd.SHA256],checksum:[e?e.checksum:"",S.maxLength(1020)],url:[e?e.url:""],isURL:[!1],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return this.isAdd?(n.addControl("file",this.fb.control(null,S.required)),n.addControl("generateChecksum",this.fb.control(!0))):(n.addControl("fileName",this.fb.control(null)),n.addControl("dataSize",this.fb.control(null)),n.addControl("contentType",this.fb.control(null))),n}updateForm(e){this.entityForm.patchValue({title:e.title,version:e.version,tag:e.tag,type:e.type,deviceProfileId:e.deviceProfileId,checksumAlgorithm:e.checksumAlgorithm,checksum:e.checksum,fileName:e.fileName,dataSize:e.dataSize,contentType:e.contentType,url:e.url,isURL:fa(e.url),additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),!this.isAdd&&this.entityForm.enabled&&(this.entityForm.disable({emitEvent:!1}),this.entityForm.get("additionalInfo").enable({emitEvent:!1}))}onPackageIdCopied(){this.store.dispatch(new tt({message:this.translate.instant("ota-update.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onPackageChecksumCopied(){this.store.dispatch(new tt({message:this.translate.instant("ota-update.checksum-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onPackageDirectUrlCopied(){this.store.dispatch(new tt({message:this.translate.instant("ota-update.checksum-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}prepareFormValue(e){return e.isURL?delete e.file:delete e.url,delete e.generateChecksum,super.prepareFormValue(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity"),g("entitiesTableConfig"),g(se),g(Xe))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-ota-update"]],features:[G],decls:62,vars:57,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col","gap-2"],[3,"formGroup"],[1,"flex","flex-col",3,"disabled"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-full","gt-xs:max-w-45%"],["matInput","","formControlName","title","type","text","required","",3,"readonly"],[4,"ngIf"],[1,"mat-block","flex-1"],["matInput","","formControlName","version","type","text","required","",3,"readonly"],[1,"mat-block","flex-1",2,"margin-bottom","8px"],["matInput","","formControlName","tag","type","text",3,"readonly"],["translate","",4,"ngIf"],["formControlName","deviceProfileId","required","",3,"hint","editProfileEnabled","addNewProfile","showDetailsPageLink"],[1,"mat-block"],["formControlName","type","required",""],[3,"value",4,"ngFor","ngForOf"],["style","margin-top: 8px",4,"ngIf"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"],[3,"value"],["translate","",1,"mat-caption",2,"margin","-8px 0 8px"],["formControlName","isURL",1,"gap-4"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-xs:gap-2",4,"ngIf"],["formControlName","file","workFromFileObj","true",3,"label","required","dropLabel"],["formControlName","generateChecksum",2,"margin-top","16px"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-full","gt-xs:max-w-33%"],["formControlName","checksumAlgorithm"],["matInput","","formControlName","checksum","type","text"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],["matInput","","formControlName","fileName","type","text"],["matInput","","formControlName","dataSize","type","text"],["matInput","","formControlName","contentType","type","text"],[2,"margin-top","8px"],["matInput","","formControlName","url","type","text",3,"required"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),d(2,"async"),y("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),r(),a(5,"button",1),d(6,"async"),y("click",function(u){return t.onEntityAction(u,"uploadPackage")}),p(7),d(8,"translate"),r(),a(9,"button",1),d(10,"async"),y("click",function(u){return t.onEntityAction(u,"delete")}),p(11),d(12,"translate"),r(),a(13,"div",2)(14,"button",3),y("cbOnSuccess",function(){return t.onPackageIdCopied()}),f(15,"mat-icon",4),a(16,"span",5),p(17,"ota-update.copyId"),r()(),a(18,"button",3),y("cbOnSuccess",function(){return t.onPackageChecksumCopied()}),f(19,"mat-icon",4),a(20,"span",5),p(21,"ota-update.copy-checksum"),r()(),a(22,"button",3),y("cbOnSuccess",function(){return t.onPackageDirectUrlCopied()}),f(23,"mat-icon",4),a(24,"span",5),p(25,"ota-update.copy-direct-url"),r()()()(),a(26,"div",6)(27,"form",7)(28,"fieldset",8),d(29,"async"),a(30,"div",9)(31,"mat-form-field",10)(32,"mat-label",5),p(33,"ota-update.title"),r(),f(34,"input",11),b(35,AM,3,3,"mat-error",12)(36,NM,3,3,"mat-error",12),r(),a(37,"mat-form-field",13)(38,"mat-label",5),p(39,"ota-update.version"),r(),f(40,"input",14),b(41,kM,3,3,"mat-error",12)(42,RM,3,3,"mat-error",12),r()(),a(43,"mat-form-field",15)(44,"mat-label",5),p(45,"ota-update.version-tag"),r(),f(46,"input",16),b(47,OM,2,0,"mat-hint",17),r(),f(48,"tb-device-profile-autocomplete",18),a(49,"mat-form-field",19)(50,"mat-label",5),p(51,"ota-update.package-type"),r(),a(52,"mat-select",20),b(53,BM,3,4,"mat-option",21),r()(),b(54,VM,10,8,"section",12)(55,WM,4,3,"section",12)(56,zM,6,2,"section",22),a(57,"div",23)(58,"mat-form-field",19)(59,"mat-label",5),p(60,"ota-update.description"),r(),f(61,"textarea",24),r()()()()()),n&2&&(o(),L("!hidden",t.isEdit||t.isDetailsPage),l("disabled",c(2,43,t.isLoading$)),o(2),h(" ",c(4,45,"common.open-details-page")," "),o(2),L("!hidden",t.isEdit),l("disabled",c(6,47,t.isLoading$)||!(t.entity!=null&&t.entity.hasData&&!(t.entity!=null&&t.entity.url))),o(2),h(" ",c(8,49,"ota-update.download")," "),o(2),L("!hidden",t.hideDelete()||t.isEdit),l("disabled",c(10,51,t.isLoading$)),o(2),h(" ",c(12,53,"ota-update.delete")," "),o(3),L("!hidden",t.isEdit),l("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(4),L("!hidden",t.isEdit||!(t.entity!=null&&t.entity.checksum)),l("cbContent",t.entity==null?null:t.entity.checksum),o(4),L("!hidden",t.isEdit||!(t.entity!=null&&t.entity.url)),l("cbContent",t.entity==null?null:t.entity.url),o(5),l("formGroup",t.entityForm),o(),l("disabled",c(29,55,t.isLoading$)||!t.isEdit),o(6),l("readonly",!t.isAdd),o(),l("ngIf",t.entityForm.get("title").hasError("required")),o(),l("ngIf",t.entityForm.get("title").hasError("maxlength")),o(4),l("readonly",!t.isAdd),o(),l("ngIf",t.entityForm.get("version").hasError("required")),o(),l("ngIf",t.entityForm.get("version").hasError("maxlength")),o(4),l("readonly",!t.isAdd),o(),l("ngIf",t.isAdd),o(),L("pb-4",t.isAdd)("pb-0",!t.isAdd),l("hint","ota-update.chose-compatible-device-profile")("editProfileEnabled",!1)("addNewProfile",!1)("showDetailsPageLink",!0),o(5),l("ngForOf",t.packageTypes),o(),l("ngIf",t.isAdd),o(),l("ngIf",!t.entityForm.get("isURL").value),o(),l("ngIf",t.entityForm.get("isURL").value))},dependencies:[we,V,K,$t,ee,ge,me,Ie,zt,De,St,ct,e0,t0,ii,fe,ue,W,z,ce,X,oe,ft,qa,H,ll,le,k],encapsulation:2})}}return i})();var Lm=(()=>{class i{constructor(e,n,t,s,u,_){this.translate=e,this.datePipe=n,this.store=t,this.otaPackageService=s,this.router=u,this.fileSize=_,this.config=new Qe,this.config.entityType=B.OTA_PACKAGE,this.config.entityComponent=Vm,this.config.entityTranslations=$e.get(B.OTA_PACKAGE),this.config.entityResources=_t.get(B.OTA_PACKAGE),this.config.entityTitle=E=>E?E.title:"",this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("title","ota-update.title","15%"),new te("version","ota-update.version","15%"),new te("tag","ota-update.version-tag","15%"),new te("type","ota-update.package-type","15%",E=>this.translate.instant(Rs.get(E.type))),new te("url","ota-update.direct-url","20%",E=>E.url?E.url.length>20?`${E.url.slice(0,20)}\u2026`:E.url:"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("ota-update.copy-direct-url"),icon:"content_paste",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:E=>!!E.url,onAction:(E,w)=>w.url,type:Va.COPY_BUTTON}),new te("fileName","ota-update.file-name","20%"),new te("dataSize","ota-update.file-size","70px",E=>E.dataSize?this.fileSize.transform(E.dataSize):""),new te("checksum","ota-update.checksum","220px",E=>E.checksum?this.checksumText(E):"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("ota-update.copy-checksum"),icon:"content_paste",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:E=>!!E.checksum,onAction:(E,w)=>w.checksum,type:Va.COPY_BUTTON})),this.config.cellActionDescriptors.push({name:this.translate.instant("ota-update.download"),icon:"file_download",isEnabled:E=>E.hasData&&!E.url,onAction:(E,w)=>this.exportPackage(E,w)}),this.config.deleteEntityTitle=E=>this.translate.instant("ota-update.delete-ota-update-title",{title:E.title}),this.config.deleteEntityContent=()=>this.translate.instant("ota-update.delete-ota-update-text"),this.config.deleteEntitiesTitle=E=>this.translate.instant("ota-update.delete-ota-updates-title",{count:E}),this.config.deleteEntitiesContent=()=>this.translate.instant("ota-update.delete-ota-updates-text"),this.config.entitiesFetchFunction=E=>this.otaPackageService.getOtaPackages(E),this.config.loadEntity=E=>this.otaPackageService.getOtaPackageInfo(E.id),this.config.saveEntity=E=>this.otaPackageService.saveOtaPackage(E),this.config.deleteEntity=E=>this.otaPackageService.deleteOtaPackage(E.id),this.config.onEntityAction=E=>this.onPackageAction(E)}resolve(){return this.config.tableTitle=this.translate.instant("ota-update.packages-repository"),this.config}openOtaPackage(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["otaUpdates",n.id.id]);this.router.navigateByUrl(t)}exportPackage(e,n){e&&e.stopPropagation(),n.url?window.open(n.url,"_blank"):this.otaPackageService.downloadOtaPackage(n.id.id).subscribe()}checksumText(e){let n=`${ks.get(e.checksumAlgorithm)}: ${e.checksum}`;return n.length>20&&(n=`${n.slice(0,20)}\u2026`),n}onPackageAction(e){switch(e.action){case"open":return this.openOtaPackage(e.event,e.entity),!0;case"uploadPackage":return this.exportPackage(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(ie),N(Ge),N(P),N(L0),N(de),N(sf))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var Rh=[{path:"otaUpdates",data:{breadcrumb:{menuId:xe.otaUpdates}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"ota-update.ota-updates"},resolve:{entitiesTableConfig:Lm}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"memory"},auth:[M.TENANT_ADMIN],title:"ota-update.ota-updates"},resolve:{entitiesTableConfig:Lm}}]}],$M=[{path:"otaUpdates",pathMatch:"full",redirectTo:"/features/otaUpdates"},{path:"otaUpdates/:entityId",redirectTo:"/features/otaUpdates/:entityId"}],jm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Lm],imports:[j.forChild($M),j]})}}return i})();(function(){Y(jm,{imports:[j],exports:[j]})})();var Gm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,jm]})}}return i})();(function(){Y(Gm,{declarations:[Vm],imports:[ae,re,Ee,jm]})})();C();C();var Oh=[{path:"vc",component:di,canDeactivate:[Fe],data:{auth:[M.TENANT_ADMIN],title:"version-control.version-control",breadcrumb:{menuId:xe.version_control}}}],QM=[{path:"vc",redirectTo:"/features/vc"}],Um=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(QM),j]})}}return i})();(function(){Y(Um,{imports:[j],exports:[j]})})();var qm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Um]})}}return i})();(function(){Y(qm,{imports:[ae,re,Um]})})();C();C();function JM(i,m){if(i&1&&(a(0,"mat-tab",3,0),d(2,"translate"),f(3,"tb-audit-log-table",4),r()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),l("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function KM(i,m){if(i&1){let e=O();a(0,"mat-tab",3,1),d(2,"translate"),a(3,"tb-version-control",5),y("versionRestored",function(){x(e);let t=v();return I(t.entitiesTableConfig.updateData())}),r()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),l("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Wm=(()=>{class i extends Kt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-asset-profile-tabs"]],features:[G],decls:2,vars:2,consts:[["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,JM,4,6,"mat-tab",2)(1,KM,4,7,"mat-tab",2),n&2&&(l("ngIf",t.entity&&!t.isEdit),o(),l("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit))},dependencies:[V,Pt,Ci,di,k],encapsulation:2})}}return i})();C();C();var Hm=(()=>{class i{constructor(e,n,t,s,u,_,E,w){this.assetProfileService=e,this.importExport=n,this.homeDialogs=t,this.translate=s,this.datePipe=u,this.dialogService=_,this.router=E,this.dialog=w,this.config=new Qe,this.config.entityType=B.ASSET_PROFILE,this.config.entityComponent=Ng,this.config.entityTabsComponent=Wm,this.config.entityTranslations=$e.get(B.ASSET_PROFILE),this.config.entityResources=_t.get(B.ASSET_PROFILE),this.config.hideDetailsTabsOnEdit=!1,this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"150px"),new te("name","asset-profile.name","50%"),new te("description","asset-profile.description","50%"),new te("isDefault","asset-profile.default","60px",q=>Ot(q.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("asset-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(q,Te)=>this.exportAssetProfile(q,Te)},{name:this.translate.instant("asset-profile.set-default"),icon:"flag",isEnabled:q=>!q.default,onAction:(q,Te)=>this.setDefaultAssetProfile(q,Te)}),this.config.deleteEntityTitle=q=>this.translate.instant("asset-profile.delete-asset-profile-title",{assetProfileName:q.name}),this.config.deleteEntityContent=()=>this.translate.instant("asset-profile.delete-asset-profile-text"),this.config.deleteEntitiesTitle=q=>this.translate.instant("asset-profile.delete-asset-profiles-title",{count:q}),this.config.deleteEntitiesContent=()=>this.translate.instant("asset-profile.delete-asset-profiles-text"),this.config.entitiesFetchFunction=q=>this.assetProfileService.getAssetProfiles(q),this.config.loadEntity=q=>this.assetProfileService.getAssetProfile(q.id),this.config.saveEntity=q=>this.assetProfileService.saveAssetProfile(q),this.config.deleteEntity=q=>this.assetProfileService.deleteAssetProfile(q.id),this.config.onEntityAction=q=>this.onAssetProfileAction(q),this.config.deleteEnabled=q=>q&&!q.default,this.config.entitySelectionEnabled=q=>q&&!q.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("asset-profile.asset-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("asset-profile.create-asset-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:n=>this.config.getTable().addEntity(n)},{name:this.translate.instant("asset-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importAssetProfile(n)}),e}setDefaultAssetProfile(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset-profile.set-default-asset-profile-title",{assetProfileName:n.name}),this.translate.instant("asset-profile.set-default-asset-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetProfileService.setDefaultAssetProfile(n.id.id).subscribe(()=>{this.config.updateData()})})}openAssetProfile(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["profiles","assetProfiles",n.id.id]);this.router.navigateByUrl(t)}importAssetProfile(e){this.importExport.importAssetProfile().subscribe(n=>{n&&this.config.updateData()})}exportAssetProfile(e,n){e&&e.stopPropagation(),this.importExport.exportAssetProfile(n.id.id)}onAssetProfileAction(e){switch(e.action){case"open":return this.openAssetProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultAssetProfile(e.event,e.entity),!0;case"export":return this.exportAssetProfile(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(H0),N(Gi),N(Ui),N(ie),N(Ge),N(Lt),N(de),N(je))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var Bh=[{path:"assetProfiles",data:{breadcrumb:{menuId:xe.asset_profiles}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN],title:"asset-profile.asset-profiles"},resolve:{entitiesTableConfig:Hm}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"mdi:alpha-a-box"},auth:[M.TENANT_ADMIN],title:"asset-profile.asset-profiles"},resolve:{entitiesTableConfig:Hm}}]}],Gc=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Hm]})}}return i})();var zm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Gc]})}}return i})();(function(){Y(zm,{declarations:[Wm],imports:[ae,re,Ee,Gc]})})();C();C();var YM=[{path:"profiles",data:{auth:[M.TENANT_ADMIN],breadcrumb:{menuId:xe.profiles}},children:[{path:"",children:[],data:{auth:[M.TENANT_ADMIN],redirectTo:"/profiles/deviceProfiles"}},...kh,...Bh]}],$m=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(YM),j]})}}return i})();(function(){Y($m,{imports:[j],exports:[j]})})();var Qm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,$m]})}}return i})();(function(){Y(Qm,{imports:[ae,re,$m]})})();C();C();var XM=[{path:"alarms",component:Ei,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],title:"alarm.alarms",breadcrumb:{menuId:xe.alarms},isPage:!0,alarmsMode:Tu.ALL}}],Jm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(XM),j]})}}return i})();(function(){Y(Jm,{imports:[j],exports:[j]})})();var Km=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Mi,Jm]})}}return i})();(function(){Y(Km,{imports:[ae,re,Ee,Mi,Jm]})})();C();C();C();var ZM="/api/resource/dashboard/system/gateways_dashboard.json",e3=(i,m,e=Zt(Na))=>e.loadJsonResource(ZM),Vh=[{path:"gateways",component:dl,data:{auth:[M.TENANT_ADMIN],title:"gateway.gateways",breadcrumb:{menuId:xe.gateways}},resolve:{dashboard:e3}}],t3=[{path:"gateways",pathMatch:"full",redirectTo:"/entities/gateways"}],Ym=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(t3),j]})}}return i})();(function(){Y(Ym,{imports:[j],exports:[j]})})();var i3=[{path:"entities",data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],breadcrumb:{skip:!0}},children:[{path:"",children:[],data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER],redirectTo:"/entities/devices"}},...Dh,...Ph,...Fh,...Vh]}],Xm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(i3),j]})}}return i})();(function(){Y(Xm,{imports:[j],exports:[j]})})();var Zm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Xm]})}}return i})();(function(){Y(Zm,{imports:[ae,re,Xm]})})();C();C();var n3=[{path:"features",data:{auth:[M.TENANT_ADMIN],breadcrumb:{menuId:xe.features}},children:[{path:"",children:[],data:{auth:[M.TENANT_ADMIN],redirectTo:"/features/otaUpdates"}},...Rh,...Oh]}],ed=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(n3),j]})}}return i})();(function(){Y(ed,{imports:[j],exports:[j]})})();var td=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,ed]})}}return i})();(function(){Y(td,{imports:[ae,re,ed]})})();C();C();C();C();var id=(()=>{class i extends Jt{constructor(e){super(e),this.store=e}changeUnreadOnly(e){this.entitiesTableConfig.componentsData.unreadOnly=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-inbox-table-header"]],features:[G],decls:8,vars:9,consts:[[1,"flex","flex-full","flex-row","items-center","justify-start"],[1,"tb-notification-unread-toggle-group",2,"width","180px",3,"ngModelChange","ngModel"],[1,"flex-1",3,"value"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"mat-button-toggle-group",1),y("ngModelChange",function(u){return t.changeUnreadOnly(u)}),a(2,"mat-button-toggle",2),p(3),d(4,"translate"),r(),a(5,"mat-button-toggle",2),p(6),d(7,"translate"),r()()()),n&2&&(o(),l("ngModel",t.entitiesTableConfig.componentsData.unreadOnly),o(),l("value",!0),o(),R(c(4,5,"notification.unread")),o(2),l("value",!1),o(),R(c(7,7,"notification.all")))},dependencies:[Ea,wa,W,ut,k],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard{border:none;border-radius:14px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle{border-left:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle{background:#0000000f;height:28px;align-items:center;display:flex}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle .mat-button-toggle-ripple{inset:2px;border-radius:14px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-button{color:#959595}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-focus-overlay{border-radius:14px;margin:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked .mat-button-toggle-button{background-color:#359b07;color:#fff;border-radius:14px;margin-left:2px;margin-right:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content{line-height:24px;font-size:14px;font-weight:500;letter-spacing:.25px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content .mat-pseudo-checkbox{display:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.01}']})}}return i})();C();var nd=(()=>{class i extends et{constructor(e,n,t,s){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=s,this.notification=s.notification}markAsRead(e){this.dialogRef.close(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze),g(Mt))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-inbox-notification-dialog"]],features:[G],decls:1,vars:1,consts:[[3,"markAsRead","notification"]],template:function(n,t){n&1&&(a(0,"tb-notification",0),y("markAsRead",function(u){return t.markAsRead(u)}),r()),n&2&&l("notification",t.notification)},dependencies:[Cf],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;max-width:400px;min-width:350px;padding:2px}']})}}return i})();var Uc=(()=>{class i{constructor(e,n,t,s,u){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=s,this.utilsService=u,this.config=new Qe,this.config.entityType=B.NOTIFICATION,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=$e.get(B.NOTIFICATION),this.config.entityResources={},this.config.deleteEntityTitle=()=>this.translate.instant("notification.delete-notification-title"),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-notification-text"),this.config.deleteEntitiesTitle=_=>this.translate.instant("notification.delete-notifications-title",{count:_}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-notifications-text"),this.config.deleteEntity=_=>this.notificationService.deleteNotification(_.id),this.config.entitiesFetchFunction=_=>this.notificationService.getNotifications(_,this.config.componentsData.unreadOnly),this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.handleRowClick=(_,E)=>(this.showNotification(_,E),!0),this.config.componentsData={unreadOnly:!0},this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=id,this.config.headerActionDescriptors=[{name:this.translate.instant("notification.mark-all-as-read"),icon:"done_all",isEnabled:()=>!0,onAction:_=>this.markAllRead(_)}],this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("type","notification.type","10%",_=>this.translate.instant(Qa.get(_.type).name)),new te("subject","notification.subject","30%",_=>this.utilsService.customTranslation(_.subject,_.subject)),new te("text","notification.message","60%",_=>this.utilsService.customTranslation(_.text,_.text)))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.mark-as-read"),icon:"check_circle_outline",isEnabled:e=>e.status!==nc.READ,onAction:(e,n)=>this.markAsRead(e,n)}]}markAllRead(e){e&&e.stopPropagation(),this.notificationService.markAllNotificationsAsRead().subscribe(()=>{this.config.componentsData.unreadOnly?this.config.getTable().resetSortAndFilter(!0):this.config.updateData()})}markAsRead(e,n){e&&e.stopPropagation(),this.notificationService.markNotificationAsRead(n.id.id).subscribe(()=>{this.config.componentsData.unreadOnly?this.config.getTable().dataSource.pageData$.pipe(gi(1)).subscribe(t=>{t.data.length===1&&this.config.getTable().pageLink.page?this.config.getTable().paginator.previousPage():this.config.updateData()}):(n.status=nc.READ,this.config.getTable().detectChanges())})}showNotification(e,n){e&&e.stopPropagation(),this.dialog.open(nd,{disableClose:!1,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{notification:n}}).afterClosed().subscribe(t=>{t&&this.markAsRead(null,n)})}static{this.\u0275fac=function(n){return new(n||i)(N(Ii),N(ie),N(je),N(Ge),N(Ca))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();function o3(i,m){if(i&1&&(a(0,"tr")(1,"td")(2,"mat-chip"),p(3),r()(),a(4,"td",9),p(5),r()()),i&2){let e=m.$implicit;o(3),R(e.key),o(2),R(e.value)}}function a3(i,m){i&1&&f(0,"mat-divider")}function r3(i,m){if(i&1&&(a(0,"div")(1,"h6"),p(2),d(3,"translate"),r(),a(4,"table",7),b(5,o3,6,2,"tr",6),d(6,"keyvalue"),r(),b(7,a3,1,0,"mat-divider",8),r()),i&2){let e=m.$implicit,n=m.last,t=v();o(2),R(c(3,3,t.NotificationDeliveryMethodInfoMap.get(e.key).name)),o(3),l("ngForOf",c(6,5,e.value)),o(2),l("ngIf",!n)}}var od=(()=>{class i extends et{constructor(e,n,t,s){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=s,this.NotificationDeliveryMethodInfoMap=za,this.errorStats=s.notificationRequest.stats.errors}cancel(){this.dialogRef.close(null)}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze),g(Mt))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-notification-send-error-dialog"]],features:[G],decls:10,vars:3,consts:[["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],[4,"ngFor","ngForOf"],[1,"tb-table-list"],[4,"ngIf"],[1,"tb-row-error"]],template:function(n,t){n&1&&(a(0,"mat-toolbar",0)(1,"h2",1),p(2,"notification.failed-send"),r(),f(3,"span",2),a(4,"button",3),y("click",function(){return t.cancel()}),a(5,"mat-icon",4),p(6,"close"),r()()(),a(7,"div",5),b(8,r3,8,7,"div",6),d(9,"keyvalue"),r()),n&2&&(o(8),l("ngForOf",c(9,1,t.errorStats)))},dependencies:[we,V,Ce,ee,He,Je,xi,Ma,H,ts,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;width:600px;max-width:100%;color:#000000de}[_nghost-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:500;font-size:16px;line-height:20px;margin-top:0}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]{table-layout:fixed;width:100%;border:hidden;border-collapse:collapse}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:8px solid transparent;border-collapse:collapse;font-size:14px}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]   .tb-row-error[_ngcontent-%COMP%]{word-wrap:break-word}[_nghost-%COMP%]   .mat-divider[_ngcontent-%COMP%]{margin:24px 0}']})}}return i})();var qc=(()=>{class i{constructor(e,n,t,s){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=s,this.config=new Qe,this.config.entityType=B.NOTIFICATION_REQUEST,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.searchEnabled=!1,this.config.entityTranslations=$e.get(B.NOTIFICATION_REQUEST),this.config.entityResources={},this.config.deleteEntityTitle=()=>this.translate.instant("notification.delete-request-title"),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-request-text"),this.config.deleteEntitiesTitle=u=>this.translate.instant("notification.delete-requests-title",{count:u}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-requests-text"),this.config.deleteEntity=u=>this.notificationService.deleteNotificationRequest(u.id),this.config.entitiesFetchFunction=u=>this.notificationService.getNotificationRequests(u),this.config.cellActionDescriptors=this.configureCellActions(),this.config.onEntityAction=u=>this.onRequestAction(u),this.config.handleRowClick=(u,_)=>((u.target.getElementsByClassName("stats").length||u.target.className==="stats")&&this.openStatsErrorDialog(u,_),!0),this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("status","notification.status","15%",u=>`<span style="display: flex;">${this.requestStatus(u.status)}${this.requestStats(u.stats)}</span>`,u=>this.requestStatusStyle(u.status)),new te("deliveryMethods","notification.delivery-method.delivery-method","15%",u=>u.deliveryMethods.map(_=>this.translate.instant(za.get(_).name)).join(", "),()=>({}),!1),new te("templateName","notification.template","70%"))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.notify-again"),icon:"mdi:repeat-variant",isEnabled:e=>e.status!==$a.SCHEDULED,onAction:(e,n)=>this.createRequest(e,n)}]}createRequest(e,n,t=!1,s=!0){e&&e.stopPropagation(),this.dialog.open(ml,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:t,request:n}}).afterClosed().subscribe(u=>{u&&s&&this.config.updateData()})}onRequestAction(e){switch(e.action){case"add":return this.createRequest(e.event,e.entity,!0),!0;case"add-without-update":return this.createRequest(e.event,e.entity,!0,!1),!0}return!1}requestStatus(e){let n=yf.get(e),t="rgba(25, 128, 56, 0.08)";switch(e){case $a.SCHEDULED:t="rgba(48, 86, 128, 0.08)";break;case $a.PROCESSING:t="rgba(212, 125, 24, 0.08)";break}return`<div style="border-radius: 12px; height: 24px; line-height: 24px; padding: 0 10px;
                        width: fit-content; background-color: ${t}">
                ${this.translate.instant(n)}
            </div>`}requestStats(e){if(!e?.errors)return"";let n=e.totalErrors;return n===0?"":`<div style="border-radius: 12px; height: 24px; line-height: 24px; padding: 0 10px; width: max-content; cursor: pointer;
                        background-color: #D12730; color: #fff; font-weight: 500; margin-left: 8px" class="stats">
                ${this.translate.instant("notification.fails",{count:n})} >
            </div>`}requestStatusStyle(e){let n={fontSize:"14px",color:"#198038"};switch(e){case $a.SCHEDULED:n.color="#305680";break;case $a.PROCESSING:n.color="#D47D18";break}return n}openStatsErrorDialog(e,n){e&&e.stopPropagation(),this.dialog.open(od,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{notificationRequest:n}}).afterClosed().subscribe(()=>{})}static{this.\u0275fac=function(n){return new(n||i)(N(Ii),N(ie),N(je),N(Ge))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();var ad=(()=>{class i extends Jt{constructor(e){super(e),this.store=e}createTarget(e){this.entitiesTableConfig.onEntityAction({event:e,action:"add",entity:null})}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-recipient-table-header"]],features:[G],decls:7,vars:3,consts:[[1,"flex","flex-full","flex-row","items-center","justify-end"],["mat-stroked-button","","color","primary",3,"click"],[1,"flex","flex-row","items-center","justify-start"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),y("click",function(u){return t.createTarget(u)}),a(2,"div",2)(3,"mat-icon"),p(4,"add"),r(),p(5),d(6,"translate"),r()()()),n&2&&(o(5),h("",c(6,1,"notification.add-recipients")," "))},dependencies:[K,ee,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:10000px}']})}}return i})();var Wc=(()=>{class i{constructor(e,n,t,s){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=s,this.config=new Qe,this.config.entityType=B.NOTIFICATION_TARGET,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=$e.get(B.NOTIFICATION_TARGET),this.config.entityResources={},this.config.entitiesFetchFunction=u=>this.notificationService.getNotificationTargets(u),this.config.deleteEntityTitle=u=>this.translate.instant("notification.delete-recipient-title",{recipientName:u.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-recipient-text"),this.config.deleteEntitiesTitle=u=>this.translate.instant("notification.delete-recipients-title",{count:u}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-recipients-text"),this.config.deleteEntity=u=>this.notificationService.deleteNotificationTarget(u.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=ad,this.config.onEntityAction=u=>this.onTargetAction(u),this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.handleRowClick=(u,_)=>(this.editTarget(u,_),!0),this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("name","notification.recipient-group","20%"),new te("configuration.type","notification.type","20%",u=>this.translate.instant(vf.get(u.configuration.type)),()=>({}),!1),new te("configuration.description","notification.description","60%",u=>u.configuration.description||"",()=>({}),!1))}resolve(e){return this.config}configureCellActions(){return[]}editTarget(e,n,t=!1){e&&e.stopPropagation(),this.dialog.open(Mo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:t,target:n}}).afterClosed().subscribe(s=>{s&&this.config.updateData()})}onTargetAction(e){switch(e.action){case"add":return this.editTarget(e.event,e.entity,!0),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(Ii),N(ie),N(je),N(Ge))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();var rd=(()=>{class i extends Jt{constructor(e){super(e),this.store=e}createTemplate(e){this.entitiesTableConfig.onEntityAction({event:e,action:"add",entity:null})}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-template-table-header"]],features:[G],decls:7,vars:3,consts:[[1,"flex","flex-full","flex-row","items-center","justify-end"],["mat-stroked-button","","color","primary",3,"click"],[1,"flex","flex-row","items-center","justify-start"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),y("click",function(u){return t.createTemplate(u)}),a(2,"div",2)(3,"mat-icon"),p(4,"add"),r(),p(5),d(6,"translate"),r()()()),n&2&&(o(5),h("",c(6,1,"notification.add-template")," "))},dependencies:[K,ee,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:10000px}']})}}return i})();var Hc=(()=>{class i{constructor(e,n,t,s){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=s,this.config=new Qe,this.config.entityType=B.NOTIFICATION_TEMPLATE,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=$e.get(B.NOTIFICATION_TEMPLATE),this.config.entityResources={},this.config.entitiesFetchFunction=u=>this.notificationService.getNotificationTemplates(u),this.config.deleteEntityTitle=u=>this.translate.instant("notification.delete-template-title",{templateName:u.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-template-text"),this.config.deleteEntitiesTitle=u=>this.translate.instant("notification.delete-templates-title",{count:u}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-templates-text"),this.config.deleteEntity=u=>this.notificationService.deleteNotificationTemplate(u.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=rd,this.config.onEntityAction=u=>this.onTemplateAction(u),this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.handleRowClick=(u,_)=>(this.editTemplate(u,_),!0),this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("notificationType","notification.type","20%",u=>this.translate.instant(Qa.get(u.notificationType).name)),new te("name","notification.template","80%"))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.copy-template"),icon:"content_copy",isEnabled:()=>!0,onAction:(e,n)=>this.editTemplate(e,n,!1,!0)}]}editTemplate(e,n,t=!1,s=!1){e&&e.stopPropagation(),this.dialog.open(Ir,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:t,isCopy:s,template:n}}).afterClosed().subscribe(u=>{u&&this.config.updateData()})}onTemplateAction(e){switch(e.action){case"add":return this.editTemplate(e.event,e.entity,!0),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(N(Ii),N(ie),N(je),N(Ge))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();C();C();var sd=(()=>{class i extends Jt{constructor(e){super(e),this.store=e}createTarget(e){this.entitiesTableConfig.onEntityAction({event:e,action:"add",entity:null})}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-rule-table-header"]],features:[G],decls:7,vars:3,consts:[[1,"flex","flex-full","flex-row","items-center","justify-end"],["mat-stroked-button","","color","primary",3,"click"],[1,"flex","flex-row","items-center","justify-start"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"button",1),y("click",function(u){return t.createTarget(u)}),a(2,"div",2)(3,"mat-icon"),p(4,"add"),r(),p(5),d(6,"translate"),r()()()),n&2&&(o(5),h("",c(6,1,"notification.add-rule")," "))},dependencies:[K,ee,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:10000px}']})}}return i})();C();C();C();function s3(i,m){i&1&&(a(0,"div",8),p(1,"notification.first-recipient"),r())}function l3(i,m){i&1&&(a(0,"div",9)(1,"span",10),p(2,"notification.after"),r(),f(3,"tb-timeinterval",11),a(4,"span",12),p(5,"notification.notify"),r()())}var ld=(()=>{class i{constructor(e,n){this.fb=e,this.dialog=n,this.systemEscalation=!1,this.entityType=B,this.notificationType=_f,this.propagateChange=null,this.propagateChangePending=!1,this.destroy$=new Ft}registerOnChange(e){this.propagateChange=e,this.propagateChangePending&&(this.propagateChangePending=!1,setTimeout(()=>{this.propagateChange(this.modelValue)},0))}registerOnTouched(e){}ngOnInit(){this.escalationFormGroup=this.fb.group({delayInSec:[0],targets:[null,S.required]}),this.escalationFormGroup.valueChanges.pipe(dt(this.destroy$)).subscribe(()=>this.updateModel())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.escalationFormGroup.disable({emitEvent:!1}):this.escalationFormGroup.enable({emitEvent:!1})}writeValue(e){this.propagateChangePending=!1,this.modelValue=e,this.modelValue.delayInSec=+e.delayInSec,Re(this.modelValue)&&this.escalationFormGroup.patchValue(this.modelValue,{emitEvent:!1}),!this.disabled&&!this.escalationFormGroup.valid&&this.updateModel()}createTarget(e,n){e&&e.stopPropagation(),n._elementRef.nativeElement.blur(),this.dialog.open(Mo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(t=>{if(t){let s=this.escalationFormGroup.get("targets").value;s||(s=[]),s.push(t.id.id),this.escalationFormGroup.get("targets").patchValue(s)}})}validate(e){return this.escalationFormGroup.valid?null:{escalation:{valid:!1}}}updateModel(){let e=this.escalationFormGroup.value;this.modelValue=_e(_e({},this.modelValue),e),this.propagateChange?this.propagateChange(this.modelValue):this.propagateChangePending=!0}static{this.\u0275fac=function(n){return new(n||i)(g(ht),g(je))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-escalation-form"]],inputs:{disabled:"disabled",systemEscalation:"systemEscalation"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:12,vars:13,consts:[["selectTime",""],["createTargetButton",""],[1,"flex","flex-col",3,"formGroup"],[1,"escalation","flex","flex-row","items-center","justify-center","xs:flex-col","xs:items-stretch","xs:justify-start"],["class","flex-1","translate","",4,"ngIf","ngIfElse"],["required","","formControlName","targets","subscriptSizing","dynamic",1,"flex-full","xs:max-h-60%","gt-xs:max-w-60%",3,"entityType","subType","placeholderText"],["mat-button","","matSuffix","",3,"click"],[2,"white-space","nowrap"],["translate","",1,"flex-1"],[1,"flex","flex-1","flex-row","items-center","justify-center","xs:flex-col"],["translate",""],["subscriptSizing","dynamic","formControlName","delayInSec","min","60000","max","604800000","disabledAdvanced",""],["translate","",1,"escalation-notify","flex-1"]],template:function(n,t){if(n&1){let s=O();a(0,"form",2)(1,"div",3),b(2,s3,2,0,"div",4)(3,l3,6,0,"ng-template",null,0,xt),a(5,"tb-entity-list",5),d(6,"translate"),a(7,"button",6,1),y("click",function(_){x(s);let E=U(8);return I(t.createTarget(_,E))}),a(9,"span",7),p(10),d(11,"translate"),r()()()()()}if(n&2){let s=U(4);l("formGroup",t.escalationFormGroup),o(2),l("ngIf",t.systemEscalation)("ngIfElse",s),o(3),T("entityType",t.entityType.NOTIFICATION_TARGET),T("subType",t.notificationType.ALARM),l("placeholderText",t.escalationFormGroup.get("targets").value?"":c(6,9,"notification.add-recipient")),o(2),L("!hidden",t.disabled),o(3),R(c(11,11,"notification.create-new"))}},dependencies:[V,u0,So,K,ei,fe,W,z,ce,X,oe,H,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%]{height:100%;min-height:74px;max-height:100%;border-radius:8px;background:#0000000a;padding:0 10px}[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-right:10px}[_nghost-%COMP%]   .escalation-notify[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   tb-timeinterval[_ngcontent-%COMP%]{min-width:100px;padding:0 10px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding:10px 0 0}[_nghost-%COMP%]   tb-timeinterval[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]     .mat-mdc-form-field{min-width:100px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-form-field-infix{width:100%}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-select{min-width:110px!important}']})}}return i})();function m3(i,m){i&1&&f(0,"span",8)}function d3(i,m){if(i&1){let e=O();a(0,"button",9),d(1,"translate"),y("click",function(){x(e);let t=v().index,s=v();return I(s.removeEscalation(t))}),a(2,"mat-icon"),p(3,"close"),r()()}i&2&&T("matTooltip",c(1,1,"action.remove"))}function c3(i,m){if(i&1&&(a(0,"div",4),f(1,"tb-escalation-form",5),b(2,m3,1,0,"span",6)(3,d3,4,3,"button",7),r()),i&2){let e=m.$implicit,n=m.index,t=m.last,s=v();L("pb-2",!t),o(),l("formControl",e)("systemEscalation",n===0),o(),l("ngIf",n===0),o(),l("ngIf",n!==0&&!s.disabled)}}function u3(i,m){i&1&&(a(0,"div")(1,"span",10),p(2,"notification.no-rule"),r()())}function f3(i,m){if(i&1){let e=O();a(0,"div",11)(1,"button",12),y("click",function(){x(e);let t=v();return I(t.addEscalation())}),a(2,"span",13),p(3,"notification.add-stage"),r()()()}}var oa=class i{constructor(m,e){this.store=m,this.fb=e,this.destroy$=new Ft,this.propagateChange=n=>{}}registerOnChange(m){this.propagateChange=m}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}registerOnTouched(m){}ngOnInit(){this.escalationsFormGroup=this.fb.group({escalations:this.fb.array([])}),this.escalationsFormGroup.valueChanges.pipe(dt(this.destroy$)).subscribe(()=>this.updateModel())}get escalationsFormArray(){return this.escalationsFormGroup.get("escalations")}setDisabledState(m){this.disabled=m,this.disabled?this.escalationsFormGroup.disable({emitEvent:!1}):this.escalationsFormGroup.enable({emitEvent:!1})}writeValue(m){let e=[];for(let n in m)e.push({delayInSec:Number(n)*1e3,targets:m[n]});if(e.length===0)this.addEscalation(0);else if(e?.length===this.escalationsFormArray.length)this.escalationsFormArray.patchValue(e,{emitEvent:!1});else{let n=[];e.forEach(t=>{n.push(this.fb.control(t,[S.required]))}),this.escalationsFormGroup.setControl("escalations",this.fb.array(n),{emitEvent:!1}),this.disabled?this.escalationsFormGroup.disable({emitEvent:!1}):this.escalationsFormGroup.enable({emitEvent:!1})}}removeEscalation(m){this.escalationsFormGroup.get("escalations").removeAt(m)}addEscalation(m=36e5){let e={delayInSec:m,targets:null};this.escalationsFormGroup.get("escalations").push(this.fb.control(e,[]),{emitEvent:!1})}validate(m){return this.escalationsFormGroup.valid?null:{escalation:{valid:!1}}}updateModel(){let m={};this.escalationsFormGroup.get("escalations").value.forEach(e=>m[e.delayInSec/1e3]=e.targets),this.propagateChange(m)}static{this.\u0275fac=function(e){return new(e||i)(g(P),g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-escalations-component"]],inputs:{required:"required",disabled:"disabled"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}])],decls:4,vars:3,consts:[[1,"flex","flex-col"],["class","tb-tenant-profile-queues flex flex-row items-center",3,"pb-2",4,"ngFor","ngForOf"],[4,"ngIf"],["style","padding: 16px 0;",4,"ngIf"],[1,"tb-tenant-profile-queues","flex","flex-row","items-center"],[1,"flex-1",3,"formControl","systemEscalation"],["style","width: 48px;",4,"ngIf"],["mat-icon-button","","style","min-width: 40px;","type","button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[2,"width","48px"],["mat-icon-button","","type","button","matTooltipPosition","above",2,"min-width","40px",3,"click","matTooltip"],["translate","",1,"tb-prompt","flex","items-center","justify-center"],[2,"padding","16px 0"],["mat-raised-button","","color","primary","type","button",3,"click"],["translate",""]],template:function(e,n){e&1&&(a(0,"div",0),b(1,c3,4,6,"div",1)(2,u3,3,0,"div",2)(3,f3,4,0,"div",3),r()),e&2&&(o(),l("ngForOf",n.escalationsFormArray.controls),o(),l("ngIf",!n.escalationsFormArray.controls.length),o(),l("ngIf",!n.disabled))},dependencies:[we,V,K,Ce,ee,Dt,W,Yt,H,ld,k],encapsulation:2})}};Kn([io(),Yn("design:type",Boolean)],oa.prototype,"required",void 0);var h3=["addNotificationRule"];function b3(i,m){i&1&&f(0,"mat-progress-bar",31)}function v3(i,m){i&1&&f(0,"div",32)}function y3(i,m){i&1&&(a(0,"mat-icon"),p(1,"check"),r())}function _3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.basic-settings"))}function C3(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"notification.rule-name-required")," "))}function S3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.triggerTypeTranslationMap.get(e))," ")}}function T3(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"notification.trigger.trigger-required")," "))}function x3(i,m){if(i&1){let e=O();a(0,"section",34)(1,"tb-entity-list",35),d(2,"translate"),d(3,"translate"),d(4,"translate"),a(5,"button",36,3),y("click",function(t){x(e);let s=U(6),u=v();return I(u.createTarget(t,s))}),a(7,"span",37),p(8),d(9,"translate"),r()()()()}if(i&2){let e=v();o(),T("subType",e.ruleNotificationForm.get("triggerType").value),T("entityType",e.entityType.NOTIFICATION_TARGET),T("labelText",c(2,6,"notification.recipients")),T("requiredText",c(3,8,"notification.recipients-required")),T("placeholderText",c(4,10,"notification.recipient")),o(7),R(c(9,12,"notification.create-new"))}}function I3(i,m){i&1&&At(0)}function E3(i,m){if(i&1&&(a(0,"fieldset",38)(1,"legend",19),p(2,"notification.escalation-chain"),r(),a(3,"div",39),p(4,"notification.recipients"),r(),f(5,"tb-escalations-component",40),b(6,I3,1,0,"ng-container",41),r()),i&2){v();let e=U(40);o(6),l("ngTemplateOutlet",e)}}function w3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.alarmSearchStatusTranslationMap.get(e))," ")}}function M3(i,m){if(i&1&&(a(0,"form",17)(1,"section",42)(2,"section",43)(3,"div",39),p(4,"notification.stop-escalation-alarm-status-become"),r(),a(5,"mat-form-field",44)(6,"mat-label",19),p(7,"alarm.alarm-status-list"),r(),a(8,"mat-select",45),d(9,"translate"),b(10,w3,3,4,"mat-option",24),r()()()()()),i&2){let e,n=v();l("formGroup",n.alarmTemplateForm),o(8),T("placeholder",(e=n.alarmTemplateForm.get("triggerConfig.clearRule.alarmStatuses").value)!=null&&e.length?"":c(9,3,"alarm.any-status")),o(2),l("ngForOf",n.alarmSearchStatuses)}}function D3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.alarm-trigger-settings"))}function P3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.alarmSeverityTranslationMap.get(e))," ")}}function F3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.alarmActionTranslationMap.get(e))," ")}}function A3(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"notification.notify-on-required")," "))}function N3(i,m){if(i&1&&(a(0,"mat-step",15),b(1,D3,2,3,"ng-template",16),a(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),r(),f(7,"tb-string-items-list",47),d(8,"translate"),d(9,"translate"),a(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),r(),a(13,"mat-select",49),d(14,"translate"),b(15,P3,3,4,"mat-option",24),r()()(),a(16,"mat-form-field",50)(17,"mat-label",19),p(18,"notification.notify-on"),r(),a(19,"mat-select",51),b(20,F3,3,4,"mat-option",24),r(),b(21,A3,3,3,"mat-error",21),r()()(),a(22,"form",17)(23,"section",52)(24,"mat-form-field",18)(25,"mat-label",19),p(26,"notification.description"),r(),f(27,"input",53),r()()()()),i&2){let e,n,t=v();l("stepControl",t.alarmTemplateForm),o(2),l("formGroup",t.alarmTemplateForm),o(5),T("label",c(8,9,"alarm.alarm-type-list")),T("placeholder",(e=t.alarmTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&e.length?"":c(9,11,"alarm.any-type")),o(6),T("placeholder",(n=t.alarmTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&n.length?"":c(14,13,"alarm.any-severity")),o(2),l("ngForOf",t.alarmSeverities),o(5),l("ngForOf",t.alarmActions),o(),l("ngIf",t.alarmTemplateForm.get("triggerConfig.notifyOn").hasError("required")),o(),l("formGroup",t.ruleNotificationForm)}}function k3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.device-activity-trigger-settings"))}function R3(i,m){if(i&1&&(Ut(0),f(1,"tb-entity-list",58),d(2,"translate"),d(3,"translate"),d(4,"translate"),qt()),i&2){let e=v(2);o(),T("labelText",c(2,4,"device.devices")),T("placeholderText",c(3,6,"device.devices")),T("hint",c(4,8,"notification.device-list-rule-hint")),l("entityType",e.entityType.DEVICE)}}function O3(i,m){if(i&1&&(f(0,"tb-entity-list",59),d(1,"translate"),d(2,"translate"),d(3,"translate")),i&2){let e=v(2);T("labelText",c(1,4,"device-profile.device-profiles")),T("placeholderText",c(2,6,"device-profile.device-profiles")),T("hint",c(3,8,"notification.device-profiles-list-rule-hint")),l("entityType",e.entityType.DEVICE_PROFILE)}}function B3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.deviceEventTranslationMap.get(e))," ")}}function V3(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"notification.notify-on-required")," "))}function L3(i,m){if(i&1&&(a(0,"mat-step",15),b(1,k3,2,3,"ng-template",16),a(2,"form",17)(3,"section",42)(4,"div",54)(5,"mat-button-toggle-group",55)(6,"mat-button-toggle",56),p(7),d(8,"translate"),r(),a(9,"mat-button-toggle",56),p(10),d(11,"translate"),r()()(),b(12,R3,5,10,"ng-container",57)(13,O3,4,10,"ng-template",null,4,xt),a(15,"mat-form-field",50)(16,"mat-label",19),p(17,"notification.notify-on"),r(),a(18,"mat-select",51),b(19,B3,3,4,"mat-option",24),r(),b(20,V3,3,3,"mat-error",21),r()()(),a(21,"form",17)(22,"section",52)(23,"mat-form-field",18)(24,"mat-label",19),p(25,"notification.description"),r(),f(26,"input",53),r()()()()),i&2){let e=U(14),n=v();l("stepControl",n.deviceInactivityTemplateForm),o(2),l("formGroup",n.deviceInactivityTemplateForm),o(4),l("value",!0),o(),R(c(8,11,"device.device")),o(2),l("value",!1),o(),R(c(11,13,"device-profile.device-profile")),o(2),l("ngIf",n.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").value)("ngIfElse",e),o(7),l("ngForOf",n.deviceEvents),o(),l("ngIf",n.deviceInactivityTemplateForm.get("triggerConfig.notifyOn").hasError("required")),o(),l("formGroup",n.ruleNotificationForm)}}function j3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.entity-action-trigger-settings"))}function G3(i,m){if(i&1&&(a(0,"mat-step",15),b(1,j3,2,3,"ng-template",16),a(2,"form",17)(3,"fieldset",60)(4,"legend",19),p(5,"notification.filter"),r(),f(6,"tb-entity-type-list",61),a(7,"section",62)(8,"span",63),p(9,"notification.status"),r(),a(10,"mat-slide-toggle",64),p(11),d(12,"translate"),r(),a(13,"mat-slide-toggle",65),p(14),d(15,"translate"),r(),a(16,"mat-slide-toggle",66),p(17),d(18,"translate"),r()()()(),a(19,"form",17)(20,"section",52)(21,"mat-form-field",18)(22,"mat-label",19),p(23,"notification.description"),r(),f(24,"input",53),r()()()()),i&2){let e=v();l("stepControl",e.entityActionTemplateForm),o(2),l("formGroup",e.entityActionTemplateForm),o(4),l("allowedEntityTypes",e.allowEntityTypeForEntityAction),o(5),R(c(12,7,"notification.created")),o(3),R(c(15,9,"notification.updated")),o(3),R(c(18,11,"notification.deleted")),o(2),l("formGroup",e.ruleNotificationForm)}}function U3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.alarm-comment-trigger-settings"))}function q3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.alarmSeverityTranslationMap.get(e))," ")}}function W3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.alarmSearchStatusTranslationMap.get(e))," ")}}function H3(i,m){if(i&1&&(a(0,"mat-step",15),b(1,U3,2,3,"ng-template",16),a(2,"form",17)(3,"section",42)(4,"fieldset",67)(5,"legend",19),p(6,"notification.filter"),r(),f(7,"tb-string-items-list",47),d(8,"translate"),d(9,"translate"),a(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),r(),a(13,"mat-select",49),d(14,"translate"),b(15,q3,3,4,"mat-option",24),r()(),a(16,"mat-form-field",48)(17,"mat-label",19),p(18,"alarm.alarm-status-list"),r(),a(19,"mat-select",45),d(20,"translate"),b(21,W3,3,4,"mat-option",24),r()()(),a(22,"section",68)(23,"mat-slide-toggle",69),p(24),d(25,"translate"),r(),a(26,"mat-slide-toggle",70),p(27),d(28,"translate"),r()()()(),a(29,"form",17)(30,"section",52)(31,"mat-form-field",18)(32,"mat-label",19),p(33,"notification.description"),r(),f(34,"input",53),r()()()()),i&2){let e,n,t,s=v();l("stepControl",s.alarmCommentTemplateForm),o(2),l("formGroup",s.alarmCommentTemplateForm),o(5),T("label",c(8,11,"alarm.alarm-type-list")),T("placeholder",(e=s.alarmCommentTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&e.length?"":c(9,13,"alarm.any-type")),o(6),T("placeholder",(n=s.alarmCommentTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&n.length?"":c(14,15,"alarm.any-severity")),o(2),l("ngForOf",s.alarmSeverities),o(4),T("placeholder",(t=s.alarmCommentTemplateForm.get("triggerConfig.alarmStatuses").value)!=null&&t.length?"":c(20,17,"alarm.any-status")),o(2),l("ngForOf",s.alarmSearchStatuses),o(3),h(" ",c(25,19,"notification.notify-only-user-comments")," "),o(3),h(" ",c(28,21,"notification.notify-on-comment-update")," "),o(2),l("formGroup",s.ruleNotificationForm)}}function z3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.alarm-assignment-trigger-settings"))}function $3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.alarmSeverityTranslationMap.get(e))," ")}}function Q3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.alarmSearchStatusTranslationMap.get(e))," ")}}function J3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.alarmAssignmentActionTranslationMap.get(e))," ")}}function K3(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"notification.notify-on-required")," "))}function Y3(i,m){if(i&1&&(a(0,"mat-step",15),b(1,z3,2,3,"ng-template",16),a(2,"form",17)(3,"section",42)(4,"fieldset",67)(5,"legend",19),p(6,"notification.filter"),r(),f(7,"tb-string-items-list",47),d(8,"translate"),d(9,"translate"),a(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),r(),a(13,"mat-select",49),d(14,"translate"),b(15,$3,3,4,"mat-option",24),r()(),a(16,"mat-form-field",48)(17,"mat-label",19),p(18,"alarm.alarm-status-list"),r(),a(19,"mat-select",45),d(20,"translate"),b(21,Q3,3,4,"mat-option",24),r()()(),a(22,"mat-form-field",50)(23,"mat-label",19),p(24,"notification.notify-on"),r(),a(25,"mat-select",51),b(26,J3,3,4,"mat-option",24),r(),b(27,K3,3,3,"mat-error",21),r()()(),a(28,"form",17)(29,"section",52)(30,"mat-form-field",18)(31,"mat-label",19),p(32,"notification.description"),r(),f(33,"input",53),r()()()()),i&2){let e,n,t,s=v();l("stepControl",s.alarmAssignmentTemplateForm),o(2),l("formGroup",s.alarmAssignmentTemplateForm),o(5),T("label",c(8,11,"alarm.alarm-type-list")),T("placeholder",(e=s.alarmAssignmentTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&e.length?"":c(9,13,"alarm.any-type")),o(6),T("placeholder",(n=s.alarmAssignmentTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&n.length?"":c(14,15,"alarm.any-severity")),o(2),l("ngForOf",s.alarmSeverities),o(4),T("placeholder",(t=s.alarmAssignmentTemplateForm.get("triggerConfig.alarmStatuses").value)!=null&&t.length?"":c(20,17,"alarm.any-status")),o(2),l("ngForOf",s.alarmSearchStatuses),o(5),l("ngForOf",s.alarmAssignmentActions),o(),l("ngIf",s.alarmAssignmentTemplateForm.get("triggerConfig.notifyOn").hasError("required")),o(),l("formGroup",s.ruleNotificationForm)}}function X3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.rule-engine-events-trigger-settings"))}function Z3(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.componentLifecycleEventTranslationMap.get(e))," ")}}function eD(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(3);l("value",e),o(),h(" ",c(2,2,n.componentLifecycleEventTranslationMap.get(e))," ")}}function tD(i,m){if(i&1&&(a(0,"section")(1,"mat-form-field",48)(2,"mat-label",19),p(3,"rulenode.rule-node-events"),r(),a(4,"mat-select",75),d(5,"translate"),b(6,eD,3,4,"mat-option",24),r()(),a(7,"mat-slide-toggle",76),p(8),d(9,"translate"),r()()),i&2){let e,n=v(2);o(4),T("placeholder",(e=n.ruleEngineEventsTemplateForm.get("triggerConfig.ruleNodeEvents").value)!=null&&e.length?"":c(5,3,"event.all-events")),o(2),l("ngForOf",n.componentLifecycleEvents),o(2),h(" ",c(9,5,"notification.only-rule-node-lifecycle-failures")," ")}}function iD(i,m){if(i&1&&(a(0,"mat-step",15),b(1,X3,2,3,"ng-template",16),a(2,"form",17)(3,"section",42)(4,"fieldset",67)(5,"legend",19),p(6,"notification.rule-engine-filter"),r(),f(7,"tb-entity-list",71),d(8,"translate"),d(9,"translate"),d(10,"translate"),a(11,"mat-form-field",48)(12,"mat-label",19),p(13,"rulechain.rulechain-events"),r(),a(14,"mat-select",72),d(15,"translate"),b(16,Z3,3,4,"mat-option",24),r()(),a(17,"mat-slide-toggle",73),p(18),d(19,"translate"),r()(),a(20,"fieldset",67)(21,"legend",19),p(22,"notification.rule-node-filter"),r(),a(23,"mat-slide-toggle",74),p(24),d(25,"translate"),r(),b(26,tD,10,7,"section",21),r()()(),a(27,"form",17)(28,"section",52)(29,"mat-form-field",18)(30,"mat-label",19),p(31,"notification.description"),r(),f(32,"input",53),r()()()()),i&2){let e,n=v();l("stepControl",n.ruleEngineEventsTemplateForm),o(2),l("formGroup",n.ruleEngineEventsTemplateForm),o(5),T("labelText",c(8,12,"rulechain.rulechains")),T("placeholderText",c(9,14,"rulechain.rulechains")),T("hint",c(10,16,"notification.rule-chain-list-rule-hint")),l("entityType",n.entityType.RULE_CHAIN),o(7),T("placeholder",(e=n.ruleEngineEventsTemplateForm.get("triggerConfig.ruleChainEvents").value)!=null&&e.length?"":c(15,18,"event.all-events")),o(2),l("ngForOf",n.componentLifecycleEvents),o(2),h(" ",c(19,20,"notification.only-rule-chain-lifecycle-failures")," "),o(6),h(" ",c(25,22,"notification.track-rule-node-events")," "),o(2),l("ngIf",n.ruleEngineEventsTemplateForm.get("triggerConfig.trackRuleNodeEvents").value),o(),l("formGroup",n.ruleNotificationForm)}}function nD(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.edge-trigger-settings"))}function oD(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.edgeConnectionEventTranslationMap.get(e))," ")}}function aD(i,m){if(i&1&&(a(0,"mat-step",15),b(1,nD,2,3,"ng-template",16),a(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),r(),f(7,"tb-entity-list",77),d(8,"translate"),d(9,"translate"),d(10,"translate"),a(11,"mat-form-field",48)(12,"mat-label",19),p(13,"notification.notify-on"),r(),a(14,"mat-select",78),d(15,"translate"),b(16,oD,3,4,"mat-option",24),r()()()()(),a(17,"form",17)(18,"section",52)(19,"mat-form-field",18)(20,"mat-label",19),p(21,"notification.description"),r(),f(22,"input",53),r()()()()),i&2){let e,n=v();l("stepControl",n.edgeConnectionTemplateForm),o(2),l("formGroup",n.edgeConnectionTemplateForm),o(5),T("labelText",c(8,9,"edge.edge-instances")),T("placeholderText",c(9,11,"edge.edge-instances")),T("hint",c(10,13,"notification.edge-list-rule-hint")),l("entityType",n.entityType.EDGE),o(7),T("placeholder",(e=n.edgeConnectionTemplateForm.get("triggerConfig.notifyOn").value)!=null&&e.length?"":c(15,15,"event.all-events")),o(2),l("ngForOf",n.edgeConnectionEvents),o(),l("formGroup",n.ruleNotificationForm)}}function rD(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.edge-trigger-settings"))}function sD(i,m){if(i&1&&(a(0,"mat-step",15),b(1,rD,2,3,"ng-template",16),a(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),r(),f(7,"tb-entity-list",79),d(8,"translate"),d(9,"translate"),r()()(),a(10,"form",17)(11,"section",52)(12,"mat-form-field",18)(13,"mat-label",19),p(14,"notification.description"),r(),f(15,"input",53),r()()()()),i&2){let e=v();l("stepControl",e.edgeCommunicationFailureTemplateForm),o(2),l("formGroup",e.edgeCommunicationFailureTemplateForm),o(5),T("labelText",c(8,6,"edge.edge-instances")),T("hint",c(9,8,"notification.edge-list-rule-hint")),l("entityType",e.entityType.EDGE),o(3),l("formGroup",e.ruleNotificationForm)}}function lD(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.entities-limit-trigger-settings"))}function pD(i,m){if(i&1&&(a(0,"mat-step",15),b(1,lD,2,3,"ng-template",16),a(2,"form",17)(3,"fieldset",60)(4,"legend",19),p(5,"notification.filter"),r(),f(6,"tb-entity-type-list",80),a(7,"div",81)(8,"label",19),p(9,"notification.threshold"),r(),a(10,"div",82)(11,"mat-slider",83),f(12,"input",84),r(),a(13,"mat-form-field",85),f(14,"input",86),r()()()()(),a(15,"form",17)(16,"section",52)(17,"mat-form-field",18)(18,"mat-label",19),p(19,"notification.description"),r(),f(20,"input",53),r()()()()),i&2){let e=v();l("stepControl",e.entitiesLimitTemplateForm),o(2),l("formGroup",e.entitiesLimitTemplateForm),o(4),l("allowedEntityTypes",e.allowEntityTypeForEntitiesLimit),o(5),l("displayWith",e.formatLabel),o(3),l("value",e.entitiesLimitTemplateForm.get("triggerConfig.threshold").value),o(),l("formGroup",e.ruleNotificationForm)}}function mD(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.api-usage-trigger-settings"))}function dD(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.apiFeatureTranslationMap.get(e))," ")}}function cD(i,m){if(i&1&&(a(0,"mat-option",33),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v(2);l("value",e),o(),h(" ",c(2,2,n.apiUsageStateValueTranslationMap.get(e))," ")}}function uD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"notification.notify-on-required")," "))}function fD(i,m){if(i&1&&(a(0,"mat-step",15),b(1,mD,2,3,"ng-template",16),a(2,"form",17)(3,"section",42)(4,"mat-form-field",87)(5,"mat-label",19),p(6,"api-usage.api-features"),r(),a(7,"mat-select",88),b(8,dD,3,4,"mat-option",24),r(),a(9,"mat-hint"),p(10),d(11,"translate"),r()(),a(12,"mat-form-field",50)(13,"mat-label",19),p(14,"notification.notify-on"),r(),a(15,"mat-select",51),b(16,cD,3,4,"mat-option",24),r(),b(17,uD,3,3,"mat-error",21),r()()(),a(18,"form",17)(19,"section",52)(20,"mat-form-field",18)(21,"mat-label",19),p(22,"notification.description"),r(),f(23,"input",53),r()()()()),i&2){let e=v();l("stepControl",e.apiUsageLimitTemplateForm),o(2),l("formGroup",e.apiUsageLimitTemplateForm),o(6),l("ngForOf",e.apiFeatures),o(2),R(c(11,7,"notification.api-feature-hint")),o(6),l("ngForOf",e.apiUsageStateValues),o(),l("ngIf",e.apiUsageLimitTemplateForm.get("triggerConfig.notifyOn").hasError("required")),o(),l("formGroup",e.ruleNotificationForm)}}function gD(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.new-platform-version-trigger-settings"))}function hD(i,m){if(i&1&&(a(0,"mat-step",15),b(1,gD,2,3,"ng-template",16),a(2,"form",17)(3,"section",52)(4,"mat-form-field",18)(5,"mat-label",19),p(6,"notification.description"),r(),f(7,"input",53),r()()()()),i&2){let e=v();l("stepControl",e.newPlatformVersionTemplateForm),o(2),l("formGroup",e.ruleNotificationForm)}}function bD(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.rate-limits-trigger-settings"))}function vD(i,m){if(i&1&&(a(0,"mat-step",15),b(1,bD,2,3,"ng-template",16),a(2,"form",17)(3,"section",42),f(4,"tb-string-items-list",89),d(5,"translate"),d(6,"translate"),r()(),a(7,"form",17)(8,"section",52)(9,"mat-form-field",18)(10,"mat-label",19),p(11,"notification.description"),r(),f(12,"input",53),r()()()()),i&2){let e=v();l("stepControl",e.rateLimitsTemplateForm),o(2),l("formGroup",e.rateLimitsTemplateForm),o(2),T("label",c(5,6,"notification.rate-limits")),T("hint",c(6,8,"notification.api-feature-hint")),l("predefinedValues",e.limitedApis),o(3),l("formGroup",e.ruleNotificationForm)}}function yD(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"notification.task-processing-failure-trigger-settings"))}function _D(i,m){if(i&1&&(a(0,"mat-step",15),b(1,yD,2,3,"ng-template",16),a(2,"form",17)(3,"section",52)(4,"mat-form-field",18)(5,"mat-label",19),p(6,"notification.description"),r(),f(7,"input",53),r()()()()),i&2){let e=v();l("stepControl",e.taskProcessingFailureTemplateForm),o(2),l("formGroup",e.ruleNotificationForm)}}function CD(i,m){if(i&1){let e=O();a(0,"button",90),y("click",function(){x(e);let t=v();return I(t.backStep())}),p(1),d(2,"translate"),r()}i&2&&(o(),R(c(2,1,"action.back")))}var pd=(()=>{class i extends et{constructor(e,n,t,s,u,_,E,w,q){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=s,this.breakpointObserver=u,this.fb=_,this.translate=E,this.notificationService=w,this.dialog=q,this.triggerType=Qt,this.triggerTypeTranslationMap=Ks,this.alarmSearchStatuses=[Cr.ACTIVE,Cr.CLEARED,Cr.ACK,Cr.UNACK],this.alarmSearchStatusTranslationMap=Eu,this.alarmSeverityTranslationMap=Iu,this.alarmSeverities=Object.keys(xu),this.alarmActions=Object.values(ec),this.alarmActionTranslationMap=gf,this.alarmAssignmentActions=Object.values(tc),this.alarmAssignmentActionTranslationMap=hf,this.componentLifecycleEvents=Object.values(uf),this.componentLifecycleEventTranslationMap=ff,this.deviceEvents=Object.values(ic),this.deviceEventTranslationMap=bf,this.apiUsageStateValues=Object.values(lc),this.apiUsageStateValueTranslationMap=Kf,this.apiFeatures=Object.values(Yf),this.apiFeatureTranslationMap=Xf,this.edgeConnectionEvents=Object.values(U0),this.edgeConnectionEventTranslationMap=q0,this.entityType=B,this.isAdd=!0,this.allowEntityTypeForEntitiesLimit=[B.DEVICE,B.ASSET,B.CUSTOMER,B.USER,B.DASHBOARD,B.RULE_CHAIN],this.selectedIndex=0,this.dialogTitle="notification.edit-rule",this.destroy$=new Ft,this.authState=fn(this.store),this.authUser=this.authState.authUser,this.triggerTypes=this.allowTriggerTypes(),eo(s.isAdd)&&(this.isAdd=s.isAdd),this.limitedApis=Object.values(tg).map(Te=>({name:this.translate.instant(ig.get(Te)),value:Te})),this.stepperOrientation=this.breakpointObserver.observe(Ri["gt-xs"]).pipe(mt(({matches:Te})=>Te?"horizontal":"vertical")),this.ruleNotificationForm=this.fb.group({name:[null,S.required],enabled:[!0,S.required],templateId:[null,S.required],triggerType:[this.isSysAdmin()?Qt.ENTITIES_LIMIT:Qt.ALARM,S.required],recipientsConfig:this.fb.group({targets:[{value:null,disabled:!this.isSysAdmin()},S.required],escalationTable:[{value:null,disabled:this.isSysAdmin()},S.required]}),triggerConfig:[null],additionalConfig:this.fb.group({description:[""]})}),this.ruleNotificationForm.get("triggerType").valueChanges.pipe(dt(this.destroy$)).subscribe(Te=>{Te===Qt.ALARM?(this.ruleNotificationForm.get("recipientsConfig.escalationTable").enable({emitEvent:!1}),this.ruleNotificationForm.get("recipientsConfig.targets").disable({emitEvent:!1})):(this.ruleNotificationForm.get("recipientsConfig.escalationTable").disable({emitEvent:!1}),this.ruleNotificationForm.get("recipientsConfig.targets").enable({emitEvent:!1}))}),this.ruleNotificationForm.get("recipientsConfig.escalationTable").valueChanges.pipe(dt(this.destroy$)).subscribe(()=>{this.countRecipientsChainConfig()>1?this.alarmTemplateForm.get("triggerConfig.clearRule").enable({emitEvent:!1}):this.alarmTemplateForm.get("triggerConfig.clearRule").disable({emitEvent:!1})}),this.edgeConnectionTemplateForm=this.fb.group({triggerConfig:this.fb.group({edges:[null],notifyOn:[null]})}),this.edgeCommunicationFailureTemplateForm=this.fb.group({triggerConfig:this.fb.group({edges:[null]})}),this.alarmTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],clearRule:this.fb.group({alarmStatuses:[[]]}),notifyOn:[[ec.CREATED],S.required]})}),this.deviceInactivityTemplateForm=this.fb.group({triggerConfig:this.fb.group({filterByDevice:[!0],devices:[null],deviceProfiles:[{value:null,disabled:!0}],notifyOn:[[ic.INACTIVE],S.required]})}),this.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").valueChanges.pipe(dt(this.destroy$)).subscribe(Te=>{Te?(this.deviceInactivityTemplateForm.get("triggerConfig.devices").enable({emitEvent:!1}),this.deviceInactivityTemplateForm.get("triggerConfig.deviceProfiles").disable({emitEvent:!1})):(this.deviceInactivityTemplateForm.get("triggerConfig.deviceProfiles").enable({emitEvent:!1}),this.deviceInactivityTemplateForm.get("triggerConfig.devices").disable({emitEvent:!1}))}),this.entityActionTemplateForm=this.fb.group({triggerConfig:this.fb.group({entityTypes:[[B.DEVICE],S.required],created:[!1],updated:[!1],deleted:[!1]})}),this.alarmCommentTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],alarmStatuses:[[]],onlyUserComments:[!1],notifyOnCommentUpdate:[!1]})}),this.alarmAssignmentTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],alarmStatuses:[[]],notifyOn:[[tc.ASSIGNED],S.required]})}),this.ruleEngineEventsTemplateForm=this.fb.group({triggerConfig:this.fb.group({ruleChains:[null],ruleChainEvents:[null],onlyRuleChainLifecycleFailures:[!1],trackRuleNodeEvents:[!1],ruleNodeEvents:[null],onlyRuleNodeLifecycleFailures:[!1]})}),this.entitiesLimitTemplateForm=this.fb.group({triggerConfig:this.fb.group({entityTypes:[],threshold:[.8,[S.min(0),S.max(1)]]})}),this.apiUsageLimitTemplateForm=this.fb.group({triggerConfig:this.fb.group({apiFeatures:[[]],notifyOn:[[lc.WARNING],S.required]})}),this.newPlatformVersionTemplateForm=this.fb.group({triggerConfig:this.fb.group({})}),this.rateLimitsTemplateForm=this.fb.group({triggerConfig:this.fb.group({apis:[]})}),this.taskProcessingFailureTemplateForm=this.fb.group({triggerConfig:this.fb.group({taskTypes:[]})}),this.triggerTypeFormsMap=new Map([[Qt.ALARM,this.alarmTemplateForm],[Qt.ALARM_COMMENT,this.alarmCommentTemplateForm],[Qt.DEVICE_ACTIVITY,this.deviceInactivityTemplateForm],[Qt.ENTITY_ACTION,this.entityActionTemplateForm],[Qt.ALARM_ASSIGNMENT,this.alarmAssignmentTemplateForm],[Qt.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT,this.ruleEngineEventsTemplateForm],[Qt.ENTITIES_LIMIT,this.entitiesLimitTemplateForm],[Qt.API_USAGE_LIMIT,this.apiUsageLimitTemplateForm],[Qt.NEW_PLATFORM_VERSION,this.newPlatformVersionTemplateForm],[Qt.RATE_LIMITS,this.rateLimitsTemplateForm],[Qt.EDGE_COMMUNICATION_FAILURE,this.edgeCommunicationFailureTemplateForm],[Qt.EDGE_CONNECTION,this.edgeConnectionTemplateForm],[Qt.TASK_PROCESSING_FAILURE,this.taskProcessingFailureTemplateForm]]),(s.isAdd||s.isCopy)&&(this.dialogTitle="notification.add-rule"),this.ruleNotification=Ue(this.data.rule),this.ruleNotification&&(this.data.isCopy?this.ruleNotification.name+=` (${this.translate.instant("action.copy")})`:this.ruleNotificationForm.get("triggerType").disable({emitEvent:!1}),this.ruleNotificationForm.reset({},{emitEvent:!1}),this.ruleNotificationForm.patchValue(this.ruleNotification,{emitEvent:!1}),this.ruleNotificationForm.get("triggerType").updateValueAndValidity({onlySelf:!0}),this.triggerTypeFormsMap.get(this.ruleNotification.triggerType).patchValue(this.ruleNotification,{emitEvent:!1}),this.ruleNotification.triggerType===Qt.DEVICE_ACTIVITY&&this.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").patchValue(!!this.ruleNotification.triggerConfig.devices,{onlySelf:!0}))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}changeStep(e){this.selectedIndex=e.selectedIndex,e.previouslySelectedIndex>e.selectedIndex&&(e.previouslySelectedStep.interacted=!1)}backStep(){this.addNotificationRule.previous()}nextStep(){this.selectedIndex>=this.maxStepperIndex?this.add():this.addNotificationRule.next()}nextStepLabel(){return this.selectedIndex!==0?this.data.isAdd||this.data.isCopy?"action.add":"action.save":"action.next"}get maxStepperIndex(){return this.addNotificationRule?._steps?.length-1}add(){if(this.allValid()){let e=this.ruleNotificationForm.value,n=this.ruleNotificationForm.get("triggerType").value,t=this.triggerTypeFormsMap.get(n);Object.assign(e,t.value),n===Qt.DEVICE_ACTIVITY&&delete e.triggerConfig.filterByDevice,e.recipientsConfig.triggerType=n,e.triggerConfig.triggerType=n,this.ruleNotification&&!this.data.isCopy&&(e=_e(_e({},this.ruleNotification),e)),this.notificationService.saveNotificationRule(to(e)).subscribe(s=>this.dialogRef.close(s))}}allValid(){return!this.addNotificationRule.steps.find((e,n)=>e.stepControl.invalid?(e.interacted=!0,this.addNotificationRule.selectedIndex=n,!0):!1)}cancel(){this.dialogRef.close(null)}createTarget(e,n){e&&e.stopPropagation(),n._elementRef.nativeElement.blur(),this.dialog.open(Mo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(t=>{if(t){let s=this.ruleNotificationForm.get("recipientsConfig.targets").value;s||(s=[]),s.push(t.id.id),this.ruleNotificationForm.get("recipientsConfig.targets").patchValue(s)}})}countRecipientsChainConfig(){return Object.keys(this.ruleNotificationForm.get("recipientsConfig.escalationTable").value??{}).length}formatLabel(e){return`${(e*100).toFixed()}%`}isSysAdmin(){return this.authUser.authority===M.SYS_ADMIN}allowTriggerTypes(){let e=new Set([Qt.ENTITIES_LIMIT,Qt.API_USAGE_LIMIT,Qt.NEW_PLATFORM_VERSION,Qt.RATE_LIMITS,Qt.TASK_PROCESSING_FAILURE]);return this.isSysAdmin()?Array.from(e):Object.values(Qt).filter(n=>!e.has(n))}get allowEntityTypeForEntityAction(){if(!this._allowEntityTypeForEntityAction){let e=new Set([B.API_USAGE_STATE,B.TENANT_PROFILE,B.RPC,B.QUEUE,B.NOTIFICATION,B.NOTIFICATION_REQUEST,B.WIDGET_TYPE]);this._allowEntityTypeForEntityAction=Object.values(B).filter(n=>!e.has(n))}return this._allowEntityTypeForEntityAction}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze),g(Mt),g(ho),g(ht),g(ie),g(Ii),g(je))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-rule-notification-dialog"]],viewQuery:function(n,t){if(n&1&&be(h3,7),n&2){let s;ve(s=ye())&&(t.addNotificationRule=s.first)}},features:[G],decls:61,vars:41,consts:[["addNotificationRule",""],["alarmTargesConfig",""],["clearRules",""],["createTargetButton",""],["deviceProfile",""],["color","primary"],[1,"flex-1"],["tb-help","ruleNotifications"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","",1,"xs:p-0"],["labelPosition","end",3,"selectionChange","linear","orientation"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"formGroup"],[1,"mat-block"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","enabled",2,"margin-bottom","22px"],["formControlName","triggerType","required",""],[3,"value",4,"ngFor","ngForOf"],["required","","allowCreate","","allowEdit","","formControlName","templateId",3,"notificationTypes"],["formGroupName","recipientsConfig",4,"ngIf","ngIfElse"],[3,"stepControl",4,"ngIf"],["mat-dialog-actions","",1,"flex","flex-row"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],["formGroupName","recipientsConfig"],["required","","formControlName","targets",3,"subType","entityType","labelText","requiredText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click"],[2,"white-space","nowrap"],["formGroupName","recipientsConfig",1,"fields-group","tb-hierarchy"],["translate","",1,"mat-body-2"],["formControlName","escalationTable"],[4,"ngTemplateOutlet"],["formGroupName","triggerConfig"],["formGroupName","clearRule"],["floatLabel","always",1,"mat-block","flex-1",2,"margin-right","48px"],["formControlName","alarmStatuses","multiple","",3,"placeholder"],[1,"fields-group","tb-margin-before-field"],["editable","","floatLabel","always","formControlName","alarmTypes",3,"label","placeholder"],["floatLabel","always",1,"mat-block","flex-1"],["formControlName","alarmSeverities","multiple","",3,"placeholder"],[1,"mat-block","flex-1"],["formControlName","notifyOn","multiple",""],["formGroupName","additionalConfig"],["matInput","","formControlName","description"],[1,"flex","flex-1","items-center","justify-center"],["formControlName","filterByDevice",1,"tb-notification-unread-toggle-group",2,"width","250px"],[1,"flex-1",3,"value"],[4,"ngIf","ngIfElse"],["formControlName","devices","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","deviceProfiles","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formGroupName","triggerConfig",1,"fields-group","tb-margin"],["required","","ignoreAuthorityFilter","","formControlName","entityTypes",3,"allowedEntityTypes"],[1,"flex","flex-col","gap-2"],["translate","",1,"flex-1"],["formControlName","created"],["formControlName","updated"],["formControlName","deleted"],[1,"fields-group","tb-margin"],[1,"flex","flex-col"],["formControlName","onlyUserComments",2,"margin-bottom","12px"],["formControlName","notifyOnCommentUpdate",2,"margin-bottom","12px"],["formControlName","ruleChains","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","ruleChainEvents","multiple","",3,"placeholder"],["formControlName","onlyRuleChainLifecycleFailures"],["formControlName","trackRuleNodeEvents"],["formControlName","ruleNodeEvents","multiple","",3,"placeholder"],["formControlName","onlyRuleNodeLifecycleFailures"],["formControlName","edges","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","notifyOn","multiple","",3,"placeholder"],["formControlName","edges",3,"labelText","hint","entityType"],["formControlName","entityTypes","ignoreAuthorityFilter","",3,"allowedEntityTypes"],[1,"limit-slider-container","flex","flex-row","items-center","justify-start","xs:flex-col","xs:items-stretch"],[1,"flex","flex-1","flex-row","items-center","justify-start"],["min","0","max","1","step","0.01","discrete","",1,"flex-1",3,"displayWith"],["matSliderThumb","","formControlName","threshold"],[1,"limit-slider-value"],["matInput","","formControlName","threshold","type","number","step","0.01","min","0","max","1",3,"value"],["subscriptSizing","dynamic",1,"mat-block","flex-1"],["formControlName","apiFeatures","multiple",""],["formControlName","apis",3,"label","hint","predefinedValues"],["mat-stroked-button","",3,"click"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-toolbar",5)(1,"h2"),p(2),d(3,"translate"),r(),f(4,"span",6)(5,"div",7),a(6,"button",8),y("click",function(){return x(s),I(t.cancel())}),a(7,"mat-icon",9),p(8,"close"),r()()(),b(9,b3,1,0,"mat-progress-bar",10),d(10,"async"),b(11,v3,1,0,"div",11),d(12,"async"),a(13,"div",12)(14,"mat-horizontal-stepper",13,0),d(16,"async"),y("selectionChange",function(_){return x(s),I(t.changeStep(_))}),b(17,y3,2,0,"ng-template",14),a(18,"mat-step",15),b(19,_3,2,3,"ng-template",16),a(20,"form",17)(21,"mat-form-field",18)(22,"mat-label",19),p(23,"notification.rule-name"),r(),f(24,"input",20),b(25,C3,3,3,"mat-error",21),r(),a(26,"mat-slide-toggle",22),p(27),d(28,"translate"),r(),a(29,"mat-form-field",18)(30,"mat-label",19),p(31,"notification.trigger.trigger"),r(),a(32,"mat-select",23),b(33,S3,3,4,"mat-option",24),r(),b(34,T3,3,3,"mat-error",21),r(),f(35,"tb-template-autocomplete",25),b(36,x3,10,14,"section",26)(37,E3,7,1,"ng-template",null,1,xt),r(),b(39,M3,11,5,"ng-template",null,2,xt),r(),b(41,N3,28,15,"mat-step",27)(42,L3,27,15,"mat-step",27)(43,G3,25,13,"mat-step",27)(44,H3,35,23,"mat-step",27)(45,Y3,34,19,"mat-step",27)(46,iD,33,24,"mat-step",27)(47,aD,23,17,"mat-step",27)(48,sD,16,10,"mat-step",27)(49,pD,21,6,"mat-step",27)(50,fD,24,9,"mat-step",27)(51,hD,8,2,"mat-step",27)(52,vD,13,10,"mat-step",27)(53,_D,8,2,"mat-step",27),r()(),f(54,"mat-divider"),a(55,"div",28),b(56,CD,3,3,"button",29),f(57,"span",6),a(58,"button",30),y("click",function(){return x(s),I(t.nextStep())}),p(59),d(60,"translate"),r()()}if(n&2){let s=U(38);o(2),R(c(3,29,t.dialogTitle)),o(7),l("ngIf",c(10,31,t.isLoading$)),o(2),l("ngIf",c(12,33,t.isLoading$)===!1),o(3),l("linear",!0)("orientation",c(16,35,t.stepperOrientation)),o(4),l("stepControl",t.ruleNotificationForm),o(2),l("formGroup",t.ruleNotificationForm),o(5),l("ngIf",t.ruleNotificationForm.get("name").hasError("required")),o(2),h(" ",c(28,37,"notification.rule-enable")," "),o(6),l("ngForOf",t.triggerTypes),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").hasError("required")),o(),l("notificationTypes",t.ruleNotificationForm.get("triggerType").value),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value!==t.triggerType.ALARM)("ngIfElse",s),o(5),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.DEVICE_ACTIVITY),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ENTITY_ACTION),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM_COMMENT),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM_ASSIGNMENT),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.EDGE_CONNECTION),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.EDGE_COMMUNICATION_FAILURE),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ENTITIES_LIMIT),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.API_USAGE_LIMIT),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.NEW_PLATFORM_VERSION),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.RATE_LIMITS),o(),l("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.TASK_PROCESSING_FAILURE),o(3),l("ngIf",t.selectedIndex>0),o(3),R(c(60,39,t.nextStepLabel()))}},dependencies:[we,V,go,Tt,So,nf,Un,K,Ce,Ea,wa,ee,Oe,ge,me,Ie,zt,De,ei,He,Ct,Je,St,ct,xi,it,i0,n0,vn,hn,yn,bn,fe,ue,Ti,W,z,ce,Li,tn,X,oe,ft,H,Sf,oa,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:900px;height:100%;max-width:100%;max-height:100vh;display:flex;flex-direction:column}[_nghost-%COMP%]   .tb-hint[_ngcontent-%COMP%]{margin-top:-1.25em;padding:0}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group.tb-margin[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .fields-group.tb-margin-before-field[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .fields-group.tb-hierarchy[_ngcontent-%COMP%]{padding:0 0 8px 16px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000b3;width:fit-content}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000c2}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .clear-button-space[_ngcontent-%COMP%]{margin-right:48px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%]   .limit-slider-value[_ngcontent-%COMP%]{margin-left:16px;min-width:25px;max-width:100px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{text-align:center}@media screen and (min-width: 960px){[_nghost-%COMP%]   .history-time-input[_ngcontent-%COMP%]{min-width:364px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:16px;width:min-content;max-width:40%}}[_nghost-%COMP%]     .mat-mdc-dialog-content{display:flex;flex-direction:column;height:100%;padding:0!important;color:#000000de}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal{display:flex;height:100%;overflow:hidden}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-stepper-wrapper{flex:1 1 100%}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{height:700px;max-height:100%;width:100%;overflow-y:auto;scrollbar-gutter:stable}@media screen and (min-width: 960px){[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{min-width:500px}}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard{border:none;border-radius:18px;margin-bottom:8px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle{border-left:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle{background:#0000000f;height:36px;align-items:center;display:flex}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle .mat-button-toggle-ripple{inset:2px;border-radius:18px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-button{color:#959595}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-focus-overlay{border-radius:18px;margin:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked .mat-button-toggle-button{background-color:#359b07;color:#fff;border-radius:18px;margin-left:2px;margin-right:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content{line-height:34px;font-size:16px;font-weight:500}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.01}']})}}return i})();var zc=(()=>{class i{constructor(e,n,t,s){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=s,this.config=new Qe,this.config.entityType=B.NOTIFICATION_RULE,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=$e.get(B.NOTIFICATION_RULE),this.config.entityResources={},this.config.entitiesFetchFunction=u=>this.notificationService.getNotificationRules(u),this.config.deleteEntityTitle=u=>this.translate.instant("notification.delete-rule-title",{ruleName:u.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-rule-text"),this.config.deleteEntitiesTitle=u=>this.translate.instant("notification.delete-rules-title",{count:u}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-rules-text"),this.config.deleteEntity=u=>this.notificationService.deleteNotificationRule(u.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=sd,this.config.onEntityAction=u=>this.onTargetAction(u),this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.handleRowClick=(u,_)=>(this.editRule(u,_),!0),this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("name","notification.rule-name","30%"),new te("templateName","notification.template","20%"),new te("triggerType","notification.trigger.trigger","20%",u=>this.translate.instant(Ks.get(u.triggerType))||"",()=>({}),!0),new te("additionalConfig.description","notification.description","30%",u=>u.additionalConfig?.description||"",()=>({}),!1))}resolve(e){return this.config}configureCellActions(){return[{name:"",nameFunction:e=>this.translate.instant(e.enabled?"notification.rule-disable":"notification.rule-enable"),icon:"mdi:toggle-switch",isEnabled:()=>!0,iconFunction:e=>e.enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",onAction:(e,n)=>this.toggleEnableMode(e,n)},{name:this.translate.instant("notification.copy-rule"),icon:"content_copy",isEnabled:()=>!0,onAction:(e,n)=>this.editRule(e,n,!1,!0)}]}editRule(e,n,t=!1,s=!1){e&&e.stopPropagation(),this.dialog.open(pd,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:t,isCopy:s,rule:n}}).afterClosed().subscribe(u=>{u&&this.config.updateData()})}onTargetAction(e){switch(e.action){case"add":return this.editRule(e.event,e.entity,!0),!0}return!1}toggleEnableMode(e,n){e&&e.stopPropagation();let t=$i(_e({},n),{enabled:!n.enabled});this.notificationService.saveNotificationRule(t,{ignoreLoading:!0}).subscribe(s=>{n.enabled=s.enabled,this.config.getTable().detectChanges()})}static{this.\u0275fac=function(n){return new(n||i)(N(Ii),N(ie),N(je),N(Ge))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var SD=[{path:"notification",component:Tn,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER,M.SYS_ADMIN],breadcrumb:{menuId:xe.notifications_center},routerTabsHeaderComponent:Rg},children:[{path:"",children:[],data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER,M.SYS_ADMIN],redirectTo:"/notification/inbox"}},{path:"inbox",component:qe,data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER,M.SYS_ADMIN],title:"notification.inbox",breadcrumb:{menuId:xe.notification_inbox}},resolve:{entitiesTableConfig:Uc}},{path:"sent",component:qe,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"notification.sent",breadcrumb:{menuId:xe.notification_sent}},resolve:{entitiesTableConfig:qc}},{path:"templates",component:qe,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"notification.templates",breadcrumb:{menuId:xe.notification_templates}},resolve:{entitiesTableConfig:Hc}},{path:"recipients",component:qe,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"notification.recipients",breadcrumb:{menuId:xe.notification_recipients}},resolve:{entitiesTableConfig:Wc}},{path:"rules",component:qe,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"notification.rules",breadcrumb:{menuId:xe.notification_rules}},resolve:{entitiesTableConfig:zc}}]}],md=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Uc,qc,Wc,Hc,zc],imports:[j.forChild(SD),j]})}}return i})();(function(){Y(md,{imports:[j],exports:[j]})})();C();C();function TD(i,m){if(i&1){let e=O();a(0,"div",6)(1,"div",7)(2,"mat-checkbox",8),y("click",function(){let t=x(e).$implicit,s=v();return I(s.toggleDeliviryMethod(t))}),r()()()}if(i&2){let e=m.$implicit,n=v();o(2),l("checked",n.getChecked(e))}}var dd=(()=>{class i{constructor(e){this.fb=e,this.deliveryMethods=[],this.notificationTemplateTypeTranslateMap=Qa,this.propagateChange=null,this.valueChange$=null}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){let e={};this.deliveryMethods.forEach(n=>{e[n]=!0}),this.notificationSettingsFormGroup=this.fb.group({name:[""],enabled:[!0],enabledDeliveryMethods:this.fb.group(_e({},e))}),this.valueChange$=this.notificationSettingsFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.valueChange$&&(this.valueChange$.unsubscribe(),this.valueChange$=null)}setDisabledState(e){this.disabled=e,this.disabled?this.notificationSettingsFormGroup.disable({emitEvent:!1}):this.notificationSettingsFormGroup.enable({emitEvent:!1})}getChecked(e){if(e)return this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).value;{let n=Object.values(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value),t=n.some(s=>s===!0);return t!==this.notificationSettingsFormGroup.get("enabled").value&&setTimeout(()=>this.notificationSettingsFormGroup.get("enabled").patchValue(t),0),n.every(s=>s)}}toggleDeliviryMethod(e){this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).patchValue(!this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).value)}changeInstanceTypeCheckBox(e){let n=Ue(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value);Object.keys(n).forEach(t=>{n[t]=e}),this.notificationSettingsFormGroup.get("enabled").patchValue(e,{emitEvent:!1}),this.notificationSettingsFormGroup.get("enabledDeliveryMethods").patchValue(n),this.notificationSettingsFormGroup.markAsDirty()}getIndeterminate(){if(!this.notificationSettingsFormGroup.get("enabled").value)return!1;let e=Object.values(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value),n=e.filter(t=>t);return n.length!==0&&n.length!==e.length}writeValue(e){Re(e)&&this.notificationSettingsFormGroup.patchValue(e,{emitEvent:!1})}updateModel(){this.propagateChange(this.notificationSettingsFormGroup.value)}static{this.\u0275fac=function(n){return new(n||i)(g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-notification-setting-form"]],inputs:{disabled:"disabled",deliveryMethods:"deliveryMethods"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0}])],decls:8,vars:9,consts:[[1,"flex","flex-col",3,"formGroup"],[1,"flex","flex-row",2,"height","48px"],[1,"flex","max-w-50%","flex-full","items-center","justify-start"],["color","primary",3,"click","change","checked","indeterminate"],[1,"notification-type"],["class","flex flex-1 flex-row",4,"ngFor","ngForOf"],[1,"flex","flex-1","flex-row"],[1,"flex","flex-1","items-center","justify-start"],["color","primary",3,"click","checked"]],template:function(n,t){if(n&1&&(a(0,"form",0)(1,"div",1)(2,"div",2)(3,"mat-checkbox",3),y("click",function(u){return u.stopPropagation()})("change",function(u){return t.changeInstanceTypeCheckBox(u.checked)}),a(4,"span",4),p(5),d(6,"translate"),r()()(),b(7,TD,3,1,"div",5),r()()),n&2){let s;l("formGroup",t.notificationSettingsFormGroup),o(3),l("checked",t.getChecked())("indeterminate",t.getIndeterminate()),o(),L("notification-type-disabled",!t.notificationSettingsFormGroup.get("enabled").value),o(),h(" ",c(6,7,(s=t.notificationTemplateTypeTranslateMap.get(t.notificationSettingsFormGroup.get("name").value))==null?null:s.name)," "),o(2),l("ngForOf",t.deliveryMethods)}},dependencies:[we,$t,fe,z,X,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .notification-type[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .notification-type-disabled[_ngcontent-%COMP%]{color:#00000061}']})}}return i})();function ID(i,m){i&1&&f(0,"mat-progress-bar",20)}function ED(i,m){i&1&&f(0,"div",21)}function wD(i,m){if(i&1){let e=O();a(0,"div",22)(1,"div",23)(2,"mat-checkbox",24),y("change",function(t){let s=x(e).$implicit,u=v();return I(u.changeInstanceTypeCheckBox(t.checked,s))})("click",function(t){return x(e),I(t.stopPropagation())}),a(3,"mat-label"),p(4),d(5,"translate"),r()()()()}if(i&2){let e=m.$implicit,n=v();o(2),l("checked",n.getChecked(e))("indeterminate",n.getIndeterminate(e)),o(2),R(c(5,3,n.notificationDeliveryMethodInfoMap.get(e).name))}}function MD(i,m){i&1&&f(0,"mat-divider")}function DD(i,m){if(i&1&&(a(0,"div"),f(1,"tb-notification-setting-form",25),b(2,MD,1,0,"mat-divider",26),r()),i&2){let e=m.$implicit,n=m.last,t=v();o(),l("formControl",e)("deliveryMethods",t.notificationDeliveryMethods),o(),l("ngIf",!n)}}var cd=(()=>{class i extends It{constructor(e,n,t,s,u,_){super(e),this.store=e,this.route=n,this.translate=t,this.dialogService=s,this.notificationService=u,this.fb=_,this.notificationDeliveryMethodInfoMap=za,this.deliveryMethods=new Set([oc.SLACK,oc.MICROSOFT_TEAMS]),this.getChecked=(E=null)=>{let w=this.notificationSettings.get("prefs").value;return Re(E)?Re(w)&&w.every(q=>q.enabledDeliveryMethods[E]):Re(w)&&w.every(q=>q.enabled)},this.getSomeChecked=()=>{let E=this.notificationSettings.get("prefs").value;return Re(E)&&E.some(w=>w.enabled)},this.getIndeterminate=(E=null)=>{let w=this.notificationSettings.get("prefs").value;if(Re(w)){let q=Re(E)?w.filter(Te=>Te.enabledDeliveryMethods[E]):w.filter(Te=>Te.enabled);return q.length!==0&&q.length!==w.length}return!1},this.changeInstanceTypeCheckBox=(E,w=null)=>{let q=Ue(this.notificationSettings.get("prefs").value);Re(w)?q.forEach(Te=>Te.enabledDeliveryMethods[w]=E):q.forEach(Te=>{Te.enabled=E,Te.enabledDeliveryMethods=Object.keys(Te.enabledDeliveryMethods).reduce((Le,gt)=>$i(_e({},Le),{[gt]:E}),{})}),this.notificationSettings.get("prefs").patchValue(q,{emitEvent:!1}),this.notificationSettings.markAsDirty()},this.notificationService.getAvailableDeliveryMethods({ignoreLoading:!0}).subscribe(E=>{this.notificationDeliveryMethods=E.filter(w=>!this.deliveryMethods.has(w)),this.patchNotificationSettings(this.route.snapshot.data.userSettings)})}ngOnInit(){this.buildNotificationSettingsForm()}buildNotificationSettingsForm(){this.notificationSettings=this.fb.group({prefs:this.fb.array([])})}patchNotificationSettings(e){let n=[];e.prefs&&this.prepareNotificationSettings(e.prefs).forEach(t=>n.push(this.fb.control(t,[S.required]))),this.notificationSettings.setControl("prefs",this.fb.array(n),{emitEvent:!1})}prepareNotificationSettings(e){return Object.entries(e).map(n=>{if(n[1].name=n[0],!n[1].enabled&&Object.values(n[1].enabledDeliveryMethods).some(t=>t===!0)){let t=Ue(n[1].enabledDeliveryMethods);Object.keys(t).forEach(s=>{t[s]=!1}),n[1].enabledDeliveryMethods=t}return n[1].enabledDeliveryMethods=Object.assign(this.notificationDeliveryMethods.reduce((t,s)=>$i(_e({},t),{[s]:!0}),{}),n[1].enabledDeliveryMethods),n[1]})}resetSettings(){this.dialogService.confirm(this.translate.instant("notification.settings.reset-all-title"),this.translate.instant("notification.settings.reset-all-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(e=>{if(e){let n=this.prepareNotificationSettings(this.route.snapshot.data.userSettings.prefs),t=[];this.notificationSettings.reset({}),n&&n.forEach(s=>{s.enabled=!0,s.enabledDeliveryMethods=this.notificationDeliveryMethods.reduce((u,_)=>$i(_e({},u),{[_]:!0}),{}),t.push(this.fb.control(s,[S.required]))}),this.notificationSettings.setControl("prefs",this.fb.array(t),{emitEvent:!1}),this.save()}})}get notificationSettingsFormArray(){return this.notificationSettings.get("prefs")}save(){let e={prefs:{}};this.notificationSettings.getRawValue().prefs.forEach(n=>{let t=n.name;delete n.name,e.prefs[t]=n}),this.notificationService.saveNotificationUserSettings(e).subscribe(n=>{this.notificationSettings.get("prefs").reset({}),this.patchNotificationSettings(n)})}confirmForm(){return this.notificationSettings}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(Si),g(ie),g(Lt),g(Ii),g(se))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-notification-settings"]],features:[G],decls:33,vars:23,consts:[["appearance","outlined",1,"settings-card","tb-absolute-fill"],[1,"flex","flex-1","flex-row","items-start","justify-between","xs:flex-col","xs:justify-start","xs:gap-2"],[1,"flex","flex-1","flex-col"],["translate","",1,"mat-headline-5"],[1,"flex","flex-col"],["mat-button","","color","primary",3,"click","disabled"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px","overflow","hidden"],[1,"notification-form",3,"formGroup"],[1,"notification-section"],[1,"notification-section-block"],[1,"flex","flex-row","items-center","justify-start",2,"height","44px"],[1,"max-w-50%","flex-full"],["color","warn",3,"click","change","indeterminate","checked"],["translate",""],["class","flex-1",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","items-start","justify-end",2,"padding","16px"],["mat-button","","mat-raised-button","","color","primary","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"flex-1"],[1,"flex","flex-1","items-center","justify-start"],["color","warn",3,"change","click","checked","indeterminate"],[3,"formControl","deliveryMethods"],[4,"ngIf"]],template:function(n,t){n&1&&(a(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"div",1)(4,"div",2)(5,"span",3),p(6,"notification.settings.notification-settings"),r()(),a(7,"div",4)(8,"button",5),d(9,"async"),y("click",function(){return t.resetSettings()}),p(10),d(11,"translate"),r()()()(),b(12,ID,1,0,"mat-progress-bar",6),d(13,"async"),b(14,ED,1,0,"div",7),d(15,"async"),a(16,"mat-card-content",8)(17,"form",9)(18,"section",10)(19,"div",11)(20,"div",12)(21,"div",13)(22,"mat-checkbox",14),y("click",function(u){return u.stopPropagation()})("change",function(u){return t.changeInstanceTypeCheckBox(u.checked)}),a(23,"mat-label",15),p(24,"notification.settings.type"),r()()(),b(25,wD,6,5,"div",16),r(),f(26,"mat-divider"),b(27,DD,3,3,"div",17),r()()()(),a(28,"div",18)(29,"button",19),d(30,"async"),y("click",function(){return t.save()}),p(31),d(32,"translate"),r()()()()),n&2&&(o(8),l("disabled",c(9,11,t.isLoading$)),o(2),R(c(11,13,"notification.settings.reset-all")),o(2),l("ngIf",c(13,15,t.isLoading$)),o(2),l("ngIf",!c(15,17,t.isLoading$)),o(3),l("formGroup",t.notificationSettings),o(5),l("indeterminate",t.getIndeterminate())("checked",t.getChecked()),o(3),l("ngForOf",t.notificationDeliveryMethods),o(2),l("ngForOf",t.notificationSettingsFormArray.controls),o(2),l("disabled",c(30,19,t.isLoading$)||t.notificationSettings.invalid||!t.notificationSettings.dirty),o(2),h(" ",c(32,21,"action.save")," "))},dependencies:[we,V,K,$t,ti,pi,yi,Oe,Ie,xi,fe,W,z,Yt,X,H,dd,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-form[_ngcontent-%COMP%]{height:100%;min-height:min-content;max-height:min-content}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-section[_ngcontent-%COMP%]{height:100%;border:1px solid rgba(0,0,0,.12);overflow:scroll}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-section-block[_ngcontent-%COMP%]{min-width:470px}']})}}return i})();var ud=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,md,Ee]})}}return i})();(function(){Y(ud,{declarations:[id,nd,od,ml,Mo,ad,Ir,rd,ld,oa,pd,sd,cd,dd,gc,kg],imports:[ae,re,md,Ee]})})();fo(Ir,[we,V,Tt,K,Ce,ee,Oe,ge,me,Ie,De,He,Ct,Je,St,ct,xi,it,vn,hn,yn,bn,o0,fe,ue,W,z,ce,X,oe,ft,H,gc],[le,k]);C();C();C();var Lh=[{path:"notificationSettings",component:cd,canDeactivate:[Fe],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN,M.CUSTOMER_USER],title:"account.notification-settings",breadcrumb:{label:"account.notification-settings",icon:"settings"}},resolve:{userSettings:()=>Zt(Ii).getNotificationUserSettings()}}];var PD=[{path:"account",component:Tn,data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN,M.CUSTOMER_USER],showMainLoadingBar:!1,breadcrumb:{label:"account.account",icon:"account_circle"},useChildrenRoutesForTabs:!0},resolve:{replaceUrl:()=>fn(Zt(P)).forceFullscreen},children:[{path:"",children:[],data:{auth:[M.SYS_ADMIN,M.TENANT_ADMIN,M.CUSTOMER_USER],redirectTo:"/account/profile"}},...vh,...Th,...Lh]}],fd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(PD),j]})}}return i})();(function(){Y(fd,{imports:[j],exports:[j]})})();var gd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,fd]})}}return i})();(function(){Y(gd,{imports:[ae,fd]})})();C();C();var hd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,tr]})}}return i})();(function(){Y(hd,{declarations:[jr,mr,ep,Zl,Jo,Vr,tp,Ko,Lr,ip],imports:[ae,re,tr],exports:[jr]})})();fo(Jo,[we,V,Zd,K,Ce,ee,Dt,Lo,Vo,Bo,W,Yt,H,Vr],[k]);fo(Ko,[we,V,Zd,K,Ce,ee,Dt,Lo,Vo,Bo,W,Yt,H,Lr],[k]);var bd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,hd,Jl,tr]})}}return i})();(function(){Y(bd,{declarations:[Xl,op],imports:[ae,re,Ee,hd,Jl,tr]})})();C();var vd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Ym]})}}return i})();(function(){Y(vd,{imports:[ae,re,Ee,Ym]})})();C();C();C();C();C();C();var Hr=(()=>{class i{constructor(e){this.fb=e,this.editorContentApplied=new rt,this.tinyMceOptions={base_url:"/assets/tinymce",suffix:".min",plugins:["lists"],menubar:"edit insert view format",toolbar:["fontfamily fontsize | bold italic underline strikethrough forecolor backcolor","alignleft aligncenter alignright alignjustify | bullist"],toolbar_mode:"sliding",height:400,autofocus:!1,branding:!1,promotion:!1}}ngOnInit(){this.editorControl=this.fb.control(this.content),this.disabled&&this.editorControl.disable({emitEvent:!1})}cancel(){this.popover?.hide()}apply(){this.editorControl.valid&&this.editorContentApplied.emit(this.editorControl.value)}static{this.\u0275fac=function(n){return new(n||i)(g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-release-notes-panel"]],inputs:{disabled:"disabled",content:"content",title:"title",popover:"popover"},outputs:{editorContentApplied:"editorContentApplied"},decls:12,vars:12,consts:[[1,"tb-editor-panel"],[1,"tb-editor-title"],[1,"tb-editor",3,"init","formControl"],[1,"tb-editor-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1),p(2),d(3,"translate"),r(),f(4,"editor",2),a(5,"div",3)(6,"button",4),y("click",function(){return t.cancel()}),p(7),d(8,"translate"),r(),a(9,"button",5),y("click",function(){return t.apply()}),p(10),d(11,"translate"),r()()()),n&2&&(o(2),R(c(3,6,t.title)),o(2),l("init",t.tinyMceOptions)("formControl",t.editorControl),o(3),h(" ",c(8,8,"action.cancel")," "),o(2),l("disabled",t.editorControl.invalid||!t.editorControl.dirty),o(),h(" ",c(11,10,"action.apply")," "))},dependencies:[K,W,Yt,s0,k],styles:[`@charset "UTF-8";.tb-editor-panel{width:600px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-editor-panel{width:90vw}}.tb-editor-panel .tb-editor-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-editor-panel .tb-editor{height:400px}.tb-editor-panel .tb-editor-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();function FD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.mobile-package-required")," "))}function AD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.mobile-package-max-length")," "))}function ND(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.mobile-package-pattern")," "))}function kD(i,m){if(i&1&&(a(0,"mat-option",28),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.platformTypeTranslations.get(e))," ")}}function RD(i,m){if(i&1){let e=O();a(0,"button",29),d(1,"translate"),y("click",function(t){x(e);let s=v();return I(s.generateAppSecret(t))}),a(2,"tb-icon"),p(3,"cached"),r()()}i&2&&T("matTooltip",c(1,1,"mobile.generate-application-secret"))}function OD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.application-secret-required")," "))}function BD(i,m){if(i&1&&(a(0,"mat-option",28),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.mobileAppStatusTranslations.get(e))," ")}}function VD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.invalid-version-pattern")," "))}function LD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.invalid-version-pattern")," "))}function jD(i,m){if(i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2){let e=v();o(),h(" ",c(2,1,e.entityForm.get("platformType").value===e.PlatformType.ANDROID?"mobile.google-play-link-required":"mobile.app-store-link-required")," ")}}function GD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.invalid-store-link")," "))}function UD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.sha256-certificate-fingerprints-required")," "))}function qD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.sha256-certificate-fingerprints-pattern")," "))}function WD(i,m){if(i&1&&(a(0,"mat-form-field",15)(1,"mat-label",4),p(2,"mobile.sha256-certificate-fingerprints"),r(),f(3,"input",30)(4,"tb-copy-button",6),d(5,"translate"),b(6,UD,3,3,"mat-error",7)(7,qD,3,3,"mat-error",7),r()),i&2){let e=v();o(3),l("required",e.entityForm.get("status").value===e.MobileAppStatus.PUBLISHED),o(),T("tooltipText",c(5,5,"mobile.copy-sha256-certificate-fingerprints")),l("copyText",e.entityForm.get("storeInfo.sha256CertFingerprints").value),o(2),l("ngIf",e.entityForm.get("storeInfo.sha256CertFingerprints").hasError("required")),o(),l("ngIf",e.entityForm.get("storeInfo.sha256CertFingerprints").hasError("pattern"))}}function HD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.app-id-required")," "))}function zD(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.app-id-pattern")," "))}function $D(i,m){if(i&1&&(a(0,"mat-form-field",15)(1,"mat-label",4),p(2,"mobile.app-id"),r(),f(3,"input",31)(4,"tb-copy-button",6),d(5,"translate"),b(6,HD,3,3,"mat-error",7)(7,zD,3,3,"mat-error",7),r()),i&2){let e=v();o(3),l("required",e.entityForm.get("status").value===e.MobileAppStatus.PUBLISHED),o(),T("tooltipText",c(5,5,"mobile.copy-app-id")),l("copyText",e.entityForm.get("storeInfo.appId").value),o(2),l("ngIf",e.entityForm.get("storeInfo.appId").hasError("required")),o(),l("ngIf",e.entityForm.get("storeInfo.appId").hasError("pattern"))}}var hr=(()=>{class i extends jt{constructor(e,n,t,s,u,_,E,w,q){super(e,_,t,s,u),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=s,this.cd=u,this.fb=_,this.popoverService=E,this.renderer=w,this.viewContainerRef=q,this.entityType=B,this.platformTypes=[en.ANDROID,en.IOS],this.MobileAppStatus=xn,this.PlatformType=en,this.mobileAppStatuses=Object.keys(xn),this.platformTypeTranslations=vo,this.mobileAppStatusTranslations=al}buildForm(e){let n=this.fb.group({pkgName:[e?.pkgName?e.pkgName:"",[S.required,S.maxLength(255),S.pattern(/^[a-zA-Z][a-zA-Z\d_]*(?:\.[a-zA-Z][a-zA-Z\d_]*)+$/)]],platformType:[e?.platformType?e.platformType:en.ANDROID],appSecret:[e?.appSecret?e.appSecret:btoa(_r(64)),[S.required,this.base64Format]],status:[e?.status?e.status:xn.DRAFT],versionInfo:this.fb.group({minVersion:[e?.versionInfo?.minVersion?e.versionInfo.minVersion:"",S.pattern(/^\d+\.\d+\.\d+(-[a-zA-Z\d-.]+)?(\+[a-zA-Z\d-.]+)?$/)],minVersionReleaseNotes:[e?.versionInfo?.minVersionReleaseNotes?e.versionInfo.minVersionReleaseNotes:""],latestVersion:[e?.versionInfo?.latestVersion?e.versionInfo.latestVersion:"",S.pattern(/^\d+\.\d+\.\d+(-[a-zA-Z\d-.]+)?(\+[a-zA-Z\d-.]+)?$/)],latestVersionReleaseNotes:[e?.versionInfo?.latestVersionReleaseNotes?e.versionInfo.latestVersionReleaseNotes:""]}),storeInfo:this.fb.group({storeLink:[e?.storeInfo?.storeLink?e.storeInfo.storeLink:"",S.pattern(/^https?:\/\/play\.google\.com\/store\/apps\/details\?id=[a-zA-Z0-9._]+$/)],sha256CertFingerprints:[e?.storeInfo?.sha256CertFingerprints?e.storeInfo.sha256CertFingerprints:"",S.pattern(/^[A-Fa-f0-9]{2}(:[A-Fa-f0-9]{2}){1,31}$/)],appId:[e?.storeInfo?.appId?e.storeInfo.appId:"",S.pattern(/^\d{7,10}$/)]})});return n.get("platformType").valueChanges.pipe(ai()).subscribe(t=>{t===en.ANDROID?(n.get("storeInfo.sha256CertFingerprints").enable({emitEvent:!1}),n.get("storeInfo.appId").disable({emitEvent:!1}),n.get("storeInfo.storeLink").setValidators(S.pattern(/^https?:\/\/play\.google\.com\/store\/apps\/details\?id=[a-zA-Z0-9._]+$/))):t===en.IOS&&(n.get("storeInfo.sha256CertFingerprints").disable({emitEvent:!1}),n.get("storeInfo.appId").enable({emitEvent:!1}),n.get("storeInfo.storeLink").setValidators(S.pattern(/^https?:\/\/apps\.apple\.com\/[a-z]{2}\/app\/[\w-]+\/id\d{7,10}$/))),n.get("storeInfo.storeLink").setValue("",{emitEvent:!1})}),n.get("status").valueChanges.pipe(ai()).subscribe(t=>{t!==xn.DRAFT?(n.get("storeInfo.storeLink").addValidators(S.required),n.get("storeInfo.sha256CertFingerprints").addValidators(S.required),n.get("storeInfo.appId").addValidators(S.required)):(n.get("storeInfo.storeLink").clearValidators(),n.get("storeInfo.sha256CertFingerprints").removeValidators(S.required),n.get("storeInfo.appId").removeValidators(S.required)),n.get("storeInfo.storeLink").updateValueAndValidity({emitEvent:!1}),n.get("storeInfo.sha256CertFingerprints").updateValueAndValidity({emitEvent:!1}),n.get("storeInfo.appId").updateValueAndValidity({emitEvent:!1})}),n}updateForm(e){this.entityForm.patchValue(e,{emitEvent:!1})}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("status").updateValueAndValidity({onlySelf:!1}),this.entityForm.get("platformType").disable({emitEvent:!1}),this.entityForm.get("platformType").value===en.ANDROID?this.entityForm.get("storeInfo.appId").disable({emitEvent:!1}):this.entityForm.get("platformType").value===en.IOS&&this.entityForm.get("storeInfo.sha256CertFingerprints").disable({emitEvent:!1})),this.entityForm&&this.isAdd&&this.entityForm.get("storeInfo.appId").disable({emitEvent:!1})}prepareFormValue(e){return e.storeInfo=this.entityForm.get("storeInfo").value,super.prepareFormValue(e)}generateAppSecret(e){e.stopPropagation(),this.entityForm.get("appSecret").setValue(btoa(_r(64))),this.entityForm.get("appSecret").markAsDirty()}editReleaseNote(e,n,t){e&&e.stopPropagation();let s=n._elementRef.nativeElement;if(this.popoverService.hasPopover(s))this.popoverService.hidePopover(s);else{let u={disabled:!(this.isAdd||this.isEdit),title:t?"mobile.latest-version-release-notes":"mobile.min-version-release-notes",content:t?this.entityForm.get("versionInfo.latestVersionReleaseNotes").value:this.entityForm.get("versionInfo.minVersionReleaseNotes").value},_=this.popoverService.displayPopover(s,this.renderer,this.viewContainerRef,Hr,["leftOnly","leftBottomOnly","leftTopOnly"],!0,null,u,{},{},{},!1,()=>{},{padding:"16px 24px"});_.tbComponentRef.instance.popover=_,_.tbComponentRef.instance.editorContentApplied.subscribe(E=>{_.hide(),t?(this.entityForm.get("versionInfo.latestVersionReleaseNotes").setValue(E),this.entityForm.get("versionInfo.latestVersionReleaseNotes").markAsDirty()):(this.entityForm.get("versionInfo.minVersionReleaseNotes").setValue(E),this.entityForm.get("versionInfo.minVersionReleaseNotes").markAsDirty())})}}base64Format(e){if(e.value==="")return null;try{return atob(e.value).length<64?{minLength:!0}:null}catch{return{base64:!0}}}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(ie),g("entity",8),g("entitiesTableConfig",8),g(Xe),g(ht),g(Sn),g(un),g(ki))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-app"]],features:[G],decls:75,vars:39,consts:[["editMinReleaseNotesVersionButton",""],["editLatestReleaseNotesVersionButton",""],[1,"mat-padding","flex","flex-col",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic"],["translate",""],["matInput","","required","","formControlName","pkgName"],["matSuffix","","miniButton","false","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],[4,"ngIf"],["appearance","outline",1,"flex"],["formControlName","platformType"],[3,"value",4,"ngFor","ngForOf"],["matInput","","required","","formControlName","appSecret",3,"placeholder"],["matSuffix","",2,"display","flex","align-items","center"],["mat-icon-button","","type","button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["miniButton","false","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],["appearance","outline"],["formControlName","status"],["formGroupName","versionInfo",1,"tb-form-panel","stroked","no-padding-bottom",2,"margin-bottom","21px"],["translate","",1,"tb-form-panel-title"],[1,"flex","flex-col"],[1,"flex","flex-row"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["matInput","","formControlName","minVersion"],["mat-icon-button","","type","button","matTooltipPosition","above",2,"margin-top","4px","color","#00000061",3,"click","matTooltip"],["matInput","","formControlName","latestVersion"],["formGroupName","storeInfo",1,"tb-form-panel","stroked","no-padding-bottom"],["matInput","","formControlName","storeLink",3,"required"],["appearance","outline",4,"ngIf"],[3,"value"],["mat-icon-button","","type","button","matTooltipPosition","above",3,"click","matTooltip"],["matInput","","formControlName","sha256CertFingerprints",3,"required"],["matInput","","formControlName","appId",3,"required"]],template:function(n,t){if(n&1){let s=O();a(0,"section",2)(1,"mat-form-field",3)(2,"mat-label",4),p(3,"mobile.mobile-package"),r(),f(4,"input",5)(5,"tb-copy-button",6),d(6,"translate"),f(7,"mat-hint"),b(8,FD,3,3,"mat-error",7)(9,AD,3,3,"mat-error",7)(10,ND,3,3,"mat-error",7),r(),a(11,"mat-form-field",8)(12,"mat-label",4),p(13,"mobile.platform-type"),r(),a(14,"mat-select",9),b(15,kD,3,4,"mat-option",10),r()(),a(16,"mat-form-field",3)(17,"mat-label",4),p(18,"mobile.application-secret"),r(),f(19,"input",11),d(20,"translate"),a(21,"div",12),b(22,RD,4,3,"button",13),f(23,"tb-copy-button",14),d(24,"translate"),r(),f(25,"mat-hint"),b(26,OD,3,3,"mat-error",7),r(),a(27,"mat-form-field",15)(28,"mat-label",4),p(29,"mobile.status"),r(),a(30,"mat-select",16),b(31,BD,3,4,"mat-option",10),r()(),a(32,"section",17)(33,"div",18),p(34,"mobile.version-information"),r(),a(35,"section",19)(36,"section",20)(37,"mat-form-field",21)(38,"mat-label",4),p(39,"mobile.min-version"),r(),f(40,"input",22)(41,"mat-hint"),b(42,VD,3,3,"mat-error",7),r(),a(43,"button",23,0),d(45,"translate"),y("click",function(_){x(s);let E=U(44);return I(t.editReleaseNote(_,E,!1))}),a(46,"tb-icon"),p(47,"mdi:text-box-edit"),r()()(),a(48,"section",20)(49,"mat-form-field",21)(50,"mat-label",4),p(51,"mobile.latest-version"),r(),f(52,"input",24)(53,"mat-hint"),b(54,LD,3,3,"mat-error",7),r(),a(55,"button",23,1),d(57,"translate"),y("click",function(_){x(s);let E=U(56);return I(t.editReleaseNote(_,E,!0))}),a(58,"tb-icon"),p(59,"mdi:text-box-edit"),r()()()()(),a(60,"section",25)(61,"div",18),p(62,"mobile.store-information"),r(),a(63,"section",19)(64,"mat-form-field",15)(65,"mat-label"),p(66),d(67,"translate"),r(),f(68,"input",26)(69,"tb-copy-button",6),d(70,"translate"),b(71,jD,3,3,"mat-error",7)(72,GD,3,3,"mat-error",7),r(),b(73,WD,8,7,"mat-form-field",27)(74,$D,8,7,"mat-form-field",27),r()()()}n&2&&(l("formGroup",t.entityForm),o(5),T("tooltipText",c(6,25,"mobile.copy-application-package")),l("copyText",t.entityForm.get("pkgName").value),o(3),l("ngIf",t.entityForm.get("pkgName").hasError("required")),o(),l("ngIf",t.entityForm.get("pkgName").hasError("maxlength")),o(),l("ngIf",t.entityForm.get("pkgName").hasError("pattern")),o(5),l("ngForOf",t.platformTypes),o(4),T("placeholder",c(20,27,"mobile.set")),o(3),l("ngIf",t.isEdit),o(),T("tooltipText",c(24,29,"mobile.copy-application-secret")),l("copyText",t.entityForm.get("appSecret").value),o(3),l("ngIf",t.entityForm.get("appSecret").hasError("required")),o(5),l("ngForOf",t.mobileAppStatuses),o(11),l("ngIf",t.entityForm.get("versionInfo.minVersion").hasError("pattern")),o(),T("matTooltip",c(45,31,"mobile.min-version-release-notes")),o(11),l("ngIf",t.entityForm.get("versionInfo.minVersion").hasError("pattern")),o(),T("matTooltip",c(57,33,"mobile.latest-version-release-notes")),o(11),R(c(67,35,t.entityForm.get("platformType").value===t.PlatformType.ANDROID?"mobile.google-play-link":"mobile.app-store-link")),o(2),l("required",t.entityForm.get("status").value==="PUBLISHED"),o(),T("tooltipText",c(70,37,t.entityForm.get("platformType").value===t.PlatformType.ANDROID?"mobile.copy-google-play-link":"mobile.copy-app-store-link")),l("copyText",t.entityForm.get("storeInfo.storeLink").value),o(2),l("ngIf",t.entityForm.get("storeInfo.storeLink").hasError("required")),o(),l("ngIf",t.entityForm.get("storeInfo.storeLink").hasError("pattern")),o(),l("ngIf",t.entityForm.get("platformType").value===t.PlatformType.ANDROID),o(),l("ngIf",t.entityForm.get("platformType").value===t.PlatformType.IOS))},dependencies:[we,V,Ce,ge,me,Ie,zt,De,ei,St,ct,Dt,ue,W,z,ce,X,oe,ft,H,Wa,ji,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}']})}}return i})();C();var yd=(()=>{class i extends Jt{constructor(e){super(e),this.store=e}createMobile(e){this.entitiesTableConfig.getTable().addEntity(e)}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-app-table-header"]],features:[G],decls:10,vars:3,consts:[[1,"flex","flex-full","items-center","justify-between"],[1,"flex","items-center","xs:!hidden"],["tbTruncateWithTooltip","","translate",""],["tb-help","mobileApplication"],["mat-stroked-button","","color","primary",3,"click"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"section",1)(2,"div",2),p(3,"mobile.applications"),r(),f(4,"div",3),r(),a(5,"button",4),y("click",function(u){return t.createMobile(u)}),a(6,"mat-icon"),p(7,"add"),r(),p(8),d(9,"translate"),r()()),n&2&&(o(8),h("",c(9,1,"mobile.add-application")," "))},dependencies:[Tt,K,ee,yo,H,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100000px}']})}}return i})();C();function JD(i,m){i&1&&f(0,"mat-progress-bar",13)}function KD(i,m){i&1&&f(0,"div")}var Cd=(()=>{class i extends et{constructor(e,n,t,s,u,_,E,w){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=s,this.translate=u,this.sanitizer=_,this.fb=E,this.mobileAppService=w,this.deleteVerification=this.fb.control(""),this.deleteVerificationText=this.translate.instant("mobile.delete-application-phrase"),this.deleteApplicationText=this.sanitizer.bypassSecurityTrustHtml(this.translate.instant("mobile.delete-application-text",{phrase:this.deleteVerificationText}))}cancel(){this.dialogRef.close(!1)}delete(){this.mobileAppService.deleteMobileApp(this.data.id).subscribe(()=>{this.dialogRef.close(!0)})}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze),g(Mt),g(ie),g(is),g(ht),g(Gn))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-remove-app-dialog"]],features:[G],decls:24,vars:23,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"flex","flex-col","gap-4"],[1,"select-none",3,"innerHTML"],["appearance","outline","subscriptSizing","dynamic"],["matInput","",3,"formControl","placeholder"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-button","","mat-raised-button","","color","warn","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"]],template:function(n,t){n&1&&(a(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.delete-application"),r(),a(3,"button",2),y("click",function(){return t.cancel()}),a(4,"mat-icon",3),p(5,"close"),r()()(),b(6,JD,1,0,"mat-progress-bar",4),d(7,"async"),b(8,KD,1,0,"div",5),d(9,"async"),a(10,"div",6),f(11,"div",7),a(12,"mat-form-field",8),f(13,"input",9),d(14,"translate"),r()(),a(15,"div",10)(16,"button",11),d(17,"async"),y("click",function(){return t.cancel()}),p(18),d(19,"translate"),r(),a(20,"button",12),d(21,"async"),y("click",function(){return t.delete()}),p(22),d(23,"translate"),r()()),n&2&&(o(6),l("ngIf",c(7,9,t.isLoading$)),o(2),l("ngIf",!c(9,11,t.isLoading$)),o(3),l("innerHTML",t.deleteApplicationText,sn),o(2),T("placeholder",c(14,13,"mobile.type-here")),l("formControl",t.deleteVerification),o(3),l("disabled",c(17,15,t.isLoading$)),o(2),h(" ",c(19,17,"action.suspend")," "),o(2),l("disabled",c(21,19,t.isLoading$)||t.deleteVerification.invalid||t.deleteVerification.value!==t.deleteVerificationText),o(2),h(" ",c(23,21,"mobile.delete-application-button-text")," "))},dependencies:[V,K,Ce,ee,Oe,ge,me,He,Ct,Je,ue,W,Yt,H,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:750px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content 4px minmax(auto,1fr) min-content;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}']})}}return i})();var Sd=(()=>{class i{constructor(e,n,t,s,u){this.translate=e,this.datePipe=n,this.mobileAppService=t,this.truncatePipe=s,this.dialog=u,this.config=new Qe,this.config.selectionEnabled=!1,this.config.entityType=B.MOBILE_APP,this.config.addEnabled=!1,this.config.entitiesDeleteEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=$e.get(B.MOBILE_APP),this.config.entityResources=_t.get(B.MOBILE_APP),this.config.entityComponent=hr,this.config.headerComponent=yd,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("pkgName","mobile.application-package","20%",_=>_.pkgName??"",()=>({}),!1,()=>({}),()=>{},!1,{name:this.translate.instant("mobile.copy-application-package"),icon:"content_copy",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.54)"},isEnabled:_=>!!_.pkgName,onAction:(_,E)=>E.pkgName,type:Va.COPY_BUTTON}),new te("appSecret","mobile.application-secret","15%",_=>this.truncatePipe.transform(_.appSecret,!0,10,"\u2026"),()=>({}),!1,()=>({}),()=>{},!1,{name:this.translate.instant("mobile.copy-application-secret"),icon:"content_copy",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.54)"},isEnabled:_=>!!_.appSecret,onAction:(_,E)=>E.appSecret,type:Va.COPY_BUTTON}),new te("platformType","mobile.platform-type","15%",_=>this.translate.instant(vo.get(_.platformType))),new te("status","mobile.status","15%",_=>`<span style="display: flex;">${this.mobileStatus(_.status)}</span>`,_=>this.mobileStatusStyle(_.status)),new te("minVersion","mobile.min-version","15%",_=>_.versionInfo?.minVersion??"",()=>({}),!1),new te("latestVersion","mobile.latest-version","15%",_=>_.versionInfo?.latestVersion??"",()=>({}),!1)),this.config.entitiesFetchFunction=_=>this.mobileAppService.getTenantMobileAppInfos(_),this.config.loadEntity=_=>this.mobileAppService.getMobileAppInfoById(_.id),this.config.saveEntity=_=>this.mobileAppService.saveMobileApp(_),this.config.deleteEntity=_=>this.mobileAppService.deleteMobileApp(_.id),this.config.cellActionDescriptors=this.configureCellActions()}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("action.delete"),icon:"delete",isEnabled:()=>!0,onAction:(e,n)=>this.deleteEntity(e,n)}]}deleteEntity(e,n){e&&e.stopPropagation(),this.dialog.open(Cd,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{id:n.id.id}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}mobileStatus(e){let n=al.get(e),t="rgba(25, 128, 56, 0.06)";switch(e){case xn.DEPRECATED:t="rgba(250, 164, 5, 0.06)";break;case xn.SUSPENDED:t="rgba(209, 39, 48, 0.06)";break;case xn.DRAFT:t="rgba(0, 148, 255, 0.06)";break}return`<div style="border-radius: 14px; height: 28px; line-height: 20px; padding: 4px 10px;
                        width: fit-content; background-color: ${t}">
                ${this.translate.instant(n)}
            </div>`}mobileStatusStyle(e){let n={fontSize:"14px",color:"#198038"};switch(e){case xn.DEPRECATED:n.color="#FAA405";break;case xn.SUSPENDED:n.color="#D12730";break;case xn.DRAFT:n.color="#0094FF";break}return n}static{this.\u0275fac=function(n){return new(n||i)(N(ie),N(Ge),N(Gn),N(Ga),N(je))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var jh=[{path:"applications",data:{breadcrumb:{menuId:xe.mobile_apps}},children:[{path:"",component:qe,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"mobile.applications"},resolve:{entitiesTableConfig:Sd}},{path:":entityId",component:bt,canDeactivate:[Fe],data:{breadcrumb:{labelFunction:vt,icon:"list"},auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"mobile.applications"},resolve:{entitiesTableConfig:Sd}}]}],YD=[{path:"security-settings/oauth2/mobile-applications",pathMatch:"full",redirectTo:"/mobile-center/applications"}],Td=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Sd],imports:[j.forChild(YD),j]})}}return i})();(function(){Y(Td,{imports:[j],exports:[j]})})();C();C();C();var xd=(()=>{class i extends Jt{constructor(e){super(e),this.store=e}createBundle(e){this.entitiesTableConfig.onEntityAction({event:e,action:"add",entity:null})}static{this.\u0275fac=function(n){return new(n||i)(g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-bundle-table-header"]],features:[G],decls:10,vars:3,consts:[[1,"flex","flex-full","items-center","justify-between"],[1,"flex","items-center","xs:!hidden"],["tbTruncateWithTooltip","","translate",""],["tb-help","mobileBundle"],["mat-stroked-button","","color","primary",3,"click"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"section",1)(2,"div",2),p(3,"mobile.bundles"),r(),f(4,"div",3),r(),a(5,"button",4),y("click",function(u){return t.createBundle(u)}),a(6,"mat-icon"),p(7,"add"),r(),p(8),d(9,"translate"),r()()),n&2&&(o(8),h("",c(9,1,"mobile.add-bundle")," "))},dependencies:[Tt,K,ee,yo,H,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100000px}']})}}return i})();C();C();var XD=["mobileAppComponent"];function ZD(i,m){i&1&&f(0,"mat-progress-bar",13)}function eP(i,m){i&1&&f(0,"div")}var zr=(()=>{class i extends et{constructor(e,n,t,s,u,_){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.mobileAppService=s,this.data=u,this.errorStateMatcher=_,this.submitted=!1}ngAfterViewInit(){setTimeout(()=>{this.mobileAppComponent.entityForm.markAsDirty(),this.mobileAppComponent.entityForm.patchValue({platformType:this.data.platformType}),this.mobileAppComponent.entityForm.get("platformType").disable({emitEvent:!1})},0)}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),s=!!(e&&e.invalid&&this.submitted);return t||s}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0,this.mobileAppComponent.entityForm.valid&&this.mobileAppService.saveMobileApp(this.mobileAppComponent.entityFormValue()).subscribe(e=>this.dialogRef.close(e))}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze),g(Gn),g(Mt),g(hi,4))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-app-dialog"]],viewQuery:function(n,t){if(n&1&&be(XD,7),n&2){let s;ve(s=ye())&&(t.mobileAppComponent=s.first)}},features:[ke([{provide:hi,useExisting:i}]),G],decls:26,vars:21,consts:[["mobileAppComponent",""],[2,"width","850px","max-height","100vh","display","grid","grid-template-rows","min-content 4px minmax(auto, 1fr) min-content",3,"ngSubmit"],["color","primary"],[1,"flex-1"],["tb-help","mobileApplication"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"!p-0"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(n,t){if(n&1){let s=O();a(0,"form",1),y("ngSubmit",function(){return x(s),I(t.save())}),a(1,"mat-toolbar",2)(2,"h2"),p(3),d(4,"translate"),r(),f(5,"span",3)(6,"div",4),a(7,"button",5),y("click",function(){return x(s),I(t.cancel())}),a(8,"mat-icon",6),p(9,"close"),r()()(),b(10,ZD,1,0,"mat-progress-bar",7),d(11,"async"),b(12,eP,1,0,"div",8),d(13,"async"),a(14,"div",9),f(15,"tb-mobile-app",null,0),r(),a(17,"div",10)(18,"button",11),d(19,"async"),y("click",function(){return x(s),I(t.cancel())}),p(20),d(21,"translate"),r(),a(22,"button",12),d(23,"async"),p(24),d(25,"translate"),r()()()}if(n&2){let s=U(16);o(3),R(c(4,7,"mobile.add-application")),o(7),l("ngIf",c(11,9,t.isLoading$)),o(2),l("ngIf",!c(13,11,t.isLoading$)),o(6),l("disabled",c(19,13,t.isLoading$)),o(2),h(" ",c(21,15,"action.cancel")," "),o(2),l("disabled",c(23,17,t.isLoading$)||(s.entityForm==null?null:s.entityForm.invalid)||!(s.entityForm!=null&&s.entityForm.dirty)),o(2),h(" ",c(25,19,"action.add")," ")}},dependencies:[V,Tt,K,Ce,ee,Oe,He,Ct,Je,fe,z,Yi,hr,le,k],encapsulation:2})}}return i})();C();C();C();function tP(i,m){if(i&1&&(a(0,"mat-option",12),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit,n=v();l("value",e),o(),h(" ",c(2,2,n.mobilePageTypeTranslations.get(e))," ")}}function iP(i,m){i&1&&(Ut(0),f(1,"tb-dashboard-autocomplete",13),d(2,"translate"),d(3,"translate"),qt()),i&2&&(o(),T("label",c(2,3,"dashboard.dashboard")),T("placeholder",c(3,5,"dashboard.select-dashboard")),l("selectFirstDashboard",!1))}function nP(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.url-pattern")," "))}function oP(i,m){if(i&1&&(Ut(0),a(1,"mat-form-field",5)(2,"mat-label",6),p(3,"mobile.url"),r(),f(4,"input",14)(5,"mat-hint"),b(6,nP,3,3,"mat-error",11),r(),qt()),i&2){let e=v();o(6),l("ngIf",e.customMobilePageForm.get("url").hasError("pattern"))}}function aP(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.path-pattern")," "))}function rP(i,m){if(i&1&&(Ut(0),a(1,"mat-form-field",5)(2,"mat-label",6),p(3,"mobile.path"),r(),f(4,"input",15)(5,"mat-hint"),b(6,aP,3,3,"mat-error",11),r(),qt()),i&2){let e=v();o(6),l("ngIf",e.customMobilePageForm.get("path").hasError("pattern"))}}var br=(()=>{class i{constructor(e,n){this.fb=e,this.store=n,this.mobilePagesTypes=[Xi.DASHBOARD,Xi.WEB_VIEW,Xi.CUSTOM],this.MobilePageType=Xi,this.mobilePageTypeTranslations=rl,this.customMobilePageForm=this.fb.group({visible:[!0],icon:["star"],label:["",S.required],type:[Xi.DASHBOARD],dashboardId:["",S.required],url:[{value:"",disabled:!0},[S.required,S.pattern(/^(https?:\/\/)?(localhost|([\w\-]+\.)+[\w\-]+)(:\d+)?(\/[\w\-._~:\/?#[\]@!$&'()*+,;=%]*)?$/)]],path:[{value:"",disabled:!0},[S.required,S.pattern(/^(\/[\w\-._~:\/?#[\]@!$&'()*+,;=%]*)?$/)]]}),this.propagateChange=t=>{},this.customMobilePageForm.get("type").valueChanges.pipe(ai()).subscribe(t=>{switch(this.customMobilePageForm.get("dashboardId").disable({emitEvent:!1}),this.customMobilePageForm.get("url").disable({emitEvent:!1}),this.customMobilePageForm.get("path").disable({emitEvent:!1}),t){case Xi.DASHBOARD:this.customMobilePageForm.get("dashboardId").enable({emitEvent:!1});break;case Xi.WEB_VIEW:this.customMobilePageForm.get("url").enable({emitEvent:!1});break;case Xi.CUSTOM:this.customMobilePageForm.get("path").enable({emitEvent:!1});break}}),Bt(this.store).authority===M.SYS_ADMIN&&(this.mobilePagesTypes.shift(),this.customMobilePageForm.get("type").setValue(Xi.WEB_VIEW)),this.customMobilePageForm.valueChanges.pipe(ai()).subscribe(t=>this.propagateChange(t))}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.customMobilePageForm.disable({emitEvent:!1}):(this.customMobilePageForm.enable({emitEvent:!1}),this.customMobilePageForm.get("type").updateValueAndValidity({onlySelf:!0}))}validate(){return this.customMobilePageForm.valid?null:{invalidCustomMobilePageForm:!0}}writeValue(e){this.customMobilePageForm.patchValue(e,{emitEvent:!1})}static{this.\u0275fac=function(n){return new(n||i)(g(ht),g(P))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-page-item"]],inputs:{disabled:[2,"disabled","disabled",da]},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}]),la],decls:19,vars:8,consts:[[1,"mobile-page-form",3,"formGroup"],[1,"tb-form-row","space-between"],["formControlName","visible",1,"mat-slide","fixed-title-width"],[1,"flex","items-center","justify-center","gap-2"],["asBoxInput","","required","","color","#305680","formControlName","icon"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["translate",""],["required","","matInput","","formControlName","label"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],["formControlName","dashboardId","required","","floatLabel","always","appearance","outline","subscriptSizing","dynamic","requiredText","dashboard.dashboard-required",1,"flex-1",3,"label","placeholder","selectFirstDashboard"],["required","","matInput","","formControlName","url"],["required","","matInput","","formControlName","path"]],template:function(n,t){n&1&&(a(0,"section",0)(1,"div",1)(2,"mat-slide-toggle",2),p(3),d(4,"translate"),r()(),a(5,"div",3),f(6,"tb-material-icon-select",4),a(7,"mat-form-field",5)(8,"mat-label",6),p(9,"mobile.page-name"),r(),f(10,"input",7),r()(),a(11,"mat-form-field",8)(12,"mat-label",6),p(13,"mobile.page-type"),r(),a(14,"mat-select",9),b(15,tP,3,4,"mat-option",10),r()(),b(16,iP,4,7,"ng-container",11)(17,oP,7,1,"ng-container",11)(18,rP,7,1,"ng-container",11),r()),n&2&&(l("formGroup",t.customMobilePageForm),o(3),h(" ",c(4,6,"mobile.visible")," "),o(12),l("ngForOf",t.mobilePagesTypes),o(),l("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.DASHBOARD),o(),l("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.WEB_VIEW),o(),l("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.CUSTOM))},dependencies:[we,V,_n,ge,me,Ie,zt,De,St,ct,it,ue,W,z,ce,X,oe,To,H,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}[_nghost-%COMP%]   .mobile-page-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}']})}}return i})();var Id=(()=>{class i extends et{constructor(e,n,t,s){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.fb=s,this.customMobilePage=this.fb.control(null)}cancel(){this.dialogRef.close(null)}save(){if(this.customMobilePage.valid){let e=to(this.customMobilePage.value);this.dialogRef.close(e)}}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze),g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-add-mobile-page-dialog"]],features:[G],decls:17,vars:13,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],[3,"formControl"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(a(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.add-specific-page"),r(),a(3,"button",2),y("click",function(){return t.cancel()}),a(4,"mat-icon",3),p(5,"close"),r()()(),a(6,"div",4),f(7,"tb-mobile-page-item",5),r(),a(8,"div",6)(9,"button",7),d(10,"async"),y("click",function(){return t.cancel()}),p(11),d(12,"translate"),r(),a(13,"button",8),d(14,"async"),y("click",function(){return t.save()}),p(15),d(16,"translate"),r()()),n&2&&(o(7),l("formControl",t.customMobilePage),o(2),l("disabled",c(10,5,t.isLoading$)),o(2),h(" ",c(12,7,"action.cancel")," "),o(2),l("disabled",c(14,9,t.isLoading$)||t.customMobilePage.invalid||!t.customMobilePage.dirty),o(2),h(" ",c(16,11,"action.add")," "))},dependencies:[K,Ce,ee,He,Ct,Je,W,Yt,H,br,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:600px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .mobile-page-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}']})}}return i})();C();C();var Ed=(()=>{class i{constructor(e){this.fb=e,this.customMobilePageApplied=new rt,this.mobilePageControl=this.fb.control(null)}ngOnInit(){this.mobilePageControl.setValue(this.pageItem,{emitEvent:!1}),this.disabled&&this.mobilePageControl.disable({emitEvent:!1})}cancel(){this.popover?.hide()}apply(){if(this.mobilePageControl.valid){let e=this.mobilePageControl.value;this.customMobilePageApplied.emit(e)}}static{this.\u0275fac=function(n){return new(n||i)(g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-custom-menu-item-panel"]],inputs:{disabled:"disabled",pageItem:"pageItem",popover:"popover"},outputs:{customMobilePageApplied:"customMobilePageApplied"},decls:12,vars:8,consts:[[1,"tb-custom-mobile-page-panel"],["translate","",1,"tb-custom-mobile-page-title"],[1,"tb-custom-mobile-page-panel-content"],[3,"formControl"],[1,"tb-custom-mobile-page-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1),p(2,"mobile.edit-custom-page"),r(),a(3,"div",2),f(4,"tb-mobile-page-item",3),r(),a(5,"div",4)(6,"button",5),y("click",function(){return t.cancel()}),p(7),d(8,"translate"),r(),a(9,"button",6),y("click",function(){return t.apply()}),p(10),d(11,"translate"),r()()()),n&2&&(o(4),l("formControl",t.mobilePageControl),o(3),h(" ",c(8,4,"action.cancel")," "),o(2),l("disabled",t.mobilePageControl.invalid||!t.mobilePageControl.dirty),o(),h(" ",c(11,6,"action.apply")," "))},dependencies:[K,W,Yt,H,br,k],styles:[`@charset "UTF-8";.tb-custom-mobile-page-panel{width:500px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-custom-mobile-page-panel{width:90vw}}.tb-custom-mobile-page-panel .tb-custom-mobile-page-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-custom-mobile-page-panel .tb-custom-mobile-page-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-custom-mobile-page-panel .tb-custom-mobile-page-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();C();function sP(i,m){if(i&1){let e=O();a(0,"button",15),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.cleanup())}),a(2,"tb-icon",16),p(3,"mdi:broom"),r()()}if(i&2){let e=v();T("matTooltip",c(1,3,"mobile.reset-to-page-default")),l("disabled",!e.isCleanupEnabled),o(2),l("color",e.isCleanupEnabled?"primary":null)}}var wd=(()=>{class i{constructor(e){this.fb=e,this.defaultMobilePageApplied=new rt,this.mobilePageFormGroup=this.fb.group({visible:[!0],icon:[""],label:[""]}),this.isCleanupEnabled=!1,this.destroyRef=Zt(Yr)}ngOnInit(){this.defaultMobilePages=Mr.get(this.pageItem.id),this.defaultItemName=this.defaultMobilePages.label,this.mobilePageFormGroup.patchValue({label:this.pageItem.label,icon:this.pageItem.icon?this.pageItem.icon:this.defaultMobilePages.icon,visible:this.pageItem.visible},{emitEvent:!1}),this.disabled?this.mobilePageFormGroup.disable({emitEvent:!1}):(this.mobilePageFormGroup.valueChanges.pipe(ai(this.destroyRef)).subscribe(()=>{this.updateModel()}),this.updateCleanupState())}cancel(){this.popover?.hide()}apply(){this.defaultMobilePageApplied.emit(this.pageItem)}cleanup(){this.mobilePageFormGroup.patchValue({visible:!er.includes(this.pageItem.id),icon:this.defaultMobilePages.icon,label:null},{emitEvent:!1}),this.mobilePageFormGroup.markAsDirty(),this.updateModel()}updateCleanupState(){this.isCleanupEnabled=(er.includes(this.pageItem.id)?this.pageItem.visible:!this.pageItem.visible)||!!this.pageItem.label||!!this.pageItem.icon}updateModel(){this.pageItem.visible=this.mobilePageFormGroup.get("visible").value;let e=this.mobilePageFormGroup.get("label").value;e?this.pageItem.label=e:delete this.pageItem.label;let n=this.mobilePageFormGroup.get("icon").value;n!==this.defaultMobilePages.icon?this.pageItem.icon=n:delete this.pageItem.icon,this.updateCleanupState()}static{this.\u0275fac=function(n){return new(n||i)(g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-default-mobile-page-panel"]],inputs:{disabled:"disabled",pageItem:"pageItem",popover:"popover"},outputs:{defaultMobilePageApplied:"defaultMobilePageApplied"},decls:23,vars:13,consts:[[1,"tb-default-mobile-page-panel",3,"formGroup"],[1,"tb-default-mobile-page-title-container"],["translate","",1,"tb-default-mobile-page-title"],["type","button","mat-stroked-button","","class","tb-box-button","matTooltipPosition","above",3,"disabled","matTooltip","click",4,"ngIf"],[1,"tb-default-mobile-page-panel-content"],[1,"tb-form-row","space-between"],["formControlName","visible",1,"mat-slide","fixed-title-width"],[1,"flex","items-center","justify-center","gap-2"],["asBoxInput","","color","#305680","formControlName","icon"],["appearance","outline","subscriptSizing","dynamic","floatLabel","always",1,"flex-1"],["translate",""],["matInput","","formControlName","label",3,"placeholder"],[1,"tb-default-mobile-page-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["type","button","mat-stroked-button","","matTooltipPosition","above",1,"tb-box-button",3,"click","disabled","matTooltip"],["matButtonIcon","",3,"color"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),p(3,"mobile.edit-page"),r(),b(4,sP,4,5,"button",3),r(),a(5,"div",4)(6,"div",5)(7,"mat-slide-toggle",6),p(8),d(9,"translate"),r()(),a(10,"div",7),f(11,"tb-material-icon-select",8),a(12,"mat-form-field",9)(13,"mat-label",10),p(14,"mobile.page-name"),r(),f(15,"input",11),r()()(),a(16,"div",12)(17,"button",13),y("click",function(){return t.cancel()}),p(18),d(19,"translate"),r(),a(20,"button",14),y("click",function(){return t.apply()}),p(21),d(22,"translate"),r()()()),n&2&&(l("formGroup",t.mobilePageFormGroup),o(4),l("ngIf",!t.disabled),o(4),h(" ",c(9,7,"mobile.visible")," "),o(7),T("placeholder",t.defaultItemName),o(3),h(" ",c(19,9,"action.cancel")," "),o(2),l("disabled",t.mobilePageFormGroup.invalid||!t.mobilePageFormGroup.dirty),o(),h(" ",c(22,11,"action.apply")," "))},dependencies:[V,K,ge,me,Ie,Dt,it,ue,W,z,X,oe,To,H,ji,k],styles:[`@charset "UTF-8";.tb-default-mobile-page-panel{width:500px;display:flex;flex-direction:column;gap:16px;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}@media screen and (max-width: 959px){.tb-default-mobile-page-panel{width:90vw}}.tb-default-mobile-page-panel .tb-default-mobile-page-title-container{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.tb-default-mobile-page-panel .tb-default-mobile-page-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-default-mobile-page-panel .tb-default-mobile-page-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-default-mobile-page-panel .tb-default-mobile-page-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();var lP=[[["",8,"tb-custom-menu-item-row-prefix"]]],pP=[".tb-custom-menu-item-row-prefix"];function mP(i,m){i&1&&(a(0,"mat-icon",17),d(1,"translate"),p(2," warning "),r()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-required"))}function dP(i,m){if(i&1&&(a(0,"mat-form-field",18),f(1,"input",19),r()),i&2){let e=v();o(),l("placeholder",e.itemInfo)}}function cP(i,m){if(i&1){let e=O();a(0,"button",20,0),d(2,"translate"),y("click",function(t){x(e);let s=U(1),u=v();return I(u.edit(t,s))}),a(3,"mat-icon"),p(4,"edit"),r()()}i&2&&T("matTooltip",c(2,1,"mobile.edit-page"))}function uP(i,m){if(i&1){let e=O();a(0,"button",21),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.cleanup())}),a(2,"tb-icon"),p(3,"mdi:broom"),r()()}if(i&2){let e=v();T("matTooltip",c(1,2,"mobile.reset-to-page-default")),l("disabled",!e.isCleanupEnabled)}}function fP(i,m){if(i&1){let e=O();a(0,"button",22),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.delete())}),a(2,"mat-icon"),p(3,"delete"),r()()}i&2&&T("matTooltip",c(1,1,"mobile.delete-page"))}var Md=(()=>{class i{constructor(e,n,t,s,u,_){this.fb=e,this.cd=n,this.popoverService=t,this.renderer=s,this.viewContainerRef=u,this.translate=_,this.maxIconNameBlockWidth=256,this.pageRemoved=new rt,this.iconNameBlockWidth="256px",this.isDefaultMenuItem=!1,this.isCustomMenuItem=!1,this.isCleanupEnabled=!1,this.mobilePageRowForm=this.fb.group({visible:[!0,[]],icon:["",[]],label:["",[]],type:[Xi.DEFAULT]}),this.propagateChange=E=>{},this.destroyRef=Zt(Yr),this.mobilePageRowForm.valueChanges.pipe(ai()).subscribe(()=>this.updateModel())}ngOnInit(){this.updateIconNameBlockWidth(),this.hideItems&&this.hideItems.pipe(ai(this.destroyRef)).subscribe(()=>{!this.disabled&&this.modelValue.visible&&this.mobilePageRowForm.patchValue({visible:!1},{emitEvent:!0})})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.mobilePageRowForm.disable({emitEvent:!1}):this.mobilePageRowForm.enable({emitEvent:!1})}validate(){return this.mobilePageRowForm.valid?null:{invalidMobileMenuItem:!0}}writeValue(e){if(this.modelValue=e,this.mobilePageRowForm.patchValue({visible:e.visible,icon:e.icon,label:e.label},{emitEvent:!1}),this.modelValue.type===Xi.DEFAULT){this.isDefaultMenuItem=!0;let n=this.modelValue;Mr.has(n.id)&&(this.defaultMobilePages=Mr.get(n.id),this.defaultItemName=this.defaultMobilePages.label,e.icon||this.mobilePageRowForm.patchValue({icon:this.defaultMobilePages.icon},{emitEvent:!1}))}else this.isCustomMenuItem=!0,this.mobilePageRowForm.get("label").setValidators([S.required]),this.mobilePageRowForm.get("label").updateValueAndValidity({emitEvent:!1});this.updateCleanupState(),this.updateItemInfo(),this.cd.markForCheck()}cleanup(){let e=!er.includes(this.modelValue.id);this.mobilePageRowForm.patchValue({visible:e,icon:this.defaultMobilePages.icon,label:null},{emitEvent:!1}),this.modelValue.visible=e,delete this.modelValue.icon,delete this.modelValue.label,this.updateModel()}delete(){this.pageRemoved.emit()}edit(e,n){e&&e.stopPropagation();let t=n._elementRef.nativeElement;if(this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let s={disabled:this.disabled,pageItem:Ue(this.modelValue)};if(this.isDefaultMenuItem){let u=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,wd,["right","bottom","top"],!0,null,s,{},{},{},!1,()=>{},{padding:"16px 24px"});u.tbComponentRef.instance.popover=u,u.tbComponentRef.instance.defaultMobilePageApplied.subscribe(_=>{u.hide(),this.afterPageEdit(_)})}else{let u=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,Ed,["right","bottom","top"],!0,null,s,{},{},{},!1,()=>{},{padding:"16px 24px"});u.tbComponentRef.instance.popover=u,u.tbComponentRef.instance.customMobilePageApplied.subscribe(_=>{u.hide(),this.afterPageEdit(_)})}}}get itemName(){return this.isDefaultMenuItem?this.defaultItemName:this.mobilePageRowForm.get("label").value}get itemNamePlaceholder(){return this.isDefaultMenuItem?this.defaultItemName:""}updateIconNameBlockWidth(){this.maxIconNameBlockWidth?this.iconNameBlockWidth=`${this.maxIconNameBlockWidth}px`:this.iconNameBlockWidth="100%"}updateModel(){this.modelValue.visible=this.mobilePageRowForm.get("visible").value;let e=this.mobilePageRowForm.get("label").value;e?this.modelValue.label=e:delete this.modelValue.label;let n=this.mobilePageRowForm.get("icon").value;this.isDefaultMenuItem&&this.defaultMobilePages.icon===n&&(n=null),n?this.modelValue.icon=n:delete this.modelValue.icon,this.updateCleanupState(),this.updateItemInfo(),this.propagateChange(this.modelValue)}updateCleanupState(){this.isDefaultMenuItem&&(this.isCleanupEnabled=(er.includes(this.modelValue.id)?this.modelValue.visible:!this.modelValue.visible)||!!this.modelValue.label||!!this.modelValue.icon)}updateItemInfo(){this.isCustomMenuItem?this.itemInfo=this.translate.instant(rl.get(this.modelValue.type)):this.itemInfo=""}afterPageEdit(e){this.mobilePageRowForm.patchValue({visible:e.visible,icon:e.icon||(this.isDefaultMenuItem?this.defaultMobilePages.icon:null),label:e.label},{emitEvent:!1}),this.isCustomMenuItem&&(this.modelValue=e),this.updateModel()}static{this.\u0275fac=function(n){return new(n||i)(g(ht),g(Xe),g(Sn),g(un),g(ki),g(ie))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-menu-item-row"]],inputs:{disabled:[2,"disabled","disabled",da],maxIconNameBlockWidth:[2,"maxIconNameBlockWidth","maxIconNameBlockWidth",ou],hideItems:"hideItems"},outputs:{pageRemoved:"pageRemoved"},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}]),la],ngContentSelectors:pP,decls:19,vars:14,consts:[["editButton",""],[1,"tb-mobile-page-item-row-component-container"],[1,"tb-mobile-page-item-row-component"],[1,"tb-form-row",3,"formGroup"],[1,"tb-mobile-page-item-start-block"],[1,"tb-mobile-page-item-icon-name-block"],["matTooltipPosition","above","formControlName","visible",3,"matTooltip"],["asBoxInput","","color","#305680","formControlName","icon"],["tbTruncateWithTooltip",""],[1,"tb-mobile-page-item-input-block","xs:!hidden"],["appearance","outline","subscriptSizing","dynamic",1,"tb-suffix-absolute","flex"],["matInput","","formControlName","label",3,"required","placeholder"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["class","tb-mobile-page-item-info flex","appearance","outline","subscriptSizing","dynamic",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],["appearance","outline","subscriptSizing","dynamic",1,"tb-mobile-page-item-info","flex"],["matInput","","readonly","",3,"placeholder"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["mat-icon-button","","matTooltipPosition","above",3,"click","disabled","matTooltip"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"]],template:function(n,t){n&1&&(pa(lP),a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),uo(4),a(5,"div",5),f(6,"mat-slide-toggle",6),d(7,"translate"),f(8,"tb-material-icon-select",7),a(9,"div",8),p(10),r()()(),a(11,"div",9)(12,"mat-form-field",10),f(13,"input",11),b(14,mP,3,3,"mat-icon",12),r(),b(15,dP,2,1,"mat-form-field",13),r()(),b(16,cP,5,3,"button",14)(17,uP,4,4,"button",15)(18,fP,4,3,"button",16),r()()),n&2&&(o(2),l("formGroup",t.mobilePageRowForm),o(3),Qi("width",t.iconNameBlockWidth),o(),T("matTooltip",c(7,12,t.mobilePageRowForm.get("visible").value?"mobile.visible":"mobile.hidden")),o(4),h(" ",t.itemName," "),o(3),T("placeholder",t.itemNamePlaceholder),l("required",t.isCustomMenuItem),o(),l("ngIf",t.mobilePageRowForm.get("label").hasError("required")&&t.mobilePageRowForm.get("label").touched),o(),l("ngIf",t.isCustomMenuItem),o(),l("ngIf",!t.disabled),o(),l("ngIf",!t.disabled&&t.isDefaultMenuItem),o(),l("ngIf",!t.disabled&&t.isCustomMenuItem))},dependencies:[V,Ce,ee,ge,me,ei,Dt,it,ue,W,z,ce,X,oe,To,yo,ji,k],styles:[`@charset "UTF-8";.tb-mobile-page-item-row-component-container{display:flex;flex-direction:column;gap:0}.tb-mobile-page-item-row-component{display:flex;gap:8px;align-items:center}@media screen and (max-width: 599px){.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle){width:24px;height:24px;line-height:24px;padding:0!important}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-icon{display:block;margin:auto}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-mdc-button-touch-target{width:24px;height:24px}}@media screen and (min-width: 600px) and (max-width: 959px){.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle){width:32px;height:32px;line-height:32px;padding:0!important}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-icon{display:block;margin:auto}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-mdc-button-touch-target{width:32px;height:32px}}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(:disabled) .mat-icon{color:#0000008a}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:disabled .mat-icon{color:#0000001f}.tb-mobile-page-item-row-component .tb-form-row{flex:1;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-start-block{display:flex;align-items:center;gap:0;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-icon-name-block{display:flex;align-items:center;gap:12px;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-input-block{display:flex;gap:8px;flex:1}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input{cursor:default}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input::placeholder{color:#359b07}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input:-ms-input-placeholder{color:#359b07}
`],encapsulation:2})}}return i})();var hP=["mobilePagesContainer"];function bP(i,m){if(i&1){let e=O();a(0,"button",12),y("click",function(){x(e);let t=v();return I(t.hideAll())}),a(1,"tb-icon",13),p(2,"visibility_off"),r(),a(3,"div",14),p(4),d(5,"translate"),r()()}i&2&&(o(4),R(c(5,1,"mobile.hide-all-pages")))}function vP(i,m){if(i&1){let e=O();a(0,"button",12),y("click",function(){x(e);let t=v();return I(t.resetToDefault())}),a(1,"tb-icon",13),p(2,"mdi:broom"),r(),a(3,"div",14),p(4),d(5,"translate"),r()()}i&2&&(o(4),R(c(5,1,"mobile.reset-to-default-pages")))}function yP(i,m){if(i&1){let e=O();a(0,"button",15),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.hideAll())}),a(2,"tb-icon",16),p(3,"visibility_off"),r()()}i&2&&T("matTooltip",c(1,1,"mobile.hide-all-pages"))}function _P(i,m){if(i&1){let e=O();a(0,"button",15),d(1,"translate"),y("click",function(){x(e);let t=v();return I(t.resetToDefault())}),a(2,"tb-icon",16),p(3,"mdi:broom"),r()()}i&2&&T("matTooltip",c(1,1,"mobile.reset-to-default-pages"))}function CP(i,m){i&1&&(a(0,"div",23),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.custom-page")," "))}function SP(i,m){i&1&&(a(0,"button",24),d(1,"translate"),a(2,"tb-icon"),p(3,"drag_indicator"),r()()),i&2&&T("matTooltip",c(1,1,"action.drag"))}function TP(i,m){if(i&1&&(a(0,"span",29),p(1),d(2,"translate"),r()),i&2){let e=v(2).index,n=v();o(),R(c(2,1,n.getDividerLabel(e)))}}function xP(i,m){if(i&1){let e=O();a(0,"button",25),d(1,"translate"),y("click",function(){x(e);let t=v().index,s=v();return I(s.addCustomMobilePage(t))}),a(2,"div",26)(3,"mat-icon",27),p(4,"add"),r(),b(5,TP,3,3,"span",28),r()()}if(i&2){let e=v().index,n=v();L("divider",n.showMenuDivider(e)),T("matTooltip",c(1,4,"mobile.add-specific-page")),o(5),l("ngIf",n.showMenuDivider(e))}}function IP(i,m){if(i&1){let e=O();a(0,"div",17)(1,"div",18),b(2,CP,3,3,"div",19)(3,SP,4,3,"button",20),a(4,"tb-mobile-menu-item-row",21),y("pageRemoved",function(){let t=x(e).index,s=v();return I(s.removeCustomPage(t))}),r()(),b(5,xP,6,6,"button",22),r()}if(i&2){let e=m.$implicit,n=m.last,t=v();o(),l("cdkDragDisabled",!t.dragEnabled),o(),l("ngIf",t.isCustom(e)),o(),l("ngIf",t.dragEnabled),o(),l("formControl",e)("maxIconNameBlockWidth",t.maxIconNameBlockWidth)("hideItems",t.hideItems$),o(),l("ngIf",!n&&!t.readonly)}}function EP(i,m){if(i&1){let e=O();a(0,"button",30),y("click",function(){x(e);let t=v();return I(t.addCustomMobilePage())}),a(1,"mat-icon",31),p(2,"add"),r(),a(3,"span",32),p(4,"mobile.add-specific-page"),r()()}}var Dd=(()=>{class i{constructor(e,n,t){this.fb=e,this.breakpointObserver=n,this.dialog=t,this.pagesForm=this.fb.group({pages:this.fb.array([])}),this.maxIconNameBlockWidth=256,this.showHiddenPages=new xa(!0),this.hideItemsSubject=new Ft,this.hideItems$=this.hideItemsSubject.asObservable(),this.propagateChange=s=>{},this.pagesForm.valueChanges.pipe(ai()).subscribe(()=>this.updateModel()),this.breakpointObserver.observe([Ri.xs,Ri["gt-xs"],Ri["gt-sm"]]).pipe(ai()).subscribe(()=>{this.computeMaxIconNameBlockWidth()}),this.computeMaxIconNameBlockWidth()}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){e?this.pagesForm.disable({emitEvent:!1}):this.pagesForm.enable({emitEvent:!1})}writeValue(e){let n=this.prepareMobilePages(e);this.pagesForm.setControl("pages",this.prepareMobilePagesFormArray(n))}validate(e){return this.pagesForm.valid?null:{invalidLayoutForm:!0}}hideAll(){this.hideItemsSubject.next(),this.showHiddenPages.value&&this.showHiddenPages.setValue(!1)}resetToDefault(){if(!mc(this.pagesForm.value.pages)){let e=this.prepareMobilePages(null);this.pagesForm.setControl("pages",this.prepareMobilePagesFormArray(e))}}get dragEnabled(){return!this.readonly&&this.visibleMobilePagesControls().length>1}visibleMobilePagesControls(){return this.pagesFormArray().controls.filter(e=>this.showHiddenPages.value||e.value.visible)}mobileItemDrop(e){let n=this.pagesFormArray(),t=this.visibleMobilePagesControls()[e.previousIndex],s=this.actualMobilePageIndex(e.previousIndex),u=this.actualMobilePageIndex(e.currentIndex);n.removeAt(s),n.insert(u,t),this.pagesForm.markAsDirty()}trackByMenuItem(e,n){return n}addCustomMobilePage(e){this.dialog.open(Id,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(n=>{if(n){let t=this.pagesFormArray(),s=this.fb.control(n,[]);if(eo(e)){let u=this.actualMobilePageIndex(e)+1;t.insert(u,s)}else t.push(s),setTimeout(()=>{this.mobilePagesContainer.nativeElement.scrollTop=this.mobilePagesContainer.nativeElement.scrollHeight},0);this.pagesForm.markAsDirty()}})}isCustom(e){return e.value.type!==Xi.DEFAULT}removeCustomPage(e){this.pagesFormArray().removeAt(this.actualMobilePageIndex(e)),this.pagesForm.markAsDirty()}showMenuDivider(e){return dc.has(e)}getDividerLabel(e){return dc.get(e)}updateModel(){mc(this.pagesForm.value.pages)?this.propagateChange({pages:[]}):this.propagateChange(this.pagesForm.value)}prepareMobilePages(e){return e?.pages?.length?e.pages:hg()}prepareMobilePagesFormArray(e){let n=[];return e.forEach(t=>{n.push(this.fb.control(Ue(t)))}),this.fb.array(n)}computeMaxIconNameBlockWidth(){this.breakpointObserver.isMatched(Ri["gt-sm"])?this.maxIconNameBlockWidth=256:this.breakpointObserver.isMatched(Ri["gt-xs"])?this.maxIconNameBlockWidth=200:this.maxIconNameBlockWidth=0}pagesFormArray(){return this.pagesForm.get("pages")}actualMobilePageIndex(e){let n=this.visibleMobilePagesControls()[e];return this.pagesFormArray().controls.indexOf(n)}static{this.\u0275fac=function(n){return new(n||i)(g(ht),g(ho),g(je))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-layout"]],viewQuery:function(n,t){if(n&1&&be(hP,5),n&2){let s;ve(s=ye())&&(t.mobilePagesContainer=s.first)}},inputs:{readonly:[2,"readonly","readonly",da]},features:[ke([{provide:We,useExisting:Pe(()=>i),multi:!0},{provide:kt,useExisting:Pe(()=>i),multi:!0}]),la],decls:17,vars:12,consts:[["mobilePagesContainer",""],[1,"mobile-layout-container"],[1,"header","flex","items-center","gap-2"],[1,"title-section"],["tbTruncateWithTooltip","","translate","",1,"title-container"],[1,"whitespace-nowrap","xs:!hidden",3,"formControl"],[1,"flex-1"],["class","tb-mobile-layout-button lt-lg:!hidden","mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["type","button","mat-stroked-button","","class","tb-box-button gt-md:!hidden","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-drop-list","tb-mobile-items-container",3,"cdkDropListDropped","cdkDropListDisabled"],["class","tb-mobile-item-row-container",4,"ngFor","ngForOf","ngForTrackBy"],["mat-button","","color","primary","class","tb-primary-fill","style","min-height: 52px;",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",1,"tb-mobile-layout-button","lt-lg:!hidden",3,"click"],["matButtonIcon",""],["tbTruncateWithTooltip",""],["type","button","mat-stroked-button","","matTooltipPosition","above",1,"tb-box-button","gt-md:!hidden",3,"click","matTooltip"],["color","primary","matButtonIcon",""],[1,"tb-mobile-item-row-container"],["cdkDrag","",1,"tb-draggable","tb-mobile-item-row",3,"cdkDragDisabled"],["class","tb-mobile-item-label",4,"ngIf"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above","class","tb-mat-40 tb-drag-handle",3,"matTooltip",4,"ngIf"],[2,"flex","1","min-width","0",3,"pageRemoved","formControl","maxIconNameBlockWidth","hideItems"],["class","tb-add-mobile-item-button","mat-button","","matTooltipPosition","above","color","primary",3,"divider","matTooltip","click",4,"ngIf"],[1,"tb-mobile-item-label"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-40","tb-drag-handle",3,"matTooltip"],["mat-button","","matTooltipPosition","above","color","primary",1,"tb-add-mobile-item-button",3,"click","matTooltip"],[1,"tb-add-mobile-label-container","tb-primary-fill"],["color","primary",1,"tb-mat-18"],["class","tb-mobile-divider-label",4,"ngIf"],[1,"tb-mobile-divider-label"],["mat-button","","color","primary",1,"tb-primary-fill",2,"min-height","52px",3,"click"],["color","primary"],["translate",""]],template:function(n,t){if(n&1){let s=O();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),p(4,"mobile.pages"),r(),a(5,"mat-slide-toggle",5),p(6),d(7,"translate"),r()(),f(8,"span",6),b(9,bP,6,3,"button",7)(10,vP,6,3,"button",7)(11,yP,4,3,"button",8)(12,_P,4,3,"button",8),r(),a(13,"div",9,0),y("cdkDropListDropped",function(_){return x(s),I(t.mobileItemDrop(_))}),b(15,IP,6,7,"div",10),r(),b(16,EP,5,0,"button",11),r()}n&2&&(o(5),l("formControl",t.showHiddenPages),o(),R(c(7,10,"mobile.show-hidden-pages")),o(3),l("ngIf",!t.readonly),o(),l("ngIf",!t.readonly),o(),l("ngIf",!t.readonly),o(),l("ngIf",!t.readonly),o(),l("cdkDropListDisabled",!t.dragEnabled),o(2),l("ngForOf",t.visibleMobilePagesControls())("ngForTrackBy",t.trackByMenuItem),o(),l("ngIf",!t.readonly))},dependencies:[we,V,K,Ce,ee,Dt,it,Lo,Vo,Bo,W,Yt,yo,H,ji,Md,k],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:24px;min-width:0}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.1px}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .tb-mobile-items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;min-height:0;overflow:auto;padding-top:8px;padding-bottom:8px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]{min-width:120px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]   tb-icon[_ngcontent-%COMP%]{min-width:18px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]   .mdc-button__label[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button{height:24px;opacity:0;transition:all .2s}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider{opacity:1}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple{border-bottom-style:dashed;border-bottom-width:1px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .tb-add-mobile-label-container{vertical-align:middle}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .tb-add-mobile-label-container .mat-icon{display:none}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .mat-mdc-button-persistent-ripple{border-bottom-style:inherit;border-bottom-width:inherit}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container{vertical-align:sub}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container .mat-icon{display:inline-block}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container .tb-mobile-divider-label{display:none}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple{top:11px;bottom:11px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple:before{opacity:.32}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:hover{opacity:1}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .mat-mdc-button-persistent-ripple{top:11px;bottom:11px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .mat-mdc-button-persistent-ripple:before{opacity:.32}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:active .mat-mdc-button-persistent-ripple:before{opacity:.48}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:active .tb-add-mobile-label-container:after{opacity:.48}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container{display:inline-flex;padding:3px;vertical-align:sub;border-radius:6px;background:#fff}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container .mat-icon{margin:0}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container .tb-mobile-divider-label{line-height:12px;font-size:10px;font-weight:400;padding:0 6px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container:after{display:block;height:auto;content:"";position:absolute;inset:0;opacity:.32;border-radius:6px;border:1px solid #359B07;pointer-events:none}.tb-mobile-item-row-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.tb-mobile-item-row[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:row;align-items:center;padding:12px 12px 12px 0;background:#fff;gap:0;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-mobile-item-row[_ngcontent-%COMP%]   .tb-mobile-item-label[_ngcontent-%COMP%]{position:absolute;left:8px;top:-8px;padding-left:8px;padding-right:8px;background:#fff;font-size:12px;font-weight:400;line-height:16px;letter-spacing:.4px;color:#0000008a}']})}}return i})();var MP=["addMobileBundle"];function DP(i,m){i&1&&f(0,"mat-progress-bar",31)}function PP(i,m){i&1&&f(0,"div")}function FP(i,m){i&1&&(a(0,"mat-icon"),p(1,"check"),r())}function AP(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"mobile.basic-settings"))}function NP(i,m){i&1&&(a(0,"mat-error"),p(1),d(2,"translate"),r()),i&2&&(o(),h(" ",c(2,1,"mobile.title-required")," "))}function kP(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"admin.oauth2.oauth2"))}function RP(i,m){i&1&&(p(0),d(1,"translate")),i&2&&R(c(1,1,"mobile.layout"))}function OP(i,m){if(i&1){let e=O();a(0,"button",32),y("click",function(){x(e);let t=v();return I(t.backStep())}),p(1),d(2,"translate"),r()}i&2&&(o(),R(c(2,1,"action.back")))}var Pd=(()=>{class i extends et{constructor(e,n,t,s,u,_,E,w){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=s,this.breakpointObserver=u,this.fb=_,this.dialog=E,this.mobileAppService=w,this.entityType=B,this.selectedIndex=0,this.dialogTitle="mobile.edit-bundle",this.platformType=en,this.bundlesForms=this.fb.group({title:["",S.required],androidAppId:[null],iosAppId:[null],description:[""]}),this.oauthForms=this.fb.group({oauth2Enabled:[!0],oauth2ClientIds:[null]}),this.layoutForms=this.fb.group({layoutConfig:[null]}),this.isAdd=!1,this.data.isAdd&&(this.dialogTitle="mobile.add-bundle",this.isAdd=!0),this.stepperOrientation=this.breakpointObserver.observe(Ri["gt-xs"]).pipe(mt(({matches:q})=>q?"horizontal":"vertical")),this.oauthForms.get("oauth2Enabled").valueChanges.pipe(ai()).subscribe(q=>{q?this.oauthForms.get("oauth2ClientIds").enable({emitEvent:!1}):this.oauthForms.get("oauth2ClientIds").disable({emitEvent:!1})}),!this.data.isAdd&&this.data.bundle&&(this.bundlesForms.patchValue(this.data.bundle,{emitEvent:!1}),this.oauthForms.get("oauth2Enabled").setValue(this.data.bundle.oauth2Enabled,{onlySelf:!0}),this.oauthForms.get("oauth2ClientIds").setValue(Ue(this.data.bundle.oauth2ClientInfos.map(q=>q.id.id)),{emitEvent:!1}),this.layoutForms.patchValue(this.data.bundle,{emitEvent:!1}))}cancel(){this.dialogRef.close(null)}backStep(){this.addMobileBundle.previous()}nextStep(){this.selectedIndex>=this.maxStepperIndex?this.add():this.addMobileBundle.next()}nextStepLabel(){return this.selectedIndex>=this.maxStepperIndex?this.data.isAdd?"action.add":"action.save":"action.next"}changeStep(e){this.selectedIndex=e.selectedIndex,e.previouslySelectedIndex>e.selectedIndex&&(e.previouslySelectedStep.interacted=!1)}createApplication(e,n){this.dialog.open(zr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{platformType:n}}).afterClosed().subscribe(t=>{t&&(this.bundlesForms.get(e).patchValue(t.id),this.bundlesForms.get(e).markAsDirty())})}createClient(e){e&&(e.stopPropagation(),e.preventDefault()),this.dialog.open(lr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(n=>{if(n){let t=this.oauthForms.get("oauth2ClientIds").value?[...this.oauthForms.get("oauth2ClientIds").value]:[];t.push(n.id.id),this.oauthForms.get("oauth2ClientIds").patchValue(t),this.oauthForms.get("oauth2ClientIds").markAsDirty()}})}get maxStepperIndex(){return this.addMobileBundle?._steps?.length-1}add(){if(this.allValid()){let e={mobileBundle:this.mobileAppService.saveMobileAppBundle(this.mobileAppBundleFormValue,this.oauthForms.value.oauth2ClientIds),oath2Clients:null};if(this.data.isAdd)delete e.oath2Clients;else{let n=_e(_e({},this.data.bundle),this.mobileAppBundleFormValue);e.mobileBundle=this.mobileAppService.saveMobileAppBundle(n),e.oath2Clients=this.mobileAppService.updateOauth2Clients(n.id.id,this.oauthForms.get("oauth2ClientIds").value)}Gt(e).subscribe(n=>this.dialogRef.close(n.mobileBundle))}}allValid(){return!this.addMobileBundle.steps.find((e,n)=>e.stepControl?.invalid?(e.interacted=!0,this.addMobileBundle.selectedIndex=n,!0):!1)}get mobileAppBundleFormValue(){let e=to(this.bundlesForms.value);return e.layoutConfig=to(this.layoutForms.value.layoutConfig),e.oauth2Enabled=this.oauthForms.value.oauth2Enabled,e}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Ze),g(Mt),g(ho),g(ht),g(je),g(Gn))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-bundle-dialog"]],viewQuery:function(n,t){if(n&1&&be(MP,7),n&2){let s;ve(s=ye())&&(t.addMobileBundle=s.first)}},features:[G],decls:56,vars:42,consts:[["addMobileBundle",""],["color","primary"],[1,"flex-1"],["tb-help","mobileBundle"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"xs:!p-0"],["labelPosition","end",3,"selectionChange","linear","orientation"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[2,"margin-top","4px",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic"],["translate",""],["matInput","","required","","formControlName","title"],["allowCreateNew","","useFullEntityId","","appearance","outline","labelText","mobile.android-application","formControlName","androidAppId",3,"createNew","entityType","entitySubtype"],["allowCreateNew","","useFullEntityId","","appearance","outline","labelText","mobile.ios-application","formControlName","iosAppId",3,"createNew","entityType","entitySubtype"],["appearance","outline"],["matInput","","formControlName","description","rows","1"],[2,"margin-top","8px",3,"formGroup"],["formControlName","oauth2Enabled"],["formControlName","oauth2ClientIds","appearance","outline",3,"entityType","labelText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click","disabled"],[2,"white-space","nowrap"],[1,"layout-form",3,"formGroup"],["formControlName","layoutConfig"],["mat-dialog-actions",""],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["color","warn","mode","indeterminate"],["mat-stroked-button","",3,"click"]],template:function(n,t){if(n&1){let s=O();a(0,"mat-toolbar",1)(1,"h2"),p(2),d(3,"translate"),r(),f(4,"span",2)(5,"div",3),a(6,"button",4),y("click",function(){return x(s),I(t.cancel())}),a(7,"mat-icon",5),p(8,"close"),r()()(),b(9,DP,1,0,"mat-progress-bar",6),d(10,"async"),b(11,PP,1,0,"div",7),d(12,"async"),a(13,"div",8)(14,"mat-horizontal-stepper",9,0),d(16,"async"),y("selectionChange",function(_){return x(s),I(t.changeStep(_))}),b(17,FP,2,0,"ng-template",10),a(18,"mat-step",11),b(19,AP,2,3,"ng-template",12),a(20,"form",13)(21,"mat-form-field",14)(22,"mat-label",15),p(23,"mobile.title"),r(),f(24,"input",16)(25,"mat-hint"),b(26,NP,3,3,"mat-error",7),r(),a(27,"tb-entity-autocomplete",17),y("createNew",function(){return x(s),I(t.createApplication("androidAppId",t.platformType.ANDROID))}),r(),a(28,"tb-entity-autocomplete",18),y("createNew",function(){return x(s),I(t.createApplication("iosAppId",t.platformType.IOS))}),r(),a(29,"mat-form-field",19)(30,"mat-label",15),p(31,"mobile.description"),r(),f(32,"textarea",20),r()()(),a(33,"mat-step",11),b(34,kP,2,3,"ng-template",12),a(35,"form",21)(36,"mat-slide-toggle",22),p(37),d(38,"translate"),r(),a(39,"tb-entity-list",23),d(40,"translate"),d(41,"translate"),a(42,"button",24),y("click",function(_){return x(s),I(t.createClient(_))}),a(43,"span",25),p(44),d(45,"translate"),r()()()()(),a(46,"mat-step",11),b(47,RP,2,3,"ng-template",12),a(48,"form",26),f(49,"tb-mobile-layout",27),r()()()(),a(50,"div",28),b(51,OP,3,3,"button",29),f(52,"span",2),a(53,"button",30),y("click",function(){return x(s),I(t.nextStep())}),p(54),d(55,"translate"),r()()}n&2&&(o(2),R(c(3,24,t.dialogTitle)),o(7),l("ngIf",c(10,26,t.isLoading$)),o(2),l("ngIf",!c(12,28,t.isLoading$)),o(3),l("linear",t.isAdd)("orientation",c(16,30,t.stepperOrientation)),o(4),l("stepControl",t.bundlesForms),o(2),l("formGroup",t.bundlesForms),o(6),l("ngIf",t.bundlesForms.get("title").hasError("required")),o(),l("entityType",t.entityType.MOBILE_APP)("entitySubtype",t.platformType.ANDROID),o(),l("entityType",t.entityType.MOBILE_APP)("entitySubtype",t.platformType.IOS),o(5),l("stepControl",t.oauthForms),o(2),l("formGroup",t.oauthForms),o(2),h(" ",c(38,32,"mobile.enable-oauth")," "),o(2),T("labelText",c(40,34,"admin.oauth2.clients")),T("placeholderText",c(41,36,"admin.oauth2.add-client")),l("entityType",t.entityType.OAUTH2_CLIENT),o(3),l("disabled",t.oauthForms.get("oauth2ClientIds").disabled),o(2),R(c(45,38,"admin.oauth2.create-new")),o(2),l("stepControl",t.layoutForms),o(2),l("formGroup",t.layoutForms),o(3),l("ngIf",t.selectedIndex>0),o(3),R(c(55,40,t.nextStepLabel())))},dependencies:[V,Tt,Ba,So,K,Ce,ee,Oe,ge,me,Ie,zt,De,ei,He,Ct,Je,it,vn,hn,yn,bn,fe,ue,W,z,ce,X,oe,H,Dd,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:850px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content 4px minmax(auto,1fr) min-content;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   form.layout-form[_ngcontent-%COMP%]{display:block;height:100%;max-height:100%}[_nghost-%COMP%]     .mat-mdc-dialog-content{display:flex;flex-direction:column;height:100%;padding:0!important;color:#000000de}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal{display:flex;height:100%;overflow:hidden}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-stepper-wrapper{flex:1 1 100%;max-width:100%}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{height:700px;max-height:100%;width:100%;overflow-y:auto;scrollbar-gutter:stable}@media screen and (min-width: 960px){[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{min-width:500px}}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container .mat-horizontal-stepper-content:not(.mat-horizontal-stepper-content-inactive):nth-child(3){height:100%;max-height:100%;overflow:hidden}']})}}return i})();C();var Fd=(()=>{class i extends et{constructor(e,n,t,s){super(e,n,s),this.store=e,this.router=n,this.data=t,this.dialogRef=s,this.notShowAgain=!1,this.gitRepositoryLink="git clone -b master https://github.com/thingsboard/flutter_thingsboard_app.git",this.pathToConstants="lib/constants/app_constants.dart",this.flutterRunCommand="flutter run",this.configureApi=[],this.showDontShowAgain=this.data.afterAdd,this.configureApi.push(`static const thingsBoardApiEndpoint = '${window.location.origin}';`),this.configureApi.push(`static const thingsboardOAuth2AppSecret = '${this.data.appSecret}';`)}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new ha({notDisplayConfigurationAfterAddMobileBundle:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}createMarkDownCommand(e){if(Array.isArray(e)){let n=[];return e.forEach(t=>n.push(this.createMarkDownSingleCommand(t))),n.join(`
<br />

`)}else return this.createMarkDownSingleCommand(e)}createMarkDownSingleCommand(e){return"```bash\n"+e+"{:copy-code}\n```"}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(de),g(Mt),g(Ze))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-app-configuration-dialog"]],features:[G],decls:57,vars:22,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content","",1,"flex","flex-col","gap-4","xs:gap-2","gt-xs:max-h-[80vh]"],[1,"tb-form-panel","stroked"],["translate","",1,"tb-form-panel-title"],[1,"flex","gap-4"],["translate","",1,"flex-1"],["mat-stroked-button","","color","primary","href","https://docs.flutter.dev/get-started/install","target","_blank"],[1,"tb-mat-24"],["usePlainMarkdown","","containerClass","tb-command-code",3,"data"],[1,"flex","items-center","gap-4"],["mat-dialog-actions","",1,"tb-dialog-actions","gap-2"],[3,"ngModelChange","ngModel"],[1,"flex-1"],["mat-button","",3,"click","disabled"]],template:function(n,t){n&1&&(a(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.configuration-dialog"),r(),a(3,"button",2),y("click",function(){return t.close()}),a(4,"mat-icon",3),p(5,"close"),r()()(),a(6,"div",4)(7,"div",5)(8,"div",6),p(9,"mobile.configuration-step.prepare-environment-title"),r(),a(10,"div",7)(11,"div",8),p(12,"mobile.configuration-step.prepare-environment-text"),r(),a(13,"a",9)(14,"mat-icon",10),p(15,"description"),r(),p(16),d(17,"translate"),r()()(),a(18,"div",5)(19,"div",6),p(20,"mobile.configuration-step.get-source-code-title"),r(),a(21,"div",1),p(22,"mobile.configuration-step.get-source-code-text"),r(),f(23,"tb-markdown",11),r(),a(24,"div",5)(25,"div",6),p(26,"mobile.configuration-step.configure-api-title"),r(),a(27,"div",1),p(28,"mobile.configuration-step.configure-api-text"),r(),f(29,"tb-markdown",11),a(30,"div",1),p(31,"mobile.configuration-step.configure-api-hint"),r(),f(32,"tb-markdown",11),r(),a(33,"div",5)(34,"div",6),p(35,"mobile.configuration-step.run-app-title"),r(),a(36,"div",1),p(37,"mobile.configuration-step.run-app-text"),r(),f(38,"tb-markdown",11),r(),a(39,"div",5)(40,"div",12)(41,"div",8),p(42,"mobile.configuration-step.more-information"),r(),a(43,"a",9)(44,"mat-icon",10),p(45,"rocket_launch"),r(),p(46),d(47,"translate"),r()()()(),a(48,"div",13)(49,"mat-slide-toggle",14),pt("ngModelChange",function(u){return lt(t.notShowAgain,u)||(t.notShowAgain=u),u}),p(50),d(51,"translate"),r(),f(52,"span",15),a(53,"button",16),d(54,"async"),y("click",function(){return t.close()}),p(55),d(56,"translate"),r()()),n&2&&(o(16),h("",c(17,12,"common.documentation")," "),o(7),l("data",t.createMarkDownCommand(t.gitRepositoryLink)),o(6),l("data",t.createMarkDownCommand(t.pathToConstants)),o(3),l("data",t.createMarkDownCommand(t.configureApi)),o(6),l("data",t.createMarkDownCommand(t.flutterRunCommand)),o(8),h("",c(47,14,"mobile.configuration-step.getting-started")," "),o(3),L("!hidden",!t.showDontShowAgain),st("ngModel",t.notShowAgain),o(),R(c(51,16,"action.dont-show-again")),o(3),l("disabled",c(54,18,t.isLoading$)),o(2),R(c(56,20,"action.close")))},dependencies:[Ha,Sa,K,Ce,ee,He,Ct,Je,it,W,ut,H,le,k],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;width:870px;max-width:100%;grid-template-rows:min-content minmax(auto,1fr) min-content}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{padding:8px 16px 8px 24px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper{padding:0}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]{margin:0;font-size:14px;background:#f3f6fa;border-color:#359b07;padding-right:38px;overflow:scroll;padding-bottom:4px;min-height:42px;scrollbar-width:thin}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]::-webkit-scrollbar{width:4px;height:4px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn{right:-2px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p{color:#359b07}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#359b07;mask-image:url(/src/assets/copy-code-icon.svg);-webkit-mask-image:url(/src/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}']})}}return i})();var Qc=(()=>{class i{constructor(e,n,t,s,u){this.datePipe=e,this.mobileAppService=n,this.translate=t,this.dialog=s,this.store=u,this.config=new Qe,this.config.selectionEnabled=!1,this.config.entityType=B.MOBILE_APP_BUNDLE,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.detailsPanelEnabled=!1,this.config.entityTranslations=$e.get(B.MOBILE_APP_BUNDLE),this.config.entityResources=_t.get(B.MOBILE_APP_BUNDLE),this.config.headerComponent=xd,this.config.onEntityAction=_=>this.onBundleAction(_),this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:ni.DESC},this.config.columns.push(new Ke("createdTime","common.created-time",this.datePipe,"170px"),new te("title","mobile.title","25%"),new La("oauth2ClientInfos","mobile.oauth-clients","35%"),new La("androidPkg","mobile.android-app","20%"),new La("iosPkg","mobile.ios-app","20%"),new te("oauth2Enabled","mobile.enable-oauth","140px",_=>Ot(_.oauth2Enabled))),this.config.deleteEnabled=_=>!(_.iosAppId||_.androidAppId),this.config.deleteEntityTitle=_=>this.translate.instant("mobile.delete-applications-bundle-title",{bundleName:_.name}),this.config.deleteEntityContent=()=>this.translate.instant("mobile.delete-applications-bundle-text"),this.config.deleteEntity=_=>this.mobileAppService.deleteMobileAppBundle(_.id),this.config.entitiesFetchFunction=_=>this.mobileAppService.getTenantMobileAppBundleInfos(_).pipe(mt(E=>(E.data.map(w=>{w.androidPkgName&&(w.androidPkg={id:w.androidAppId,name:w.androidPkgName}),w.iosPkgName&&(w.iosPkg={id:w.iosAppId,name:w.iosPkgName})}),E))),this.config.handleRowClick=(_,E)=>(_?.stopPropagation(),this.mobileAppService.getMobileAppBundleInfoById(E.id.id).subscribe(w=>{this.editBundle(_,w)}),!0),this.config.cellActionDescriptors=this.configureCellActions()}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("mobile.configuration-app"),icon:"code",isEnabled:()=>!0,onAction:(e,n)=>this.configurationApp(e,n)}]}editBundle(e,n,t=!1){e&&e.stopPropagation(),this.dialog.open(Pd,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:t,bundle:n}}).afterClosed().subscribe(s=>{s&&(t?this.store.pipe(Ht(ba("notDisplayConfigurationAfterAddMobileBundle"))).pipe(gi(1)).subscribe(u=>{u?this.config.updateData():this.configurationApp(null,s,!0)}):this.config.updateData())})}onBundleAction(e){switch(e.action){case"add":return this.editBundle(e.event,e.entity,!0),!0}return!1}configurationApp(e,n,t=!1){e&&e.stopPropagation();let s={androidApp:n.androidAppId?this.mobileAppService.getMobileAppInfoById(n.androidAppId.id):ot(null),iosApp:n.iosAppId?this.mobileAppService.getMobileAppInfoById(n.iosAppId.id):ot(null)};Gt(s).subscribe(u=>{this.dialog.open(Fd,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{afterAdd:t,appSecret:u.androidApp?.appSecret||u.iosApp?.appSecret}}).afterClosed().subscribe(()=>{t&&this.config.updateData()})})}static{this.\u0275fac=function(n){return new(n||i)(N(Ge),N(Gn),N(ie),N(je),N(P))}}static{this.\u0275prov=Ae({token:i,factory:i.\u0275fac})}}return i})();var Uh=[{path:"bundles",component:qe,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"mobile.bundles",breadcrumb:{menuId:xe.mobile_bundles}},resolve:{entitiesTableConfig:Qc}}],Jc=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({providers:[Qc]})}}return i})();C();C();var BP=()=>["flex"];function VP(i,m){i&1&&f(0,"mat-progress-bar",23)}function LP(i,m){i&1&&f(0,"div",24)}function jP(i,m){if(i&1&&(a(0,"div",25)(1,"div",26),p(2),d(3,"translate"),r(),f(4,"tb-entity-autocomplete",27),r()),i&2){let e=v();o(2),R(c(3,3,"mobile.bundle")),o(2),l("additionalClasses",Rt(5,BP))("entityType",e.entityType.MOBILE_APP_BUNDLE)}}function GP(i,m){if(i&1&&(a(0,"mat-option",12),p(1),d(2,"translate"),r()),i&2){let e=m.$implicit;l("value",e.key),o(),h(" ",c(2,2,e.value)," ")}}function UP(i,m){if(i&1){let e=O();a(0,"div",28)(1,"div",29)(2,"mat-slide-toggle",30),y("click",function(t){return x(e),I(t.stopPropagation())}),p(3),d(4,"translate"),r(),a(5,"mat-form-field",31)(6,"mat-select",32),b(7,GP,3,4,"mat-option",33),d(8,"keyvalue"),r()()()()}if(i&2){let e=v();o(3),h(" ",c(4,2,"admin.mobile-app.badges")," "),o(4),l("ngForOf",c(8,4,e.badgePositionTranslationsMap))}}function qP(i,m){if(i&1&&(a(0,"mat-icon",37),d(1,"translate"),p(2," warning "),r()),i&2){let e=v(2);l("matTooltip",c(1,1,e.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("required")?"admin.mobile-app.label-required":"admin.mobile-app.label-max-length"))}}function WP(i,m){if(i&1){let e=O();a(0,"div",28)(1,"div",29)(2,"mat-slide-toggle",34),y("click",function(t){return x(e),I(t.stopPropagation())}),p(3),d(4,"translate"),r(),a(5,"mat-form-field",31),f(6,"input",35),d(7,"translate"),b(8,qP,3,3,"mat-icon",36),r()()()}if(i&2){let e=v();o(3),h(" ",c(4,3,"admin.mobile-app.label")," "),o(3),T("placeholder",c(7,5,"admin.mobile-app.set")),o(2),l("ngIf",!e.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").untouched&&e.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("required")||e.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("maxlength"))}}function HP(i,m){if(i&1&&(a(0,"div",38)(1,"div",10),p(2,"admin.mobile-app.preview"),r(),f(3,"tb-mobile-app-qrcode-widget",39),r()),i&2){let e=v();o(3),l("mobileAppSettings",e.mobileAppSettingsForm.getRawValue())}}var Ad=(()=>{class i extends It{constructor(e,n,t){super(e),this.store=e,this.mobileAppService=n,this.fb=t,this.badgePositionTranslationsMap=gg,this.entityType=B,this.mobileAppSettingsForm=this.fb.group({useDefaultApp:[!0],mobileAppBundleId:[{value:null,disabled:!0},S.required],androidEnabled:[!0],iosEnabled:[!0],qrCodeConfig:this.fb.group({showOnHomePage:[!0],badgeEnabled:[!0],badgePosition:[fg.RIGHT],qrCodeLabelEnabled:[!0],qrCodeLabel:["",[S.required,S.maxLength(50)]]})}),this.mobileAppService.getMobileAppSettings().subscribe(s=>this.processMobileAppSettings(s)),this.mobileAppSettingsForm.get("useDefaultApp").valueChanges.pipe(ai()).subscribe(s=>{s?this.mobileAppSettingsForm.get("mobileAppBundleId").disable({emitEvent:!1}):this.mobileAppSettingsForm.get("mobileAppBundleId").enable({emitEvent:!1})}),this.mobileAppSettingsForm.get("androidEnabled").valueChanges.pipe(ai()).subscribe(()=>{this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("iosEnabled").valueChanges.pipe(ai()).subscribe(()=>{this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").valueChanges.pipe(ai()).subscribe(s=>{s?this.mobileAppSettingsForm.get("qrCodeConfig").enable({emitEvent:!1}):(this.mobileAppSettingsForm.get("qrCodeConfig").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").enable({emitEvent:!1})),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0}),this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabelEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").valueChanges.pipe(ai()).subscribe(s=>{if(s){let u=this.mobileAppSettingsForm.getRawValue();u.androidEnabled||u.iosEnabled?(this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").enable({emitEvent:!1})):(this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").disable({emitEvent:!1}))}else this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").disable({emitEvent:!1})}),this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabelEnabled").valueChanges.pipe(ai()).subscribe(s=>{s&&this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value?this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").enable({emitEvent:!1}):this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").disable({emitEvent:!1})})}processMobileAppSettings(e){this.mobileAppSettings=_e({},e),this.mobileAppSettingsForm.reset(this.mobileAppSettings)}save(){let e=this.mobileAppSettings.qrCodeConfig.showOnHomePage;this.mobileAppSettings=_e(_e({},this.mobileAppSettings),this.mobileAppSettingsForm.getRawValue()),this.mobileAppService.saveMobileAppSettings(this.mobileAppSettings).subscribe(n=>{let t=n.qrCodeConfig.showOnHomePage;e!==t&&this.store.dispatch(new yu({mobileQrEnabled:t})),this.processMobileAppSettings(n)})}confirmForm(){return this.mobileAppSettingsForm}static{this.\u0275fac=function(n){return new(n||i)(g(P),g(bg),g(ht))}}static{this.\u0275cmp=D({type:i,selectors:[["tb-mobile-qr-code-widget"]],features:[G],decls:51,vars:39,consts:[["appearance","outlined",1,"settings-card"],[1,"items-center"],["translate","",1,"mat-headline-5"],["tb-help","mobileQrCode"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[1,"tb-form-panel","no-border","no-padding",3,"formGroup"],[1,"tb-form-panel"],[1,"tb-form-row","column-xs","no-border","no-padding","space-between"],["translate","",1,"tb-form-panel-title"],["formControlName","useDefaultApp"],[3,"value"],["class","tb-form-row column-xs",4,"ngIf"],[1,"tb-form-row","stroked","no-padding-bottom"],["formControlName","androidEnabled",1,"mat-slide",3,"click"],["formControlName","iosEnabled",1,"mat-slide",3,"click"],["formGroupName","qrCodeConfig",1,"tb-form-panel"],["formControlName","showOnHomePage"],["class","tb-form-panel stroked no-padding no-gap",4,"ngIf"],["class","tb-form-panel tb-qrcode-preview",4,"ngIf"],[1,"tb-flex","row","flex-end",2,"margin-top","16px"],["mat-button","","mat-raised-button","","color","primary",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"tb-form-row","column-xs"],[1,"fixed-title-width-230"],["useFullEntityId","","appearance","outline","subscriptSizing","dynamic","formControlName","mobileAppBundleId",1,"flex-1",3,"additionalClasses","entityType"],[1,"tb-form-panel","stroked","no-padding","no-gap"],[1,"tb-form-row","space-between","no-border","no-padding-bottom","column-xs"],["formControlName","badgeEnabled",1,"mat-slide","fixed-title-width-230",3,"click"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["formControlName","badgePosition"],[3,"value",4,"ngFor","ngForOf"],["formControlName","qrCodeLabelEnabled",1,"mat-slide","fixed-title-width-230",3,"click"],["matInput","","formControlName","qrCodeLabel",3,"placeholder"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],[1,"tb-form-panel","tb-qrcode-preview"],[3,"mobileAppSettings"]],template:function(n,t){n&1&&(a(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title")(3,"span",2),p(4,"admin.mobile-app.mobile-app-qr-code-widget-settings"),r()(),f(5,"div",3),r(),b(6,VP,1,0,"mat-progress-bar",4),d(7,"async"),b(8,LP,1,0,"div",5),d(9,"async"),a(10,"mat-card-content",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),p(15,"admin.mobile-app.applications"),r(),a(16,"tb-toggle-select",11)(17,"tb-toggle-option",12),p(18),d(19,"translate"),r(),a(20,"tb-toggle-option",12),p(21),d(22,"translate"),r()()(),b(23,jP,5,6,"div",13),a(24,"div",14)(25,"mat-slide-toggle",15),y("click",function(u){return u.stopPropagation()}),p(26),d(27,"translate"),r()(),a(28,"div",14)(29,"mat-slide-toggle",16),y("click",function(u){return u.stopPropagation()}),p(30),d(31,"translate"),r()()(),a(32,"div",17)(33,"div",9)(34,"div",10),p(35,"admin.mobile-app.appearance-on-home-page"),r(),a(36,"tb-toggle-select",18)(37,"tb-toggle-option",12),p(38),d(39,"translate"),r(),a(40,"tb-toggle-option",12),p(41),d(42,"translate"),r()()(),b(43,UP,9,6,"div",19)(44,WP,9,7,"div",19)(45,HP,4,1,"div",20),r()(),a(46,"div",21)(47,"button",22),d(48,"async"),y("click",function(){return t.save()}),p(49),d(50,"translate"),r()()()()),n&2&&(o(6),l("ngIf",c(7,19,t.isLoading$)),o(2),l("ngIf",!c(9,21,t.isLoading$)),o(3),l("formGroup",t.mobileAppSettingsForm),o(6),l("value",!0),o(),R(c(19,23,"admin.mobile-app.default")),o(2),l("value",!1),o(),R(c(22,25,"admin.mobile-app.custom")),o(2),l("ngIf",!t.mobileAppSettingsForm.get("useDefaultApp").value),o(3),h(" ",c(27,27,"admin.mobile-app.android")," "),o(4),h(" ",c(31,29,"admin.mobile-app.ios")," "),o(7),l("value",!0),o(),R(c(39,31,"admin.mobile-app.enabled")),o(2),l("value",!1),o(),R(c(42,33,"admin.mobile-app.disabled")),o(2),l("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),o(),l("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),o(),l("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),o(2),l("disabled",c(48,35,t.isLoading$)||t.mobileAppSettingsForm.invalid||!t.mobileAppSettingsForm.dirty),o(2),h(" ",c(50,37,"action.save")," "))},dependencies:[we,V,Tt,Ba,K,ee,ti,pi,yi,vi,Oe,ge,me,ei,St,ct,Dt,it,ue,W,z,X,oe,ft,H,qn,Wn,vg,le,ts,k],styles:['@charset "UTF-8";.tb-qrcode-preview[_ngcontent-%COMP%]{background-color:#0000000a;box-shadow:none}.tb-qrcode-preview[_ngcontent-%COMP%]   .tb-form-panel-title[_ngcontent-%COMP%]{color:#00000061}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();var qh=[{path:"qr-code-widget",component:Ad,canDeactivate:[Fe],data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],title:"mobile.qr-code-widget",breadcrumb:{menuId:xe.mobile_qr_code_widget}}}],zP=[{path:"settings/mobile-app",pathMatch:"full",redirectTo:"/mobile-center/qr-code-widget"}],Nd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild(zP),j]})}}return i})();(function(){Y(Nd,{imports:[j],exports:[j]})})();var $P=[{path:"mobile-center",component:Tn,data:{auth:[M.TENANT_ADMIN,M.SYS_ADMIN],breadcrumb:{menuId:xe.mobile_center}},children:[{path:"",children:[],data:{auth:[M.TENANT_ADMIN,M.CUSTOMER_USER,M.SYS_ADMIN],redirectTo:"/mobile-center/bundles"}},...jh,...Uh,...qh]}],kd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[j.forChild($P),j]})}}return i})();(function(){Y(kd,{imports:[j],exports:[j]})})();C();C();var Rd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re]})}}return i})();(function(){Y(Rd,{declarations:[Hr],imports:[ae,re],exports:[Hr]})})();var Od=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Rd,Td]})}}return i})();(function(){Y(Od,{declarations:[hr,yd,zr,Cd],imports:[ae,re,Ee,Rd,Td],exports:[zr]})})();C();var Bd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Jc]})}}return i})();(function(){Y(Bd,{declarations:[xd,Pd,Dd,Md,Id,br,Ed,wd,Fd],imports:[ae,re,Ee,Jc]})})();C();var Vd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,cc,Nd]})}}return i})();(function(){Y(Vd,{declarations:[Ad],imports:[ae,re,Ee,cc,Nd]})})();var Ld=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[ae,re,Ee,Od,Bd,Vd,kd]})}}return i})();(function(){Y(Ld,{imports:[ae,re,Ee,Od,Bd,Vd,kd]})})();var QP=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=J({type:i})}static{this.\u0275inj=Q({imports:[sp,mp,fp,Cp,Pm,Dp,Nm,zm,Qm,Zm,td,Ld,ud,lm,mm,Km,Bm,gm,nm,xm,Im,Em,om,Rm,vd,Gm,rm,qm,gd,bd]})}}return i})();(function(){Y(QP,{exports:[sp,mp,fp,Cp,Pm,Dp,Nm,zm,Qm,Zm,td,Ld,ud,lm,mm,Km,Bm,gm,nm,xm,Im,Em,om,Rm,vd,Gm,rm,qm,gd,bd]})})();export{QP as HomePagesModule};
