import{r as H}from"./chunk-IOY2JS2Z.js";import{K as j,Ub as m,Xb as V,Yb as k}from"./chunk-7ONBG64W.js";import{D as N,I as K,La as M,O as R,na as T,pa as A,qa as I,ra as L}from"./chunk-TV2KLZD5.js";import{Ba as z,Ca as F,Ka as f,i as W,x as p}from"./chunk-FSPAMUWJ.js";import{a as u,b as y,j as c}from"./chunk-NZGOIL2E.js";c();c();var O=function(e){return e.SHOW_NOTIFICATION="[Notification] Show",e.HIDE_NOTIFICATION="[Notification] Hide",e}(O||{}),g=class{constructor(t){this.notification=t,this.type=O.SHOW_NOTIFICATION}},b=class{constructor(t){this.hideNotification=t,this.type=O.HIDE_NOTIFICATION}};c();c();var d=function(e){return e.ASC="ASC",e.DESC="DESC",e}(d||{});function Z(e){let t,s=d.ASC;return e.startsWith("-")?(s=d.DESC,t=e.substring(1)):e.startsWith("+")?t=e.substring(1):t=e,{property:t,direction:s}}c();function $(){return{data:[],totalPages:0,totalElements:0,hasNext:!1}}var at=2147483647;function _(e){return(t,s)=>Y(t,s,e)}var Y=(e,t,s)=>{if(t===null||!t.length)return!0;let r=(""+t).toLowerCase();if(s&&s.length){if(Object.prototype.hasOwnProperty.call(e,s)){let i=e[s];if(i!==null&&i!==Object(i)&&(""+i).toLowerCase().indexOf(r)!==-1)return!0}}else for(let i of Object.keys(e)){let a=e[i];if(a!==null){if(a!==Object(a)){if((""+a).toLowerCase().indexOf(r)!==-1)return!0}else if(K(a)&&Y(a,t))return!0}}return!1};function q(e,t,s,r){let i=T(e,s),a=T(t,s),o=0;if(i!==a){let n=typeof i,l=typeof a;n==="number"&&l==="number"?o=i-a:n==="string"&&l==="string"?o=i.localeCompare(a):(n==="boolean"&&l==="boolean"||n!==l)&&(i&&!a?o=1:!i&&a&&(o=-1))}return r?o:o*-1}var h=class e{constructor(t,s=0,r=null,i=null){this.textSearch=r,this.pageSize=t,this.page=s,this.sortOrder=i}nextPageLink(){return new e(this.pageSize,this.page+1,this.textSearch,this.sortOrder)}toQuery(){let t=`?pageSize=${this.pageSize}&page=${this.page}`,s=this.textSearch?.trim();if(s?.length){let r=encodeURIComponent(s);t+=`&textSearch=${r}`}return this.sortOrder&&(t+=`&sortProperty=${this.sortOrder.property}&sortOrder=${this.sortOrder.direction}`),t}sort(t,s){if(this.sortOrder){let r=this.sortOrder.property,i=this.sortOrder.direction===d.ASC;return q(t,s,r,i)}return 0}filterData(t,s=_()){let r=$();if(r.data=[...t],this.textSearch&&this.textSearch.length&&(r.data=r.data.filter(i=>s(i,this.textSearch))),r.totalElements=r.data.length,r.totalPages=this.pageSize===Number.POSITIVE_INFINITY?1:Math.ceil(r.totalElements/this.pageSize),this.sortOrder){let i=this.sortOrder.property,a=this.sortOrder.direction===d.ASC;r.data=r.data.sort((o,n)=>q(o,n,i,a))}if(this.pageSize!==Number.POSITIVE_INFINITY){let i=this.pageSize*this.page;r.data=r.data.slice(i,i+this.pageSize),r.hasNext=r.totalElements>i+r.data.length}return r}sortDirection(){return this.sortOrder?(this.sortOrder.direction+"").toLowerCase():""}},C=class e extends h{constructor(t,s=0,r=null,i=null,a=null,o=null){super(t,s,r,i),this.startTime=a,this.endTime=o}nextPageLink(){return new e(this.pageSize,this.page+1,this.textSearch,this.sortOrder,this.startTime,this.endTime)}toQuery(){let t=super.toQuery();return this.startTime&&(t+=`&startTime=${this.startTime}`),this.endTime&&(t+=`&endTime=${this.endTime}`),t}};var X=class{constructor(t,s,r,i,a){this.dashboard=t,this.dashboardWidget=s,this.widget=r,this.parentDashboard=i,this.popoverComponent=a,this.inited=!1,this.destroyed=!1,this.subscriptions={},this.defaultSubscription=null,this.labelPatterns=new Map,this.timewindowFunctions={onUpdateTimewindow:(o,n,l)=>{this.defaultSubscription&&this.defaultSubscription.onUpdateTimewindow(o,n,l)},onResetTimewindow:()=>{this.defaultSubscription&&this.defaultSubscription.onResetTimewindow()}},this.controlApi={sendOneWayCommand:(o,n,l,x,D,v,P)=>this.defaultSubscription?this.defaultSubscription.sendOneWayCommand(o,n,l,x,D,v,P):p(null),sendTwoWayCommand:(o,n,l,x,D,v,P)=>this.defaultSubscription?this.defaultSubscription.sendTwoWayCommand(o,n,l,x,D,v,P):p(null),completedCommand:()=>this.defaultSubscription?this.defaultSubscription.completedCommand():p(null)},this.utils={formatValue:R,getEntityDetailsPageURL:M},this.hideTitlePanel=!1,this.popoverComponents=[],this.rxjs=u(u({},z),F)}get stateController(){return this.parentDashboard?this.parentDashboard.stateController:this.dashboard.stateController}get aliasController(){return this.dashboard.aliasController}get dashboardTimewindow(){return this.dashboard.dashboardTimewindow}get widgetConfig(){return this.widget.config}get settings(){return this.widget.config.settings}get units(){return this.widget.config.units||""}get decimals(){return N(this.widget.config.decimals)?this.widget.config.decimals:2}set changeDetector(t){this.changeDetectorValue=t}set containerChangeDetector(t){this.containerChangeDetectorValue=t}get currentUser(){return this.store?H(this.store):null}get dashboardPageElement(){return this.dashboard?.stateController?.dashboardCtrl?.elRef?.nativeElement}get dashboardContentElement(){return this.dashboard?.stateController?.dashboardCtrl?.dashboardContent?.nativeElement}registerPopoverComponent(t){this.popoverComponents.push(t),t.tbDestroy.subscribe(()=>{let s=this.popoverComponents.indexOf(t,0);s>-1&&this.popoverComponents.splice(s,1)})}updatePopoverPositions(){this.popoverComponents.forEach(t=>{t.updatePosition()})}setPopoversHidden(t){this.popoverComponents.forEach(s=>{s.tbHidden=t})}registerLabelPattern(t,s){let r=s?this.labelPatterns.get(s):null;return r?r.setupPattern(t):(r=new w(t,this),this.labelPatterns.set(r.label$,r)),r.label$}updateLabelPatterns(){for(let t of this.labelPatterns.values())t.update()}showSuccessToast(t,s=1e3,r="bottom",i="left",a="dashboardRoot",o=!1){this.showToast("success",t,s,r,i,a,o)}showInfoToast(t,s="bottom",r="left",i="dashboardRoot",a=!1){this.showToast("info",t,void 0,s,r,i,a)}showWarnToast(t,s="bottom",r="left",i="dashboardRoot",a=!1){this.showToast("warn",t,void 0,s,r,i,a)}showErrorToast(t,s="bottom",r="left",i="dashboardRoot",a=!1){this.showToast("error",t,void 0,s,r,i,a)}showToast(t,s,r,i="bottom",a="left",o="dashboardRoot",n=!1){this.store.dispatch(new g({message:s,type:t,duration:r,verticalPosition:i,horizontalPosition:a,target:o,panelClass:this.widgetNamespace,forceDismiss:!0,modern:n}))}hideToast(t){this.store.dispatch(new b({target:t}))}detectChanges(t=!1){if(!this.destroyed){t&&this.dashboardWidget.updateWidgetParams();try{this.ngZone?this.ngZone.run(()=>{this.changeDetectorValue?.detectChanges()}):this.changeDetectorValue?.detectChanges()}catch{}}}detectContainerChanges(){if(!this.destroyed)try{this.ngZone?this.ngZone.run(()=>{this.containerChangeDetectorValue?.detectChanges()}):this.containerChangeDetectorValue?.detectChanges()}catch{}}updateWidgetParams(){this.destroyed||setTimeout(()=>{this.dashboardWidget.updateWidgetParams()},0)}updateAliases(t){this.aliasController.updateAliases(t)}reset(){this.destroyed=!1,this.hideTitlePanel=!1,this.widgetTitle=void 0,this.widgetActions=void 0}destroy(){for(let t of this.labelPatterns.values())t.destroy();this.labelPatterns.clear(),this.width=void 0,this.height=void 0,this.destroyed=!0}closeDialog(t=null){let s=this.$scope.dialogRef||this.stateController.dashboardCtrl.dashboardCtx.getDashboard().dialogRef;s&&s.close(t)}pageLink(t,s=0,r=null,i=null){return new h(t,s,r,i)}timePageLink(t,s,r,i=0,a=null,o=null){return new C(r,i,a,o,t,s)}alarmQuery(t,s,r,i,a,o){return new j(t,s,r,i,a,o)}},w=class{constructor(t,s){this.ctx=s,this.labelSubject=new W(""),this.label$=this.labelSubject.asObservable(),this.setupPattern(t)}setupPattern(t){this.pattern=this.ctx.dashboard.utils.customTranslation(t,t),this.hasVariables=L(this.pattern),this.update()}update(){let t=this.pattern;if(this.hasVariables)if(this.ctx.defaultSubscription?.type===m.rpc){let s=this.ctx.defaultSubscription.getFirstEntityInfo();t=I(s,t)}else{let s=this.ctx.defaultSubscription?.firstDatasource;t=A(s,t)}this.labelSubject.value!==t&&this.labelSubject.next(t)}destroy(){this.labelSubject.complete()}},gt=new f("widgetContext"),bt=new f("errorMessages"),St=new f("widgetTitlePanel"),Ct={type:m.latest,widgetName:"Widget type not found",fullFqn:"undefined",deprecated:!1,scada:!1,sizeX:8,sizeY:6,resources:[],templateHtml:`<div class="tb-widget-error-container"><div class="tb-widget-error-msg" innerHTML="{{'widget.widget-type-not-found' | translate }}"></div></div>`,templateCss:"",controllerScript:"self.onInit = function() {}",settingsSchema:`{}
`,dataKeySettingsSchema:`{}
`,image:null,description:null,defaultConfig:`{
"title": "Widget type not found",
"datasources": [],
"settings": {}
}
`,typeParameters:{}},xt={type:m.latest,widgetName:"Error loading widget",fullFqn:"error",deprecated:!1,scada:!1,sizeX:8,sizeY:6,resources:[],templateHtml:'<div class="tb-widget-error-container"><div translate class="tb-widget-error-msg">widget.widget-type-load-error</div><div *ngFor="let error of errorMessages" class="tb-widget-error-msg">{{ error }}</div></div>',templateCss:"",controllerScript:"self.onInit = function() {}",settingsSchema:`{}
`,dataKeySettingsSchema:`{}
`,image:null,description:null,defaultConfig:`{
"title": "Widget failed to load",
"datasources": [],
"settings": {}
}
`,typeParameters:{}},U=e=>({widgetName:e.name,fullFqn:V(e),deprecated:e.deprecated,scada:e.scada,type:e.descriptor.type,sizeX:e.descriptor.sizeX,sizeY:e.descriptor.sizeY,resources:e.descriptor.resources,templateHtml:e.descriptor.templateHtml,templateCss:e.descriptor.templateCss,controllerScript:e.descriptor.controllerScript,settingsSchema:e.descriptor.settingsSchema,dataKeySettingsSchema:e.descriptor.dataKeySettingsSchema,latestDataKeySettingsSchema:e.descriptor.latestDataKeySettingsSchema,settingsDirective:e.descriptor.settingsDirective,dataKeySettingsDirective:e.descriptor.dataKeySettingsDirective,latestDataKeySettingsDirective:e.descriptor.latestDataKeySettingsDirective,hasBasicMode:e.descriptor.hasBasicMode,basicModeDirective:e.descriptor.basicModeDirective,defaultConfig:e.descriptor.defaultConfig}),Dt=e=>{let t=U(e);return t.image=e.image,t.description=e.description,t.tags=e.tags,t},B=(e,t,s,r,i)=>{let a={type:e.type,sizeX:e.sizeX,sizeY:e.sizeY,resources:e.resources,templateHtml:e.templateHtml,templateCss:e.templateCss,controllerScript:e.controllerScript,settingsSchema:e.settingsSchema,dataKeySettingsSchema:e.dataKeySettingsSchema,latestDataKeySettingsSchema:e.latestDataKeySettingsSchema,settingsDirective:e.settingsDirective,dataKeySettingsDirective:e.dataKeySettingsDirective,latestDataKeySettingsDirective:e.latestDataKeySettingsDirective,hasBasicMode:e.hasBasicMode,basicModeDirective:e.basicModeDirective,defaultConfig:e.defaultConfig};return{id:t,tenantId:s,createdTime:r,version:i,fqn:k(e.fullFqn),name:e.widgetName,deprecated:e.deprecated,scada:e.scada,descriptor:a}},vt=(e,t,s,r,i)=>{let a=B(e,t,s,r,i);return y(u({},a),{description:e.description,tags:e.tags,image:e.image})},Pt=(e,t,s,r,i)=>{if(s){let a;t&&t.length?(a=e[t],a||(a={},e[t]=a,e.targetEntityParamName=t)):a=e,a.entityId=s,r&&(a.entityName=r),i&&(a.entityLabel=i)}};export{O as a,g as b,b as c,d,Z as e,$ as f,at as g,_ as h,q as i,h as j,C as k,X as l,gt as m,bt as n,St as o,Ct as p,xt as q,U as r,Dt as s,B as t,vt as u,Pt as v};
